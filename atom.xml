<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yiye Li</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-07-02T14:34:12.504Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Yiye Li</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</title>
    <link href="http://yoursite.com/2020/07/03/238.%20%E9%99%A4%E8%87%AA%E8%BA%AB%E4%BB%A5%E5%A4%96%E6%95%B0%E7%BB%84%E7%9A%84%E4%B9%98%E7%A7%AF/"/>
    <id>http://yoursite.com/2020/07/03/238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯/</id>
    <published>2020-07-03T14:52:12.000Z</published>
    <updated>2020-07-02T14:34:12.504Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­ n &gt; 1ï¼Œè¿”å›è¾“å‡ºæ•°ç»„ output ï¼Œå…¶ä¸­ output[i] ç­‰äº nums ä¸­é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚</p><a id="more"></a><p>ç¤ºä¾‹:</p><pre><code>è¾“å…¥: [1,2,3,4]è¾“å‡º: [24,12,8,6]æç¤ºï¼šé¢˜ç›®æ•°æ®ä¿è¯æ•°ç»„ä¹‹ä¸­ä»»æ„å…ƒç´ çš„å…¨éƒ¨å‰ç¼€å…ƒç´ å’Œåç¼€ï¼ˆç”šè‡³æ˜¯æ•´ä¸ªæ•°ç»„ï¼‰çš„ä¹˜ç§¯éƒ½åœ¨ 32 ä½æ•´æ•°èŒƒå›´å†…ã€‚è¯´æ˜: è¯·ä¸è¦ä½¿ç”¨é™¤æ³•ï¼Œä¸”åœ¨ O(n) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚</code></pre><p>è¿›é˜¶ï¼š</p><p>ä½ å¯ä»¥åœ¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸ªé¢˜ç›®å—ï¼Ÿï¼ˆ å‡ºäºå¯¹ç©ºé—´å¤æ‚åº¦åˆ†æçš„ç›®çš„ï¼Œè¾“å‡ºæ•°ç»„ä¸è¢«è§†ä¸ºé¢å¤–ç©ºé—´ã€‚ï¼‰</p><h3 id="ğŸ“ºè§†é¢‘é¢˜è§£"><a href="#ğŸ“ºè§†é¢‘é¢˜è§£" class="headerlink" title="ğŸ“ºè§†é¢‘é¢˜è§£"></a>ğŸ“ºè§†é¢‘é¢˜è§£</h3><p> <a href="5f8f385b-1288-4c91-8a65-e7490a96764c">238.é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯.mp4</a></p><h3 id="ğŸ“–æ–‡å­—é¢˜è§£"><a href="#ğŸ“–æ–‡å­—é¢˜è§£" class="headerlink" title="ğŸ“–æ–‡å­—é¢˜è§£"></a>ğŸ“–æ–‡å­—é¢˜è§£</h3><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å’Œç©ºé—´å†…è§£å†³ã€‚å…ˆè®¡ç®—ç»™å®šæ•°ç»„æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ï¼Œç„¶åå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  <em>x</em>ï¼Œå°†æ€»çš„ä¹˜ç§¯é™¤ä»¥ <em>x</em> æ¥æ±‚å¾—é™¤è‡ªèº«å€¼çš„ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ã€‚</p><p>ç„¶è€Œè¿™æ ·çš„è§£å†³æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœè¾“å…¥æ•°ç»„ä¸­å‡ºç° 0ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¤±æ•ˆäº†ã€‚è€Œä¸”åœ¨é—®é¢˜ä¸­è¯´æ˜äº†ä¸å…è®¸ä½¿ç”¨é™¤æ³•è¿ç®—ã€‚è¿™å¢åŠ äº†è¿™ä¸ªé—®é¢˜çš„éš¾åº¦ã€‚</p><h4 id="æ–¹æ³•ä¸€ï¼šå·¦å³ä¹˜ç§¯åˆ—è¡¨"><a href="#æ–¹æ³•ä¸€ï¼šå·¦å³ä¹˜ç§¯åˆ—è¡¨" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå·¦å³ä¹˜ç§¯åˆ—è¡¨"></a>æ–¹æ³•ä¸€ï¼šå·¦å³ä¹˜ç§¯åˆ—è¡¨</h4><p><strong>æ€è·¯</strong></p><p>æˆ‘ä»¬ä¸å¿…å°†æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯é™¤ä»¥ç»™å®šç´¢å¼•å¤„çš„æ•°å­—å¾—åˆ°ç›¸åº”çš„ç­”æ¡ˆï¼Œè€Œæ˜¯åˆ©ç”¨ç´¢å¼•å·¦ä¾§æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯å’Œå³ä¾§æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ï¼ˆå³å‰ç¼€ä¸åç¼€ï¼‰ç›¸ä¹˜å¾—åˆ°ç­”æ¡ˆã€‚</p><p>å¯¹äºç»™å®šç´¢å¼• <em>i</em>ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒå·¦è¾¹æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ä¹˜ä»¥å³è¾¹æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ›´åŠ å…·ä½“çš„æè¿°è¿™ä¸ªç®—æ³•ã€‚</p><p><strong>ç®—æ³•</strong></p><ol><li>åˆå§‹åŒ–ä¸¤ä¸ªç©ºæ•°ç»„ <code>L</code> å’Œ <code>R</code>ã€‚å¯¹äºç»™å®šç´¢å¼• <code>i</code>ï¼Œ<code>L[i]</code> ä»£è¡¨çš„æ˜¯ <code>i</code> å·¦ä¾§æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ï¼Œ<code>R[i]</code> ä»£è¡¨çš„æ˜¯ <code>i</code> å³ä¾§æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ã€‚</li><li>æˆ‘ä»¬éœ€è¦ç”¨ä¸¤ä¸ªå¾ªç¯æ¥å¡«å…… <code>L</code> å’Œ <code>R</code> æ•°ç»„çš„å€¼ã€‚å¯¹äºæ•°ç»„ <code>L</code>ï¼Œ<code>L[0]</code> åº”è¯¥æ˜¯ <code>1</code>ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ çš„å·¦è¾¹æ²¡æœ‰å…ƒç´ ã€‚å¯¹äºå…¶ä»–å…ƒç´ ï¼š<code>L[i] = L[i-1] * nums[i-1]</code>ã€‚</li><li>åŒç†ï¼Œå¯¹äºæ•°ç»„ <code>R</code>ï¼Œ<code>R[length-1]</code> åº”ä¸º <code>1</code>ã€‚<code>length</code> æŒ‡çš„æ˜¯è¾“å…¥æ•°ç»„çš„å¤§å°ã€‚å…¶ä»–å…ƒç´ ï¼š<code>R[i] = R[i+1] * nums[i+1]</code>ã€‚</li><li>å½“ <code>R</code> å’Œ <code>L</code> æ•°ç»„å¡«å……å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¾“å…¥æ•°ç»„ä¸Šè¿­ä»£ï¼Œä¸”ç´¢å¼• <code>i</code> å¤„çš„å€¼ä¸ºï¼š<code>L[i] * R[i]</code>ã€‚</li></ol><p>è®©æˆ‘ä»¬ç”¨ä»¥ä¸‹å›¾ç‰‡çœ‹çœ‹ç®—æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><p>  <a href="https://assets.leetcode-cn.com/solution-static/238/1.PNG" target="_blank" rel="noopener">fig1</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/2.PNG" target="_blank" rel="noopener">fig2</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/3.PNG" target="_blank" rel="noopener">fig3</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/4.PNG" target="_blank" rel="noopener">fig4</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/5.PNG" target="_blank" rel="noopener">fig5</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/6.PNG" target="_blank" rel="noopener">fig6</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/7.PNG" target="_blank" rel="noopener">fig7</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/8.PNG" target="_blank" rel="noopener">fig8</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/9.PNG" target="_blank" rel="noopener">fig9</a>  <a href="https://assets.leetcode-cn.com/solution-static/238/10.PNG" target="_blank" rel="noopener">fig10</a> </p><figure class="highlight c++"><figcaption><span>[sol1-C++]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; productExceptSelf(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> length = nums.size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// L å’Œ R åˆ†åˆ«è¡¨ç¤ºå·¦å³ä¸¤ä¾§çš„ä¹˜ç§¯åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; L(length, <span class="number">0</span>), R(length, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; answer(length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// L[i] ä¸ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼•ä¸º '0' çš„å…ƒç´ ï¼Œå› ä¸ºå·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ L[0] = 1</span></span><br><span class="line">        L[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">            L[i] = nums[i - <span class="number">1</span>] * L[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// R[i] ä¸ºç´¢å¼• i å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼•ä¸º 'length-1' çš„å…ƒç´ ï¼Œå› ä¸ºå³ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R[length-1] = 1</span></span><br><span class="line">        R[length - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            R[i] = nums[i + <span class="number">1</span>] * R[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼• iï¼Œé™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯å°±æ˜¯å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ä¹˜ä»¥å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            answer[i] = L[i] * R[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>[sol1-Python3]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">productExceptSelf</span><span class="params">(self, nums: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        length = len(nums)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># L å’Œ R åˆ†åˆ«è¡¨ç¤ºå·¦å³ä¸¤ä¾§çš„ä¹˜ç§¯åˆ—è¡¨</span></span><br><span class="line">        L, R, answer = [<span class="number">0</span>]*length, [<span class="number">0</span>]*length, [<span class="number">0</span>]*length</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># L[i] ä¸ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment"># å¯¹äºç´¢å¼•ä¸º '0' çš„å…ƒç´ ï¼Œå› ä¸ºå·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ L[0] = 1</span></span><br><span class="line">        L[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">            L[i] = nums[i - <span class="number">1</span>] * L[i - <span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># R[i] ä¸ºç´¢å¼• i å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment"># å¯¹äºç´¢å¼•ä¸º 'length-1' çš„å…ƒç´ ï¼Œå› ä¸ºå³ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R[length-1] = 1</span></span><br><span class="line">        R[length - <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(length - <span class="number">1</span>)):</span><br><span class="line">            R[i] = nums[i + <span class="number">1</span>] * R[i + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹äºç´¢å¼• iï¼Œé™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯å°±æ˜¯å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ä¹˜ä»¥å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            answer[i] = L[i] * R[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> answer</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[sol1-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] productExceptSelf(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> length = nums.length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// L å’Œ R åˆ†åˆ«è¡¨ç¤ºå·¦å³ä¸¤ä¾§çš„ä¹˜ç§¯åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">int</span>[] L = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line">        <span class="keyword">int</span>[] R = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] answer = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// L[i] ä¸ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼•ä¸º '0' çš„å…ƒç´ ï¼Œå› ä¸ºå·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ L[0] = 1</span></span><br><span class="line">        L[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">            L[i] = nums[i - <span class="number">1</span>] * L[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// R[i] ä¸ºç´¢å¼• i å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼•ä¸º 'length-1' çš„å…ƒç´ ï¼Œå› ä¸ºå³ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R[length-1] = 1</span></span><br><span class="line">        R[length - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            R[i] = nums[i + <span class="number">1</span>] * R[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼• iï¼Œé™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯å°±æ˜¯å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ä¹˜ä»¥å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            answer[i] = L[i] * R[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight golang"><figcaption><span>[sol1-Golang]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelf</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    length := <span class="built_in">len</span>(nums)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// L å’Œ R åˆ†åˆ«è¡¨ç¤ºå·¦å³ä¸¤ä¾§çš„ä¹˜ç§¯åˆ—è¡¨</span></span><br><span class="line">    L, R, answer := <span class="built_in">make</span>([]<span class="keyword">int</span>, length), <span class="built_in">make</span>([]<span class="keyword">int</span>, length), <span class="built_in">make</span>([]<span class="keyword">int</span>, length)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// L[i] ä¸ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼•ä¸º '0' çš„å…ƒç´ ï¼Œå› ä¸ºå·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ L[0] = 1</span></span><br><span class="line">    L[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; length; i++ &#123;</span><br><span class="line">        L[i] = nums[i<span class="number">-1</span>] * L[i<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// R[i] ä¸ºç´¢å¼• i å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼•ä¸º 'length-1' çš„å…ƒç´ ï¼Œå› ä¸ºå³ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R[length-1] = 1</span></span><br><span class="line">    R[length<span class="number">-1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        R[i] = nums[i+<span class="number">1</span>] * R[i+<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼• iï¼Œé™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯å°±æ˜¯å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ä¹˜ä»¥å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; length; i++ &#123;</span><br><span class="line">        answer[i] = L[i] * R[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><figcaption><span>[sol1-TypeScript]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> productExceptSelf = <span class="function"><span class="keyword">function</span>(<span class="params">nums: <span class="built_in">number</span>[]</span>): <span class="title">number</span>[] </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> length = nums.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// L å’Œ R åˆ†åˆ«è¡¨ç¤ºå·¦å³ä¸¤ä¾§çš„ä¹˜ç§¯åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">const</span> L = <span class="keyword">new</span> <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;(length);</span><br><span class="line">    <span class="keyword">const</span> R = <span class="keyword">new</span> <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;(length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> answer = <span class="keyword">new</span> <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;(length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// L[i] ä¸ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼•ä¸º '0' çš„å…ƒç´ ï¼Œå› ä¸ºå·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ L[0] = 1</span></span><br><span class="line">    L[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">        L[i] = nums[i - <span class="number">1</span>] * L[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// R[i] ä¸ºç´¢å¼• i å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼•ä¸º 'length-1' çš„å…ƒç´ ï¼Œå› ä¸ºå³ä¾§æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R[length-1] = 1</span></span><br><span class="line">    R[length - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        R[i] = nums[i + <span class="number">1</span>] * R[i + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äºç´¢å¼• iï¼Œé™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯å°±æ˜¯å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ä¹˜ä»¥å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        answer[i] = L[i] * R[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> answer;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(N)*ï¼Œå…¶ä¸­ *N</em> æŒ‡çš„æ˜¯æ•°ç»„ <code>nums</code> çš„å¤§å°ã€‚é¢„å¤„ç† <code>L</code> å’Œ <code>R</code> æ•°ç»„ä»¥åŠæœ€åçš„éå†è®¡ç®—éƒ½æ˜¯ <em>O(N)</em> çš„æ—¶é—´å¤æ‚åº¦ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(N)*ï¼Œå…¶ä¸­ *N</em> æŒ‡çš„æ˜¯æ•°ç»„ <code>nums</code> çš„å¤§å°ã€‚ä½¿ç”¨äº† <code>L</code> å’Œ <code>R</code> æ•°ç»„å»æ„é€ ç­”æ¡ˆï¼Œ<code>L</code> å’Œ <code>R</code> æ•°ç»„çš„é•¿åº¦ä¸ºæ•°ç»„ <code>nums</code> çš„å¤§å°ã€‚</li></ul><h4 id="æ–¹æ³•äºŒï¼šç©ºé—´å¤æ‚åº¦-O-1-çš„æ–¹æ³•"><a href="#æ–¹æ³•äºŒï¼šç©ºé—´å¤æ‚åº¦-O-1-çš„æ–¹æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šç©ºé—´å¤æ‚åº¦ O(1) çš„æ–¹æ³•"></a>æ–¹æ³•äºŒï¼šç©ºé—´å¤æ‚åº¦ <em>O(1)</em> çš„æ–¹æ³•</h4><p><strong>æ€è·¯</strong></p><p>å°½ç®¡ä¸Šé¢çš„æ–¹æ³•å·²ç»èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦å¹¶ä¸ä¸ºå¸¸æ•°ã€‚</p><p>ç”±äºè¾“å‡ºæ•°ç»„ä¸ç®—åœ¨ç©ºé—´å¤æ‚åº¦å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°† <code>L</code> æˆ– <code>R</code> æ•°ç»„ç”¨è¾“å‡ºæ•°ç»„æ¥è®¡ç®—ã€‚å…ˆæŠŠè¾“å‡ºæ•°ç»„å½“ä½œ <code>L</code> æ•°ç»„æ¥è®¡ç®—ï¼Œç„¶åå†åŠ¨æ€æ„é€  <code>R</code> æ•°ç»„å¾—åˆ°ç»“æœã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹åŸºäºè¿™ä¸ªæ€æƒ³çš„ç®—æ³•ã€‚</p><p><strong>ç®—æ³•</strong></p><ol><li>åˆå§‹åŒ– <code>answer</code> æ•°ç»„ï¼Œå¯¹äºç»™å®šç´¢å¼• <code>i</code>ï¼Œ<code>answer[i]</code> ä»£è¡¨çš„æ˜¯ <code>i</code> å·¦ä¾§æ‰€æœ‰æ•°å­—çš„ä¹˜ç§¯ã€‚</li><li>æ„é€ æ–¹å¼ä¸ä¹‹å‰ç›¸åŒï¼Œåªæ˜¯æˆ‘ä»¬è¯•å›¾èŠ‚çœç©ºé—´ï¼Œå…ˆæŠŠ <code>answer</code> ä½œä¸ºæ–¹æ³•ä¸€çš„ <code>L</code> æ•°ç»„ã€‚</li><li>è¿™ç§æ–¹æ³•çš„å”¯ä¸€å˜åŒ–å°±æ˜¯æˆ‘ä»¬æ²¡æœ‰æ„é€  <code>R</code> æ•°ç»„ã€‚è€Œæ˜¯ç”¨ä¸€ä¸ªéå†æ¥è·Ÿè¸ªå³è¾¹å…ƒç´ çš„ä¹˜ç§¯ã€‚å¹¶æ›´æ–°æ•°ç»„ <em>answer[i]=answer[i]<em>R</em>ã€‚ç„¶å *R</em> æ›´æ–°ä¸º <em>R=R<em>nums[i]</em>ï¼Œå…¶ä¸­å˜é‡ *R</em> è¡¨ç¤ºçš„å°±æ˜¯ç´¢å¼•å³ä¾§æ•°å­—çš„ä¹˜ç§¯ã€‚</li></ol><figure class="highlight cpp"><figcaption><span>[sol2-C++]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; productExceptSelf(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> length = nums.size();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; answer(length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// answer[i] è¡¨ç¤ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å› ä¸ºç´¢å¼•ä¸º '0' çš„å…ƒç´ å·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œ æ‰€ä»¥ answer[0] = 1</span></span><br><span class="line">        answer[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">            answer[i] = nums[i - <span class="number">1</span>] * answer[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// R ä¸ºå³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// åˆšå¼€å§‹å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R = 1</span></span><br><span class="line">        <span class="keyword">int</span> R = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="comment">// å¯¹äºç´¢å¼• iï¼Œå·¦è¾¹çš„ä¹˜ç§¯ä¸º answer[i]ï¼Œå³è¾¹çš„ä¹˜ç§¯ä¸º R</span></span><br><span class="line">            answer[i] = answer[i] * R;</span><br><span class="line">            <span class="comment">// R éœ€è¦åŒ…å«å³è¾¹æ‰€æœ‰çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªç»“æœæ—¶éœ€è¦å°†å½“å‰å€¼ä¹˜åˆ° R ä¸Š</span></span><br><span class="line">            R *= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>[sol2-Python3]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">productExceptSelf</span><span class="params">(self, nums: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        length = len(nums)</span><br><span class="line">        answer = [<span class="number">0</span>]*length</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># answer[i] è¡¨ç¤ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment"># å› ä¸ºç´¢å¼•ä¸º '0' çš„å…ƒç´ å·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œ æ‰€ä»¥ answer[0] = 1</span></span><br><span class="line">        answer[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">            answer[i] = nums[i - <span class="number">1</span>] * answer[i - <span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># R ä¸ºå³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment"># åˆšå¼€å§‹å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R = 1</span></span><br><span class="line">        R = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(length)):</span><br><span class="line">            <span class="comment"># å¯¹äºç´¢å¼• iï¼Œå·¦è¾¹çš„ä¹˜ç§¯ä¸º answer[i]ï¼Œå³è¾¹çš„ä¹˜ç§¯ä¸º R</span></span><br><span class="line">            answer[i] = answer[i] * R</span><br><span class="line">            <span class="comment"># R éœ€è¦åŒ…å«å³è¾¹æ‰€æœ‰çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªç»“æœæ—¶éœ€è¦å°†å½“å‰å€¼ä¹˜åˆ° R ä¸Š</span></span><br><span class="line">            R *= nums[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> answer</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[sol2-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] productExceptSelf(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> length = nums.length;</span><br><span class="line">        <span class="keyword">int</span>[] answer = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// answer[i] è¡¨ç¤ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// å› ä¸ºç´¢å¼•ä¸º '0' çš„å…ƒç´ å·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œ æ‰€ä»¥ answer[0] = 1</span></span><br><span class="line">        answer[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">            answer[i] = nums[i - <span class="number">1</span>] * answer[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// R ä¸ºå³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// åˆšå¼€å§‹å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R = 1</span></span><br><span class="line">        <span class="keyword">int</span> R = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="comment">// å¯¹äºç´¢å¼• iï¼Œå·¦è¾¹çš„ä¹˜ç§¯ä¸º answer[i]ï¼Œå³è¾¹çš„ä¹˜ç§¯ä¸º R</span></span><br><span class="line">            answer[i] = answer[i] * R;</span><br><span class="line">            <span class="comment">// R éœ€è¦åŒ…å«å³è¾¹æ‰€æœ‰çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªç»“æœæ—¶éœ€è¦å°†å½“å‰å€¼ä¹˜åˆ° R ä¸Š</span></span><br><span class="line">            R *= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight golang"><figcaption><span>[sol2-Golang]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelf</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    length := <span class="built_in">len</span>(nums)</span><br><span class="line">    answer := <span class="built_in">make</span>([]<span class="keyword">int</span>, length)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// answer[i] è¡¨ç¤ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å› ä¸ºç´¢å¼•ä¸º '0' çš„å…ƒç´ å·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œ æ‰€ä»¥ answer[0] = 1</span></span><br><span class="line">    answer[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; length; i++ &#123;</span><br><span class="line">        answer[i] = nums[i<span class="number">-1</span>] * answer[i<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// R ä¸ºå³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// åˆšå¼€å§‹å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R = 1</span></span><br><span class="line">    R := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼• iï¼Œå·¦è¾¹çš„ä¹˜ç§¯ä¸º answer[i]ï¼Œå³è¾¹çš„ä¹˜ç§¯ä¸º R</span></span><br><span class="line">        answer[i] = answer[i] * R</span><br><span class="line">        <span class="comment">// R éœ€è¦åŒ…å«å³è¾¹æ‰€æœ‰çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªç»“æœæ—¶éœ€è¦å°†å½“å‰å€¼ä¹˜åˆ° R ä¸Š</span></span><br><span class="line">        R *= nums[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><figcaption><span>[sol2-TypeScript]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> productExceptSelf = <span class="function"><span class="keyword">function</span>(<span class="params">nums: <span class="built_in">number</span>[]</span>): <span class="title">number</span>[] </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> length = nums.length;</span><br><span class="line">    <span class="keyword">const</span> answer = <span class="keyword">new</span> <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;(length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// answer[i] è¡¨ç¤ºç´¢å¼• i å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// å› ä¸ºç´¢å¼•ä¸º '0' çš„å…ƒç´ å·¦ä¾§æ²¡æœ‰å…ƒç´ ï¼Œ æ‰€ä»¥ answer[0] = 1</span></span><br><span class="line">    answer[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">        answer[i] = nums[i - <span class="number">1</span>] * answer[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// R ä¸ºå³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">    <span class="comment">// åˆšå¼€å§‹å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ R = 1</span></span><br><span class="line">    <span class="keyword">let</span> R = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// å¯¹äºç´¢å¼• iï¼Œå·¦è¾¹çš„ä¹˜ç§¯ä¸º answer[i]ï¼Œå³è¾¹çš„ä¹˜ç§¯ä¸º R</span></span><br><span class="line">        answer[i] = answer[i] * R;</span><br><span class="line">        <span class="comment">// R éœ€è¦åŒ…å«å³è¾¹æ‰€æœ‰çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥è®¡ç®—ä¸‹ä¸€ä¸ªç»“æœæ—¶éœ€è¦å°†å½“å‰å€¼ä¹˜åˆ° R ä¸Š</span></span><br><span class="line">        R *= nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> answer;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(N)*ï¼Œå…¶ä¸­ *N</em> æŒ‡çš„æ˜¯æ•°ç»„ <code>nums</code> çš„å¤§å°ã€‚åˆ†æä¸æ–¹æ³•ä¸€ç›¸åŒã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(1)</em>ï¼Œè¾“å‡ºæ•°ç»„ä¸ç®—è¿›ç©ºé—´å¤æ‚åº¦ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å¸¸æ•°çš„ç©ºé—´å­˜æ”¾å˜é‡ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­ n &amp;gt; 1ï¼Œè¿”å›è¾“å‡ºæ•°ç»„ output ï¼Œå…¶ä¸­ output[i] ç­‰äº nums ä¸­é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>240. æœç´¢äºŒç»´çŸ©é˜µII</title>
    <link href="http://yoursite.com/2020/06/30/240.%20%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5II/"/>
    <id>http://yoursite.com/2020/06/30/240. æœç´¢äºŒç»´çŸ©é˜µII/</id>
    <published>2020-06-30T14:52:12.000Z</published>
    <updated>2020-06-30T16:10:49.197Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚</p><a id="more"></a><p>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p>æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚<br>æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚<br>ç¤ºä¾‹:</p><pre><code>ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š[  [1,   4,  7, 11, 15],  [2,   5,  8, 12, 19],  [3,   6,  9, 16, 22],  [10, 13, 14, 17, 24],  [18, 21, 23, 26, 30]]ç»™å®š target = 5ï¼Œè¿”å› trueã€‚ç»™å®š target = 20ï¼Œè¿”å› falseã€‚</code></pre><p>è¿™é“é¢˜å‡ºçš„ä¸å¥½ï¼Œå› ä¸ºå¯ä»¥ç”¨74.æœç´¢äºŒç»´çŸ©é˜µé¢˜ä¸€æ ·çš„æ–¹æ³•ä»å·¦ä¸‹è§’æœç´¢æ¥è§£å†³ã€‚</p><h1 id="ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢"><a href="#ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢" class="headerlink" title="ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢"></a>ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢</h1><p>å› ä¸ºçŸ©é˜µçš„è¡Œå’Œåˆ—æ˜¯æ’åºçš„ï¼ˆåˆ†åˆ«ä»å·¦åˆ°å³å’Œä»ä¸Šåˆ°ä¸‹ï¼‰ï¼Œæ‰€ä»¥åœ¨æŸ¥çœ‹ä»»ä½•ç‰¹å®šå€¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®å‰ªO(m)æˆ–O(n)å…ƒç´ ã€‚</p><p>ç®—æ³•ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å‘çŸ©é˜µå·¦ä¸‹è§’çš„ (rowï¼Œcol) æŒ‡é’ˆã€‚ç„¶åï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å¹¶è¿”å› trueï¼ˆæˆ–è€…æŒ‡é’ˆæŒ‡å‘çŸ©é˜µç»´åº¦ä¹‹å¤–çš„ (rowï¼Œcol) ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>å¦‚æœå½“å‰æŒ‡å‘çš„å€¼å¤§äºç›®æ ‡å€¼ï¼Œåˆ™å¯ä»¥ â€œå‘ä¸Šâ€ ç§»åŠ¨ä¸€è¡Œã€‚ </p><p>å¦åˆ™ï¼Œå¦‚æœå½“å‰æŒ‡å‘çš„å€¼å°äºç›®æ ‡å€¼ï¼Œåˆ™å¯ä»¥ç§»åŠ¨ä¸€åˆ—ã€‚ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆè¿™æ ·åšæ°¸è¿œä¸ä¼šåˆ å‡æ­£ç¡®çš„ç­”æ¡ˆï¼›å› ä¸ºè¡Œæ˜¯ä»å·¦åˆ°å³æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å½“å‰å€¼å³ä¾§çš„æ¯ä¸ªå€¼éƒ½è¾ƒå¤§ã€‚ </p><p>å› æ­¤ï¼Œå¦‚æœå½“å‰å€¼å·²ç»å¤§äºç›®æ ‡å€¼ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå³è¾¹çš„æ¯ä¸ªå€¼ä¼šæ¯”è¾ƒå¤§ã€‚ä¹Ÿå¯ä»¥å¯¹åˆ—è¿›è¡Œéå¸¸ç±»ä¼¼çš„è®ºè¯ï¼Œå› æ­¤è¿™ç§æœç´¢æ–¹å¼å°†å§‹ç»ˆåœ¨çŸ©é˜µä¸­æ‰¾åˆ°ç›®æ ‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean searchMatrix(int[][] matrix, int target) &#123;</span><br><span class="line">//        äºŒç»´æ•°ç»„ä¸ºç©ºï¼Œè¦æ£€æŸ¥ä¸‰ä¸ªéƒ¨åˆ†:</span><br><span class="line">//        ä¸€æ˜¯æ•°ç»„é¦–åœ°å€æ˜¯å¦ä¸ºç©º</span><br><span class="line">//        äºŒæ˜¯æ˜¯å¦ä¸º&#123;&#125;ï¼Œä¹Ÿå°±æ˜¯array.length==0çš„æƒ…å†µ</span><br><span class="line">//        ä¸‰æ˜¯&#123;&#123;&#125;&#125;ï¼Œè¿™æ—¶array.length=1ï¼Œä½†æ˜¯array[0].length==0ã€‚æ»¡è¶³ä»»æ„ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥è¿”å›falseäº†ã€‚</span><br><span class="line">        if (matrix == null || matrix.length == 0 || matrix[0].length == 0) return false;</span><br><span class="line">        int row = matrix.length;</span><br><span class="line">        int col = matrix[0].length;</span><br><span class="line">        int rowindex = row - 1;</span><br><span class="line">        int colindex = 0;</span><br><span class="line"></span><br><span class="line">        while (colindex &lt; col &amp;&amp; rowindex &gt;= 0) &#123;</span><br><span class="line">            if (target == matrix[rowindex][colindex]) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125; else if (target &gt; matrix[rowindex][colindex]) &#123;</span><br><span class="line">                colindex++;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                rowindex--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®ƒæ–¹æ³•è§<a href="https://leetcode-cn.com/problems/search-a-2d-matrix-ii/solution/sou-suo-er-wei-ju-zhen-ii-by-leetcode-2/" target="_blank" rel="noopener">^1</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Binary Search" scheme="http://yoursite.com/tags/Binary-Search/"/>
    
      <category term="Divide and Conquer" scheme="http://yoursite.com/tags/Divide-and-Conquer/"/>
    
  </entry>
  
  <entry>
    <title>74. æœç´¢äºŒç»´çŸ©é˜µ</title>
    <link href="http://yoursite.com/2020/06/30/74.%20%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5/"/>
    <id>http://yoursite.com/2020/06/30/74. æœç´¢äºŒç»´çŸ©é˜µ/</id>
    <published>2020-06-30T14:52:12.000Z</published>
    <updated>2020-06-30T16:11:22.253Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚</p><a id="more"></a><p>è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p><p>æ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰å‡åºæ’åˆ—ã€‚<br>æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚<br>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥:matrix = [  [1,   3,  5,  7],  [10, 11, 16, 20],  [23, 30, 34, 50]]</code></pre><p>target = 3<br>è¾“å‡º: true<br>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥:matrix = [  [1,   3,  5,  7],  [10, 11, 16, 20],  [23, 30, 34, 50]]target = 13è¾“å‡º: false</code></pre><h1 id="ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢"><a href="#ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢" class="headerlink" title="ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢"></a>ä»å·¦ä¸‹è§’å¼€å§‹æœç´¢</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean searchMatrix(int[][] matrix, int target) &#123;</span><br><span class="line">//        äºŒç»´æ•°ç»„ä¸ºç©ºï¼Œè¦æ£€æŸ¥ä¸‰ä¸ªéƒ¨åˆ†:</span><br><span class="line">//        ä¸€æ˜¯æ•°ç»„é¦–åœ°å€æ˜¯å¦ä¸ºç©º</span><br><span class="line">//        äºŒæ˜¯æ˜¯å¦ä¸º&#123;&#125;ï¼Œä¹Ÿå°±æ˜¯array.length==0çš„æƒ…å†µ</span><br><span class="line">//        ä¸‰æ˜¯&#123;&#123;&#125;&#125;ï¼Œè¿™æ—¶array.length=1ï¼Œä½†æ˜¯array[0].length==0ã€‚æ»¡è¶³ä»»æ„ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥è¿”å›falseäº†ã€‚</span><br><span class="line">        if (matrix == null || matrix.length == 0 || matrix[0].length == 0) return false;</span><br><span class="line">        int row = matrix.length;</span><br><span class="line">        int col = matrix[0].length;</span><br><span class="line">        int rowindex = row - 1;</span><br><span class="line">        int colindex = 0;</span><br><span class="line"></span><br><span class="line">        while (colindex &lt; col &amp;&amp; rowindex &gt;= 0) &#123;</span><br><span class="line">            if (target == matrix[rowindex][colindex]) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125; else if (target &gt; matrix[rowindex][colindex]) &#123;</span><br><span class="line">                colindex++;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                rowindex--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–¹æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾"><a href="#æ–¹æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="æ–¹æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾"></a>æ–¹æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾</h1><p><strong>ç›´è§‰</strong></p><p>æ³¨æ„åˆ°è¾“å…¥çš„ <code>m x n</code> çŸ©é˜µå¯ä»¥è§†ä¸ºé•¿åº¦ä¸º <code>m x n</code>çš„æœ‰åºæ•°ç»„ã€‚</p><p> <a href="https://pic.leetcode-cn.com/d9b47b40a4de17b0c56446b0a4935a5042490ea1d92a6f4c529c2aaa0095c189-287711dcb87bd4d4681fa117f792d1baaaa7ce3e2c65d6a4f6439c0cbbb0345e-image.png" target="_blank" rel="noopener">äºŒåˆ†æŸ¥æ‰¾</a></p><p>ç”±äºè¯¥ <em>è™š</em> æ•°ç»„çš„åºå·å¯ä»¥ç”±ä¸‹å¼æ–¹ä¾¿åœ°è½¬åŒ–ä¸ºåŸçŸ©é˜µä¸­çš„è¡Œå’Œåˆ— (<em>æˆ‘ä»¬å½“ç„¶ä¸ä¼šçœŸçš„åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„</em>) ï¼Œè¯¥æœ‰åºæ•°ç»„éå¸¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚</p><blockquote><p><code>row = idx // n</code> ï¼Œ <code>col = idx % n</code>ã€‚</p></blockquote><p><strong>ç®—æ³•</strong></p><p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†äºŒåˆ†æŸ¥æ‰¾ç®—æ³• : </p><ul><li><p>åˆå§‹åŒ–å·¦å³åºå·<br><code>left = 0</code> å’Œ <code>right = m x n - 1</code>ã€‚</p></li><li><p>While <code>left &lt; right</code> :</p><ul><li><p>é€‰å–è™šæ•°ç»„æœ€ä¸­é—´çš„åºå·ä½œä¸ºä¸­é—´åºå·: <code>pivot_idx = (left + right) / 2</code>ã€‚</p></li><li><p>è¯¥åºå·å¯¹åº”äºåŸçŸ©é˜µä¸­çš„ <code>row = pivot_idx // n</code>è¡Œ <code>col = pivot_idx % n</code> åˆ—, ç”±æ­¤å¯ä»¥æ‹¿åˆ°ä¸­é—´å…ƒç´ <code>pivot_element</code>ã€‚è¯¥å…ƒç´ å°†è™šæ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚</p></li><li><p>æ¯”è¾ƒ <code>pivot_element</code> ä¸ <code>target</code> ä»¥ç¡®å®šåœ¨å“ªä¸€éƒ¨åˆ†è¿›è¡Œè¿›ä¸€æ­¥æŸ¥æ‰¾ã€‚</p></li></ul></li></ul><p><strong>å®ç°</strong></p><figure class="highlight java"><figcaption><span>[solution1]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">searchMatrix</span><span class="params">(<span class="keyword">int</span>[][] matrix, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = matrix.length;</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span> n = matrix[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>, right = m * n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> pivotIdx, pivotElement;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">      pivotIdx = (left + right) / <span class="number">2</span>;</span><br><span class="line">      pivotElement = matrix[pivotIdx / n][pivotIdx % n];</span><br><span class="line">      <span class="keyword">if</span> (target == pivotElement) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; pivotElement) right = pivotIdx - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> left = pivotIdx + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>[solution1]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchMatrix</span><span class="params">(self, matrix: List[List[int]], target: int)</span> -&gt; bool:</span></span><br><span class="line">        m = len(matrix)</span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        n = len(matrix[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">        left, right = <span class="number">0</span>, m * n - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">                pivot_idx = (left + right) // <span class="number">2</span></span><br><span class="line">                pivot_element = matrix[pivot_idx // n][pivot_idx % n]</span><br><span class="line">                <span class="keyword">if</span> target == pivot_element:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> target &lt; pivot_element:</span><br><span class="line">                        right = pivot_idx - <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        left = pivot_idx + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><figcaption><span>[solution1]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">searchMatrix</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; matrix, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = matrix.size();</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">int</span> n = matrix[<span class="number">0</span>].size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>, right = m * n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> pivotIdx, pivotElement;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">      pivotIdx = (left + right) / <span class="number">2</span>;</span><br><span class="line">      pivotElement = matrix[pivotIdx / n][pivotIdx % n];</span><br><span class="line">      <span class="keyword">if</span> (target == pivotElement) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; pivotElement) right = pivotIdx - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> left = pivotIdx + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ : ç”±äºæ˜¯æ ‡å‡†çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log(mn)) ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ : <em>O(1)</em>ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Binary Search" scheme="http://yoursite.com/tags/Binary-Search/"/>
    
  </entry>
  
  <entry>
    <title>334. é€’å¢çš„ä¸‰å…ƒå­åºåˆ—</title>
    <link href="http://yoursite.com/2020/06/30/334.%E9%80%92%E5%A2%9E%E7%9A%84%E4%B8%89%E5%85%83%E5%AD%90%E5%BA%8F%E5%88%97/"/>
    <id>http://yoursite.com/2020/06/30/334.é€’å¢çš„ä¸‰å…ƒå­åºåˆ—/</id>
    <published>2020-06-30T12:52:12.000Z</published>
    <updated>2020-06-30T13:09:57.486Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•°ç»„ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨é•¿åº¦ä¸º 3 çš„é€’å¢å­åºåˆ—ã€‚</p><a id="more"></a><p>æ•°å­¦è¡¨è¾¾å¼å¦‚ä¸‹:</p><p>å¦‚æœå­˜åœ¨è¿™æ ·çš„ i, j, k,  ä¸”æ»¡è¶³ 0 â‰¤ i &lt; j &lt; k â‰¤ n-1ï¼Œ<br>ä½¿å¾— arr[i] &lt; arr[j] &lt; arr[k] ï¼Œè¿”å› true ; å¦åˆ™è¿”å› false ã€‚<br>è¯´æ˜: è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1) ã€‚</p><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: [1,2,3,4,5]è¾“å‡º: true</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: [5,4,3,2,1]è¾“å‡º: false</code></pre><h1 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h1><ol><li>ç¬¬ä¸€ç§æ–¹æ³•é‡‡ç”¨äº†åŒæŒ‡é’ˆçš„æ€æƒ³ï¼Œé’ˆå¯¹è¿™ä¸ªé¢˜çš„ä¸‰å…ƒå­åºåˆ—ï¼Œå¦‚æœæ˜¯å››å…ƒæˆ–æ›´é«˜å…ƒåˆ™ä¸é€šç”¨ã€‚ä¸»è¦æ€è·¯æ˜¯ç»´æŠ¤å½“å‰è®¿é—®æ•°ç»„çš„æœ€å°å€¼å’Œæœ€å°å€¼å³ä¾§å¤§äºæœ€å°å€¼çš„æœ€å°çš„ä¸€ä¸ªã€‚å…·ä½“æ­¥éª¤é¡ºåºéå†æ•°ç»„ï¼Œé¦–å…ˆç¡®å®šå½“å‰å·²è®¿é—®çš„æ•°ç»„çš„æœ€å°å€¼ï¼Œå³å¦‚æœå°äºç­‰äºminå€¼çš„è¯æ›´æ–°minå€¼ï¼Œå¦‚æœå¤§äºminï¼Œåˆ¤æ–­æ˜¯å¦å°äºç­‰äºmaxå€¼ï¼Œå¦‚æœæ˜¯ï¼Œæ›´æ–°maxå€¼ã€‚å¦‚æœå¤§äºmaxå€¼ï¼Œåˆ™è¯´æ˜æœ‰ä¸‰å…ƒå­åºåˆ—ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">increasingTriplet</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> min = Integer.MAX_VALUE, max = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num: nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num &lt;= min)&#123;</span><br><span class="line">                min = num;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(num &lt;= max)&#123;</span><br><span class="line">                max = num;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¬¬äºŒç§æ–¹æ³•æ˜¯åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œä¸»è¦æ€è·¯æ˜¯ç»´æŠ¤å’Œæ›´æ–°ä»¥iä¸ºç»“å°¾çš„ä¸‰å…ƒå­åºåˆ—çš„æœ€é•¿é€’å¢é•¿åº¦ã€‚è½¬ç§»æ–¹ç¨‹ä¸ºdp[i] = max{dp[i], dp[j] + 1} (0&lt;=j&lt;i).</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">increasingTriplet</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] &gt; nums[j])&#123;</span><br><span class="line">                    dp[i] = Math.max(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(dp[i] &gt;= <span class="number">2</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•°ç»„ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨é•¿åº¦ä¸º 3 çš„é€’å¢å­åºåˆ—ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†II</title>
    <link href="http://yoursite.com/2020/06/29/350.%20%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86II/"/>
    <id>http://yoursite.com/2020/06/29/350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†II/</id>
    <published>2020-06-29T15:52:12.000Z</published>
    <updated>2020-06-30T13:09:41.642Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚</p><a id="more"></a><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: nums1 = [1,2,2,1], nums2 = [2,2]è¾“å‡º: [2,2]</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: nums1 = [4,9,5], nums2 = [9,4,9,8,4]è¾“å‡º: [4,9]</code></pre><p>è¯´æ˜ï¼š</p><pre><code>è¾“å‡ºç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ã€‚æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚</code></pre><p>è¿›é˜¶:</p><pre><code>å¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿå¦‚æœ nums1 çš„å¤§å°æ¯” nums2 å°å¾ˆå¤šï¼Œå“ªç§æ–¹æ³•æ›´ä¼˜ï¼Ÿå¦‚æœ nums2 çš„å…ƒç´ å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç£ç›˜å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„å…ƒç´ åˆ°å†…å­˜ä¸­ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ</code></pre><h1 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œæ˜ å°„"><a href="#æ–¹æ³•ä¸€ï¼šå“ˆå¸Œæ˜ å°„" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œæ˜ å°„"></a>æ–¹æ³•ä¸€ï¼šå“ˆå¸Œæ˜ å°„</h1><p>å‰é¢çš„é—®é¢˜ <a href="https://leetcode-cn.com/problems/intersection-of-two-arrays/" target="_blank" rel="noopener">349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</a>ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>set</code> æ¥å®ç°çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>HashMap</code> æ¥è·Ÿè¸ªæ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ã€‚</p><p>æˆ‘ä»¬å…ˆåœ¨ <code>HashMap</code> è®°å½•ä¸€ä¸ªæ•°ç»„ä¸­çš„å­˜åœ¨çš„æ•°å­—å’Œå¯¹åº”å‡ºç°çš„æ¬¡æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬éå†ç¬¬äºŒä¸ªæ•°ç»„ï¼Œæ£€æŸ¥æ•°å­—åœ¨ <code>HashMap</code> ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ä¸”è®¡æ•°ä¸ºæ­£ï¼Œåˆ™å°†è¯¥æ•°å­—æ·»åŠ åˆ°ç­”æ¡ˆå¹¶å‡å°‘ <code>HashMap</code> ä¸­çš„è®¡æ•°ã€‚<br> <a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMzUwLzM1MF9hcHByb2FjaDEtdjIucG5n?x-oss-process=image/format,png" target="_blank" rel="noopener">å“ˆå¸Œæ˜ å°„</a><br>æ£€æŸ¥æ•°ç»„çš„å¤§å°å¹¶å¯¹è¾ƒå°çš„æ•°ç»„è¿›è¡Œå“ˆå¸Œæ˜ å°„æ˜¯ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæ•°ç»„è¾ƒå¤§æ—¶ï¼Œä¼šå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</p><p><strong>ç®—æ³•ï¼š</strong></p><ul><li>å¦‚æœ <code>nums1</code> å…ƒç´ ä¸ªæ•°å¤§äº <code>nums2</code>ï¼Œåˆ™äº¤æ¢æ•°ç»„å…ƒç´ ã€‚</li><li>å¯¹äº <code>nums1</code> çš„æ¯ä¸ªå…ƒç´ ï¼Œæ·»åŠ åˆ° <code>HashMap m</code> ä¸­ï¼Œå¦‚æœå…ƒç´ å·²ç»å­˜åœ¨åˆ™å¢åŠ å¯¹åº”çš„è®¡æ•°ã€‚</li><li>åˆå§‹åŒ– <code>k = 0</code>ï¼Œè®°å½•å½“å‰äº¤é›†å…ƒç´ ä¸ªæ•°ã€‚</li><li>éå†æ•°ç»„ <code>nums2</code>ï¼š<ul><li>æ£€æŸ¥å…ƒç´ åœ¨ <code>m</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ä¸”è®¡æ•°ä¸ºæ­£ï¼š<ul><li>å°†å…ƒç´ æ‹·è´åˆ° <code>nums1[k]</code>ï¼Œä¸” <code>k++</code>ã€‚</li><li>å‡å°‘ <code>m</code> ä¸­å¯¹åº”å…ƒç´ çš„è®¡æ•°ã€‚</li></ul></li></ul></li><li>è¿”å› <code>nums1</code> å‰ <code>k</code> ä¸ªå…ƒç´ ã€‚</li></ul><figure class="highlight c++"><figcaption><span>[solution1-C++]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; intersect(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums1.size() &gt; nums2.size()) &#123;</span><br><span class="line">        <span class="keyword">return</span> intersect(nums2, nums1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> n : nums1) &#123;</span><br><span class="line">        ++m[n];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> n : nums2) &#123;</span><br><span class="line">        <span class="keyword">auto</span> it = m.find(n);</span><br><span class="line">        <span class="keyword">if</span> (it != end(m) &amp;&amp; --it-&gt;second &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            nums1[k++] = n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">vector</span>(begin(nums1), begin(nums1) + k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[solution1-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] intersect(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums1.length &gt; nums2.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> intersect(nums2, nums1);</span><br><span class="line">    &#125;</span><br><span class="line">    HashMap&lt;Integer, Integer&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n : nums1) &#123;</span><br><span class="line">        m.put(n, m.getOrDefault(n, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n : nums2) &#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = m.getOrDefault(n, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (cnt &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            nums1[k++] = n;</span><br><span class="line">            m.put(n, cnt - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Arrays.copyOfRange(nums1, <span class="number">0</span>, k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n+m) ã€‚å…¶ä¸­ <em>n</em>ï¼Œ<em>m</em> åˆ†åˆ«ä»£è¡¨äº†æ•°ç»„çš„å¤§å°ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(min(n,m)) ï¼Œæˆ‘ä»¬å¯¹è¾ƒå°çš„æ•°ç»„è¿›è¡Œå“ˆå¸Œæ˜ å°„ä½¿ç”¨çš„ç©ºé—´ã€‚</li></ul><h1 id="æ–¹æ³•äºŒï¼šæ’åº"><a href="#æ–¹æ³•äºŒï¼šæ’åº" class="headerlink" title="æ–¹æ³•äºŒï¼šæ’åº"></a>æ–¹æ³•äºŒï¼šæ’åº</h1><p>å½“è¾“å…¥æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ¨èä½¿ç”¨æ­¤æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ä¸¤ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œå¹¶ä¸”ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆåœ¨ä¸€æ¬¡æ‰«é¢æ‰¾å‡ºå…¬å…±çš„æ•°å­—ã€‚<br> <a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMzUwLzM1MF9hcHByb2FjaDItdjIucG5n?x-oss-process=image/format,png" target="_blank" rel="noopener">æ’åº</a></p><p><strong>ç®—æ³•ï¼š</strong></p><ul><li>å¯¹æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> æ’åºã€‚</li><li>åˆå§‹åŒ–æŒ‡é’ˆ <code>i</code>ï¼Œ<code>j</code> å’Œ <code>k</code> ä¸º <code>0</code>ã€‚</li><li>æŒ‡é’ˆ <code>i</code> æŒ‡å‘ <code>nums1</code>ï¼ŒæŒ‡é’ˆ <code>j</code> æŒ‡å‘ <code>nums2</code>ï¼š<ul><li>å¦‚æœ <code>nums1[i] &lt; nums2[j]</code>ï¼Œåˆ™ <code>i++</code>ã€‚ </li><li>å¦‚æœ <code>nums1[i] &gt; nums2[j]</code>ï¼Œåˆ™ <code>j++</code>ã€‚ </li><li>å¦‚æœ <code>nums1[i] == nums2[j]</code>ï¼Œå°†å…ƒç´ æ‹·è´åˆ° <code>nums1[k]</code>ï¼Œä¸” <code>i++</code>ï¼Œ<code>j++</code>ï¼Œ<code>k++</code>ã€‚</li></ul></li><li>è¿”å›æ•°ç»„ <code>nums1</code> å‰ <code>k</code> ä¸ªå…ƒç´ ã€‚</li></ul><figure class="highlight c++"><figcaption><span>[solution2-C++]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; intersect(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2) &#123;</span><br><span class="line">    sort(begin(nums1), end(nums1));</span><br><span class="line">    sort(begin(nums2), end(nums2));</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; nums1.size() &amp;&amp; j &lt; nums2.size()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums1[i] &lt; nums2[j]) &#123;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums1[i] &gt; nums2[j]) &#123;</span><br><span class="line">            ++j;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[k++] = nums1[i++];</span><br><span class="line">            ++j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(begin(nums1), begin(nums1) + k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[solution2-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] intersect(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">    Arrays.sort(nums1);</span><br><span class="line">    Arrays.sort(nums2);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; nums1.length &amp;&amp; j &lt; nums2.length) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums1[i] &lt; nums2[j]) &#123;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums1[i] &gt; nums2[j]) &#123;</span><br><span class="line">            ++j;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[k++] = nums1[i++];</span><br><span class="line">            ++j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Arrays.copyOfRange(nums1, <span class="number">0</span>, k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="public-static-int-copyOfRange-int-original-int-from-int-to"><a href="#public-static-int-copyOfRange-int-original-int-from-int-to" class="headerlink" title="public static int[] copyOfRange(int[] original, int from, int to)"></a>public static int[] copyOfRange(int[] original, int from, int to)</h2><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn+mlogm ã€‚å…¶ä¸­ <em>n</em>ï¼Œ<em>m</em> åˆ†åˆ«ä»£è¡¨äº†æ•°ç»„çš„å¤§å°ã€‚æˆ‘ä»¬å¯¹æ•°ç»„è¿›è¡Œäº†æ’åºç„¶åè¿›è¡Œäº†çº¿æ€§æ‰«æã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(1)</em>ï¼Œæˆ‘ä»¬å¿½ç•¥å­˜å‚¨ç­”æ¡ˆæ‰€ä½¿ç”¨çš„ç©ºé—´ï¼Œå› ä¸ºå®ƒå¯¹ç®—æ³•æœ¬èº«å¹¶ä¸é‡è¦ã€‚</li></ul><h1 id="æ–¹æ³•ä¸‰ï¼š"><a href="#æ–¹æ³•ä¸‰ï¼š" class="headerlink" title="æ–¹æ³•ä¸‰ï¼š"></a>æ–¹æ³•ä¸‰ï¼š</h1><p><strong>ç®—æ³•ï¼š</strong></p><p>è¿™ç±»ä¼¼äºæ–¹æ³• 2ã€‚æˆ‘ä»¬ä¸ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆè¿›è¡Œè¿­ä»£ï¼Œè€Œæ˜¯ä½¿ç”¨å†…ç½®å‡½æ•°æ¥æŸ¥æ‰¾å…¬å…±å…ƒç´ ã€‚åœ¨ C++ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>set_intersection</code> æ¥æ’åºæ•°ç»„ï¼ˆæˆ– <code>multisets</code>ï¼‰ã€‚</p><p>åœ¨ Java ä¸­çš„ <code>retainAll</code> æ–¹æ³•å¹¶ä¸å…³å¿ƒä¸€ä¸ªå…ƒç´ åœ¨å¦ä¸€ä¸ªé›†åˆä¸­å‡ºç°çš„æ¬¡æ•°ã€‚è¿™å°±æœ‰ç‚¹å°´å°¬äº†ï¼Œæˆ‘ä¸€å¼€å§‹æƒ³åˆ°çš„å°±æ˜¯ç”¨å†…ç½®å‡½æ•°ä½†é‡åˆ°ç”¨ä¾‹<code>[1,2]ï¼Œ[1,2]</code>å°±é”™äº†ï¼Œæ€ä¹ˆå†™ä¹Ÿæ²¡å¼„å‡ºæ¥ï¼Œæ‰€ä»¥Javaæ­¤æ³•æš‚ä¸å¯è¡Œã€‚</p><figure class="highlight c++"><figcaption><span>[solution3-C++]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; intersect(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2) &#123;</span><br><span class="line">    sort(begin(nums1), end(nums1));</span><br><span class="line">    sort(begin(nums2), end(nums2));</span><br><span class="line">    nums1.erase(set_intersection(begin(nums1), end(nums1), </span><br><span class="line">        begin(nums2), end(nums2), begin(nums1)), end(nums1));</span><br><span class="line">    <span class="keyword">return</span> nums1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶ç©ºå¤æ‚åº¦ï¼šä¸æ–¹æ³•äºŒç›¸åŒã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Hash Table" scheme="http://yoursite.com/tags/Hash-Table/"/>
    
      <category term="Binary Search" scheme="http://yoursite.com/tags/Binary-Search/"/>
    
      <category term="Two Pointers" scheme="http://yoursite.com/tags/Two-Pointers/"/>
    
  </entry>
  
  <entry>
    <title>349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</title>
    <link href="http://yoursite.com/2020/06/29/349.%20%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86/"/>
    <id>http://yoursite.com/2020/06/29/349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†/</id>
    <published>2020-06-29T12:42:12.000Z</published>
    <updated>2020-06-29T15:51:47.249Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚</p><a id="more"></a><p>ç¤ºä¾‹ 1ï¼š</p><pre><code>è¾“å…¥ï¼šnums1 = [1,2,2,1], nums2 = [2,2]è¾“å‡ºï¼š[2]</code></pre><p>ç¤ºä¾‹ 2ï¼š</p><pre><code>è¾“å…¥ï¼šnums1 = [4,9,5], nums2 = [9,4,9,8,4]è¾“å‡ºï¼š[9,4]</code></pre><p>è¯´æ˜ï¼š</p><pre><code>è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚</code></pre><h4 id="æ–¹æ³•ä¸€ï¼šä¸¤ä¸ªset"><a href="#æ–¹æ³•ä¸€ï¼šä¸¤ä¸ªset" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä¸¤ä¸ªset"></a>æ–¹æ³•ä¸€ï¼šä¸¤ä¸ªset</h4><p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯è¿­ä»£å¹¶æ£€æŸ¥ç¬¬ä¸€ä¸ªæ•°ç»„ <code>nums1</code> ä¸­çš„æ¯ä¸ªå€¼æ˜¯å¦ä¹Ÿå­˜åœ¨äº <code>nums2</code> ä¸­ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å°†å€¼æ·»åŠ åˆ°è¾“å‡ºã€‚è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n*m)  ï¼Œå…¶ä¸­ <code>n</code> å’Œ <code>m</code> åˆ†åˆ«ä¸ºæ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> çš„é•¿åº¦ã€‚ </p><p>ä¸ºäº†åœ¨çº¿æ€§æ—¶é—´å†…è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨é›†åˆ <code>set</code> è¿™ä¸€æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„å¯ä»¥æä¾›å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º <em>O(1)</em> çš„ <code>in/contains</code> æ“ä½œï¼ˆç”¨äºæµ‹è¯•æŸä¸€å…ƒç´ æ˜¯å¦ä¸ºè¯¥é›†åˆçš„æˆå‘˜ï¼‰ã€‚</p><p>æœ¬è§£æ³•å…ˆå°†ä¸¤ä¸ªæ•°ç»„éƒ½è½¬æ¢ä¸ºé›†åˆï¼Œç„¶åè¿­ä»£è¾ƒå°çš„é›†åˆï¼Œæ£€æŸ¥å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦åŒæ ·å­˜åœ¨äºè¾ƒå¤§çš„é›†åˆä¸­ã€‚å¹³å‡æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º <em>O(n+m)</em> ã€‚ </p><p><strong>å®ç°ï¼š</strong></p><figure class="highlight python"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_intersection</span><span class="params">(self, set1, set2)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> set1 <span class="keyword">if</span> x <span class="keyword">in</span> set2]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersection</span><span class="params">(self, nums1, nums2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums1: List[int]</span></span><br><span class="line"><span class="string">        :type nums2: List[int]</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span>  </span><br><span class="line">        set1 = set(nums1)</span><br><span class="line">        set2 = set(nums2)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> len(set1) &lt; len(set2):</span><br><span class="line">            <span class="keyword">return</span> self.set_intersection(set1, set2)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.set_intersection(set2, set1)</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span>[] set_intersection(HashSet&lt;Integer&gt; set1, HashSet&lt;Integer&gt; set2) &#123;</span><br><span class="line">    <span class="keyword">int</span> [] output = <span class="keyword">new</span> <span class="keyword">int</span>[set1.size()];</span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Integer s : set1)</span><br><span class="line">      <span class="keyword">if</span> (set2.contains(s)) output[idx++] = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Arrays.copyOf(output, idx);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">    HashSet&lt;Integer&gt; set1 = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer n : nums1) set1.add(n);</span><br><span class="line">    HashSet&lt;Integer&gt; set2 = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer n : nums2) set2.add(n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (set1.size() &lt; set2.size()) <span class="keyword">return</span> set_intersection(set1, set2);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> set_intersection(set2, set1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(m+n)*ï¼Œå…¶ä¸­ <code>n</code> å’Œ <code>m</code> æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚å°† <code>nums1</code> è½¬æ¢ä¸ºé›†åˆéœ€è¦ *O(n)</em> çš„æ—¶é—´ï¼Œç±»ä¼¼åœ°ï¼Œå°† <code>nums2</code> è½¬æ¢ä¸ºé›†åˆéœ€è¦ <em>O(m)</em> çš„æ—¶é—´ã€‚è€Œåœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œé›†åˆçš„ <code>in/contains</code> æ“ä½œåªéœ€è¦ <em>O(1)</em> çš„æ—¶é—´ã€‚ </li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(m+n)</em>ï¼Œæœ€åçš„æƒ…å†µæ˜¯æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸åŒã€‚ </li></ul><h3 id="Arrays-copyOf"><a href="#Arrays-copyOf" class="headerlink" title="Arrays.copyOf()"></a>Arrays.copyOf()</h3><p>original - è¦å¤åˆ¶çš„æ•°ç»„ </p><p>newLength - è¦è¿”å›çš„å‰¯æœ¬çš„é•¿åº¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*original - è¦å¤åˆ¶çš„æ•°ç»„ </span><br><span class="line">*newLength - è¦è¿”å›çš„å‰¯æœ¬çš„é•¿åº¦</span><br><span class="line">*/</span><br><span class="line">public static int[] copyOf(int[] original, int newLength) &#123;</span><br><span class="line">        int[] copy = new int[newLength];</span><br><span class="line">        System.arraycopy(original, 0, copy, 0,</span><br><span class="line">                         Math.min(original.length, newLength));</span><br><span class="line">        return copy;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒï¼šå†…ç½®å‡½æ•°"><a href="#æ–¹æ³•äºŒï¼šå†…ç½®å‡½æ•°" class="headerlink" title="æ–¹æ³•äºŒï¼šå†…ç½®å‡½æ•°"></a>æ–¹æ³•äºŒï¼šå†…ç½®å‡½æ•°</h4><p>å¦‚æœä½¿ç”¨å†…ç½®å‡½æ•°ï¼šé‚£ä¹ˆå¹³å‡æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <em>O(n+m)</em> ï¼›è€Œæœ€åçš„æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n*m)  ã€‚</p><p>Python æä¾›äº†å¯ç”¨äºæ±‚äº¤é›†çš„ <code>&amp;</code> è¿ç®—ç¬¦ï¼Œè€Œ Java æä¾›äº† <code>retainAll()</code>  å‡½æ•°ã€‚</p><p><strong>å®ç°:</strong></p><figure class="highlight python"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">intersection</span><span class="params">(self, nums1, nums2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums1: List[int]</span></span><br><span class="line"><span class="string">        :type nums2: List[int]</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span>  </span><br><span class="line">        set1 = set(nums1)</span><br><span class="line">        set2 = set(nums2)</span><br><span class="line">        <span class="keyword">return</span> list(set2 &amp; set1)</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) &#123;</span><br><span class="line">    HashSet&lt;Integer&gt; set1 = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer n : nums1) set1.add(n);</span><br><span class="line">    HashSet&lt;Integer&gt; set2 = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer n : nums2) set2.add(n);</span><br><span class="line"></span><br><span class="line">    set1.retainAll(set2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> [] output = <span class="keyword">new</span> <span class="keyword">int</span>[set1.size()];</span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> s : set1) output[idx++] = s;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ <em>O(m+n)</em>ï¼Œæœ€åæƒ…å†µä¸‹æ˜¯ O(m*n)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šæœ€åçš„æƒ…å†µæ˜¯ <em>O(m+n)</em>ï¼Œæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸åŒã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Hash Table" scheme="http://yoursite.com/tags/Hash-Table/"/>
    
      <category term="Binary Search" scheme="http://yoursite.com/tags/Binary-Search/"/>
    
      <category term="Two Pointers" scheme="http://yoursite.com/tags/Two-Pointers/"/>
    
  </entry>
  
  <entry>
    <title>384. æ‰“ä¹±æ•°ç»„</title>
    <link href="http://yoursite.com/2020/06/29/384.%20%E6%89%93%E4%B9%B1%E6%95%B0%E7%BB%84/"/>
    <id>http://yoursite.com/2020/06/29/384. æ‰“ä¹±æ•°ç»„/</id>
    <published>2020-06-29T10:02:12.000Z</published>
    <updated>2020-06-29T12:41:22.009Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰“ä¹±ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ã€‚</p><a id="more"></a><p>ç¤ºä¾‹:</p><pre><code>// ä»¥æ•°å­—é›†åˆ 1, 2 å’Œ 3 åˆå§‹åŒ–æ•°ç»„ã€‚int[] nums = {1,2,3};Solution solution = new Solution(nums);// æ‰“ä¹±æ•°ç»„ [1,2,3] å¹¶è¿”å›ç»“æœã€‚ä»»ä½• [1,2,3]çš„æ’åˆ—è¿”å›çš„æ¦‚ç‡åº”è¯¥ç›¸åŒã€‚solution.shuffle();// é‡è®¾æ•°ç»„åˆ°å®ƒçš„åˆå§‹çŠ¶æ€[1,2,3]ã€‚solution.reset();// éšæœºè¿”å›æ•°ç»„[1,2,3]æ‰“ä¹±åçš„ç»“æœã€‚solution.shuffle();</code></pre><h1 id="ç»ªç« -1"><a href="#ç»ªç« -1" class="headerlink" title="ç»ªç« ^1"></a>ç»ªç« <a href="https://leetcode-cn.com/problems/shuffle-an-array/solution/da-luan-shu-zu-by-leetcode/" target="_blank" rel="noopener">^1</a></h1><p>å¯¹äºæ´—ç‰Œé—®é¢˜ï¼ŒFisher-Yates æ´—ç‰Œç®—æ³•å³æ˜¯é€šä¿—è§£æ³•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ¸è¿›æœ€ä¼˜çš„è§£æ³•ã€‚</p><p>åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰éœ€è¦äº†è§£ä¸€äº›å…³äºéšæœºåŒ–çš„çŸ¥è¯† - ä¸‹é¢ä»‹ç»çš„ä¸¤ä¸ªæ–¹æ³•éƒ½å‡è®¾ç¼–ç¨‹è¯­è¨€ä¸­æä¾›çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨æ˜¯è¶³å¤Ÿéšæœºçš„ã€‚æˆ‘ä»¬ç»™å‡ºçš„ç¤ºä¾‹ä»£ç ä¹Ÿéƒ½é‡‡ç”¨äº†æœ€ç®€å•çš„æ–¹æ³•æ¥å¾—åˆ°ä¼ªéšæœºæ•°ï¼Œä½†ä¸ºäº†è®©æ•°ç»„çš„æ¯ä¸ªæ’åˆ—å‡ºç°çš„å¯èƒ½æ€§å°½å¯èƒ½ç›¸ç­‰ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›å…¶ä»–ä¸œè¥¿éœ€è¦æ³¨æ„çš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé•¿åº¦ä¸º <em>n</em> çš„æ•°ç»„æœ‰ <em>n!</em> ä¸ªä¸åŒçš„æ’åˆ—ç»„åˆã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½å°†æ‰€æœ‰çš„æ’åˆ—åœ¨æ•´æ•°ç©ºé—´ç¼–ç ï¼Œæˆ‘ä»¬éœ€è¦lg(n!) æ¯”ç‰¹ï¼Œè¿™æ˜¯é»˜è®¤çš„ä¼ªéšæœºæ•°ä¸èƒ½ä¿è¯çš„ã€‚</p><h1 id="æ–¹æ³•ä¸€ï¼š-æš´åŠ›-ã€é€šè¿‡ã€‘"><a href="#æ–¹æ³•ä¸€ï¼š-æš´åŠ›-ã€é€šè¿‡ã€‘" class="headerlink" title="æ–¹æ³•ä¸€ï¼š æš´åŠ› ã€é€šè¿‡ã€‘"></a>æ–¹æ³•ä¸€ï¼š æš´åŠ› ã€é€šè¿‡ã€‘</h1><p><strong>æ€è·¯</strong></p><p>å‡è®¾æˆ‘ä»¬æŠŠæ¯ä¸ªæ•°éƒ½æ”¾åœ¨ä¸€ä¸ª â€å¸½å­â€œ é‡Œé¢ï¼Œç„¶åæˆ‘ä»¬ä»å¸½å­é‡Œé¢æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªæ‘¸å‡ºæ¥ï¼Œæ‘¸å‡ºæ¥çš„æ•°æŒ‰é¡ºåºæ”¾å…¥æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æ­£å¥½å°±æ˜¯æˆ‘ä»¬è¦çš„æ´—ç‰Œåçš„æ•°ç»„ã€‚</p><p><strong>ç®—æ³•</strong></p><p>æš´åŠ›ç®—æ³•ç®€å•çš„æ¥è¯´å°±æ˜¯æŠŠæ¯ä¸ªæ•°æ”¾åœ¨ä¸€ä¸ª â€å¸½å­â€œ é‡Œé¢ï¼Œæ¯æ¬¡ä» â€å¸½å­â€œ é‡Œé¢éšæœºæ‘¸ä¸€ä¸ªæ•°å‡ºæ¥ï¼Œç›´åˆ° â€œå¸½å­â€ ä¸ºç©ºã€‚ä¸‹é¢æ˜¯å…·ä½“æ“ä½œï¼Œé¦–å…ˆæˆ‘ä»¬æŠŠæ•°ç»„ <code>array</code> å¤åˆ¶ä¸€ä»½ç»™æ•°ç»„ <code>aux</code>ï¼Œä¹‹åæ¯æ¬¡éšæœºä» <code>aux</code> ä¸­å–ä¸€ä¸ªæ•°ï¼Œä¸ºäº†é˜²æ­¢æ•°è¢«é‡å¤å–å‡ºï¼Œæ¯æ¬¡å–å®Œå°±æŠŠè¿™ä¸ªæ•°ä» <code>aux</code> ä¸­ç§»é™¤ã€‚<code>é‡ç½®</code> çš„å®ç°æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€æŠŠ <code>array</code> æ¢å¤ç§°æœ€å¼€å§‹çš„çŠ¶æ€å°±å¯ä»¥äº†ã€‚ </p><p>è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§åœ¨äºï¼Œæ¯æ¬¡ <code>for</code> å¾ªç¯ä¸­ï¼Œä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½ä¼šä»¥ç­‰å¯èƒ½çš„æ¦‚ç‡è¢«é€‰ä¸­ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºæ¥ï¼Œä¸€ä¸ªç‰¹å®šçš„å…ƒç´  <em>e</em> åœ¨ç¬¬ <em>k</em> è½®è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸º</p><p><em>P</em>(<em>e</em> åœ¨ç¬¬ <em>k</em> è½®è¢«é€‰ä¸­) Â·  <em>P</em>(<em>e</em> åœ¨å‰ <em>k</em> è½®ä¸è¢«é€‰ä¸­)ã€‚</p><p>å‡è®¾æ´—ç‰Œçš„æ•°ç»„æœ‰ <em>n</em> ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªæ¦‚ç‡å…¬å¼è§<a href="https://leetcode-cn.com/problems/shuffle-an-array/solution/da-luan-shu-zu-by-leetcode/" target="_blank" rel="noopener">^1</a></p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] original;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">getArrayCopy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; asList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            asList.add(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> asList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Solution</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        array = nums;</span><br><span class="line">        original = nums.clone();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] reset() &#123;</span><br><span class="line">        array = original;</span><br><span class="line">        original = original.clone();</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] shuffle() &#123;</span><br><span class="line">        List&lt;Integer&gt; aux = getArrayCopy();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> removeIdx = rand.nextInt(aux.size());</span><br><span class="line">            array[i] = aux.get(removeIdx);</span><br><span class="line">            aux.remove(removeIdx);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼š <em>O(n^2)</em><br>ä¹˜æ–¹æ—¶é—´å¤æ‚åº¦æ¥è‡ªäº <code>list.remove</code>ï¼ˆ<code>list.pop</code>ï¼‰ã€‚æ¯æ¬¡æ“ä½œéƒ½æ˜¯çº¿æ€§æ—¶é—´çš„ï¼Œæ€»å…±å‘ç”Ÿ <em>n</em> æ¬¡ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼š <em>O(n)</em><br>å› ä¸ºéœ€è¦å®ç° <code>é‡ç½®</code> æ–¹æ³•ï¼Œéœ€è¦é¢å¤–çš„ç©ºé—´æŠŠåŸå§‹æ•°ç»„å¦å­˜ä¸€ä»½ï¼Œåœ¨é‡ç½®çš„æ—¶å€™ç”¨æ¥æ¢å¤åŸå§‹çŠ¶æ€ã€‚</p></li></ul><h4 id="æ–¹æ³•äºŒï¼š-Fisher-Yates-æ´—ç‰Œç®—æ³•-ã€é€šè¿‡ã€‘"><a href="#æ–¹æ³•äºŒï¼š-Fisher-Yates-æ´—ç‰Œç®—æ³•-ã€é€šè¿‡ã€‘" class="headerlink" title="æ–¹æ³•äºŒï¼š Fisher-Yates æ´—ç‰Œç®—æ³• ã€é€šè¿‡ã€‘"></a>æ–¹æ³•äºŒï¼š Fisher-Yates æ´—ç‰Œç®—æ³• ã€é€šè¿‡ã€‘</h4><p><strong>æ€è·¯</strong></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æŠ€å·§æ¥é™ä½ä¹‹å‰ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ï¼Œé‚£å°±æ˜¯è®©æ•°ç»„ä¸­çš„å…ƒç´ äº’ç›¸äº¤æ¢ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ‰æ¯æ¬¡è¿­ä»£ä¸­ç”¨äºä¿®æ”¹åˆ—è¡¨çš„æ—¶é—´äº†ã€‚</p><p><strong>ç®—æ³•</strong></p><p>Fisher-Yates æ´—ç‰Œç®—æ³•è·Ÿæš´åŠ›ç®—æ³•å¾ˆåƒã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œç”Ÿæˆä¸€ä¸ªèŒƒå›´åœ¨å½“å‰ä¸‹æ ‡åˆ°æ•°ç»„æœ«å°¾å…ƒç´ ä¸‹æ ‡ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚æ¥ä¸‹æ¥ï¼Œå°†å½“å‰å…ƒç´ å’Œéšæœºé€‰å‡ºçš„ä¸‹æ ‡æ‰€æŒ‡çš„å…ƒç´ äº’ç›¸äº¤æ¢ - è¿™ä¸€æ­¥æ¨¡æ‹Ÿäº†æ¯æ¬¡ä» â€œå¸½å­â€ é‡Œé¢æ‘¸ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹ï¼Œå…¶ä¸­é€‰å–ä¸‹æ ‡èŒƒå›´çš„ä¾æ®åœ¨äºæ¯ä¸ªè¢«æ‘¸å‡ºçš„å…ƒç´ éƒ½ä¸å¯èƒ½å†è¢«æ‘¸å‡ºæ¥äº†ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç»†èŠ‚ï¼Œå½“å‰å…ƒç´ æ˜¯å¯ä»¥å’Œå®ƒæœ¬èº«äº’ç›¸äº¤æ¢çš„ - å¦åˆ™ç”Ÿæˆæœ€åçš„æ’åˆ—ç»„åˆçš„æ¦‚ç‡å°±ä¸å¯¹äº†ã€‚ä¸ºäº†æ›´æ¸…æ¥šåœ°ç†è§£è¿™ä¸€è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™äº›åŠ¨ç”»ï¼š</p><p>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates1.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates2.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates3.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates4.png" target="_blank" rel="noopener">1000</a></p><p>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates5.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates6.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates7.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates8.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates9.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates10.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates11.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates12.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates13.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates14.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates15.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates16.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates17.png" target="_blank" rel="noopener">1000</a><br>  <a href="https://pic.leetcode-cn.com/Figures/384/384_fisher_yates18.png" target="_blank" rel="noopener">1000</a> </p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] original;</span><br><span class="line"></span><br><span class="line">    Random rand = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">randRange</span><span class="params">(<span class="keyword">int</span> min, <span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rand.nextInt(max - min) + min;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swapAt</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Solution</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        array = nums;</span><br><span class="line">        original = nums.clone();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] reset() &#123;</span><br><span class="line">        array = original;</span><br><span class="line">        original = original.clone();</span><br><span class="line">        <span class="keyword">return</span> original;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] shuffle() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            swapAt(i, randRange(i, array.length));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li><p>æ—¶é—´å¤æ‚åº¦ ï¼š <em>O(n)</em><br>Fisher-Yates æ´—ç‰Œç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œå› ä¸ºç®—æ³•ä¸­ç”Ÿæˆéšæœºåºåˆ—ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ è¿™ä¸¤ç§æ“ä½œéƒ½æ˜¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦çš„ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼š <em>O(n)</em><br>å› ä¸ºè¦å®ç° <code>é‡ç½®</code> åŠŸèƒ½ï¼ŒåŸå§‹æ•°ç»„å¿…é¡»å¾—ä¿å­˜ä¸€ä»½ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦å¹¶æ²¡æœ‰ä¼˜åŒ–ã€‚</p></li></ul><h2 id="Random-nextInt-æ–¹æ³•ï¼Œéšæœºäº§ç”ŸæŸä¸ªèŒƒå›´å†…çš„æ•´æ•°"><a href="#Random-nextInt-æ–¹æ³•ï¼Œéšæœºäº§ç”ŸæŸä¸ªèŒƒå›´å†…çš„æ•´æ•°" class="headerlink" title="Random.nextInt()æ–¹æ³•ï¼Œéšæœºäº§ç”ŸæŸä¸ªèŒƒå›´å†…çš„æ•´æ•°"></a>Random.nextInt()æ–¹æ³•ï¼Œéšæœºäº§ç”ŸæŸä¸ªèŒƒå›´å†…çš„æ•´æ•°</h2><pre><code>int nextInt()            //éšæœºè¿”å›ä¸€ä¸ªintå‹æ•´æ•°int nextInt(int num)         //éšæœºè¿”å›ä¸€ä¸ªå€¼åœ¨[0,num)çš„intç±»å‹çš„æ•´æ•°,åŒ…æ‹¬0ä¸åŒ…æ‹¬num</code></pre><p>nextIntèƒ½æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå®ƒæ‰€äº§ç”Ÿçš„éšæœºæ•´æ•°çš„ä¸Šé™,ä¸‹é™ä¸ºé›¶ï¼Œè‹¥è¦è¾¾åˆ°éé›¶ä¸‹é™çš„æ•ˆæœï¼Œå¿…é¡»æŠŠä¸Šé™å‡å»ä¸‹é™çš„ç»“æœä¼ ç»™ nextInt( )ï¼Œç„¶åæŠŠä¸‹é™åŠ å…¥ nextInt( ) è¿”å›çš„æ•´æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‰“ä¹±ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>283. ç§»åŠ¨é›¶</title>
    <link href="http://yoursite.com/2020/06/29/283.%20%E7%A7%BB%E5%8A%A8%E9%9B%B6/"/>
    <id>http://yoursite.com/2020/06/29/283. ç§»åŠ¨é›¶/</id>
    <published>2020-06-29T09:49:12.000Z</published>
    <updated>2020-06-29T10:00:39.219Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><a id="more"></a><p>ç¤ºä¾‹:</p><pre><code>è¾“å…¥: [0,1,0,3,12]è¾“å‡º: [1,3,12,0,0]</code></pre><p>è¯´æ˜:</p><p>å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼Œä¸èƒ½æ‹·è´é¢å¤–çš„æ•°ç»„ã€‚<br>å°½é‡å‡å°‘æ“ä½œæ¬¡æ•°ã€‚</p><p>æˆ‘é¦–å…ˆæƒ³åˆ°çš„è§£æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public void moveZeroes(int[] nums) &#123;</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            if (nums[i] == 0) &#123;</span><br><span class="line">                swap(nums,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void swap(int[] nums, int zeroindex) &#123;</span><br><span class="line">        int i=zeroindex;</span><br><span class="line">        while (i &lt; nums.length) &#123;</span><br><span class="line">            if (nums[i] == 0) &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                nums[zeroindex] = nums[i];</span><br><span class="line">                nums[i]=0;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è§£ç­”æˆåŠŸ:</span><br><span class="line">æ‰§è¡Œè€—æ—¶:5 ms,å‡»è´¥äº†12.67% çš„Javaç”¨æˆ·</span><br><span class="line">å†…å­˜æ¶ˆè€—:40.4 MB,å‡»è´¥äº†5.62% çš„Javaç”¨æˆ·</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•æ•ˆç‡è¾ƒä½ï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆçš„æ–¹æ³•å‘¢ï¼Ÿ</p><h1 id="åŒæŒ‡é’ˆæ³•"><a href="#åŒæŒ‡é’ˆæ³•" class="headerlink" title="åŒæŒ‡é’ˆæ³•"></a>åŒæŒ‡é’ˆæ³•</h1><ol><li>å®šä¹‰ä¸€ä¸ªéé›¶çš„æŒ‡é’ˆ <code>j=0</code>ï¼Œå¾ªç¯éå†æ•°ç»„ç”¨æŒ‡é’ˆ<code>j</code>è®°å½•éé›¶å€¼<code>nums[j] = num[i]</code>;</li><li>åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆ<code>i</code>ä¸<code>j</code>æ˜¯å¦ç›¸ç­‰ï¼Œè¿™é‡Œä¸¤ä¸ªæŒ‡é’ˆåˆå§‹å€¼éƒ½ä¸º0ï¼Œ<code>j</code>æŒ‡é’ˆåªæœ‰åœ¨éé›¶çš„æƒ…å†µä¸‹ä¼š<code>j++</code>ï¼›</li><li>å› æ­¤å¯ä»¥åˆ¤æ–­<code>j</code>æŒ‡é’ˆå¯¹åº”çš„å€¼éƒ½ä¸ºéé›¶çš„æ•°æ®ï¼Œä¸”ä¿å­˜åŸæœ‰é¡ºåºï¼›</li><li>æ‰€ä»¥ï¼ŒåŸæœ‰æ•°ç»„ç»§ç»­éå†æƒ…å†µä¸‹ï¼Œ<code>nums[i]</code>éƒ½ä¸º0ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public void moveZeroes(int[] nums) &#123;</span><br><span class="line">        int j = 0;</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            if (nums[i] != 0) &#123;</span><br><span class="line">                nums[j] = nums[i];</span><br><span class="line">                if( i != j)&#123;</span><br><span class="line">                    nums[i] = 0;</span><br><span class="line">                &#125;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">            è§£ç­”æˆåŠŸ:</span><br><span class="line">æ‰§è¡Œè€—æ—¶:0 ms,å‡»è´¥äº†100.00% çš„Javaç”¨æˆ·</span><br><span class="line">å†…å­˜æ¶ˆè€—:39.6 MB,å‡»è´¥äº†5.62% çš„Javaç”¨æˆ·</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Two Pointers" scheme="http://yoursite.com/tags/Two-Pointers/"/>
    
  </entry>
  
  <entry>
    <title>Javaä¹‹TreeSetç±»</title>
    <link href="http://yoursite.com/2020/06/29/Java%E4%B9%8BTreeSet%E7%B1%BB/"/>
    <id>http://yoursite.com/2020/06/29/Javaä¹‹TreeSetç±»/</id>
    <published>2020-06-29T08:21:12.000Z</published>
    <updated>2020-06-29T09:09:17.746Z</updated>
    
    <content type="html"><![CDATA[<p>java.util.TreeSet ç±»å®ç°Setæ¥å£ã€‚</p><a id="more"></a><p>ä»¥ä¸‹æ˜¯å…³äºTreeSetçš„è¦ç‚¹<a href="http://gitbook.net/java/util/java_util_treeset.html" target="_blank" rel="noopener">^1</a>ï¼š</p><ul><li>TreeSetç±»ä¿è¯è¯¥æ˜ å°„å°†åœ¨å‡åºé”®é¡ºåºï¼Œç”±TreeMapæ”¯æŒã€‚</li><li>è¯¥æ˜ å°„æ˜¯æŒ‰ç…§è‡ªç„¶æ’åºæ–¹æ³•è¯¥é”®ç±»ï¼Œæˆ–åœ¨é›†åˆ›å»ºæ—¶æä¾›çš„æ¯”è¾ƒå™¨ï¼Œè¿™å°†å–å†³äºå…¶æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æ’åºã€‚</li><li>é¡ºåºå¿…é¡»æ˜¯æ€»ä¸ºäº†ä½¿æ ‘åˆ°åŠŸèƒ½å±æ€§ã€‚</li></ul><p>è¿™é‡Œä»…åˆ—å‡ºå‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œæ›´å¤šè¯¦è§<a href="http://gitbook.net/java/util/java_util_treeset.html" target="_blank" rel="noopener">^1</a></p><h1 id="ç±»æ–¹æ³•"><a href="#ç±»æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•"></a>ç±»æ–¹æ³•</h1><h2 id="E-ceiling-E-e-æ–¹æ³•"><a href="#E-ceiling-E-e-æ–¹æ³•" class="headerlink" title="E ceiling(E e) æ–¹æ³•"></a>E ceiling(E e) æ–¹æ³•</h2><p>ç”¨æ¥è¿”å›å¤§äºæˆ–ç­‰äºç»™å®šçš„å…ƒç´ çš„æœ€å°å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ è¿”å›nullã€‚</p><h2 id="E-floor-E-e-æ–¹æ³•"><a href="#E-floor-E-e-æ–¹æ³•" class="headerlink" title="E floor(E e) æ–¹æ³•"></a>E floor(E e) æ–¹æ³•</h2><p>æ­¤æ–¹æ³•è¿”å›å°äºæˆ–ç­‰äºç»™å®šçš„å…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ è¿”å›nullã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;java.util.TreeSet ç±»å®ç°Setæ¥å£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="TreeSet" scheme="http://yoursite.com/tags/TreeSet/"/>
    
  </entry>
  
  <entry>
    <title>220. å­˜åœ¨é‡å¤å…ƒç´ III</title>
    <link href="http://yoursite.com/2020/06/29/220.%20%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0III/"/>
    <id>http://yoursite.com/2020/06/29/220. å­˜åœ¨é‡å¤å…ƒç´ III/</id>
    <published>2020-06-29T06:59:12.000Z</published>
    <updated>2020-06-29T09:31:29.444Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ•´æ•°æ•°ç»„ nums ä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸‹æ ‡ i å’Œ jï¼Œä½¿å¾— nums [i] å’Œ nums [j] çš„å·®çš„ç»å¯¹å€¼å°äºç­‰äº t ï¼Œä¸”æ»¡è¶³ i å’Œ j çš„å·®çš„ç»å¯¹å€¼ä¹Ÿå°äºç­‰äº Ä· ã€‚</p><a id="more"></a><p>å¦‚æœå­˜åœ¨åˆ™è¿”å› trueï¼Œä¸å­˜åœ¨è¿”å› falseã€‚</p><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: nums = [1,2,3,1], k = 3, t = 0è¾“å‡º: true</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: nums = [1,0,1,1], k = 1, t = 2è¾“å‡º: true</code></pre><p>ç¤ºä¾‹ 3:</p><pre><code>è¾“å…¥: nums = [1,5,9,1,5,9], k = 2, t = 3è¾“å‡º: false</code></pre><h1 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h1><p>é¦–å…ˆæƒ³åˆ°ç”¨HashSetæ¥è§£å†³ä½†è¶…æ—¶äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean containsNearbyAlmostDuplicate(int[] nums, int k, int t) &#123;</span><br><span class="line">        Set&lt;Integer&gt; set = new HashSet&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            for (int j = nums[i] - t; j &lt;= nums[i] + t; j++) &#123;</span><br><span class="line">                if (set.contains(j)) &#123;</span><br><span class="line">//                    System.out.println(&quot;i=&quot;+i+&quot;, j=&quot;+j);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            if (set.size() &gt; k) &#123;</span><br><span class="line">                set.remove(nums[i - k]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸‹å®˜æ–¹é¢˜è§£<a href="https://leetcode-cn.com/problems/contains-duplicate-iii/solution/cun-zai-zhong-fu-yuan-su-iii-by-leetcode/" target="_blank" rel="noopener">^1</a></p><h1 id="äºŒå‰æœç´¢æ ‘-ã€é€šè¿‡ã€‘"><a href="#äºŒå‰æœç´¢æ ‘-ã€é€šè¿‡ã€‘" class="headerlink" title="äºŒå‰æœç´¢æ ‘ ã€é€šè¿‡ã€‘"></a>äºŒå‰æœç´¢æ ‘ ã€é€šè¿‡ã€‘</h1><p>æ€»ç»“ä¸€ä¸‹è¯¥æ–¹æ³•å¼•å…¥è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ¥ä¿è¯èƒ½åœ¨O(logn) æ—¶é—´å†…å®Œæˆ æ’å…¥ï¼Œæœç´¢ï¼Œåˆ é™¤ æ“ä½œã€‚å‡å°‘å¯¹æ»‘åŠ¨çª—å£ä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ æ“ä½œæ‰€éœ€çš„æ—¶é—´ã€‚</p><p>ä¸‹é¢ç»™å‡ºæ•´ä¸ªç®—æ³•çš„ä¼ªä»£ç ï¼š</p><pre><code>åˆå§‹åŒ–ä¸€é¢—ç©ºçš„äºŒå‰æœç´¢æ ‘ setå¯¹äºæ¯ä¸ªå…ƒç´ xxï¼Œéå†æ•´ä¸ªæ•°ç»„    åœ¨ set ä¸ŠæŸ¥æ‰¾å¤§äºç­‰äºxxçš„æœ€å°çš„æ•°ï¼Œå¦‚æœs - x \leq tsâˆ’xâ‰¤tåˆ™è¿”å› true    åœ¨ set ä¸ŠæŸ¥æ‰¾å°äºç­‰äºxxçš„æœ€å¤§çš„æ•°ï¼Œå¦‚æœx - g \leq txâˆ’gâ‰¤tåˆ™è¿”å› true    åœ¨ set ä¸­æ’å…¥xx    å¦‚æœæ ‘çš„å¤§å°è¶…è¿‡äº†kk, åˆ™ç§»é™¤æœ€æ—©åŠ å…¥æ ‘çš„é‚£ä¸ªæ•°ã€‚è¿”å› false</code></pre><p>æˆ‘ä»¬æŠŠå¤§äºç­‰äº <em>x</em> çš„æœ€å°çš„æ•° <em>s</em> å½“åš <em>x</em> åœ¨ BST ä¸­çš„åç»§èŠ‚ç‚¹ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬èƒ½æŠŠå°äºç­‰äº <em>x</em> æœ€å¤§çš„æ•° <em>g</em> å½“åš <em>x</em> åœ¨ BST ä¸­çš„å‰ç»§èŠ‚ç‚¹ã€‚<em>s</em> å’Œ <em>g</em> è¿™ä¸¤ä¸ªæ•°æ˜¯è·ç¦» <em>x</em> æœ€è¿‘çš„æ•°ã€‚å› æ­¤åªéœ€è¦æ£€æŸ¥å®ƒä»¬å’Œ <em>x</em> çš„è·ç¦»å°±èƒ½çŸ¥é“æ¡ä»¶äºŒæ˜¯å¦æ»¡è¶³äº†ã€‚</p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyAlmostDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    TreeSet&lt;Integer&gt; set = <span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class="line">        <span class="comment">// Find the successor of current element</span></span><br><span class="line">        Integer s = set.ceiling(nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (s != <span class="keyword">null</span> &amp;&amp; s &lt;= nums[i] + t) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Find the predecessor of current element</span></span><br><span class="line">        Integer g = set.floor(nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (g != <span class="keyword">null</span> &amp;&amp; nums[i] &lt;= g + t) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        set.add(nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (set.size() &gt; k) &#123;</span><br><span class="line">            set.remove(nums[i - k]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-ceiling-E-e-æ–¹æ³•-2"><a href="#E-ceiling-E-e-æ–¹æ³•-2" class="headerlink" title="E ceiling(E e) æ–¹æ³•^2"></a>E ceiling(E e) æ–¹æ³•<a href="http://gitbook.net/java/util/java_util_treeset.html" target="_blank" rel="noopener">^2</a></h2><p>ç”¨æ¥è¿”å›å¤§äºæˆ–ç­‰äºç»™å®šçš„å…ƒç´ çš„æœ€å°å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ è¿”å›nullã€‚</p><h2 id="E-floor-E-e-æ–¹æ³•"><a href="#E-floor-E-e-æ–¹æ³•" class="headerlink" title="E floor(E e) æ–¹æ³•"></a>E floor(E e) æ–¹æ³•</h2><p>æ­¤æ–¹æ³•è¿”å›å°äºæˆ–ç­‰äºç»™å®šçš„å…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ è¿”å›nullã€‚</p><h2 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h2><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n log (min(n,k)))<br>æˆ‘ä»¬éœ€è¦éå†è¿™ä¸ª n é•¿åº¦çš„æ•°ç»„ã€‚å¯¹äºæ¯æ¬¡éå†ï¼Œåœ¨ BST ä¸­ æœç´¢ï¼Œæ’å…¥ æˆ–è€… åˆ é™¤ éƒ½éœ€è¦èŠ±è´¹ O(logmin(k, n))çš„æ—¶é—´ã€‚</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(min(n,k))<br>ç©ºé—´å¤æ‚åº¦ç”± BST çš„å¤§å°å†³å®šï¼Œå…¶å¤§å°çš„ä¸Šé™ç”± k å’Œ n å…±åŒå†³å®šã€‚</p><h2 id="æº¢å‡ºé”™è¯¯"><a href="#æº¢å‡ºé”™è¯¯" class="headerlink" title="æº¢å‡ºé”™è¯¯"></a>æº¢å‡ºé”™è¯¯</h2><p>å½“æ•°ç»„ä¸­çš„å…ƒç´ éå¸¸å¤§çš„æ—¶å€™ï¼Œè¿›è¡Œæ•°å­¦è¿ç®—å¯èƒ½é€ æˆæº¢å‡ºã€‚æ‰€ä»¥å¯ä»¥è€ƒè™‘ä½¿ç”¨æ”¯æŒå¤§æ•°çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ longã€‚</p><p>C++ ä¸­çš„ std::setï¼Œstd::set::upper_bound å’Œ std::set::lower_bound åˆ†åˆ«ç­‰ä»·äº Java ä¸­çš„ TreeSetï¼ŒTreeSet::ceiling å’Œ TreeSet::floorã€‚Python æ ‡å‡†åº“ä¸æä¾›è‡ªå¹³è¡¡ BSTã€‚</p><p>å½“æµ‹è¯•ç”¨ä¾‹ä¸º</p><pre><code>[-2147483648,-2147483647]33</code></pre><p>æ—¶ä¼šæº¢å‡ºï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨longç±»å‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean containsNearbyAlmostDuplicate(int[] nums, int k, int t) &#123;</span><br><span class="line">        TreeSet&lt;Long&gt; set = new TreeSet&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            // Find the successor of current element</span><br><span class="line">            Long s = set.ceiling((long) nums[i]);</span><br><span class="line">            if (s != null &amp;&amp; s &lt;= (long) nums[i] + t) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // Find the predecessor of current element</span><br><span class="line">            Long g = set.floor((long) nums[i]);</span><br><span class="line">            if (g != null &amp;&amp; g &gt;= (long) nums[i] - t) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            set.add((long) nums[i]);</span><br><span class="line">            if (set.size() &gt; k) &#123;</span><br><span class="line">                set.remove((long) nums[i - k]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–¹æ³•ä¸‰-ï¼ˆæ¡¶ï¼‰-ã€é€šè¿‡ã€‘"><a href="#æ–¹æ³•ä¸‰-ï¼ˆæ¡¶ï¼‰-ã€é€šè¿‡ã€‘" class="headerlink" title="æ–¹æ³•ä¸‰ ï¼ˆæ¡¶ï¼‰ ã€é€šè¿‡ã€‘"></a>æ–¹æ³•ä¸‰ ï¼ˆæ¡¶ï¼‰ ã€é€šè¿‡ã€‘</h1><p><strong>æ€è·¯</strong></p><p>å— <code>æ¡¶æ’åº</code> çš„å¯å‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <em>æ¡¶</em> å½“åšçª—å£æ¥å®ç°ä¸€ä¸ªçº¿æ€§å¤æ‚åº¦çš„è§£æ³•ã€‚</p><p><strong>ç®—æ³•</strong></p><p>æ¡¶æ’åºæ˜¯ä¸€ç§æŠŠå…ƒç´ åˆ†æ•£åˆ°ä¸åŒæ¡¶ä¸­çš„æ’åºç®—æ³•ã€‚æ¥ç€æŠŠæ¯ä¸ªæ¡¶å†ç‹¬ç«‹åœ°ç”¨ä¸åŒçš„æ’åºç®—æ³•è¿›è¡Œæ’åºã€‚æ¡¶æ’åºçš„æ¦‚è§ˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ 8 ä¸ªæœªæ’åºçš„æ•´æ•°ã€‚æˆ‘ä»¬é¦–å…ˆæ¥åˆ›å»ºäº”ä¸ªæ¡¶ï¼Œè¿™äº”ä¸ªæ¡¶åˆ†åˆ«åŒ…å« <em>[0,9], [10,19], [20, 29], [30, 39], [40, 49]</em> è¿™å‡ ä¸ªåŒºé—´ã€‚è¿™ 8 ä¸ªå…ƒç´ ä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½åœ¨ä¸€ä¸ªæ¡¶é‡Œé¢ã€‚å¯¹äºå€¼ä¸º <em>x</em> çš„å…ƒç´ æ¥è¯´ï¼Œå®ƒæ‰€å±æ¡¶çš„æ ‡ç­¾ä¸º <em>x/w</em>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è®© <em>w = 10</em>ã€‚å¯¹äºæ¯ä¸ªæ¡¶æˆ‘ä»¬å•ç‹¬ç”¨å…¶ä»–æ’åºç®—æ³•è¿›è¡Œæ’åºï¼Œæœ€åæŒ‰ç…§æ¡¶çš„é¡ºåºæ”¶é›†æ‰€æœ‰çš„å…ƒç´ å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„æ•°ç»„äº†ã€‚</p><p>å›åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°è¯•å»è§£å†³çš„æœ€å¤§çš„é—®é¢˜åœ¨äºï¼š</p><blockquote><ol><li>å¯¹äºç»™å®šçš„å…ƒç´  <em>x</em>, åœ¨çª—å£ä¸­æ˜¯å¦æœ‰å­˜åœ¨åŒºé—´ <em>[x-t, x+t]</em> å†…çš„å…ƒç´ ï¼Ÿ  </li><li>æˆ‘ä»¬èƒ½åœ¨å¸¸é‡æ—¶é—´å†…å®Œæˆä»¥ä¸Šåˆ¤æ–­å˜›ï¼Ÿ</li></ol></blockquote><p>æˆ‘ä»¬ä¸å¦¨æŠŠæŠŠæ¯ä¸ªå…ƒç´ å½“åšä¸€ä¸ªäººçš„ç”Ÿæ—¥æ¥è€ƒè™‘ä¸€ä¸‹å§ã€‚å‡è®¾ä½ æ˜¯ç­ä¸Šæ–°æ¥çš„ä¸€ä½å­¦ç”Ÿï¼Œä½ çš„ç”Ÿæ—¥åœ¨ <em>ä¸‰æœˆ</em> çš„æŸä¸€å¤©ï¼Œä½ æƒ³çŸ¥é“ç­ä¸Šæ˜¯å¦æœ‰äººç”Ÿæ—¥è·Ÿä½ ç”Ÿæ—¥åœ¨ <em>t=30</em> å¤©ä»¥å†…ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆå‡è®¾æ¯ä¸ªæœˆéƒ½æ˜¯<em>30<em>å¤©ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬åªéœ€è¦æ£€æŸ¥æ‰€æœ‰ç”Ÿæ—¥åœ¨ *äºŒæœˆ</em>ï¼Œ<em>ä¸‰æœˆ</em>ï¼Œ*å››æœˆ</em> çš„åŒå­¦å°±å¯ä»¥äº†ã€‚</p><p>ä¹‹æ‰€ä»¥èƒ½è¿™ä¹ˆåšçš„åŸå› åœ¨äºï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªäººçš„ç”Ÿæ—¥éƒ½å±äºä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ¡¶ç§°ä½œæœˆä»½ï¼æ¯ä¸ªæ¡¶æ‰€åŒ…å«çš„åŒºé—´èŒƒå›´éƒ½æ˜¯ <em>t</em>ï¼Œè¿™èƒ½æå¤§çš„ç®€åŒ–æˆ‘ä»¬çš„é—®é¢˜ã€‚å¾ˆæ˜¾ç„¶ï¼Œä»»ä½•ä¸åœ¨åŒä¸€ä¸ªæ¡¶æˆ–ç›¸é‚»æ¡¶çš„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„è·ç¦»ä¸€å®šæ˜¯å¤§äº <em>t</em> çš„ã€‚</p><p>æˆ‘ä»¬æŠŠä¸Šé¢æåˆ°çš„æ¡¶çš„æ€æƒ³åº”ç”¨åˆ°è¿™ä¸ªé—®é¢˜é‡Œé¢æ¥ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€äº›æ¡¶ï¼Œè®©ä»–ä»¬åˆ†åˆ«åŒ…å«åŒºé—´ <em>â€¦, [0,t], [t+1, 2t+1], â€¦*ã€‚æˆ‘ä»¬æŠŠæ¡¶æ¥å½“åšçª—å£ï¼Œäºæ˜¯æ¯æ¬¡æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ *x</em> æ‰€å±çš„é‚£ä¸ªæ¡¶å’Œç›¸é‚»æ¡¶ä¸­çš„å…ƒç´ å°±å¯ä»¥äº†ã€‚ç»ˆäºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¸¸é‡æ—¶é—´è§£å†³åœ¨çª—å£ä¸­æœç´¢çš„é—®é¢˜äº†ã€‚</p><p>è¿˜æœ‰ä¸€ä»¶å€¼å¾—æ³¨æ„çš„äº‹ï¼</p><p>è¿™ä¸ªé—®é¢˜å’Œæ¡¶æ’åºçš„ä¸åŒä¹‹å¤„åœ¨äºæ¯æ¬¡æˆ‘ä»¬çš„æ¡¶é‡Œåªéœ€è¦åŒ…å«æœ€å¤šä¸€ä¸ªå…ƒç´ å°±å¯ä»¥äº†ï¼Œå› ä¸ºå¦‚æœä»»æ„ä¸€ä¸ªæ¡¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¹Ÿå°±æ˜¯æ„å‘³ç€è¿™ä¸¤ä¸ªå…ƒç´ æ˜¯ <em>è¶³å¤Ÿæ¥è¿‘çš„</em> äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±ç›´æ¥å¾—åˆ°ç­”æ¡ˆäº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€ä½¿ç”¨ä¸€ä¸ªæ ‡ç­¾ä¸ºæ¡¶åºå·çš„æ•£åˆ—è¡¨å°±å¯ä»¥äº†ã€‚ </p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Get the ID of the bucket from element value x and bucket width w</span></span><br><span class="line">    <span class="comment">// In Java, `-3 / 5 = 0` and but we need `-3 / 5 = -1`.</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getID</span><span class="params">(<span class="keyword">long</span> x, <span class="keyword">long</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> ? (x + <span class="number">1</span>) / w - <span class="number">1</span> : x / w;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyAlmostDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// Key: ID of the bucket   Value: bucket  value</span></span><br><span class="line">        Map&lt;Long, Long&gt; d = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">long</span> w = (<span class="keyword">long</span>)t + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">long</span> m = getID(nums[i], w);</span><br><span class="line">            <span class="comment">// check if bucket m is empty, each bucket may contain at most one element</span></span><br><span class="line">            <span class="keyword">if</span> (d.containsKey(m))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// check the neighbor buckets for almost duplicate</span></span><br><span class="line">            <span class="keyword">if</span> (d.containsKey(m - <span class="number">1</span>) &amp;&amp; Math.abs(nums[i] - d.get(m - <span class="number">1</span>)) &lt; w)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (d.containsKey(m + <span class="number">1</span>) &amp;&amp; Math.abs(nums[i] - d.get(m + <span class="number">1</span>)) &lt; w)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// now bucket m is empty and no almost duplicate in nei***or buckets</span></span><br><span class="line">            d.put(m, (<span class="keyword">long</span>)nums[i]);</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= k) d.remove(getID(nums[i - k], w));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(n)</em></li></ul><p>å¯¹äºè¿™ <em>n</em> ä¸ªå…ƒç´ ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¤šåªéœ€è¦åœ¨æ•£åˆ—è¡¨ä¸­åšä¸‰æ¬¡ <code>æœç´¢</code>ï¼Œä¸€æ¬¡ <code>æ’å…¥</code> å’Œä¸€æ¬¡ <code>åˆ é™¤</code>ã€‚è¿™äº›æ“ä½œæ˜¯å¸¸é‡æ—¶é—´å¤æ‚åº¦çš„ã€‚å› æ­¤ï¼Œæ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º <em>O(n)</em>ã€‚</p><ul><li>ç©ºé—´å¤æ‚åº¦ï¼šO(min(n,k))<br>éœ€è¦å¼€è¾Ÿçš„é¢å¤–ç©ºé—´å–å†³äº†æ•£åˆ—è¡¨çš„å¤§å°ï¼Œå…¶å¤§å°è·Ÿå®ƒæ‰€åŒ…å«çš„å…ƒç´ æ•°é‡æˆçº¿æ€§å…³ç³»ã€‚æ•£åˆ—è¡¨çš„å¤§å°çš„ä¸Šé™åŒæ—¶ç”± <em>n</em> å’Œ <em>k</em> å†³å®šã€‚å› æ­¤ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(min(n,k))  ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æ•´æ•°æ•°ç»„ nums ä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸‹æ ‡ i å’Œ jï¼Œä½¿å¾— nums [i] å’Œ nums [j] çš„å·®çš„ç»å¯¹å€¼å°äºç­‰äº t ï¼Œä¸”æ»¡è¶³ i å’Œ j çš„å·®çš„ç»å¯¹å€¼ä¹Ÿå°äºç­‰äº Ä· ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Sort" scheme="http://yoursite.com/tags/Sort/"/>
    
      <category term="Ordered Map" scheme="http://yoursite.com/tags/Ordered-Map/"/>
    
  </entry>
  
  <entry>
    <title>217. å­˜åœ¨é‡å¤å…ƒç´ </title>
    <link href="http://yoursite.com/2020/06/29/217.%20%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/"/>
    <id>http://yoursite.com/2020/06/29/217. å­˜åœ¨é‡å¤å…ƒç´ /</id>
    <published>2020-06-29T06:33:12.000Z</published>
    <updated>2020-06-29T06:41:10.110Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚å¦‚æœä»»æ„ä¸€å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› true ã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› false ã€‚</p><a id="more"></a><h1 id="å“ˆå¸Œè¡¨è§£å†³"><a href="#å“ˆå¸Œè¡¨è§£å†³" class="headerlink" title="å“ˆå¸Œè¡¨è§£å†³"></a>å“ˆå¸Œè¡¨è§£å†³</h1><p>å¯ä»¥ç”¨Setæˆ–HashMapæ¥è§£å†³</p><figure class="highlight java"><figcaption><span>[solution 3]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;(nums.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x: nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> (set.contains(x)) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        set.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´å¤šè¯¦ç»†åˆ†æè§<a href="https://leetcode-cn.com/problems/contains-duplicate/solution/cun-zai-zhong-fu-yuan-su-by-leetcode/" target="_blank" rel="noopener">^1</a></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://leetcode-cn.com/problems/contains-duplicate-ii/" target="_blank" rel="noopener">219 å­˜åœ¨é‡å¤å…ƒç´  II</a></li><li><a href="https://leetcode-cn.com/problems/contains-duplicate-iii/" target="_blank" rel="noopener">220 å­˜åœ¨é‡å¤å…ƒç´  III</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚å¦‚æœä»»æ„ä¸€å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› true ã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› false ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Hash Table" scheme="http://yoursite.com/tags/Hash-Table/"/>
    
  </entry>
  
  <entry>
    <title>219. å­˜åœ¨é‡å¤å…ƒç´ II</title>
    <link href="http://yoursite.com/2020/06/29/219.%20%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0II/"/>
    <id>http://yoursite.com/2020/06/29/219. å­˜åœ¨é‡å¤å…ƒç´ II/</id>
    <published>2020-06-29T06:33:12.000Z</published>
    <updated>2020-06-29T06:55:28.045Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• i å’Œ jï¼Œä½¿å¾— nums [i] = nums [j]ï¼Œå¹¶ä¸” i å’Œ j çš„å·®çš„ ç»å¯¹å€¼ è‡³å¤šä¸º kã€‚</p><a id="more"></a><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: nums = [1,2,3,1], k = 3è¾“å‡º: true</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: nums = [1,0,1,1], k = 1è¾“å‡º: true</code></pre><p>ç¤ºä¾‹ 3:</p><pre><code>è¾“å…¥: nums = [1,2,3,1,2,3], k = 2è¾“å‡º: false</code></pre><h1 id="è§£æ³•ä¸€ï¼šHashMap"><a href="#è§£æ³•ä¸€ï¼šHashMap" class="headerlink" title="è§£æ³•ä¸€ï¼šHashMap"></a>è§£æ³•ä¸€ï¼šHashMap</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean containsNearbyDuplicate(int[] nums, int k) &#123;</span><br><span class="line">        //Key-&gt;nums[i] , Value-&gt;i</span><br><span class="line">        HashMap&lt;Integer,Integer&gt; hashMap=new HashMap&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            if (hashMap.containsKey(nums[i])) &#123;</span><br><span class="line">                if (Math.abs(i - hashMap.get(nums[i])) &lt;= k) &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            hashMap.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–¹æ³•äºŒ-ï¼ˆæ•£åˆ—è¡¨ï¼‰"><a href="#æ–¹æ³•äºŒ-ï¼ˆæ•£åˆ—è¡¨ï¼‰" class="headerlink" title="æ–¹æ³•äºŒ ï¼ˆæ•£åˆ—è¡¨ï¼‰"></a>æ–¹æ³•äºŒ ï¼ˆæ•£åˆ—è¡¨ï¼‰</h1><p><strong>æ€è·¯</strong></p><p>ç”¨æ•£åˆ—è¡¨æ¥ç»´æŠ¤è¿™ä¸ª<em>k</em>å¤§å°çš„æ»‘åŠ¨çª—å£ã€‚<a href="https://leetcode-cn.com/problems/contains-duplicate-ii/solution/cun-zai-zhong-fu-yuan-su-ii-by-leetcode/" target="_blank" rel="noopener">^1</a></p><p><strong>ç®—æ³•</strong></p><p>åœ¨ä¹‹å‰çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹æ•°æ—¶é—´å¤æ‚åº¦çš„ <code>æœç´¢</code> æ“ä½œæ˜¯ä¸å¤Ÿçš„ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ”¯æŒåœ¨å¸¸é‡æ—¶é—´å†…å®Œæˆ <code>æœç´¢</code>ï¼Œ<code>åˆ é™¤</code>ï¼Œ<code>æ’å…¥</code> æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œé‚£å°±æ˜¯æ•£åˆ—è¡¨ã€‚è¿™ä¸ªç®—æ³•çš„å®ç°è·Ÿæ–¹æ³•äºŒå‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p><ul><li>éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ åšä»¥ä¸‹æ“ä½œï¼š<ul><li>åœ¨æ•£åˆ—è¡¨ä¸­æœç´¢å½“å‰å…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±è¿”å› <code>true</code>ã€‚</li><li>åœ¨æ•£åˆ—è¡¨ä¸­æ’å…¥å½“å‰å…ƒç´ ã€‚</li><li>å¦‚æœå½“å‰æ•£åˆ—è¡¨çš„å¤§å°è¶…è¿‡äº† <em>k</em>ï¼Œ åˆ é™¤æ•£åˆ—è¡¨ä¸­æœ€æ—§çš„å…ƒç´ ã€‚</li></ul></li><li>è¿”å› <code>false</code>ã€‚</li></ul><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (set.contains(nums[i])) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        set.add(nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (set.size() &gt; k) &#123;</span><br><span class="line">            set.remove(nums[i - k]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(n)</em><br>æˆ‘ä»¬ä¼šåš <em>n</em> æ¬¡ <code>æœç´¢</code>ï¼Œ<code>åˆ é™¤</code>ï¼Œ<code>æ’å…¥</code> æ“ä½œï¼Œæ¯æ¬¡æ“ä½œéƒ½è€—è´¹å¸¸æ•°æ—¶é—´ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼šO(min(n,k)) </p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• i å’Œ jï¼Œä½¿å¾— nums [i] = nums [j]ï¼Œå¹¶ä¸” i å’Œ j çš„å·®çš„ ç»å¯¹å€¼ è‡³å¤šä¸º kã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
      <category term="Hash Table" scheme="http://yoursite.com/tags/Hash-Table/"/>
    
  </entry>
  
  <entry>
    <title>152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„</title>
    <link href="http://yoursite.com/2020/06/29/152.%20%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84/"/>
    <id>http://yoursite.com/2020/06/29/152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„/</id>
    <published>2020-06-29T06:06:12.000Z</published>
    <updated>2020-06-29T06:23:19.793Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºæ•°ç»„ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­æ•°ç»„ï¼ˆè¯¥å­æ•°ç»„ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„æ‰€å¯¹åº”çš„ä¹˜ç§¯ã€‚</p><a id="more"></a><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: [2,3,-2,4]è¾“å‡º: 6è§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: [-2,0,-1]è¾“å‡º: 0è§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚</code></pre><h1 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h1><p>è¿™é“é¢˜æ¯”è¾ƒç»å…¸ï¼Œå®˜æ–¹è§£æ³•å¯ä»¥è§<a href="https://leetcode-cn.com/problems/maximum-product-subarray/solution/cheng-ji-zui-da-zi-shu-zu-by-leetcode-solution/" target="_blank" rel="noopener">^1</a>,æˆ‘é¦–å…ˆæƒ³åˆ°ç”¨å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„æ–¹æ³•æ¥è§£å†³ï¼Œä½†æ˜¯è¦æ³¨æ„ä¸¤ä¸ªæµ‹è¯•æ ·ä¾‹[-2]å’Œ[0,2]ï¼Œéœ€è¦å¯¹å…¨å±€å’Œå±€éƒ¨æœ€å¤§å˜é‡åšç›¸åº”å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int maxProduct(int[] nums) &#123;</span><br><span class="line">        int maxpro=nums[0];</span><br><span class="line">        for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            int localpro=nums[i];</span><br><span class="line">            maxpro = Math.max(maxpro, localpro);</span><br><span class="line">            for (int j = i+1; j &lt; nums.length; j++) &#123;</span><br><span class="line">                localpro *= nums[j];</span><br><span class="line">                maxpro = Math.max(maxpro, localpro);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return maxpro;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºæ•°ç»„ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­æ•°ç»„ï¼ˆè¯¥å­æ•°ç»„ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„æ‰€å¯¹åº”çš„ä¹˜ç§¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Dynamic Programming" scheme="http://yoursite.com/tags/Dynamic-Programming/"/>
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>189. æ—‹è½¬æ•°ç»„</title>
    <link href="http://yoursite.com/2020/06/29/189.%20%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84/"/>
    <id>http://yoursite.com/2020/06/29/189. æ—‹è½¬æ•°ç»„/</id>
    <published>2020-06-29T06:06:12.000Z</published>
    <updated>2020-06-29T06:23:14.982Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚</p><a id="more"></a><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: [1,2,3,4,5,6,7] å’Œ k = 3è¾“å‡º: [5,6,7,1,2,3,4]è§£é‡Š:å‘å³æ—‹è½¬ 1 æ­¥: [7,1,2,3,4,5,6]å‘å³æ—‹è½¬ 2 æ­¥: [6,7,1,2,3,4,5]å‘å³æ—‹è½¬ 3 æ­¥: [5,6,7,1,2,3,4]</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: [-1,-100,3,99] å’Œ k = 2è¾“å‡º: [3,99,-1,-100]è§£é‡Š: å‘å³æ—‹è½¬ 1 æ­¥: [99,-1,-100,3]å‘å³æ—‹è½¬ 2 æ­¥: [3,99,-1,-100]</code></pre><p>è¯´æ˜:</p><pre><code>å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¦æ±‚ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„ åŸåœ° ç®—æ³•ã€‚</code></pre><h2 id="æ–¹æ³•-1ï¼šæš´åŠ›"><a href="#æ–¹æ³•-1ï¼šæš´åŠ›" class="headerlink" title="æ–¹æ³• 1ï¼šæš´åŠ›"></a>æ–¹æ³• 1ï¼šæš´åŠ›</h2><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ—‹è½¬ k æ¬¡ï¼Œæ¯æ¬¡å°†æ•°ç»„æ—‹è½¬ 1 ä¸ªå…ƒç´ ã€‚</p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp, previous;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            previous = nums[nums.length - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; nums.length; j++) &#123;</span><br><span class="line">                temp = nums[j];</span><br><span class="line">                nums[j] = previous;</span><br><span class="line">                previous = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(n*k)</em> ã€‚æ¯ä¸ªå…ƒç´ éƒ½è¢«ç§»åŠ¨ 1 æ­¥ï¼ˆ<em>O(n)</em>ï¼‰ kæ¬¡ï¼ˆ<em>O(k)</em>ï¼‰ ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(1)</em> ã€‚æ²¡æœ‰é¢å¤–ç©ºé—´è¢«ä½¿ç”¨ã€‚</li></ul><h2 id="æ–¹æ³•-2ï¼šä½¿ç”¨é¢å¤–çš„æ•°ç»„"><a href="#æ–¹æ³•-2ï¼šä½¿ç”¨é¢å¤–çš„æ•°ç»„" class="headerlink" title="æ–¹æ³• 2ï¼šä½¿ç”¨é¢å¤–çš„æ•°ç»„"></a>æ–¹æ³• 2ï¼šä½¿ç”¨é¢å¤–çš„æ•°ç»„</h2><p><strong>ç®—æ³•</strong></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„æ¥å°†æ¯ä¸ªå…ƒç´ æ”¾åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šï¼Œä¹Ÿå°±æ˜¯åŸæœ¬æ•°ç»„é‡Œä¸‹æ ‡ä¸º <em>i</em> çš„æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ° <img src="./p___i+k_%%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6_.png" alt="(i+k)\%æ•°ç»„é•¿åº¦ ">  çš„ä½ç½®ã€‚ç„¶åæŠŠæ–°çš„æ•°ç»„æ‹·è´åˆ°åŸæ•°ç»„ä¸­ã€‚</p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            a[(i + k) % nums.length] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            nums[i] = a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š <em>O(n)</em> ã€‚å°†æ•°å­—æ”¾åˆ°æ–°çš„æ•°ç»„ä¸­éœ€è¦ä¸€ééå†ï¼Œå¦ä¸€è¾¹æ¥æŠŠæ–°æ•°ç»„çš„å…ƒç´ æ‹·è´å›åŸæ•°ç»„ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š <em>O(n)</em>ã€‚å¦ä¸€ä¸ªæ•°ç»„éœ€è¦åŸæ•°ç»„é•¿åº¦çš„ç©ºé—´ã€‚</li></ul><h2 id="æ–¹æ³•-3ï¼šä½¿ç”¨ç¯çŠ¶æ›¿æ¢"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨ç¯çŠ¶æ›¿æ¢" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ç¯çŠ¶æ›¿æ¢"></a>æ–¹æ³• 3ï¼šä½¿ç”¨ç¯çŠ¶æ›¿æ¢</h2><p><strong>ç®—æ³•</strong></p><p>å¦‚æœæˆ‘ä»¬ç›´æ¥æŠŠæ¯ä¸€ä¸ªæ•°å­—æ”¾åˆ°å®ƒæœ€åçš„ä½ç½®ï¼Œä½†è¿™æ ·çš„åæœæ˜¯é—å¤±åŸæ¥çš„å…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¢«æ›¿æ¢çš„æ•°å­—ä¿å­˜åœ¨å˜é‡ <em>temp</em> é‡Œé¢ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¢«æ›¿æ¢æ•°å­—ï¼ˆ<em>temp*ï¼‰æ”¾åˆ°å®ƒæ­£ç¡®çš„ä½ç½®ï¼Œå¹¶ç»§ç»­è¿™ä¸ªè¿‡ç¨‹ *n</em> æ¬¡ï¼Œ <em>n</em> æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å°†æ•°ç»„é‡Œæ‰€æœ‰çš„å…ƒç´ éƒ½ç§»åŠ¨ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœ <img src="./p__n%k==0_.png" alt="n\%k==0 "> ï¼Œå…¶ä¸­ <img src="./p__k=k%n_.png" alt="k=k\%n ">  ï¼ˆå› ä¸ºå¦‚æœ <em>k</em> å¤§äº <em>n</em> ï¼Œç§»åŠ¨ <em>k</em> æ¬¡å®é™…ä¸Šç›¸å½“äºç§»åŠ¨ <img src="./p__k%n_.png" alt="k\%n ">  æ¬¡ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨æ²¡æœ‰éå†æ‰€æœ‰æ•°å­—çš„æƒ…å†µä¸‹å›åˆ°å‡ºå‘æ•°å­—ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä»ä¸‹ä¸€ä¸ªæ•°å­—å¼€å§‹å†é‡å¤ç›¸åŒçš„è¿‡ç¨‹ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸Šé¢æ–¹æ³•çš„è¯æ˜ã€‚å‡è®¾ï¼Œæ•°ç»„é‡Œæˆ‘ä»¬æœ‰ <em>n</em> ä¸ªå…ƒç´ å¹¶ä¸” <em>k</em> æ˜¯è¦æ±‚ç§»åŠ¨çš„æ¬¡æ•°ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå‡è®¾ <img src="./p__n%k=0_.png" alt="n\%k=0 ">  ã€‚ç¬¬ä¸€è½®ä¸­ï¼Œæ‰€æœ‰ç§»åŠ¨æ•°å­—çš„ä¸‹æ ‡ <em>i</em> æ»¡è¶³ <img src="./p__i%k==0_.png" alt="i\%k==0 ">  ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ¯è·³ <em>k</em> æ­¥ï¼Œæˆ‘ä»¬åªä¼šåˆ°è¾¾ç›¸è·ä¸º <em>k</em> ä¸ªä½ç½®ä¸‹æ ‡çš„æ•°ã€‚æ¯ä¸€è½®ï¼Œæˆ‘ä»¬éƒ½ä¼šç§»åŠ¨ <img src="./p__frac%7Bn%7D%7Bk%7D_.png" alt="\frac{n}{k} ">  ä¸ªå…ƒç´ ã€‚ä¸‹ä¸€è½®ä¸­ï¼Œæˆ‘ä»¬ä¼šç§»åŠ¨æ»¡è¶³ <img src="./p__i%k==1_.png" alt="i\%k==1 ">  çš„ä½ç½®çš„æ•°ã€‚è¿™æ ·çš„è½®æ¬¡ä¼šä¸€ç›´æŒç»­åˆ°æˆ‘ä»¬å†æ¬¡é‡åˆ° <img src="./p__i%k==0_.png" alt="i\%k==0 ">  çš„åœ°æ–¹ä¸ºæ­¢ï¼Œæ­¤æ—¶ <em>i=k</em> ã€‚æ­¤æ—¶åœ¨æ­£ç¡®ä½ç½®ä¸Šçš„æ•°å­—å…±æœ‰ <img src="./p__k_times_frac%7Bn%7D%7Bk%7D=n_.png" alt="k\times\frac{n}{k}=n ">  ä¸ªã€‚å› æ­¤æ‰€æœ‰æ•°å­—éƒ½åœ¨æ­£ç¡®ä½ç½®ä¸Šã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ¥ä¸‹æ¥çš„ä¾‹å­ï¼Œä»¥æ›´å¥½åœ°è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nums: [1, 2, 3, 4, 5, 6]</span><br><span class="line">k: 2</span><br></pre></td></tr></table></figure></p><p> <a href="https://pic.leetcode-cn.com/f0493a97cdb7bc46b37306ca14e555451496f9f9c21effcad8517a81a26f30d6-image.png" target="_blank" rel="noopener">ä¾‹å­</a></p><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        k = k % nums.length;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> start = <span class="number">0</span>; count &lt; nums.length; start++) &#123;</span><br><span class="line">            <span class="keyword">int</span> current = start;</span><br><span class="line">            <span class="keyword">int</span> prev = nums[start];</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> next = (current + k) % nums.length;</span><br><span class="line">                <span class="keyword">int</span> temp = nums[next];</span><br><span class="line">                nums[next] = prev;</span><br><span class="line">                prev = temp;</span><br><span class="line">                current = next;</span><br><span class="line">                count++;</span><br><span class="line">            &#125; <span class="keyword">while</span> (start != current);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(n)</em> ã€‚åªéå†äº†æ¯ä¸ªå…ƒç´ ä¸€æ¬¡ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(1)</em> ã€‚ä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–ç©ºé—´ã€‚</li></ul><h2 id="æ–¹æ³•-4ï¼šä½¿ç”¨åè½¬"><a href="#æ–¹æ³•-4ï¼šä½¿ç”¨åè½¬" class="headerlink" title="æ–¹æ³• 4ï¼šä½¿ç”¨åè½¬"></a>æ–¹æ³• 4ï¼šä½¿ç”¨åè½¬</h2><p><strong>ç®—æ³•</strong></p><p>è¿™ä¸ªæ–¹æ³•åŸºäºè¿™ä¸ªäº‹å®ï¼šå½“æˆ‘ä»¬æ—‹è½¬æ•°ç»„ k æ¬¡ï¼Œ <img src="./p__k%n_.png" alt="k\%n ">  ä¸ªå°¾éƒ¨å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°å¤´éƒ¨ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¼šè¢«å‘åç§»åŠ¨ã€‚</p><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ‰€æœ‰å…ƒç´ åè½¬ã€‚ç„¶ååè½¬å‰ k ä¸ªå…ƒç´ ï¼Œå†åè½¬åé¢ <em>n-k</em> ä¸ªå…ƒç´ ï¼Œå°±èƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚</p><p>æˆ‘ç”¨è¿™ç§æ–¹æ³•æ¥è§£å†³æ—¶é‡åˆ°æ•°ç»„è¶Šç•Œé”™è¯¯ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æŠŠkå–æ¨¡ï¼Œå› ä¸ºæœ‰äº›æƒ…å†µä¸‹kå¯èƒ½å¤§äºæ•°ç»„é•¿åº¦ã€‚è¿™ä¸ªæ˜“é”™ç‚¹éœ€è¦æ³¨æ„ã€‚</p><p>å‡è®¾ <em>n=7</em> ä¸” <em>k=3</em> ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹æ•°ç»„                  : 1 2 3 4 5 6 7</span><br><span class="line">åè½¬æ‰€æœ‰æ•°å­—å             : 7 6 5 4 3 2 1</span><br><span class="line">åè½¬å‰ k ä¸ªæ•°å­—å          : 5 6 7 4 3 2 1</span><br><span class="line">åè½¬å n-k ä¸ªæ•°å­—å        : 5 6 7 1 2 3 4 --&gt; ç»“æœ</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        k %= nums.length;</span><br><span class="line">        reverse(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">        reverse(nums, <span class="number">0</span>, k - <span class="number">1</span>);</span><br><span class="line">        reverse(nums, k, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = nums[start];</span><br><span class="line">            nums[start] = nums[end];</span><br><span class="line">            nums[end] = temp;</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(n)</em> ã€‚ <em>n</em> ä¸ªå…ƒç´ è¢«åè½¬äº†æ€»å…± 3 æ¬¡ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(1)</em> ã€‚ æ²¡æœ‰ä½¿ç”¨é¢å¤–çš„ç©ºé—´ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>63. ä¸åŒè·¯å¾„II</title>
    <link href="http://yoursite.com/2020/06/28/63.%20%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84II/"/>
    <id>http://yoursite.com/2020/06/28/63. ä¸åŒè·¯å¾„II/</id>
    <published>2020-06-28T12:50:12.000Z</published>
    <updated>2020-06-29T06:22:31.214Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><a id="more"></a><p>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</p><p>è¯´æ˜ï¼šm å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p><p>ç¤ºä¾‹1:</p><pre><code>è¾“å…¥:[  [0,0,0],  [0,1,0],  [0,0,0]]è¾“å‡º: 2è§£é‡Š:3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹ -&gt; å‘ä¸‹2. å‘ä¸‹ -&gt; å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</code></pre><h2 id="æ–¹æ³•-1ï¼šåŠ¨æ€è§„åˆ’-1"><a href="#æ–¹æ³•-1ï¼šåŠ¨æ€è§„åˆ’-1" class="headerlink" title="æ–¹æ³• 1ï¼šåŠ¨æ€è§„åˆ’^1"></a>æ–¹æ³• 1ï¼šåŠ¨æ€è§„åˆ’<a href="https://leetcode-cn.com/problems/unique-paths-ii/solution/bu-tong-lu-jing-ii-by-leetcode/" target="_blank" rel="noopener">^1</a></h2><p><strong>ç›´è§‰</strong></p><p>æœºå™¨äººåªå¯ä»¥å‘ä¸‹å’Œå‘å³ç§»åŠ¨ï¼Œå› æ­¤ç¬¬ä¸€è¡Œçš„æ ¼å­åªèƒ½ä»å·¦è¾¹çš„æ ¼å­ç§»åŠ¨åˆ°ï¼Œç¬¬ä¸€åˆ—çš„æ ¼å­åªèƒ½ä»ä¸Šæ–¹çš„æ ¼å­ç§»åŠ¨åˆ°ã€‚</p><p>å¦‚æœæ ¼å­ä¸Šæœ‰éšœç¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸è€ƒè™‘åŒ…å«è¿™ä¸ªæ ¼å­çš„ä»»ä½•è·¯å¾„ã€‚æˆ‘ä»¬ä»å·¦è‡³å³ã€ä»ä¸Šè‡³ä¸‹çš„éå†æ•´ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆåœ¨åˆ°è¾¾æŸä¸ªé¡¶ç‚¹ä¹‹å‰æˆ‘ä»¬å°±å·²ç»è·å¾—äº†åˆ°è¾¾å‰é©±èŠ‚ç‚¹çš„æ–¹æ¡ˆæ•°ï¼Œè¿™å°±å˜æˆäº†ä¸€ä¸ª<code>åŠ¨æ€è§„åˆ’</code>é—®é¢˜ã€‚æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª <code>obstacleGrid</code> æ•°ç»„ä½œä¸º DP æ•°ç»„ã€‚</p><p><code>æ³¨æ„ï¼š</code> æ ¹æ®é¢˜ç›®æè¿°ï¼ŒåŒ…å«éšœç¢ç‰©çš„æ ¼ç‚¹æœ‰æƒå€¼ <code>1</code>ï¼Œæˆ‘ä»¬ä¾æ­¤æ¥åˆ¤æ–­æ˜¯å¦åŒ…å«åœ¨è·¯å¾„ä¸­ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç©ºé—´æ¥å­˜å‚¨åˆ°è¾¾è¿™ä¸ªæ ¼ç‚¹çš„æ–¹æ¡ˆæ•°ã€‚</p><p><strong>ç®—æ³•</strong></p><ol><li>å¦‚æœç¬¬ä¸€ä¸ªæ ¼ç‚¹ <code>obstacleGrid[0,0]</code> æ˜¯ <code>1</code>ï¼Œè¯´æ˜æœ‰éšœç¢ç‰©ï¼Œé‚£ä¹ˆæœºå™¨äººä¸èƒ½åšä»»ä½•ç§»åŠ¨ï¼Œæˆ‘ä»¬è¿”å›ç»“æœ <code>0</code>ã€‚</li><li>å¦åˆ™ï¼Œå¦‚æœ <code>obstacleGrid[0,0]</code> æ˜¯ <code>0</code>ï¼Œæˆ‘ä»¬åˆå§‹åŒ–è¿™ä¸ªå€¼ä¸º <code>1</code> ç„¶åç»§ç»­ç®—æ³•ã€‚</li><li>éå†ç¬¬ä¸€è¡Œï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ ¼ç‚¹åˆå§‹å€¼ä¸º <code>1</code> ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹æœ‰éšœç¢ç‰©ï¼Œæ²¡æœ‰è·¯å¾„å¯ä»¥é€šè¿‡ï¼Œè®¾å€¼ä¸º <code>0</code> ï¼›å¦åˆ™è®¾è¿™ä¸ªå€¼æ˜¯å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ <code>obstacleGrid[i,j] = obstacleGrid[i,j-1]</code>ã€‚</li><li>éå†ç¬¬ä¸€åˆ—ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ ¼ç‚¹åˆå§‹å€¼ä¸º <code>1</code> ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹æœ‰éšœç¢ç‰©ï¼Œæ²¡æœ‰è·¯å¾„å¯ä»¥é€šè¿‡ï¼Œè®¾å€¼ä¸º <code>0</code> ï¼›å¦åˆ™è®¾è¿™ä¸ªå€¼æ˜¯å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ <code>obstacleGrid[i,j] = obstacleGrid[i-1,j]</code>ã€‚</li><li>ç°åœ¨ï¼Œä» <code>obstacleGrid[1,1]</code> å¼€å§‹éå†æ•´ä¸ªæ•°ç»„ï¼Œå¦‚æœæŸä¸ªæ ¼ç‚¹åˆå§‹ä¸åŒ…å«ä»»ä½•éšœç¢ç‰©ï¼Œå°±æŠŠå€¼èµ‹ä¸ºä¸Šæ–¹å’Œå·¦ä¾§ä¸¤ä¸ªæ ¼ç‚¹æ–¹æ¡ˆæ•°ä¹‹å’Œ <code>obstacleGrid[i,j] = obstacleGrid[i-1,j] + obstacleGrid[i,j-1]</code>ã€‚</li><li>å¦‚æœè¿™ä¸ªç‚¹æœ‰éšœç¢ç‰©ï¼Œè®¾å€¼ä¸º <code>0</code> ï¼Œè¿™å¯ä»¥ä¿è¯ä¸ä¼šå¯¹åé¢çš„è·¯å¾„äº§ç”Ÿè´¡çŒ®ã€‚</li></ol><figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> R = obstacleGrid.length;</span><br><span class="line">        <span class="keyword">int</span> C = obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the starting cell has an obstacle, then simply return as there would be</span></span><br><span class="line">        <span class="comment">// no paths to the destination.</span></span><br><span class="line">        <span class="keyword">if</span> (obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Number of ways of reaching the starting cell = 1.</span></span><br><span class="line">        obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Filling the values for the first column</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; R; i++) &#123;</span><br><span class="line">            obstacleGrid[i][<span class="number">0</span>] = (obstacleGrid[i][<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; obstacleGrid[i - <span class="number">1</span>][<span class="number">0</span>] == <span class="number">1</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Filling the values for the first row</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; C; i++) &#123;</span><br><span class="line">            obstacleGrid[<span class="number">0</span>][i] = (obstacleGrid[<span class="number">0</span>][i] == <span class="number">0</span> &amp;&amp; obstacleGrid[<span class="number">0</span>][i - <span class="number">1</span>] == <span class="number">1</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Starting from cell(1,1) fill up the values</span></span><br><span class="line">        <span class="comment">// No. of ways of reaching cell[i][j] = cell[i - 1][j] + cell[i][j - 1]</span></span><br><span class="line">        <span class="comment">// i.e. From above and left.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; R; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; C; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (obstacleGrid[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                    obstacleGrid[i][j] = obstacleGrid[i - <span class="number">1</span>][j] + obstacleGrid[i][j - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    obstacleGrid[i][j] = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Return value stored in rightmost bottommost cell. That is the destination.</span></span><br><span class="line">        <span class="keyword">return</span> obstacleGrid[R - <span class="number">1</span>][C - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ ï¼š O(M\timesN)   ã€‚é•¿æ–¹å½¢ç½‘æ ¼çš„å¤§å°æ˜¯ M\timesN ï¼Œè€Œè®¿é—®æ¯ä¸ªæ ¼ç‚¹æ°å¥½ä¸€æ¬¡ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ ï¼š <em>O(1)</em>ã€‚æˆ‘ä»¬åˆ©ç”¨ <code>obstacleGrid</code> ä½œä¸º DP æ•°ç»„ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–çš„ç©ºé—´ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Dynamic Programming" scheme="http://yoursite.com/tags/Dynamic-Programming/"/>
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>980. ä¸åŒè·¯å¾„ III</title>
    <link href="http://yoursite.com/2020/06/28/980.%20%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84%20III/"/>
    <id>http://yoursite.com/2020/06/28/980. ä¸åŒè·¯å¾„ III/</id>
    <published>2020-06-28T12:50:12.000Z</published>
    <updated>2020-06-29T10:06:02.298Z</updated>
    
    <content type="html"><![CDATA[<p>è¿”å›åœ¨å››ä¸ªæ–¹å‘ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰ä¸Šè¡Œèµ°æ—¶ï¼Œä»èµ·å§‹æ–¹æ ¼åˆ°ç»“æŸæ–¹æ ¼çš„ä¸åŒè·¯å¾„çš„æ•°ç›®ï¼Œæ¯ä¸€ä¸ªæ— éšœç¢æ–¹æ ¼éƒ½è¦é€šè¿‡ä¸€æ¬¡ã€‚</p><a id="more"></a><h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>åœ¨äºŒç»´ç½‘æ ¼ grid ä¸Šï¼Œæœ‰ 4 ç§ç±»å‹çš„æ–¹æ ¼ï¼š</p><pre><code>1 è¡¨ç¤ºèµ·å§‹æ–¹æ ¼ã€‚ä¸”åªæœ‰ä¸€ä¸ªèµ·å§‹æ–¹æ ¼ã€‚2 è¡¨ç¤ºç»“æŸæ–¹æ ¼ï¼Œä¸”åªæœ‰ä¸€ä¸ªç»“æŸæ–¹æ ¼ã€‚0 è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥èµ°è¿‡çš„ç©ºæ–¹æ ¼ã€‚-1 è¡¨ç¤ºæˆ‘ä»¬æ— æ³•è·¨è¶Šçš„éšœç¢ã€‚</code></pre><p>è¿”å›åœ¨å››ä¸ªæ–¹å‘ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰ä¸Šè¡Œèµ°æ—¶ï¼Œä»èµ·å§‹æ–¹æ ¼åˆ°ç»“æŸæ–¹æ ¼çš„ä¸åŒè·¯å¾„çš„æ•°ç›®ï¼Œæ¯ä¸€ä¸ªæ— éšœç¢æ–¹æ ¼éƒ½è¦é€šè¿‡ä¸€æ¬¡ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><pre><code>è¾“å…¥ï¼š[[1,0,0,0],[0,0,0,0],[0,0,2,-1]]è¾“å‡ºï¼š2è§£é‡Šï¼šæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸¤æ¡è·¯å¾„ï¼š1. (0,0),(0,1),(0,2),(0,3),(1,3),(1,2),(1,1),(1,0),(2,0),(2,1),(2,2)2. (0,0),(1,0),(2,0),(2,1),(1,1),(0,1),(0,2),(0,3),(1,3),(1,2),(2,2)</code></pre><p>ç¤ºä¾‹ 2ï¼š</p><pre><code>è¾“å…¥ï¼š[[1,0,0,0],[0,0,0,0],[0,0,0,2]]è¾“å‡ºï¼š4è§£é‡Šï¼šæˆ‘ä»¬æœ‰ä»¥ä¸‹å››æ¡è·¯å¾„ï¼š 1. (0,0),(0,1),(0,2),(0,3),(1,3),(1,2),(1,1),(1,0),(2,0),(2,1),(2,2),(2,3)2. (0,0),(0,1),(1,1),(1,0),(2,0),(2,1),(2,2),(1,2),(0,2),(0,3),(1,3),(2,3)3. (0,0),(1,0),(2,0),(2,1),(2,2),(1,2),(1,1),(0,1),(0,2),(0,3),(1,3),(2,3)4. (0,0),(1,0),(2,0),(2,1),(1,1),(0,1),(0,2),(0,3),(1,3),(1,2),(2,2),(2,3)</code></pre><p>ç¤ºä¾‹ 3ï¼š</p><pre><code>è¾“å…¥ï¼š[[0,1],[2,0]]è¾“å‡ºï¼š0è§£é‡Šï¼šæ²¡æœ‰ä¸€æ¡è·¯èƒ½å®Œå…¨ç©¿è¿‡æ¯ä¸€ä¸ªç©ºçš„æ–¹æ ¼ä¸€æ¬¡ã€‚è¯·æ³¨æ„ï¼Œèµ·å§‹å’Œç»“æŸæ–¹æ ¼å¯ä»¥ä½äºç½‘æ ¼ä¸­çš„ä»»æ„ä½ç½®ã€‚</code></pre><p>æç¤ºï¼š</p><p>1 &lt;= grid.length * grid[0].length &lt;= 20</p><h4 id="æ–¹æ³•ä¸€ï¼šå›æº¯æ·±åº¦ä¼˜å…ˆæœç´¢"><a href="#æ–¹æ³•ä¸€ï¼šå›æº¯æ·±åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå›æº¯æ·±åº¦ä¼˜å…ˆæœç´¢"></a>æ–¹æ³•ä¸€ï¼šå›æº¯æ·±åº¦ä¼˜å…ˆæœç´¢</h4><p><strong>æ€è·¯ä¸ç®—æ³•</strong><a href="https://leetcode-cn.com/problems/unique-paths-iii/solution/bu-tong-lu-jing-iii-by-leetcode/" target="_blank" rel="noopener">^1</a></p><p>è®©æˆ‘ä»¬å°è¯•éå†æ¯ä¸€ä¸ª <code>0</code> æ–¹æ ¼ï¼Œå¹¶åœ¨èµ°è¿‡çš„æ–¹æ ¼é‡Œç•™ä¸‹ä¸€ä¸ªéšœç¢ã€‚å›æº¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦åˆ é™¤é‚£äº›è‡ªå·±ç•™ä¸‹çš„éšœç¢ã€‚</p><p>ä»‹äºè¾“å…¥æ•°æ®çš„é™åˆ¶ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥é€šè¿‡çš„ï¼Œå› ä¸ºä¸€ä¸ªä¸å¥½çš„è·¯å¾„å¾ˆå¿«å°±ä¼šå› æ²¡æœ‰æ— éšœç¢çš„æ–¹æ ¼å¯ä»¥èµ°è€Œè¢«å¡ä½ã€‚ </p><figure class="highlight java"><figcaption><span>[2RULHstn-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="keyword">int</span>[][] grid;</span><br><span class="line">    <span class="keyword">int</span> targetR, targetC;</span><br><span class="line">    <span class="keyword">int</span> R, C;</span><br><span class="line">    <span class="keyword">int</span>[] dr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span>[] dc = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsIII</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.grid = grid;</span><br><span class="line">        R = grid.length;</span><br><span class="line">        C = grid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> todo = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> sourceR = <span class="number">0</span>, sourceC = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//è·å–æ— éšœç¢æ–¹æ ¼æ•°é‡å’Œå‡ºå‘ç»ˆæ­¢ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r = <span class="number">0</span>; r &lt; R; r++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; C; c++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[r][c] != -<span class="number">1</span>) &#123;</span><br><span class="line">                    todo++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (grid[r][c] == <span class="number">1</span>) &#123;</span><br><span class="line">                    sourceR = r;</span><br><span class="line">                    sourceC = c;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grid[r][c] == <span class="number">2</span>) &#123;</span><br><span class="line">                    targetR = r;</span><br><span class="line">                    targetC = c;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ans = <span class="number">0</span>;</span><br><span class="line">        dfs(sourceR, sourceC, todo);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> r, <span class="keyword">int</span> c, <span class="keyword">int</span> todo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ¯ä¸€ä¸ªæ— éšœç¢æ–¹æ ¼éƒ½è¦é€šè¿‡ä¸€æ¬¡</span></span><br><span class="line">        todo--;</span><br><span class="line">        <span class="keyword">if</span> (todo &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ°è¾¾ç»ˆç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (r == targetR &amp;&amp; c == targetC) &#123;</span><br><span class="line">            <span class="keyword">if</span> (todo == <span class="number">0</span>) &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åœ¨èµ°è¿‡çš„æ–¹æ ¼é‡Œç•™ä¸‹ä¸€ä¸ªéšœç¢</span></span><br><span class="line">        grid[r][c] = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">            <span class="keyword">int</span> nr = r + dr[k];</span><br><span class="line">            <span class="keyword">int</span> nc = c + dc[k];</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt;= nr &amp;&amp; nr &lt; R &amp;&amp; <span class="number">0</span> &lt;= nc &amp;&amp; nc &lt; C) &#123;</span><br><span class="line">                <span class="comment">//å°è¯•éå†æ¯ä¸€ä¸ª `0` æ–¹æ ¼</span></span><br><span class="line">                <span class="keyword">if</span> (grid[nr][nc] % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    dfs(nr, nc, todo);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å›æº¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦åˆ é™¤é‚£äº›è‡ªå·±ç•™ä¸‹çš„éšœç¢ã€‚</span></span><br><span class="line">        grid[r][c] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>[2RULHstn-Python]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePathsIII</span><span class="params">(self, grid)</span>:</span></span><br><span class="line">        R, C = len(grid), len(grid[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">nei</span>***<span class="title">ors</span><span class="params">(r, c)</span>:</span></span><br><span class="line">            <span class="keyword">for</span> nr, nc <span class="keyword">in</span> ((r<span class="number">-1</span>, c), (r, c<span class="number">-1</span>), (r+<span class="number">1</span>, c), (r, c+<span class="number">1</span>)):</span><br><span class="line">                <span class="keyword">if</span> <span class="number">0</span> &lt;= nr &lt; R <span class="keyword">and</span> <span class="number">0</span> &lt;= nc &lt; C <span class="keyword">and</span> grid[nr][nc] % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">yield</span> nr, nc</span><br><span class="line"></span><br><span class="line">        todo = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> r, row <span class="keyword">in</span> enumerate(grid):</span><br><span class="line">            <span class="keyword">for</span> c, val <span class="keyword">in</span> enumerate(row):</span><br><span class="line">                <span class="keyword">if</span> val != <span class="number">-1</span>: todo += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> val == <span class="number">1</span>: sr, sc = r, c</span><br><span class="line">                <span class="keyword">if</span> val == <span class="number">2</span>: tr, tc = r, c</span><br><span class="line"></span><br><span class="line">        self.ans = <span class="number">0</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(r, c, todo)</span>:</span></span><br><span class="line">            todo -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> todo &lt; <span class="number">0</span>: <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> r == tr <span class="keyword">and</span> c == tc:</span><br><span class="line">                <span class="keyword">if</span> todo == <span class="number">0</span>:</span><br><span class="line">                    self.ans += <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            grid[r][c] = <span class="number">-1</span></span><br><span class="line">            <span class="keyword">for</span> nr, nc <span class="keyword">in</span> nei***ors(r, c):</span><br><span class="line">                dfs(nr, nc, todo)</span><br><span class="line">            grid[r][c] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        dfs(sr, sc, todo)</span><br><span class="line">        <span class="keyword">return</span> self.ans</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(4^{R<em>C})</em>ï¼Œå…¶ä¸­ *R, C</em> æ˜¯è¿™ä¸ªäºŒç»´ç½‘æ ¼è¡Œä¸åˆ—çš„å¤§å°ã€‚ï¼ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ›´åŠ ç²¾ç¡®çš„ç•Œé™ï¼Œä½†æ˜¯è¿™ä¸ªç•Œé™å·²ç»è¶…è¶Šäº†æœ¬æ–‡çš„èŒƒå›´ï¼‰</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(R</em>C)*ã€‚</p></li></ul><hr><h4 id="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’"><a href="#æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’" class="headerlink" title="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’"></a>æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</h4><p><strong>æ€è·¯ä¸ç®—æ³•</strong></p><p>è®©æˆ‘ä»¬å®šä¹‰ <code>dp(r, c, todo)</code> ä¸ºä»  <code>(r, c)</code> å¼€å§‹è¡Œèµ°ï¼Œè¿˜æ²¡æœ‰éå†çš„æ— éšœç¢æ–¹æ ¼é›†åˆä¸º <code>todo</code> çš„å¥½è·¯å¾„çš„æ•°é‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸ <em>æ–¹æ³•ä¸€</em> ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡è®°å¿†åŒ–çŠ¶æ€ <code>(r, c, todo)</code> çš„ç­”æ¡ˆæ¥é¿å…é‡å¤æœç´¢ã€‚</p><figure class="highlight java"><figcaption><span>[pRtnUqNa-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="keyword">int</span>[][] grid;</span><br><span class="line">    <span class="keyword">int</span> R, C;</span><br><span class="line">    <span class="keyword">int</span> tr, tc, target;</span><br><span class="line">    <span class="keyword">int</span>[] dr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span>[] dc = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    Integer[][][] memo;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsIII</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.grid = grid;</span><br><span class="line">        R = grid.length;</span><br><span class="line">        C = grid[<span class="number">0</span>].length;</span><br><span class="line">        target = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> sr = <span class="number">0</span>, sc = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r = <span class="number">0</span>; r &lt; R; ++r)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; C; ++c) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[r][c] % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                    target |= code(r, c);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (grid[r][c] == <span class="number">1</span>) &#123;</span><br><span class="line">                    sr = r;</span><br><span class="line">                    sc = c;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (grid[r][c] == <span class="number">2</span>) &#123;</span><br><span class="line">                    tr = r;</span><br><span class="line">                    tc = c;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        memo = <span class="keyword">new</span> Integer[R][C][<span class="number">1</span> &lt;&lt; R*C];</span><br><span class="line">        <span class="keyword">return</span> dp(sr, sc, target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">code</span><span class="params">(<span class="keyword">int</span> r, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; (r * C + c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">dp</span><span class="params">(<span class="keyword">int</span> r, <span class="keyword">int</span> c, <span class="keyword">int</span> todo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (memo[r][c][todo] != <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> memo[r][c][todo];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (r == tr &amp;&amp; c == tc) &#123;</span><br><span class="line">            <span class="keyword">return</span> todo == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k) &#123;</span><br><span class="line">            <span class="keyword">int</span> nr = r + dr[k];</span><br><span class="line">            <span class="keyword">int</span> nc = c + dc[k];</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt;= nr &amp;&amp; nr &lt; R &amp;&amp; <span class="number">0</span> &lt;= nc &amp;&amp; nc &lt; C) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((todo &amp; code(nr, nc)) != <span class="number">0</span>)</span><br><span class="line">                    ans += dp(nr, nc, todo ^ code(nr, nc));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        memo[r][c][todo] = ans;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>[pRtnUqNa-Python]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePathsIII</span><span class="params">(self, grid)</span>:</span></span><br><span class="line">        R, C = len(grid), len(grid[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">code</span><span class="params">(r, c)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; (r * C + c)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">nei</span>***<span class="title">ors</span><span class="params">(r, c)</span>:</span></span><br><span class="line">            <span class="keyword">for</span> nr, nc <span class="keyword">in</span> ((r<span class="number">-1</span>, c), (r, c<span class="number">-1</span>), (r+<span class="number">1</span>, c), (r, c+<span class="number">1</span>)):</span><br><span class="line">                <span class="keyword">if</span> <span class="number">0</span> &lt;= nr &lt; R <span class="keyword">and</span> <span class="number">0</span> &lt;= nc &lt; C <span class="keyword">and</span> grid[nr][nc] % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">yield</span> nr, nc</span><br><span class="line"></span><br><span class="line">        target = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> r, row <span class="keyword">in</span> enumerate(grid):</span><br><span class="line">            <span class="keyword">for</span> c, val <span class="keyword">in</span> enumerate(row):</span><br><span class="line">                <span class="keyword">if</span> val % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    target |= code(r, c)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> val == <span class="number">1</span>:</span><br><span class="line">                    sr, sc = r, c</span><br><span class="line">                <span class="keyword">if</span> val == <span class="number">2</span>:</span><br><span class="line">                    tr, tc = r, c</span><br><span class="line"></span><br><span class="line"><span class="meta">        @lru_cache(None)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dp</span><span class="params">(r, c, todo)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> r == tr <span class="keyword">and</span> c == tc:</span><br><span class="line">                <span class="keyword">return</span> +(todo == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            ans = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> nr, nc <span class="keyword">in</span> nei***ors(r, c):</span><br><span class="line">                <span class="keyword">if</span> todo &amp; code(nr, nc):</span><br><span class="line">                    ans += dp(nr, nc, todo ^ code(nr, nc))</span><br><span class="line">            <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp(sr, sc, target)</span><br></pre></td></tr></table></figure><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(R * C * 2^{R<em>C})</em>ï¼Œå…¶ä¸­ *R, C</em> æ˜¯ç»™å®šäºŒç»´ç½‘æ ¼è¡Œä¸åˆ—çš„å¤§å°ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(R * C * 2^{R</em>C})*ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿”å›åœ¨å››ä¸ªæ–¹å‘ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰ä¸Šè¡Œèµ°æ—¶ï¼Œä»èµ·å§‹æ–¹æ ¼åˆ°ç»“æŸæ–¹æ ¼çš„ä¸åŒè·¯å¾„çš„æ•°ç›®ï¼Œæ¯ä¸€ä¸ªæ— éšœç¢æ–¹æ ¼éƒ½è¦é€šè¿‡ä¸€æ¬¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Depth-first Search" scheme="http://yoursite.com/tags/Depth-first-Search/"/>
    
      <category term="Backtracking" scheme="http://yoursite.com/tags/Backtracking/"/>
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
  </entry>
  
  <entry>
    <title>62. ä¸åŒè·¯å¾„</title>
    <link href="http://yoursite.com/2020/06/28/62.%20%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84/"/>
    <id>http://yoursite.com/2020/06/28/62. ä¸åŒè·¯å¾„/</id>
    <published>2020-06-28T12:12:12.000Z</published>
    <updated>2020-06-28T14:32:49.381Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><a id="more"></a><h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>ä¾‹å¦‚ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ª7 x 3 çš„ç½‘æ ¼ã€‚æœ‰å¤šå°‘å¯èƒ½çš„è·¯å¾„ï¼Ÿ</p><p>ç¤ºä¾‹ 1:</p><pre><code>è¾“å…¥: m = 3, n = 2è¾“å‡º: 3è§£é‡Š:ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ 3 æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹2. å‘å³ -&gt; å‘ä¸‹ -&gt; å‘å³3. å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</code></pre><p>ç¤ºä¾‹ 2:</p><pre><code>è¾“å…¥: m = 7, n = 3è¾“å‡º: 28</code></pre><p>æç¤ºï¼š</p><pre><code>1 &lt;= m, n &lt;= 100</code></pre><p>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆå°äºç­‰äº 2 * 10 ^ 9</p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><h2 id="æ€è·¯ä¸€ï¼šæ’åˆ—ç»„åˆ"><a href="#æ€è·¯ä¸€ï¼šæ’åˆ—ç»„åˆ" class="headerlink" title="æ€è·¯ä¸€ï¼šæ’åˆ—ç»„åˆ"></a><strong>æ€è·¯ä¸€ï¼šæ’åˆ—ç»„åˆ</strong></h2><p>å› ä¸ºæœºå™¨åˆ°åº•å³ä¸‹è§’ï¼Œå‘ä¸‹å‡ æ­¥ï¼Œå‘å³å‡ æ­¥éƒ½æ˜¯å›ºå®šçš„ï¼Œ</p><p>æ¯”å¦‚ï¼Œ<code>m=3, n=2</code>ï¼Œæˆ‘ä»¬åªè¦å‘ä¸‹ 1 æ­¥ï¼Œå‘å³ 2 æ­¥å°±ä¸€å®šèƒ½åˆ°è¾¾ç»ˆç‚¹ã€‚</p><p>æ‰€ä»¥æœ‰ <em>C_{m+n-2}^{m-1}</em></p><figure class="highlight python"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uniquePaths</span><span class="params">(self, m: int, n: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> int(math.factorial(m+n<span class="number">-2</span>)/math.factorial(m<span class="number">-1</span>)/math.factorial(n<span class="number">-1</span>))</span><br></pre></td></tr></table></figure><h2 id="æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’"><a href="#æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’" class="headerlink" title="æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’"></a><strong>æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’</strong></h2><p>æˆ‘ä»¬ä»¤ <code>dp[i][j]</code> æ˜¯åˆ°è¾¾ <code>i, j</code> æœ€å¤šè·¯å¾„</p><p>åŠ¨æ€æ–¹ç¨‹ï¼š<code>dp[i][j] = dp[i-1][j] + dp[i][j-1]</code></p><p>æ³¨æ„ï¼Œå¯¹äºç¬¬ä¸€è¡Œ <code>dp[0][j]</code>ï¼Œæˆ–è€…ç¬¬ä¸€åˆ— <code>dp[i][0]</code>ï¼Œç”±äºéƒ½æ˜¯åœ¨è¾¹ç•Œï¼Œæ‰€ä»¥åªèƒ½ä¸º <code>1</code></p><p>æ—¶é—´å¤æ‚åº¦ï¼š<em>O(m*n)</em></p><p>ç©ºé—´å¤æ‚åº¦ï¼š<em>O(m * n)</em></p><h2 id="ä¼˜åŒ–ï¼šå› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦-dp-i-1-j-dp-i-j-1"><a href="#ä¼˜åŒ–ï¼šå› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦-dp-i-1-j-dp-i-j-1" class="headerlink" title="ä¼˜åŒ–ï¼šå› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦ dp[i-1][j],dp[i][j-1]"></a>ä¼˜åŒ–ï¼šå› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦ <code>dp[i-1][j],dp[i][j-1]</code></h2><p>æ‰€ä»¥æˆ‘ä»¬åªè¦è®°å½•è¿™ä¸¤ä¸ªæ•°ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>æ€è·¯äºŒï¼š</p><figure class="highlight java"><figcaption><span>[1]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j] + dp[i][j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m - <span class="number">1</span>][n - <span class="number">1</span>];  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–1ï¼šç©ºé—´å¤æ‚åº¦ <em>O(2n)</em></p><figure class="highlight java"><figcaption><span>[2]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] pre = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">int</span>[] cur = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        Arrays.fill(pre, <span class="number">1</span>);</span><br><span class="line">        Arrays.fill(cur,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++)&#123;</span><br><span class="line">                cur[j] = cur[j-<span class="number">1</span>] + pre[j];</span><br><span class="line">            &#125;</span><br><span class="line">            pre = cur.clone();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre[n-<span class="number">1</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–2ï¼šç©ºé—´å¤æ‚åº¦ <em>O(n)</em></p><figure class="highlight java"><figcaption><span>[3]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] cur = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        Arrays.fill(cur,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; j++)&#123;</span><br><span class="line">                cur[j] += cur[j-<span class="number">1</span>] ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur[n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Dynamic Programming" scheme="http://yoursite.com/tags/Dynamic-Programming/"/>
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Array" scheme="http://yoursite.com/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>212. å•è¯æœç´¢II</title>
    <link href="http://yoursite.com/2020/06/28/212.%20%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2II/"/>
    <id>http://yoursite.com/2020/06/28/212. å•è¯æœç´¢II/</id>
    <published>2020-06-28T10:12:12.000Z</published>
    <updated>2020-06-28T12:02:17.704Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼boardå’Œä¸€ä¸ªå­—å…¸ä¸­çš„å•è¯åˆ—è¡¨ wordsï¼Œæ‰¾å‡ºæ‰€æœ‰åŒæ—¶åœ¨äºŒç»´ç½‘æ ¼å’Œå­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚</p><a id="more"></a><h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯åœ¨ä¸€ä¸ªå•è¯ä¸­ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚</p><p>ç¤ºä¾‹:</p><p>è¾“å…¥: </p><pre><code>words = [&quot;oath&quot;,&quot;pea&quot;,&quot;eat&quot;,&quot;rain&quot;] and board =[  [&apos;o&apos;,&apos;a&apos;,&apos;a&apos;,&apos;n&apos;],  [&apos;e&apos;,&apos;t&apos;,&apos;a&apos;,&apos;e&apos;],  [&apos;i&apos;,&apos;h&apos;,&apos;k&apos;,&apos;r&apos;],  [&apos;i&apos;,&apos;f&apos;,&apos;l&apos;,&apos;v&apos;]]</code></pre><p>è¾“å‡º:</p><pre><code>[&quot;eat&quot;,&quot;oath&quot;]</code></pre><p>è¯´æ˜:</p><p>ä½ å¯ä»¥å‡è®¾æ‰€æœ‰è¾“å…¥éƒ½ç”±å°å†™å­—æ¯ a-z ç»„æˆã€‚</p><p>æç¤º:</p><ul><li><p>ä½ éœ€è¦ä¼˜åŒ–å›æº¯ç®—æ³•ä»¥é€šè¿‡æ›´å¤§æ•°æ®é‡çš„æµ‹è¯•ã€‚ä½ èƒ½å¦æ—©ç‚¹åœæ­¢å›æº¯ï¼Ÿ</p></li><li><p>å¦‚æœå½“å‰å•è¯ä¸å­˜åœ¨äºæ‰€æœ‰å•è¯çš„å‰ç¼€ä¸­ï¼Œåˆ™å¯ä»¥ç«‹å³åœæ­¢å›æº¯ã€‚ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å¯ä»¥æœ‰æ•ˆåœ°æ‰§è¡Œè¿™æ ·çš„æ“ä½œï¼Ÿæ•£åˆ—è¡¨æ˜¯å¦å¯è¡Œï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ å‰ç¼€æ ‘å¦‚ä½•ï¼Ÿå¦‚æœä½ æƒ³å­¦ä¹ å¦‚ä½•å®ç°ä¸€ä¸ªåŸºæœ¬çš„å‰ç¼€æ ‘ï¼Œè¯·å…ˆæŸ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š å®ç°Trieï¼ˆå‰ç¼€æ ‘ï¼‰ã€‚</p></li></ul><h4 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‰ç¼€æ ‘çš„å›æº¯"><a href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‰ç¼€æ ‘çš„å›æº¯" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‰ç¼€æ ‘çš„å›æº¯"></a>æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‰ç¼€æ ‘çš„å›æº¯</h4><p>è¿™ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯ä¸€ä¸ªç®€åŒ–çš„çºµæ¨ªå¡«å­—æ¸¸æˆï¼Œåœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œå•è¯çš„è§£å·²ç»è¢«åµŒå…¥äº†ä¸€äº›æ— å…³å­—æ¯ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠå®ƒä»¬åˆ’æ‰ã€‚</p><p>ç›´è§‚åœ°è¯´ï¼Œä¸ºäº†åˆ’æ‰æ‰€æœ‰æ½œåœ¨çš„å•è¯ï¼Œæ€»ä½“ç­–ç•¥æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿­ä»£å•å…ƒæ ¼ï¼Œç„¶åä»æ¯ä¸ªå•å…ƒæ ¼æ²¿ç€å®ƒçš„å››ä¸ªæ½œåœ¨æ–¹å‘çš„èµ°ï¼Œæ‰¾åˆ°åŒ¹é…çš„å•è¯ã€‚</p><p>å½“æˆ‘ä»¬åœ¨é»‘æ¿ä¸Šå¾˜å¾Šæ—¶ï¼Œè‹¥æˆ‘ä»¬çŸ¥é“è¿™ä¸ä¼šå‘ç°æ–°å•è¯æ—¶ï¼Œæˆ‘ä»¬ä¼šåœæ­¢æ¢ç´¢ã€‚</p><p>æœ‰äººå¯èƒ½å·²ç»çŒœåˆ°äº†æˆ‘ä»¬ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚æ˜¯çš„ï¼Œå®ƒæ˜¯å›æº¯ï¼Œè¿™å°†æ˜¯è§£å†³æ–¹æ¡ˆçš„ä¸»å¹²ã€‚æ„é€ ä¸€ä¸ªå›æº¯çš„è§£å†³æ–¹æ¡ˆæ˜¯ç›¸å½“ç®€å•çš„ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºæˆ‘ä»¬å¦‚ä½•ä»å­—å…¸ä¸­æ‰¾åˆ°å•è¯çš„åŒ¹é…é¡¹ã€‚ç›´è§‚åœ°è¯´ï¼Œå¯ä»¥ä½¿ç”¨ hashset æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚Python ä¸­çš„ <code>set()</code>ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œåœ¨å›æº¯è¿‡ç¨‹ä¸­ï¼Œäººä»¬ä¼šæ›´ç»å¸¸åœ°é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼šæ˜¯å¦å­˜åœ¨ä»»ä½•åŒ…å«ç‰¹å®šå‰ç¼€çš„å•è¯ï¼Œè€Œä¸æ˜¯æ˜¯å¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå•è¯å­˜åœ¨äºå­—å…¸ä¸­ã€‚å› ä¸ºå¦‚æœæˆ‘ä»¬çŸ¥é“ç»™å®šå‰ç¼€çš„å­—å…¸ä¸­ä¸å­˜åœ¨ä»»ä½•å•è¯åŒ¹é…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦è¿›ä¸€æ­¥æ¢ç´¢æŸä¸ªæ–¹å‘ã€‚è€Œè¿™ï¼Œå°†å¤§å¤§å‡å°‘æ¢æµ‹ç©ºé—´ï¼Œä»è€Œæé«˜å›æº¯ç®—æ³•çš„æ€§èƒ½ã€‚</p><p>èƒ½å¤ŸæŸ¥æ‰¾å‰ç¼€çš„æ•°æ®ç»“æ„å« Trieï¼Œäº hashset æ¯”è¾ƒã€‚Trie ä¸ä»…å¯ä»¥æ£€æŸ¥ä¸€ä¸ªå•è¯ï¼Œè¿˜å¯ä»¥ç«‹å³æ‰¾åˆ°å…±äº«ç»™å®šå‰ç¼€çš„å•è¯ã€‚äº‹å®è¯æ˜ï¼Œæ•°æ®ç»“æ„çš„é€‰æ‹©ï¼ˆTrie ä¸ hashsetï¼‰å¯èƒ½ä»¥æ’åå‰ 5% æˆ–å 5% çš„è§£å†³æ–¹æ¡ˆç»“æŸã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªç”±å•è¯åˆ—è¡¨æ„å»ºçš„ Trie ç¤ºä¾‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æ‰€è¡¨ç¤ºçš„èŠ‚ç‚¹å¤„ï¼Œæˆ‘ä»¬å°†çŸ¥é“å­—å…¸ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå‰ç¼€ä¸º <code>d</code> çš„å•è¯ã€‚</p><p> <a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl90cmllX2V4YW1wbGUucG5n?x-oss-process=image/format,png" target="_blank" rel="noopener">ä¸€ä¸ªç”±å•è¯åˆ—è¡¨æ„å»ºçš„ Trie ç¤ºä¾‹</a></p><p>æˆ‘ä»¬åœ¨å®ç° Trie æ•°æ®ç»“æ„æ—¶é‡åˆ°éº»çƒ¦ã€‚æˆ‘ä»¬å¯ä»¥ä»<a href="https://leetcode.com/problems/implement-trie-prefix-tree/" target="_blank" rel="noopener">Trie é—®é¢˜</a>å¼€å§‹ä½œä¸ºçƒ­èº«ï¼Œç„¶åå†å›æ¥è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>ç®—æ³•ï¼š</strong></p><p>è¯¥ç®—æ³•çš„æ•´ä¸ªå·¥ä½œæµç¨‹æ˜¯ç›´è§‚çš„ï¼ŒåŒ…æ‹¬åœ¨äºŒç»´ç½‘æ ¼ä¸­çš„æ¯ä¸ªå•å…ƒä¸Šå¾ªç¯å’Œä»å•å…ƒå¼€å§‹çš„é€’å½’å‡½æ•°è°ƒç”¨ã€‚è¿™æ˜¯ç®—æ³•çš„æ¡†æ¶ã€‚</p><ul><li>æˆ‘ä»¬æ ¹æ®å­—å…¸ä¸­çš„å•è¯æ„å»ºä¸€ä¸ª Trieï¼Œç¨åå°†ç”¨äºåŒ¹é…è¿‡ç¨‹ã€‚</li><li>ä»æ¯ä¸ªå•å…ƒæ ¼å¼€å§‹ï¼Œå¦‚æœå­—å…¸ä¸­å­˜åœ¨ä»¥å•å…ƒæ ¼ä¸­çš„å­—æ¯å¼€å¤´çš„å•è¯,åˆ™æˆ‘ä»¬å¼€å§‹å›æº¯æ¢ç´¢ï¼ˆå³ <code>backtracking(cell)</code>ï¼‰ã€‚</li><li>åœ¨é€’å½’å‡½æ•° <code>backtracking(cell)</code> è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢å½“å‰å•å…ƒæ ¼å‘¨å›´çš„ç›¸é‚»å•å…ƒæ ¼ï¼ˆå³ <code>neighborCell</code>ï¼‰ä»¥è¿›è¡Œä¸‹ä¸€ä¸ªé€’å½’è°ƒç”¨ <code>backtracking(neighborCell)</code>ã€‚åœ¨æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ£€æŸ¥åˆ°ç›®å‰ä¸ºæ­¢éå†çš„å­—æ¯åºåˆ—æ˜¯å¦ä¸å­—å…¸ä¸­çš„ä»»ä½•å•è¯åŒ¹é…ï¼Œè¿™éœ€è¦å€ŸåŠ©äºæˆ‘ä»¬åœ¨å¼€å§‹æ—¶æ„å»ºçš„ Trie æ•°æ®ç»“æ„ã€‚</li></ul><p>ä¸‹é¢æ˜¯ç®—æ³•çš„å·¥ä½œåŸç†çš„ã€‚åŸºäºä¸Šè¿°æ€æƒ³ï¼Œæˆ‘ä»¬ç»™å‡ºäº†ä¸€äº›ç¤ºä¾‹å®ç°ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†ä¸€äº›å¯ä»¥è¿›ä¸€æ­¥åº”ç”¨äºè¯¥ç®—æ³•çš„ä¼˜åŒ–ã€‚</p><p> <a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl90cmllX2FsZ28ucG5n?x-oss-process=image/format,png" target="_blank" rel="noopener">ç®—æ³•çš„å·¥ä½œåŸç†</a></p><figure class="highlight java"><figcaption><span>[solution1-Java]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">  HashMap&lt;Character, TrieNode&gt; children = <span class="keyword">new</span> HashMap&lt;Character, TrieNode&gt;();</span><br><span class="line">  String word = <span class="keyword">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span>[][] _board = <span class="keyword">null</span>;</span><br><span class="line">  ArrayList&lt;String&gt; _result = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">findWords</span><span class="params">(<span class="keyword">char</span>[][] board, String[] words)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Step 1). Construct the Trie</span></span><br><span class="line">    TrieNode root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">      TrieNode node = root;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (Character letter : word.toCharArray()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.children.containsKey(letter)) &#123;</span><br><span class="line">          node = node.children.get(letter);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          TrieNode newNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line">          node.children.put(letter, newNode);</span><br><span class="line">          node = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      node.word = word;  <span class="comment">// store words in Trie</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>._board = board;</span><br><span class="line">    <span class="comment">// Step 2). Backtracking starting for each cell in the board</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; board.length; ++row) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; board[row].length; ++col) &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.children.containsKey(board[row][col])) &#123;</span><br><span class="line">          backtracking(row, col, root);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">backtracking</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col, TrieNode parent)</span> </span>&#123;</span><br><span class="line">    Character letter = <span class="keyword">this</span>._board[row][col];</span><br><span class="line">    TrieNode currNode = parent.children.get(letter);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if there is any match</span></span><br><span class="line">    <span class="keyword">if</span> (currNode.word != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>._result.add(currNode.word);</span><br><span class="line">      currNode.word = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mark the current letter before the EXPLORATION</span></span><br><span class="line">    <span class="keyword">this</span>._board[row][col] = <span class="string">'#'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// explore neighbor cells in around-clock directions: up, right, down, left</span></span><br><span class="line">    <span class="keyword">int</span>[] rowOffset = &#123;-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span>[] colOffset = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">      <span class="keyword">int</span> newRow = row + rowOffset[i];</span><br><span class="line">      <span class="keyword">int</span> newCol = col + colOffset[i];</span><br><span class="line">      <span class="keyword">if</span> (newRow &lt; <span class="number">0</span> || newRow &gt;= <span class="keyword">this</span>._board.length || newCol &lt; <span class="number">0</span></span><br><span class="line">          || newCol &gt;= <span class="keyword">this</span>._board[<span class="number">0</span>].length) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (currNode.children.containsKey(<span class="keyword">this</span>._board[newRow][newCol])) &#123;</span><br><span class="line">        backtracking(newRow, newCol, currNode);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// End of EXPLORATION, restore the original letter in the board.</span></span><br><span class="line">    <span class="keyword">this</span>._board[row][col] = letter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Optimization: incrementally remove the leaf nodes</span></span><br><span class="line">    <span class="keyword">if</span> (currNode.children.isEmpty()) &#123;</span><br><span class="line">      parent.children.remove(letter);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£å›æº¯è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„åŠ¨ç”»ä¸­æ¼”ç¤ºå¦‚ä½•åœ¨ Trie ä¸­æ‰¾åˆ° <code>dog</code>ã€‚</p><p>  [1](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8xLnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8xLnBuZw?x-oss-process=image/format</a> png) </p><p>  [2](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8yLnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8yLnBuZw?x-oss-process=image/format</a> png)  </p><p>  [3](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8zLnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV8zLnBuZw?x-oss-process=image/format</a> png)  </p><p>  [4](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV80LnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV80LnBuZw?x-oss-process=image/format</a> png)  </p><p>  [5](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV81LnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV81LnBuZw?x-oss-process=image/format</a> png)  </p><p>  [6](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV82LnBuZw?x-oss-process=image/format" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9zbGlkZV82LnBuZw?x-oss-process=image/format</a> png) </p><h2 id="ä¼˜åŒ–ï¼š"><a href="#ä¼˜åŒ–ï¼š" class="headerlink" title="ä¼˜åŒ–ï¼š"></a><strong>ä¼˜åŒ–</strong>ï¼š</h2><p>åœ¨ä¸Šè¿°å®ç°ä¸­ï¼Œé™¤äº†åº”ç”¨ Trie æ•°æ®ç»“æ„å¤–ï¼Œæˆ‘ä»¬è¿˜åº”ç”¨äº†ä¸€äº›æŠ€å·§æ¥è¿›ä¸€æ­¥åŠ å¿«è¿è¡Œæ—¶é—´ã€‚ç‰¹åˆ«æ˜¯ï¼ŒPython å®ç°çš„è¿è¡Œé€Ÿåº¦å¯ä»¥è¶…è¿‡ 98% çš„æäº¤ã€‚æˆ‘ä»¬æŒ‰å…¶é‡è¦æ€§å°†è¿™äº›æŠ€å·§è¯¦è¿°å¦‚ä¸‹ã€‚</p><ul><li>æ²¿ç€ Trie çš„èŠ‚ç‚¹å›æº¯ã€‚</li></ul><p>äººä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨ Trie ä½œä¸ºå­—å…¸æ¥å¿«é€Ÿæ‰¾åˆ°å•è¯å’Œå‰ç¼€çš„åŒ¹é…ï¼Œå³åœ¨å›æº¯çš„æ¯ä¸€æ­¥ï¼Œæˆ‘ä»¬éƒ½ä»Trie çš„æ ¹å¼€å§‹ã€‚</p><p>ç„¶è€Œï¼Œæ›´æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°† Trie ä¸å›æº¯è¿‡ç¨‹ä¸€èµ·éå†ï¼Œå³æ¯ä¸€æ­¥ <code>backtracking(TrieNode)</code>ï¼Œ<code>TrieNode</code> çš„æ·±åº¦å¯¹åº”äºæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢åŒ¹é…çš„å‰ç¼€çš„é•¿åº¦ã€‚è¿™é¡¹æªæ–½å¯ä»¥å°†æ‚¨çš„è§£å†³æ–¹æ¡ˆä»æäº¤çš„æœ€ä½ <em>5%</em> ä¸­è„±é¢–å‡ºæ¥ã€‚</p><ul><li>åœ¨å›æº¯è¿‡ç¨‹ä¸­é€æ¸å‰ªé™¤ Trie ä¸­çš„èŠ‚ç‚¹ï¼ˆå‰ªæï¼‰ã€‚</li></ul><p>è¿™ä¸ªæƒ³æ³•çš„åŠ¨æœºæ˜¯æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å–å†³äº Trie çš„å¤§å°ã€‚å¯¹äº Trie ä¸­çš„å¶èŠ‚ç‚¹ï¼Œä¸€æ—¦éå†å®ƒï¼ˆå³æ‰¾åˆ°åŒ¹é…çš„å•è¯ï¼‰ï¼Œå°±ä¸éœ€è¦å†éå†å®ƒäº†ã€‚ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»æ ‘ä¸Šå‰ªä¸‹æ¥ã€‚</p><p>é€æ¸åœ°ï¼Œè¿™äº›éå¶èŠ‚ç‚¹å¯ä»¥æˆä¸ºå¶èŠ‚ç‚¹ä»¥åï¼Œå› ä¸ºæˆ‘ä»¬ä¿®å‰ªä»–ä»¬çš„å­©å­å¶èŠ‚ç‚¹ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œä¸€æ—¦æˆ‘ä»¬æ‰¾åˆ°å­—å…¸ä¸­æ‰€æœ‰å•è¯çš„åŒ¹é…é¡¹ï¼ŒTrie å°±ä¼šå˜æˆç©ºçš„ã€‚è¿™ä¸ªå‰ªææªæ–½å¯ä»¥å‡å°‘åœ¨çº¿æµ‹è¯•ç”¨ä¾‹ 50% çš„è¿è¡Œæ—¶é—´ã€‚</p><p> <a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl90cmllX3BydW5lLnBuZw?x-oss-process=image/format,png" target="_blank" rel="noopener">å‰ªæ</a></p><ul><li>ä» Trie ä¸­åˆ é™¤åŒ¹é…çš„å•è¯ã€‚</li></ul><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è¢«è¦æ±‚è¿”å›æ‰€æœ‰åŒ¹é…çš„å•è¯ï¼Œè€Œä¸æ˜¯æ½œåœ¨åŒ¹é…çš„æ•°é‡ã€‚å› æ­¤ï¼Œä¸€æ—¦åˆ°è¾¾åŒ…å«å•è¯åŒ¹é…çš„ç‰¹å®š Trie èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» Trie ä¸­åˆ é™¤åŒ¹é…å•è¯ã€‚</p><p>ä½œä¸ºé™„å¸¦å¥½å¤„ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ£€æŸ¥ç»“æœé›†ä¸­æ˜¯å¦æœ‰ä»»ä½•é‡å¤é¡¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨è€Œä¸æ˜¯é›†åˆæ¥ä¿å­˜ç»“æœï¼Œè¿™æ ·å¯ä»¥åŠ å¿«è§£å†³æ–¹æ¡ˆçš„é€Ÿåº¦ã€‚</p><p><strong>å¤æ‚åº¦åˆ†æ</strong></p><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼š<em>\mathcal{O}(M(4\cdot3^{L-1}))<em>ï¼Œå…¶ä¸­</em>M</em> æ˜¯äºŒç»´ç½‘æ ¼ä¸­çš„å•å…ƒæ ¼æ•°ï¼Œ<em>L</em> æ˜¯å•è¯çš„æœ€å¤§é•¿åº¦ã€‚</p><ul><li>è®¡ç®—å›æº¯ç®—æ³•å°†æ‰§è¡Œçš„ç¡®åˆ‡æ­¥æ•°æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸ºè¿™ä¸ªé—®é¢˜çš„æœ€åæƒ…å†µæä¾›äº†è¯¥æ­¥éª¤çš„ä¸Šé™ã€‚è¯¥ç®—æ³•å¾ªç¯éå†äºŒç»´ç½‘æ ¼ä¸­çš„æ‰€æœ‰å•å…ƒï¼Œå› æ­¤åœ¨å¤æ‚åº¦å…¬å¼ä¸­æˆ‘ä»¬æœ‰ <em>M</em> ä½œä¸ºå› å­ã€‚ç„¶åå°†å…¶å½’ç»“ä¸ºæ¯ä¸ªå¯åŠ¨å•å…ƒæ‰€éœ€çš„æœ€å¤§æ­¥éª¤æ•°ï¼ˆå³ <em>4\cdot3^{L-1}</em>ï¼‰ã€‚</li><li>å‡è®¾å•è¯çš„æœ€å¤§é•¿åº¦æ˜¯ <em>L</em>ï¼Œä»ä¸€ä¸ªå•å…ƒæ ¼å¼€å§‹ï¼Œæœ€åˆæˆ‘ä»¬æœ€å¤šå¯ä»¥æ¢ç´¢ 4 ä¸ªæ–¹å‘ã€‚å‡è®¾æ¯ä¸ªæ–¹å‘éƒ½æ˜¯æœ‰æ•ˆçš„ï¼ˆå³æœ€åæƒ…å†µï¼‰ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ¢ç´¢ä¸­ï¼Œæˆ‘ä»¬æœ€å¤šæœ‰ 3 ä¸ªç›¸é‚»çš„å•å…ƒï¼ˆä¸åŒ…æ‹¬æˆ‘ä»¬æ¥çš„å•å…ƒï¼‰è¦æ¢ç´¢ã€‚å› æ­¤ï¼Œåœ¨å›æº¯æ¢ç´¢æœŸé—´ï¼Œæˆ‘ä»¬æœ€å¤šéå† <em>4\cdot3^{L-1}</em> ä¸ªå•å…ƒæ ¼ã€‚</li><li>ä½ å¯èƒ½ä¼šæƒ³æœ€åçš„æƒ…å†µæ˜¯ä»€ä¹ˆæ ·å­ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒäºŒç»´ç½‘æ ¼ä¸­çš„æ¯ä¸ªå•å…ƒéƒ½åŒ…å«å­—æ¯ <code>a</code>ï¼Œå•è¯è¯å…¸åŒ…å«ä¸€ä¸ªå•è¯ <code>[&#39;aaaa&#39;]</code>ã€‚è¿™æ˜¯ç®—æ³•å°†é‡åˆ°çš„æœ€åçš„æƒ…å†µä¹‹ä¸€ã€‚</li></ul><p><a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjEyLzIxMl9jb21wbGV4aXR5X2V4YW1wbGUucG5n?x-oss-process=image/format,png" target="_blank" rel="noopener">æœ€åçš„æƒ…å†µ</a></p></li></ul><p>æ³¨æ„ï¼Œä¸Šè¿°æ—¶é—´å¤æ‚æ€§æ˜¯åœ¨ Trie æ•°æ®ç»“æ„ä¸€æ—¦æ„å»ºå°±ä¸ä¼šæ”¹å˜çš„å‡è®¾ä¸‹ä¼°è®¡çš„ã€‚å¦‚æœé‡‡ç”¨ä¼˜åŒ–ç­–ç•¥é€æ­¥åˆ é™¤ Trie ä¸­çš„èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥å¤§å¤§æé«˜æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºä¸€æ—¦åŒ¹é…è¯å…¸ä¸­çš„æ‰€æœ‰å•è¯ï¼Œå³ Trie å˜ä¸ºç©ºï¼Œå›æº¯çš„æˆæœ¬å°±ä¼šé™ä½åˆ°é›¶ã€‚ </p><ul><li>ç©ºé—´å¤æ‚åº¦ï¼š<em>\mathcal{O}(N)*ï¼Œå…¶ä¸­ *N</em> æ˜¯å­—å…¸ä¸­çš„å­—æ¯æ€»æ•°ã€‚<ul><li>ç®—æ³•æ¶ˆè€—çš„ä¸»è¦ç©ºé—´æ˜¯æˆ‘ä»¬æ„å»ºçš„ Trie æ•°æ®ç»“æ„ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå•è¯ä¹‹é—´æ²¡æœ‰å‰ç¼€é‡å ï¼Œåˆ™ Trie å°†æ‹¥æœ‰ä¸æ‰€æœ‰å•è¯çš„å­—æ¯ä¸€æ ·å¤šçš„èŠ‚ç‚¹ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨ Trie ä¸­ä¿ç•™å•è¯çš„å‰¯æœ¬ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ *2N$ çš„ç©ºé—´ç”¨äº Trieã€‚</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼boardå’Œä¸€ä¸ªå­—å…¸ä¸­çš„å•è¯åˆ—è¡¨ wordsï¼Œæ‰¾å‡ºæ‰€æœ‰åŒæ—¶åœ¨äºŒç»´ç½‘æ ¼å’Œå­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Backtracking" scheme="http://yoursite.com/tags/Backtracking/"/>
    
      <category term="Leetcode" scheme="http://yoursite.com/tags/Leetcode/"/>
    
      <category term="Trie" scheme="http://yoursite.com/tags/Trie/"/>
    
  </entry>
  
  <entry>
    <title>Javaç¼–ç¨‹æ€æƒ³-ç¬¬äºŒåä¸‰ç«  æ³¨è§£é˜…è¯»ç¬”è®°</title>
    <link href="http://yoursite.com/2020/06/28/Java%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E7%AB%A0%20%E6%B3%A8%E8%A7%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/06/28/Javaç¼–ç¨‹æ€æƒ³-ç¬¬äºŒåä¸‰ç«  æ³¨è§£é˜…è¯»ç¬”è®°/</id>
    <published>2020-06-28T02:59:12.000Z</published>
    <updated>2020-06-29T06:23:06.841Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥å£å’ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§å°†æ¥å£ä¸å®ç°åˆ†ç¦»çš„æ›´åŠ ç»“æ„åŒ–çš„æ–¹æ³•ã€‚</p><a id="more"></a><p>[TOC]</p><!-- Annotations --><h1 id="ç¬¬äºŒåä¸‰ç« -æ³¨è§£"><a href="#ç¬¬äºŒåä¸‰ç« -æ³¨è§£" class="headerlink" title="ç¬¬äºŒåä¸‰ç«  æ³¨è§£"></a>ç¬¬äºŒåä¸‰ç«  æ³¨è§£</h1><p>æ³¨è§£ï¼ˆä¹Ÿè¢«ç§°ä¸ºå…ƒæ•°æ®ï¼‰ä¸ºæˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ ä¿¡æ¯æä¾›äº†ä¸€ç§å½¢å¼åŒ–çš„æ–¹å¼ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ç¨åçš„æŸä¸ªæ—¶åˆ»æ›´å®¹æ˜“çš„ä½¿ç”¨è¿™äº›æ•°æ®ã€‚</p><p>æ³¨è§£åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯æŠŠå…ƒæ•°æ®å’Œæºä»£ç æ–‡ä»¶ç»“åˆåœ¨ä¸€èµ·çš„è¶‹åŠ¿æ‰€æ¿€å‘çš„ï¼Œè€Œä¸æ˜¯ä¿å­˜åœ¨å¤–éƒ¨æ–‡æ¡£ã€‚è¿™åŒæ ·æ˜¯å¯¹åƒ C# è¯­è¨€å¯¹äº Java è¯­è¨€ç‰¹æ€§å‹åŠ›çš„ä¸€ç§å›åº”ã€‚</p><p>æ³¨è§£æ˜¯ Java 5 æ‰€å¼•å…¥çš„ä¼—å¤šè¯­è¨€å˜åŒ–ä¹‹ä¸€ã€‚å®ƒä»¬æä¾›äº† Java æ— æ³•è¡¨è¾¾çš„ä½†æ˜¯ä½ éœ€è¦å®Œæ•´è¡¨è¿°ç¨‹åºæ‰€éœ€çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œæ³¨è§£ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥ç¼–è¯‘å™¨éªŒè¯çš„æ ¼å¼å­˜å‚¨ç¨‹åºçš„é¢å¤–ä¿¡æ¯ã€‚æ³¨è§£å¯ä»¥ç”Ÿæˆæè¿°ç¬¦æ–‡ä»¶ï¼Œç”šè‡³æ˜¯æ–°çš„ç±»å®šä¹‰ï¼Œå¹¶ä¸”æœ‰åŠ©äºå‡è½»ç¼–å†™â€œæ ·æ¿â€ä»£ç çš„è´Ÿæ‹…ã€‚é€šè¿‡ä½¿ç”¨æ³¨è§£ï¼Œä½ å¯ä»¥å°†å…ƒæ•°æ®ä¿å­˜åœ¨ Java æºä»£ç ä¸­ã€‚å¹¶æ‹¥æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼šç®€å•æ˜“è¯»çš„ä»£ç ï¼Œç¼–è¯‘å™¨ç±»å‹æ£€æŸ¥ï¼Œä½¿ç”¨ annotation API ä¸ºè‡ªå·±çš„æ³¨è§£æ„é€ å¤„ç†å·¥å…·ã€‚å³ä½¿ Java å®šä¹‰äº†ä¸€äº›ç±»å‹çš„å…ƒæ•°æ®ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´æ³¨è§£ç±»å‹çš„æ·»åŠ å’Œå¦‚ä½•ä½¿ç”¨å®Œå…¨å–å†³äºä½ ã€‚</p><p>æ³¨è§£çš„è¯­æ³•ååˆ†ç®€å•ï¼Œä¸»è¦æ˜¯åœ¨ç°æœ‰è¯­æ³•ä¸­æ·»åŠ  @ ç¬¦å·ã€‚Java 5 å¼•å…¥äº†å‰ä¸‰ç§å®šä¹‰åœ¨ <strong>java.lang</strong> åŒ…ä¸­çš„æ³¨è§£ï¼š</p><ul><li><strong>@Override</strong>ï¼šè¡¨ç¤ºå½“å‰çš„æ–¹æ³•å®šä¹‰å°†è¦†ç›–åŸºç±»çš„æ–¹æ³•ã€‚å¦‚æœä½ ä¸å°å¿ƒæ‹¼å†™é”™è¯¯ï¼Œæˆ–è€…æ–¹æ³•ç­¾åè¢«é”™è¯¯æ‹¼å†™çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¼šå‘å‡ºé”™è¯¯æç¤ºã€‚</li><li><strong>@Deprecated</strong>ï¼šå¦‚æœä½¿ç”¨è¯¥æ³¨è§£çš„å…ƒç´ è¢«è°ƒç”¨ï¼Œç¼–è¯‘å™¨å°±ä¼šå‘å‡ºè­¦å‘Šä¿¡æ¯ã€‚</li><li><strong>@SuppressWarnings</strong>ï¼šå…³é—­ä¸å½“çš„ç¼–è¯‘å™¨è­¦å‘Šä¿¡æ¯ã€‚</li><li><strong>@SafeVarargs</strong>ï¼šåœ¨ Java 7 ä¸­åŠ å…¥ç”¨äºç¦æ­¢å¯¹å…·æœ‰æ³›å‹varargså‚æ•°çš„æ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„è°ƒç”¨æ–¹å‘å‡ºè­¦å‘Šã€‚</li><li><strong>@FunctionalInterface</strong>ï¼šJava 8 ä¸­åŠ å…¥ç”¨äºè¡¨ç¤ºç±»å‹å£°æ˜ä¸ºå‡½æ•°å¼æ¥å£</li></ul><p>è¿˜æœ‰ 5 ç§é¢å¤–çš„æ³¨è§£ç±»å‹ç”¨äºåˆ›é€ æ–°çš„æ³¨è§£ã€‚ä½ å°†ä¼šåœ¨è¿™ä¸€ç« å­¦ä¹ å®ƒä»¬ã€‚</p><p>æ¯å½“åˆ›å»ºæ¶‰åŠé‡å¤å·¥ä½œçš„ç±»æˆ–æ¥å£æ—¶ï¼Œä½ é€šå¸¸å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥è‡ªåŠ¨åŒ–å’Œç®€åŒ–æµç¨‹ã€‚ä¾‹å¦‚åœ¨ Enterprise JavaBeanï¼ˆEJBï¼‰ä¸­çš„è®¸å¤šé¢å¤–å·¥ä½œå°±æ˜¯é€šè¿‡æ³¨è§£æ¥æ¶ˆé™¤çš„ã€‚</p><p>æ³¨è§£çš„å‡ºç°å¯ä»¥æ›¿ä»£ä¸€äº›ç°æœ‰çš„ç³»ç»Ÿï¼Œä¾‹å¦‚ XDocletï¼Œå®ƒæ˜¯ä¸€ç§ç‹¬ç«‹çš„æ–‡æ¡£åŒ–å·¥å…·ï¼Œä¸“é—¨è®¾è®¡ç”¨æ¥ç”Ÿæˆæ³¨è§£é£æ ¼çš„æ–‡æ¡£ã€‚ä¸ä¹‹ç›¸æ¯”ï¼Œæ³¨è§£æ˜¯çœŸæ­£è¯­è¨€å±‚çº§çš„æ¦‚å¿µï¼Œä»¥å‰æ„é€ å‡ºæ¥å°±äº«æœ‰ç¼–è¯‘å™¨çš„ç±»å‹æ£€æŸ¥ä¿æŠ¤ã€‚æ³¨è§£åœ¨æºä»£ç çº§åˆ«ä¿å­˜æ‰€æœ‰ä¿¡æ¯è€Œä¸æ˜¯é€šè¿‡æ³¨é‡Šæ–‡å­—ï¼Œè¿™ä½¿å¾—ä»£ç æ›´åŠ æ•´æ´å’Œä¾¿äºç»´æŠ¤ã€‚é€šè¿‡ä½¿ç”¨æ‹“å±•çš„ annotation API æˆ–ç¨ååœ¨æœ¬ç« èŠ‚å¯ä»¥çœ‹åˆ°çš„å¤–éƒ¨çš„å­—èŠ‚ç å·¥å…·ç±»åº“ï¼Œä½ ä¼šæ‹¥æœ‰å¯¹æºä»£ç åŠå­—èŠ‚ç å¼ºå¤§çš„æ£€æŸ¥ä¸æ“ä½œèƒ½åŠ›ã€‚</p><!-- Basic Syntax --><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><!-- Writing Annotation Processors --><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>@Test</code> å¯¹ <code>testExecute()</code> è¿›è¡Œæ³¨è§£ã€‚è¯¥æ³¨è§£æœ¬èº«ä¸åšä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯ç¼–è¯‘å™¨è¦ä¿è¯å…¶ç±»è·¯å¾„ä¸Šæœ‰ <code>@Test</code> æ³¨è§£çš„å®šä¹‰ã€‚ä½ å°†åœ¨æœ¬ç« çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡æ³¨è§£åˆ›å»ºäº†ä¸€ä¸ªå·¥å…·ç”¨äºè¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/Testable.java</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Testable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Executing.."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testExecute</span><span class="params">()</span> </span>&#123; execute(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¢«æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•å’Œå…¶ä»–çš„æ–¹æ³•æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ³¨è§£ <code>@Test</code> å¯ä»¥å’Œä»»ä½•ä¿®é¥°ç¬¦å…±åŒç”¨äºæ–¹æ³•ï¼Œè¯¸å¦‚ <strong>public</strong>ã€<strong>static</strong> æˆ– <strong>void</strong>ã€‚ä»è¯­æ³•çš„è§’åº¦ä¸Šçœ‹ï¼Œæ³¨è§£çš„ä½¿ç”¨æ–¹å¼å’Œä¿®é¥°ç¬¦çš„ä½¿ç”¨æ–¹å¼ä¸€è‡´ã€‚</p><h3 id="å®šä¹‰æ³¨è§£"><a href="#å®šä¹‰æ³¨è§£" class="headerlink" title="å®šä¹‰æ³¨è§£"></a>å®šä¹‰æ³¨è§£</h3><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ³¨è§£çš„å®šä¹‰ã€‚æ³¨è§£çš„å®šä¹‰çœ‹èµ·æ¥å¾ˆåƒæ¥å£çš„å®šä¹‰ã€‚äº‹å®ä¸Šï¼Œå®ƒä»¬å’Œå…¶ä»– Java æ¥å£ä¸€æ ·ï¼Œä¹Ÿä¼šè¢«ç¼–è¯‘æˆ class æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/Test.java</span></span><br><span class="line"><span class="comment">// The @Test tag</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Test &#123;&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº† @ ç¬¦å·ä¹‹å¤–ï¼Œ <code>@Test</code> çš„å®šä¹‰çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªç©ºæ¥å£ã€‚æ³¨è§£çš„å®šä¹‰ä¹Ÿéœ€è¦ä¸€äº›å…ƒæ³¨è§£ï¼ˆmeta-annoationï¼‰ï¼Œæ¯”å¦‚ <code>@Target</code> å’Œ <code>@Retention</code>ã€‚<code>@Target</code> å®šä¹‰ä½ çš„æ³¨è§£å¯ä»¥åº”ç”¨åœ¨å“ªé‡Œï¼ˆä¾‹å¦‚æ˜¯æ–¹æ³•è¿˜æ˜¯å­—æ®µï¼‰ã€‚<code>@Retention</code> å®šä¹‰äº†æ³¨è§£åœ¨å“ªé‡Œå¯ç”¨ï¼Œåœ¨æºä»£ç ä¸­ï¼ˆSOURCEï¼‰ï¼Œclassæ–‡ä»¶ï¼ˆCLASSï¼‰ä¸­æˆ–è€…æ˜¯åœ¨è¿è¡Œæ—¶ï¼ˆRUNTIMEï¼‰ã€‚</p><p>æ³¨è§£é€šå¸¸ä¼šåŒ…å«ä¸€äº›è¡¨ç¤ºç‰¹å®šå€¼çš„å…ƒç´ ã€‚å½“åˆ†æå¤„ç†æ³¨è§£çš„æ—¶å€™ï¼Œç¨‹åºæˆ–å·¥å…·å¯ä»¥åˆ©ç”¨è¿™äº›å€¼ã€‚æ³¨è§£çš„å…ƒç´ çœ‹èµ·æ¥å°±åƒæ¥å£çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥ä¸ºå…¶æŒ‡å®šé»˜è®¤å€¼ã€‚</p><p>ä¸åŒ…å«ä»»ä½•å…ƒç´ çš„æ³¨è§£ç§°ä¸ºæ ‡è®°æ³¨è§£ï¼ˆmarker annotationï¼‰ï¼Œä¾‹å¦‚ä¸Šä¾‹ä¸­çš„ <code>@Test</code> å°±æ˜¯æ ‡è®°æ³¨è§£ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¿½è¸ªé¡¹ç›®ä¸­çš„ç”¨ä¾‹ã€‚ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨è¯¥æ³¨è§£æ¥æ ‡æ³¨æ»¡è¶³ç‰¹å®šç”¨ä¾‹çš„ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ç»„æ–¹æ³•ã€‚äºæ˜¯ï¼Œé¡¹ç›®ç»ç†å¯ä»¥é€šè¿‡ç»Ÿè®¡å·²ç»å®ç°çš„ç”¨ä¾‹æ¥æŒæ§é¡¹ç›®çš„è¿›å±•ï¼Œè€Œå¼€å‘è€…åœ¨ç»´æŠ¤é¡¹ç›®æ—¶å¯ä»¥è½»æ¾çš„æ‰¾åˆ°ç”¨ä¾‹ç”¨äºæ›´æ–°ï¼Œæˆ–è€…ä»–ä»¬å¯ä»¥è°ƒè¯•ç³»ç»Ÿä¸­ä¸šåŠ¡é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/UseCase.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UseCase &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> "no description"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ <strong>id</strong> å’Œ <strong>description</strong> ä¸æ–¹æ³•å®šä¹‰ç±»ä¼¼ã€‚ç”±äºç¼–è¯‘å™¨ä¼šå¯¹ <strong>id</strong> è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå› æ­¤å°†è·Ÿè¸ªæ•°æ®åº“ä¸ç”¨ä¾‹æ–‡æ¡£å’Œæºä»£ç ç›¸å…³è”æ˜¯å¯é çš„æ–¹å¼ã€‚<strong>description</strong> å…ƒç´ æ‹¥æœ‰ä¸€ä¸ª <strong>default</strong> å€¼ï¼Œå¦‚æœåœ¨æ³¨è§£æŸä¸ªæ–¹æ³•æ—¶æ²¡æœ‰ç»™å‡º <strong>description</strong> çš„å€¼ã€‚åˆ™è¯¥æ³¨è§£çš„å¤„ç†å™¨ä¼šä½¿ç”¨æ­¤å…ƒç´ çš„é»˜è®¤å€¼ã€‚</p><p>åœ¨ä¸‹é¢çš„ç±»ä¸­ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•è¢«æ³¨è§£ä¸ºç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/PasswordUtils.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PasswordUtils</span> </span>&#123;</span><br><span class="line">    <span class="meta">@UseCase</span>(id = <span class="number">47</span>, description =</span><br><span class="line">            <span class="string">"Passwords must contain at least one numeric"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validatePassword</span><span class="params">(String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (passwd.matches(<span class="string">"\\w*\\d\\w*"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@UseCase</span>(id = <span class="number">48</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encryptPassword</span><span class="params">(String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringBuilder(passwd)</span><br><span class="line">                .reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@UseCase</span>(id = <span class="number">49</span>, description =</span><br><span class="line">            <span class="string">"New passwords can't equal previously used ones"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkForNewPassword</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            List&lt;String&gt; prevPasswords, String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !prevPasswords.contains(passwd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨è§£çš„å…ƒç´ åœ¨ä½¿ç”¨æ—¶è¡¨ç°ä¸º å-å€¼ å¯¹çš„å½¢å¼ï¼Œå¹¶ä¸”éœ€è¦æ”¾ç½®åœ¨ <code>@UseCase</code> å£°æ˜ä¹‹åçš„æ‹¬å·å†…ã€‚åœ¨ <code>encryptPassword()</code> æ–¹æ³•çš„æ³¨è§£ä¸­ï¼Œå¹¶æ²¡æœ‰ç»™å‡º <strong>description</strong> çš„å€¼ï¼Œæ‰€ä»¥åœ¨ <strong>@interface UseCase</strong> çš„æ³¨è§£å¤„ç†å™¨åˆ†æå¤„ç†è¿™ä¸ªç±»çš„æ—¶å€™ä¼šä½¿ç”¨è¯¥å…ƒç´ çš„é»˜è®¤å€¼ã€‚</p><p>ä½ åº”è¯¥èƒ½å¤Ÿæƒ³è±¡åˆ°å¦‚ä½•ä½¿ç”¨è¿™å¥—å·¥å…·æ¥â€œå‹¾å‹’â€å‡ºå°†è¦å»ºé€ çš„ç³»ç»Ÿï¼Œç„¶ååœ¨å»ºé€ çš„è¿‡ç¨‹ä¸­é€æ¸å®ç°ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ã€‚</p><h3 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h3><p>Java è¯­è¨€ä¸­ç›®å‰æœ‰ 5 ç§æ ‡å‡†æ³¨è§£ï¼ˆå‰é¢ä»‹ç»è¿‡ï¼‰ï¼Œä»¥åŠ 5 ç§å…ƒæ³¨è§£ã€‚å…ƒæ³¨è§£ç”¨äºæ³¨è§£å…¶ä»–çš„æ³¨è§£</p><table><thead><tr><th>æ³¨è§£</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>@Target</td><td>è¡¨ç¤ºæ³¨è§£å¯ä»¥ç”¨äºå“ªäº›åœ°æ–¹ã€‚å¯èƒ½çš„ <strong>ElementType</strong> å‚æ•°åŒ…æ‹¬ï¼š<br><strong>CONSTRUCTOR</strong>ï¼šæ„é€ å™¨çš„å£°æ˜<br><strong>FIELD</strong>ï¼šå­—æ®µå£°æ˜ï¼ˆåŒ…æ‹¬ enum å®ä¾‹ï¼‰<br><strong>LOCAL_VARIABLE</strong>ï¼šå±€éƒ¨å˜é‡å£°æ˜<br><strong>METHOD</strong>ï¼šæ–¹æ³•å£°æ˜<br><strong>PACKAGE</strong>ï¼šåŒ…å£°æ˜<br><strong>PARAMETER</strong>ï¼šå‚æ•°å£°æ˜<br><strong>TYPE</strong>ï¼šç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰æˆ–è€… enum å£°æ˜</td></tr><tr><td>@Retention</td><td>è¡¨ç¤ºæ³¨è§£ä¿¡æ¯ä¿å­˜çš„æ—¶é•¿ã€‚å¯é€‰çš„ <strong>RetentionPolicy</strong> å‚æ•°åŒ…æ‹¬ï¼š<br><strong>SOURCE</strong>ï¼šæ³¨è§£å°†è¢«ç¼–è¯‘å™¨ä¸¢å¼ƒ<br><strong>CLASS</strong>ï¼šæ³¨è§£åœ¨ class æ–‡ä»¶ä¸­å¯ç”¨ï¼Œä½†æ˜¯ä¼šè¢« VM ä¸¢å¼ƒã€‚<br><strong>RUNTIME</strong>ï¼šVM å°†åœ¨è¿è¡ŒæœŸä¹Ÿä¿ç•™æ³¨è§£ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£çš„ä¿¡æ¯ã€‚</td></tr><tr><td>@Documented</td><td>å°†æ­¤æ³¨è§£ä¿å­˜åœ¨ Javadoc ä¸­</td></tr><tr><td>@Inherited</td><td>å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£</td></tr><tr><td>@Repeatable</td><td>å…è®¸ä¸€ä¸ªæ³¨è§£å¯ä»¥è¢«ä½¿ç”¨ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼ˆJava 8ï¼‰ã€‚</td></tr></tbody></table><p>å¤§å¤šæ•°æ—¶å€™ï¼Œç¨‹åºå‘˜å®šä¹‰è‡ªå·±çš„æ³¨è§£ï¼Œå¹¶ç¼–å†™è‡ªå·±çš„å¤„ç†å™¨æ¥å¤„ç†ä»–ä»¬ã€‚</p><h2 id="ç¼–å†™æ³¨è§£å¤„ç†å™¨"><a href="#ç¼–å†™æ³¨è§£å¤„ç†å™¨" class="headerlink" title="ç¼–å†™æ³¨è§£å¤„ç†å™¨"></a>ç¼–å†™æ³¨è§£å¤„ç†å™¨</h2><p>å¦‚æœæ²¡æœ‰ç”¨äºè¯»å–æ³¨è§£çš„å·¥å…·ï¼Œé‚£ä¹ˆæ³¨è§£ä¸ä¼šæ¯”æ³¨é‡Šæ›´æœ‰ç”¨ã€‚ä½¿ç”¨æ³¨è§£ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„éƒ¨åˆ†å°±æ˜¯ï¼Œåˆ›å»ºä¸ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ã€‚Java æ‹“å±•äº†åå°„æœºåˆ¶çš„ API ç”¨äºå¸®åŠ©ä½ åˆ›é€ è¿™ç±»å·¥å…·ã€‚åŒæ—¶ä»–è¿˜æä¾›äº† javac ç¼–è¯‘å™¨é’©å­åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨æ³¨è§£ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ³¨è§£å¤„ç†å™¨ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥è¯»å–è¢«æ³¨è§£çš„ <strong>PasswordUtils</strong> ç±»ï¼Œå¹¶ä¸”ä½¿ç”¨åå°„æœºåˆ¶æ¥å¯»æ‰¾ <strong>@UseCase</strong> æ ‡è®°ã€‚ç»™å®šä¸€ç»„ <strong>id</strong> å€¼ï¼Œç„¶ååˆ—å‡ºåœ¨ <strong>PasswordUtils</strong> ä¸­æ‰¾åˆ°çš„ç”¨ä¾‹ï¼Œä»¥åŠç¼ºå¤±çš„ç”¨ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/UseCaseTracker.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseCaseTracker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">    trackUseCases(List&lt;Integer&gt; useCases, Class&lt;?&gt; cl) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Method m : cl.getDeclaredMethods()) &#123;</span><br><span class="line">            UseCase uc = m.getAnnotation(UseCase.class);</span><br><span class="line">            <span class="keyword">if</span>(uc != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Found Use Case "</span> +</span><br><span class="line">                        uc.id() + <span class="string">"\n "</span> + uc.description());</span><br><span class="line">                useCases.remove(Integer.valueOf(uc.id()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        useCases.forEach(i -&gt;</span><br><span class="line">                System.out.println(<span class="string">"Missing use case "</span> + i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; useCases = IntStream.range(<span class="number">47</span>, <span class="number">51</span>)</span><br><span class="line">                .boxed().collect(Collectors.toList());</span><br><span class="line">        trackUseCases(useCases, PasswordUtils.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Found Use Case <span class="number">48</span></span><br><span class="line">no description</span><br><span class="line">Found Use Case <span class="number">47</span></span><br><span class="line">Passwords must contain at least one numeric</span><br><span class="line">Found Use Case <span class="number">49</span></span><br><span class="line">New passwords can<span class="string">'t equal previously used ones</span></span><br><span class="line"><span class="string">Missing use case 50</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºç”¨äº†ä¸¤ä¸ªåå°„çš„æ–¹æ³•ï¼š<code>getDeclaredMethods()</code>  å’Œ <code>getAnnotation()</code>ï¼Œå®ƒä»¬éƒ½å±äº <strong>AnnotatedElement</strong> æ¥å£ï¼ˆ<strong>Class</strong>ï¼Œ<strong>Method</strong> ä¸ <strong>Field</strong> ç±»éƒ½å®ç°äº†è¯¥æ¥å£ï¼‰ã€‚<code>getAnnotation()</code> æ–¹æ³•è¿”å›æŒ‡å®šç±»å‹çš„æ³¨è§£å¯¹è±¡ï¼Œåœ¨æœ¬ä¾‹ä¸­å°±æ˜¯ â€œ<strong>UseCase</strong>â€ã€‚å¦‚æœè¢«æ³¨è§£çš„æ–¹æ³•ä¸Šæ²¡æœ‰è¯¥ç±»å‹çš„æ³¨è§£ï¼Œè¿”å›å€¼å°±ä¸º <strong>null</strong>ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>id()</code> å’Œ <code>description()</code> æ–¹æ³•æ¥æå–å…ƒç´ å€¼ã€‚æ³¨æ„ <code>encryptPassword()</code> æ–¹æ³•åœ¨æ³¨è§£çš„æ—¶å€™æ²¡æœ‰æŒ‡å®š <strong>description</strong> çš„å€¼ï¼Œå› æ­¤å¤„ç†å™¨åœ¨å¤„ç†å®ƒå¯¹åº”çš„æ³¨è§£æ—¶ï¼Œé€šè¿‡ <code>description()</code> å–å¾—çš„æ˜¯é»˜è®¤å€¼ â€œno descriptionâ€ã€‚</p><h3 id="æ³¨è§£å…ƒç´ "><a href="#æ³¨è§£å…ƒç´ " class="headerlink" title="æ³¨è§£å…ƒç´ "></a>æ³¨è§£å…ƒç´ </h3><p>åœ¨ <strong>UseCase.java</strong> ä¸­å®šä¹‰çš„ <strong>@UseCase</strong> çš„æ ‡ç­¾åŒ…å« int å…ƒç´  <strong>id</strong> å’Œ String å…ƒç´  <strong>description</strong>ã€‚æ³¨è§£å…ƒç´ å¯ç”¨çš„ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>æ‰€æœ‰åŸºæœ¬ç±»å‹ï¼ˆintã€floatã€booleanç­‰ï¼‰</li><li>String</li><li>Class</li><li>enum</li><li>Annotation</li><li>ä»¥ä¸Šç±»å‹çš„æ•°ç»„</li></ul><p>å¦‚æœä½ ä½¿ç”¨äº†å…¶ä»–ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚æ³¨æ„ï¼Œä¹Ÿä¸å…è®¸ä½¿ç”¨ä»»ä½•åŒ…è£…ç±»å‹ï¼Œä½†æ˜¯ç”±äºè‡ªåŠ¨è£…ç®±çš„å­˜åœ¨ï¼Œè¿™ä¸ç®—æ˜¯ä»€ä¹ˆé™åˆ¶ã€‚æ³¨è§£ä¹Ÿå¯ä»¥ä½œä¸ºå…ƒç´ çš„ç±»å‹ã€‚ç¨åä½ ä¼šçœ‹åˆ°ï¼Œæ³¨è§£åµŒå¥—æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æŠ€å·§ã€‚</p><h3 id="é»˜è®¤å€¼é™åˆ¶"><a href="#é»˜è®¤å€¼é™åˆ¶" class="headerlink" title="é»˜è®¤å€¼é™åˆ¶"></a>é»˜è®¤å€¼é™åˆ¶</h3><p>ç¼–è¯‘å™¨å¯¹äºå…ƒç´ çš„é»˜è®¤å€¼æœ‰äº›è¿‡äºæŒ‘å‰”ã€‚é¦–å…ˆï¼Œå…ƒç´ ä¸èƒ½æœ‰ä¸ç¡®å®šçš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç´ è¦ä¹ˆæœ‰é»˜è®¤å€¼ï¼Œè¦ä¹ˆå°±åœ¨ä½¿ç”¨æ³¨è§£æ—¶æä¾›å…ƒç´ çš„å€¼ã€‚</p><p>è¿™é‡Œæœ‰å¦å¤–ä¸€ä¸ªé™åˆ¶ï¼šä»»ä½•éåŸºæœ¬ç±»å‹çš„å…ƒç´ ï¼Œ æ— è®ºæ˜¯åœ¨æºä»£ç å£°æ˜æ—¶è¿˜æ˜¯åœ¨æ³¨è§£æ¥å£ä¸­å®šä¹‰é»˜è®¤å€¼æ—¶ï¼Œéƒ½ä¸èƒ½ä½¿ç”¨ null ä½œä¸ºå…¶å€¼ã€‚è¿™ä¸ªé™åˆ¶ä½¿å¾—å¤„ç†å™¨å¾ˆéš¾è¡¨ç°ä¸€ä¸ªå…ƒç´ çš„å­˜åœ¨æˆ–è€…ç¼ºå¤±çš„çŠ¶æ€ï¼Œå› ä¸ºåœ¨æ¯ä¸ªæ³¨è§£çš„å£°æ˜ä¸­ï¼Œæ‰€æœ‰çš„å…ƒç´ éƒ½å­˜åœ¨ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åº”çš„å€¼ã€‚ä¸ºäº†ç»•å¼€è¿™ä¸ªçº¦æŸï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€äº›ç‰¹æ®Šçš„å€¼ï¼Œæ¯”å¦‚ç©ºå­—ç¬¦ä¸²æˆ–è€…è´Ÿæ•°ç”¨äºè¡¨è¾¾æŸä¸ªå…ƒç´ ä¸å­˜åœ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/SimulatingNull.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SimulatingNull &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ³¨è§£çš„ä¹ æƒ¯ç”¨æ³•ã€‚</p><h3 id="ç”Ÿæˆå¤–éƒ¨æ–‡ä»¶"><a href="#ç”Ÿæˆå¤–éƒ¨æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆå¤–éƒ¨æ–‡ä»¶"></a>ç”Ÿæˆå¤–éƒ¨æ–‡ä»¶</h3><p>å½“æœ‰äº›æ¡†æ¶éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ‰èƒ½ä¸ä½ çš„æºä»£ç ååŒå·¥ä½œï¼Œè¿™ç§æƒ…å†µä¸‹æ³¨è§£å°±ä¼šå˜å¾—ååˆ†æœ‰ç”¨ã€‚åƒ Enterprise JavaBeans (EJB3 ä¹‹å‰)è¿™æ ·çš„æŠ€æœ¯ï¼Œæ¯ä¸€ä¸ª Bean éƒ½éœ€è¦éœ€è¦å¤§é‡çš„æ¥å£å’Œéƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œè€Œè¿™äº›å°±æ˜¯â€œæ ·æ¿â€æ–‡ä»¶ã€‚Web Serviceï¼Œè‡ªå®šä¹‰æ ‡ç­¾åº“ä»¥åŠå¯¹è±¡/å…³ç³»æ˜ å°„å·¥å…·ï¼ˆä¾‹å¦‚ Toplink å’Œ Hibernateï¼‰é€šå¸¸éƒ½éœ€è¦ XML æè¿°æ–‡ä»¶ï¼Œè€Œè¿™äº›æ–‡ä»¶è„±ç¦»äºä»£ç ä¹‹å¤–ã€‚é™¤äº†å®šä¹‰ Java ç±»ï¼Œç¨‹åºå‘˜è¿˜å¿…é¡»å¿å—æ²‰é—·ï¼Œé‡å¤çš„æä¾›æŸäº›ä¿¡æ¯ï¼Œä¾‹å¦‚ç±»åå’ŒåŒ…åç­‰å·²ç»åœ¨åŸå§‹ç±»ä¸­å·²ç»æä¾›çš„ä¿¡æ¯ã€‚æ¯å½“ä½ ä½¿ç”¨å¤–éƒ¨æè¿°æ–‡ä»¶æ—¶ï¼Œä»–å°±æ‹¥æœ‰äº†ä¸€ä¸ªç±»çš„ä¸¤ä¸ªç‹¬ç«‹ä¿¡æ¯æºï¼Œè¿™ç»å¸¸å¯¼è‡´ä»£ç çš„åŒæ­¥é—®é¢˜ã€‚åŒæ—¶è¿™ä¹Ÿè¦æ±‚äº†ä¸ºé¡¹ç›®å·¥ä½œçš„ç¨‹åºå‘˜åœ¨çŸ¥é“å¦‚ä½•ç¼–å†™ Java ç¨‹åºçš„åŒæ—¶ï¼Œä¹Ÿå¿…é¡»çŸ¥é“å¦‚ä½•ç¼–è¾‘æè¿°æ–‡ä»¶ã€‚</p><p>å‡è®¾ä½ æƒ³æä¾›ä¸€äº›åŸºæœ¬çš„å¯¹è±¡/å…³ç³»æ˜ å°„åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ã€‚ä½ å¯ä»¥ä½¿ç”¨ XML æè¿°æ–‡ä»¶æ¥æŒ‡æ˜ç±»çš„åå­—ã€æ¯ä¸ªæˆå‘˜ä»¥åŠæ•°æ®åº“æ˜ å°„çš„ç›¸å…³ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨æ³¨è§£ï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰ä¿¡æ¯éƒ½ä¿å­˜åœ¨ <strong>JavaBean</strong> æºæ–‡ä»¶ä¸­ã€‚ä¸ºæ­¤ä½ éœ€è¦ä¸€äº›ç”¨äºå®šä¹‰æ•°æ®åº“è¡¨åç§°ã€æ•°æ®åº“åˆ—ä»¥åŠå°† SQL ç±»å‹æ˜ å°„åˆ°å±æ€§çš„æ³¨è§£ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ³¨è§£çš„å®šä¹‰ï¼Œå®ƒå‘Šè¯‰æ³¨è§£å¤„ç†å™¨åº”è¯¥åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/DBTable.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE) <span class="comment">// Applies to classes only</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DBTable &#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>@Target</code> æ³¨è§£ä¸­æŒ‡å®šçš„æ¯ä¸€ä¸ª <strong>ElementType</strong> å°±æ˜¯ä¸€ä¸ªçº¦æŸï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªè‡ªå®šä¹‰çš„æ³¨è§£åªèƒ½ç”¨äºæŒ‡å®šçš„ç±»å‹ã€‚ä½ å¯ä»¥æŒ‡å®š <strong>enum ElementType</strong> ä¸­çš„ä¸€ä¸ªå€¼ï¼Œæˆ–è€…ä»¥é€—å·åˆ†å‰²çš„å½¢å¼æŒ‡å®šå¤šä¸ªå€¼ã€‚å¦‚æœæƒ³è¦å°†æ³¨è§£åº”ç”¨äºæ‰€æœ‰çš„ <strong>ElementType</strong>ï¼Œé‚£ä¹ˆå¯ä»¥çœå» <code>@Target</code> æ³¨è§£ï¼Œä½†æ˜¯è¿™å¹¶ä¸å¸¸è§ã€‚</p><p>æ³¨æ„ <strong>@DBTable</strong> ä¸­æœ‰ä¸€ä¸ª <code>name()</code> å…ƒç´ ï¼Œè¯¥æ³¨è§£é€šè¿‡è¿™ä¸ªå…ƒç´ ä¸ºå¤„ç†å™¨åˆ›å»ºæ•°æ®åº“æ—¶æä¾›è¡¨çš„åå­—ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¿®é¥°å­—æ®µçš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/Constraints.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Constraints &#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">primaryKey</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">allowNull</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">unique</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/SQLString.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SQLString &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="function">Constraints <span class="title">constraints</span><span class="params">()</span> <span class="keyword">default</span> @Constraints</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/SQLInteger.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SQLInteger &#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="function">Constraints <span class="title">constraints</span><span class="params">()</span> <span class="keyword">default</span> @Constraints</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@Constraints</strong> æ³¨è§£å…è®¸å¤„ç†å™¨æä¾›æ•°æ®åº“è¡¨çš„å…ƒæ•°æ®ã€‚<strong>@Constraints</strong> ä»£è¡¨äº†æ•°æ®åº“é€šå¸¸æä¾›çš„çº¦æŸçš„ä¸€å°éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒæ‰€è¦è¡¨è¾¾çš„æ€æƒ³å·²ç»å¾ˆæ¸…æ¥šäº†ã€‚<code>primaryKey()</code>ï¼Œ<code>allowNull()</code> å’Œ <code>unique()</code> å…ƒç´ æ˜æ˜¾çš„æä¾›äº†é»˜è®¤å€¼ï¼Œä»è€Œä½¿å¾—åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æ³¨è§£çš„ä½¿ç”¨è€…ä¸éœ€è¦è¾“å…¥å¤ªå¤šä¸œè¥¿ã€‚</p><p>å¦å¤–ä¸¤ä¸ª <strong>@interface</strong> å®šä¹‰çš„æ˜¯ SQL ç±»å‹ã€‚å¦‚æœå¸Œæœ›è¿™ä¸ªæ¡†æ¶æ›´æœ‰ä»·å€¼çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºæ¯ä¸ª SQL ç±»å‹éƒ½å®šä¹‰ç›¸åº”çš„æ³¨è§£ã€‚ä¸è¿‡ä¸ºä¸ºç¤ºä¾‹ï¼Œä¸¤ä¸ªå…ƒç´ è¶³å¤Ÿäº†ã€‚</p><p>è¿™äº› SQL ç±»å‹å…·æœ‰ <code>name()</code> å…ƒç´ å’Œ <code>constraints()</code> å…ƒç´ ã€‚åè€…åˆ©ç”¨äº†åµŒå¥—æ³¨è§£çš„åŠŸèƒ½ï¼Œå°†æ•°æ®åº“åˆ—çš„ç±»å‹çº¦æŸä¿¡æ¯åµŒå…¥å…¶ä¸­ã€‚æ³¨æ„ <code>constraints()</code> å…ƒç´ çš„é»˜è®¤å€¼æ˜¯ <strong>@Constraints</strong>ã€‚ç”±äºåœ¨ <strong>@Constraints</strong> æ³¨è§£ç±»å‹ä¹‹åï¼Œæ²¡æœ‰åœ¨æ‹¬å·ä¸­æŒ‡æ˜ <strong>@Constraints</strong> å…ƒç´ çš„å€¼ï¼Œå› æ­¤ï¼Œ<strong>constraints()</strong> çš„é»˜è®¤å€¼ä¸ºæ‰€æœ‰å…ƒç´ éƒ½ä¸ºé»˜è®¤å€¼çš„ <strong>@Constraints</strong> æ³¨è§£ã€‚å¦‚æœè¦ä½¿å¾—åµŒå…¥çš„  <strong>@Constraints</strong>  æ³¨è§£ä¸­çš„ <code>unique()</code> å…ƒç´ ä¸º trueï¼Œå¹¶ä½œä¸º <code>constraints()</code> å…ƒç´ çš„é»˜è®¤å€¼ï¼Œä½ å¯ä»¥åƒå¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/Uniqueness.java</span></span><br><span class="line"><span class="comment">// Sample of nested annotations</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Uniqueness &#123;</span><br><span class="line">    <span class="function">Constraints <span class="title">constraints</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">default</span> @<span class="title">Constraints</span><span class="params">(unique = <span class="keyword">true</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ï¼Œä½¿ç”¨äº†å¦‚ä¸Šæ³¨è§£çš„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/Member.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="meta">@DBTable</span>(name = <span class="string">"MEMBER"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SQLString</span>(<span class="number">30</span>) String firstName;</span><br><span class="line">    <span class="meta">@SQLString</span>(<span class="number">50</span>) String lastName;</span><br><span class="line">    <span class="meta">@SQLInteger</span> Integer age;</span><br><span class="line">    <span class="meta">@SQLString</span>(value = <span class="number">30</span>,</span><br><span class="line">            constraints = <span class="meta">@Constraints</span>(primaryKey = <span class="keyword">true</span>))</span><br><span class="line">    String reference;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> memberCount;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getReference</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> reference; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> firstName; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> lastName; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> reference; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> age; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»æ³¨è§£ <strong>@DBTable</strong> æ³¨è§£ç»™å®šäº†å…ƒç´ å€¼ MEMBERï¼Œå®ƒå°†ä¼šä½œä¸ºæ ‡çš„åå­—ã€‚ç±»çš„å±æ€§ <strong>firstName</strong> å’Œ <strong>lastName</strong> éƒ½è¢«æ³¨è§£ä¸º <strong>@SQLString</strong> ç±»å‹å¹¶ä¸”ç»™äº†é»˜è®¤å…ƒç´ å€¼åˆ†åˆ«ä¸º 30 å’Œ 50ã€‚è¿™äº›æ³¨è§£éƒ½æœ‰ä¸¤ä¸ªæœ‰è¶£çš„åœ°æ–¹ï¼šé¦–å…ˆï¼Œä»–ä»¬éƒ½ä½¿ç”¨äº†åµŒå…¥çš„ <strong>@Constraints</strong> æ³¨è§£çš„é»˜è®¤å€¼ï¼›å…¶æ¬¡ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨äº†å¿«æ·æ–¹å¼ç‰¹æ€§ã€‚å¦‚æœä½ åœ¨æ³¨è§£ä¸­å®šä¹‰äº†åä¸º <strong>value</strong> çš„å…ƒç´ ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œ<strong>value</strong> ä¸ºå”¯ä¸€ä¸€ä¸ªéœ€è¦èµ‹å€¼çš„å…ƒç´ ï¼Œä½ å°±ä¸éœ€è¦ä½¿ç”¨åâ€”å€¼å¯¹çš„è¯­æ³•ï¼Œä½ åªéœ€è¦åœ¨æ‹¬å·ä¸­ç»™å‡º <strong>value</strong> å…ƒç´ çš„å€¼å³å¯ã€‚è¿™å¯ä»¥åº”ç”¨äºä»»ä½•åˆæ³•ç±»å‹çš„å…ƒç´ ã€‚è¿™ä¹Ÿé™åˆ¶äº†ä½ å¿…é¡»å°†å…ƒç´ å‘½åä¸º <strong>value</strong>ï¼Œä¸è¿‡åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™æ ·çš„æ³¨è§£è¯­å¥ä¹Ÿæ›´æ˜“äºç†è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SQLString</span>(<span class="number">30</span>)</span><br></pre></td></tr></table></figure><p>å¤„ç†å™¨å°†åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ä½¿ç”¨è¯¥å€¼è®¾ç½® SQL åˆ—çš„å¤§å°ã€‚</p><p>é»˜è®¤å€¼çš„è¯­æ³•è™½ç„¶å¾ˆçµå·§ï¼Œä½†æ˜¯å®ƒå¾ˆå¿«å°±å˜çš„å¤æ‚èµ·æ¥ã€‚ä»¥ <strong>reference</strong> å­—æ®µçš„æ³¨è§£ä¸ºä¾‹ï¼Œä¸Šé¢æ‹¥æœ‰ <strong>@SQLString</strong> æ³¨è§£ï¼Œä½†æ˜¯è¿™ä¸ªå­—æ®µä¹Ÿå°†æˆä¸ºè¡¨çš„ä¸»é”®ï¼Œå› æ­¤åœ¨åµŒå…¥çš„ <strong>@Constraint</strong> æ³¨è§£ä¸­è®¾å®š <strong>primaryKey</strong> å…ƒç´ çš„å€¼ã€‚è¿™æ—¶äº‹æƒ…å°±å˜çš„å¤æ‚äº†ã€‚ä½ ä¸å¾—ä¸ä¸ºè¿™ä¸ªåµŒå…¥çš„æ³¨è§£ä½¿ç”¨å¾ˆé•¿çš„é”®â€”å€¼å¯¹çš„å½¢å¼ï¼Œæ¥æŒ‡å®šå…ƒç´ åç§°å’Œ <strong>@interface</strong> çš„åç§°ã€‚åŒæ—¶ï¼Œç”±äºæœ‰ç‰¹æ®Šå‘½åçš„ <strong>value</strong> ä¹Ÿä¸æ˜¯å”¯ä¸€éœ€è¦èµ‹å€¼çš„å…ƒç´ ï¼Œå› æ­¤ä¸èƒ½å†ä½¿ç”¨å¿«æ·æ–¹å¼ç‰¹æ€§ã€‚å¦‚ä½ æ‰€è§ï¼Œæœ€ç»ˆç»“æœä¸ç®—æ¸…æ™°æ˜“æ‡‚ã€‚</p><h3 id="æ›¿ä»£æ–¹æ¡ˆ"><a href="#æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="æ›¿ä»£æ–¹æ¡ˆ"></a>æ›¿ä»£æ–¹æ¡ˆ</h3><p>å¯ä»¥ä½¿ç”¨å¤šç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰è‡ªå·±çš„æ³¨è§£ç”¨äºä¸Šè¿°ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„æ³¨è§£ç±» <strong>@TableColumn</strong>ï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ª <strong>enum</strong> å…ƒç´ ï¼Œå…ƒç´ å€¼å®šä¹‰äº† <strong>STRING</strong>ï¼Œ<strong>INTEGER</strong>ï¼Œ<strong>FLOAT</strong> ç­‰ç±»å‹ã€‚è¿™æ¶ˆé™¤äº†æ¯ä¸ª SQL ç±»å‹éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ª <strong>@interface</strong> çš„è´Ÿæ‹…ï¼Œä¸è¿‡ä¹Ÿä½¿å¾—ç”¨é¢å¤–ä¿¡æ¯ä¿®é¥° SQL ç±»å‹å˜çš„ä¸å¯èƒ½ï¼Œè¿™äº›é¢å¤–çš„ä¿¡æ¯ä¾‹å¦‚é•¿åº¦æˆ–ç²¾åº¦ç­‰ï¼Œéƒ½å¯èƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <strong>String</strong> ç±»å‹çš„å…ƒç´ æ¥æè¿°å®é™…çš„ SQL ç±»å‹ï¼Œæ¯”å¦‚ â€œVARCHAR(30)â€ æˆ–è€… â€œINTEGERâ€ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥ä¿®é¥° SQL ç±»å‹ï¼Œä½†æ˜¯è¿™ä¹Ÿå°† Java ç±»å‹åˆ° SQL ç±»å‹çš„æ˜ å°„ç»‘åœ¨äº†ä¸€èµ·ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚ä½ å¹¶ä¸æƒ³åœ¨æ•°æ®åº“æ›´æ”¹ä¹‹åé‡æ–°ç¼–è¯‘ä½ çš„ä»£ç ï¼›å¦‚æœæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ³¨è§£å¤„ç†å™¨ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆâ€œå£å‘³ï¼ˆfavorï¼‰â€çš„ SQLï¼Œç„¶åæ³¨è§£åŠ©åŠ›å™¨æ¥ä¸ºæˆ‘ä»¬å¤„ç† SQL ç±»å‹çš„ç»†èŠ‚ï¼Œé‚£å°†æ˜¯ä¸€ä¸ªä¼˜é›…çš„è®¾è®¡ã€‚</p><p>ç¬¬ä¸‰ç§å¯è¡Œçš„æ–¹æ¡ˆæ˜¯ä¸€èµ·ä½¿ç”¨ä¸¤ä¸ªæ³¨è§£ï¼Œ<strong>@Constraints</strong> å’Œç›¸åº”çš„ SQL ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ<strong>@SQLInteger</strong>ï¼‰å»æ³¨è§£åŒä¸€ä¸ªå­—æ®µã€‚è¿™å¯èƒ½ä¼šè®©ä»£ç æœ‰äº›æ··ä¹±ï¼Œä½†æ˜¯ç¼–è¯‘å™¨å…è®¸ä½ å¯¹åŒä¸€ä¸ªç›®æ ‡ä½¿ç”¨å¤šä¸ªæ³¨è§£ã€‚åœ¨ Java 8ï¼Œåœ¨ä½¿ç”¨å¤šä¸ªæ³¨è§£çš„æ—¶å€™ï¼Œä½ å¯ä»¥é‡å¤ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚</p><h3 id="æ³¨è§£ä¸æ”¯æŒç»§æ‰¿"><a href="#æ³¨è§£ä¸æ”¯æŒç»§æ‰¿" class="headerlink" title="æ³¨è§£ä¸æ”¯æŒç»§æ‰¿"></a>æ³¨è§£ä¸æ”¯æŒç»§æ‰¿</h3><p>ä½ ä¸èƒ½ä½¿ç”¨ <strong>extends</strong> å…³é”®å­—æ¥ç»§æ‰¿ <strong>@interfaces</strong>ã€‚è¿™çœŸæ˜¯ä¸€ä¸ªé—æ†¾ï¼Œå¦‚æœå¯ä»¥å®šä¹‰ <strong>@TableColumn</strong> æ³¨è§£ï¼ˆå‚è€ƒå‰é¢çš„å»ºè®®ï¼‰ï¼ŒåŒæ—¶åµŒå¥—ä¸€ä¸ª <strong>@SQLType</strong> ç±»å‹çš„æ³¨è§£ï¼Œå°†æˆä¸ºä¸€ä¸ªä¼˜é›…çš„è®¾è®¡ã€‚æŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥é€šè¿‡ç»§æ‰¿ <strong>@SQLType</strong> æ¥åˆ›é€ å„ç§ SQL ç±»å‹ã€‚ä¾‹å¦‚ <strong>@SQLInteger</strong> å’Œ <strong>@SQLString</strong>ã€‚å¦‚æœæ”¯æŒç»§æ‰¿ï¼Œå°±ä¼šå¤§å¤§å‡å°‘æ‰“å­—çš„å·¥ä½œé‡å¹¶ä¸”ä½¿å¾—è¯­æ³•æ›´æ•´æ´ã€‚åœ¨ Java çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œä¼¼ä¹æ²¡æœ‰ä»»ä½•å…³äºè®©æ³¨è§£æ”¯æŒç»§æ‰¿çš„ææ¡ˆï¼Œæ‰€ä»¥åœ¨å½“å‰æƒ…å†µä¸‹ï¼Œä¸Šä¾‹ä¸­çš„è§£å†³æ–¹æ¡ˆå¯èƒ½å·²ç»æ˜¯æœ€ä½³æ–¹æ¡ˆäº†ã€‚</p><h3 id="å®ç°å¤„ç†å™¨"><a href="#å®ç°å¤„ç†å™¨" class="headerlink" title="å®ç°å¤„ç†å™¨"></a>å®ç°å¤„ç†å™¨</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨çš„ä¾‹å­ï¼Œä»–å°†è¯»å–ä¸€ä¸ªç±»æ–‡ä»¶ï¼Œæ£€æŸ¥ä¸Šé¢çš„æ•°æ®åº“æ³¨è§£ï¼Œå¹¶ç”Ÿæˆç”¨äºåˆ›å»ºæ•°æ®åº“çš„ SQL å‘½ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/database/TableCreator.java</span></span><br><span class="line"><span class="comment">// Reflection-based annotation processor</span></span><br><span class="line"><span class="comment">// &#123;java annotations.database.TableCreator</span></span><br><span class="line"><span class="comment">// annotations.database.Member&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">    main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    <span class="string">"arguments: annotated classes"</span>);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (String className : args) &#123;</span><br><span class="line">            Class&lt;?&gt; cl = Class.forName(className);</span><br><span class="line">            DBTable dbTable = cl.getAnnotation(DBTable.class);</span><br><span class="line">            <span class="keyword">if</span> (dbTable == <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(</span><br><span class="line">                        <span class="string">"No DBTable annotations in class "</span> +</span><br><span class="line">                                className);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String tableName = dbTable.name();</span><br><span class="line">            <span class="comment">// If the name is empty, use the Class name:</span></span><br><span class="line">            <span class="keyword">if</span> (tableName.length() &lt; <span class="number">1</span>)</span><br><span class="line">                tableName = cl.getName().toUpperCase();</span><br><span class="line">            List&lt;String&gt; columnDefs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Field field : cl.getDeclaredFields()) &#123;</span><br><span class="line">                String columnName = <span class="keyword">null</span>;</span><br><span class="line">                Annotation[] anns =</span><br><span class="line">                        field.getDeclaredAnnotations();</span><br><span class="line">                <span class="keyword">if</span> (anns.length &lt; <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">continue</span>; <span class="comment">// Not a db table column</span></span><br><span class="line">                <span class="keyword">if</span> (anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLInteger) &#123;</span><br><span class="line">                    SQLInteger sInt = (SQLInteger) anns[<span class="number">0</span>];</span><br><span class="line">                    <span class="comment">// Use field name if name not specified</span></span><br><span class="line">                    <span class="keyword">if</span> (sInt.name().length() &lt; <span class="number">1</span>)</span><br><span class="line">                        columnName = field.getName().toUpperCase();</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        columnName = sInt.name();</span><br><span class="line">                    columnDefs.add(columnName + <span class="string">" INT"</span> +</span><br><span class="line">                            getConstraints(sInt.constraints()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLString) &#123;</span><br><span class="line">                    SQLString sString = (SQLString) anns[<span class="number">0</span>];</span><br><span class="line">                    <span class="comment">// Use field name if name not specified.</span></span><br><span class="line">                    <span class="keyword">if</span> (sString.name().length() &lt; <span class="number">1</span>)</span><br><span class="line">                        columnName = field.getName().toUpperCase();</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        columnName = sString.name();</span><br><span class="line">                    columnDefs.add(columnName + <span class="string">" VARCHAR("</span> +</span><br><span class="line">                            sString.value() + <span class="string">")"</span> +</span><br><span class="line">                            getConstraints(sString.constraints()));</span><br><span class="line">                &#125;</span><br><span class="line">                StringBuilder createCommand = <span class="keyword">new</span> StringBuilder(</span><br><span class="line">                        <span class="string">"CREATE TABLE "</span> + tableName + <span class="string">"("</span>);</span><br><span class="line">                <span class="keyword">for</span> (String columnDef : columnDefs)</span><br><span class="line">                    createCommand.append(</span><br><span class="line">                            <span class="string">"\n "</span> + columnDef + <span class="string">","</span>);</span><br><span class="line">                <span class="comment">// Remove trailing comma</span></span><br><span class="line">                String tableCreate = createCommand.substring(</span><br><span class="line">                        <span class="number">0</span>, createCommand.length() - <span class="number">1</span>) + <span class="string">");"</span>;</span><br><span class="line">                System.out.println(<span class="string">"Table Creation SQL for "</span> +</span><br><span class="line">                        className + <span class="string">" is:\n"</span> + tableCreate);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getConstraints</span><span class="params">(Constraints con)</span> </span>&#123;</span><br><span class="line">        String constraints = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (!con.allowNull())</span><br><span class="line">            constraints += <span class="string">" NOT NULL"</span>;</span><br><span class="line">        <span class="keyword">if</span> (con.primaryKey())</span><br><span class="line">            constraints += <span class="string">" PRIMARY KEY"</span>;</span><br><span class="line">        <span class="keyword">if</span> (con.unique())</span><br><span class="line">            constraints += <span class="string">" UNIQUE"</span>;</span><br><span class="line">        <span class="keyword">return</span> constraints;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Table Creation SQL for annotations.database.Member is:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">MEMBER</span>(</span><br><span class="line">    FIRSTNAME <span class="built_in">VARCHAR</span>(<span class="number">30</span>));</span><br><span class="line">Table Creation SQL for annotations.database.Member is:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">MEMBER</span>(</span><br><span class="line">    FIRSTNAME <span class="built_in">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    LASTNAME <span class="built_in">VARCHAR</span>(<span class="number">50</span>));</span><br><span class="line">Table Creation SQL for annotations.database.Member is:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">MEMBER</span>(</span><br><span class="line">    FIRSTNAME <span class="built_in">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    LASTNAME <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    AGE <span class="built_in">INT</span>);</span><br><span class="line">Table Creation SQL for annotations.database.Member is:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">MEMBER</span>(</span><br><span class="line">    FIRSTNAME <span class="built_in">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    LASTNAME <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    AGE <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">REFERENCE</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) PRIMARY <span class="keyword">KEY</span>);</span><br></pre></td></tr></table></figure><p>ä¸»æ–¹æ³•ä¼šå¾ªç¯å¤„ç†å‘½ä»¤è¡Œä¼ å…¥çš„æ¯ä¸€ä¸ªç±»åã€‚æ¯ä¸€ä¸ªç±»éƒ½æ˜¯ç”¨ <code>forName()</code> æ–¹æ³•è¿›è¡ŒåŠ è½½ï¼Œå¹¶ä½¿ç”¨ <code>getAnnotation(DBTable.class)</code> æ¥æ£€æŸ¥è¯¥ç±»æ˜¯å¦å¸¦æœ‰ <strong>@DBTable</strong> æ³¨è§£ã€‚å¦‚æœå­˜åœ¨ï¼Œå°†è¡¨åå­˜å‚¨èµ·æ¥ã€‚ç„¶åè¯»å–è¿™ä¸ªç±»çš„æ‰€æœ‰å­—æ®µï¼Œå¹¶ä½¿ç”¨ <code>getDeclaredAnnotations()</code> è¿›è¡Œæ£€æŸ¥ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ç‰¹å®šå­—æ®µä¸Šæ‰€æœ‰æ³¨è§£çš„æ•°ç»„ã€‚ç„¶åä½¿ç”¨ <strong>instanceof</strong> æ“ä½œç¬¦åˆ¤æ–­è¿™äº›æ³¨è§£æ˜¯å¦æ˜¯ <strong>@SQLInteger</strong> æˆ–è€… <strong>@SQLString</strong> ç±»å‹ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œåœ¨å¯¹åº”çš„å¤„ç†å—ä¸­å°†æ„é€ å‡ºç›¸åº”çš„æ•°æ®åº“åˆ—çš„å­—ç¬¦ä¸²ç‰‡æ®µã€‚æ³¨æ„ï¼Œç”±äºæ³¨è§£æ²¡æœ‰ç»§æ‰¿æœºåˆ¶ï¼Œå¦‚æœè¦è·å–è¿‘ä¼¼å¤šæ€çš„è¡Œä¸ºï¼Œä½¿ç”¨ <code>getDeclaredAnnotations()</code> ä¼¼ä¹æ˜¯å”¯ä¸€çš„æ–¹å¼ã€‚</p><p>åµŒå¥—çš„ <strong>@Constraint</strong> æ³¨è§£è¢«ä¼ é€’ç»™ <code>getConstraints()</code>æ–¹æ³•ï¼Œå¹¶ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ªåŒ…å« SQL çº¦æŸçš„ String å¯¹è±¡ã€‚</p><p>éœ€è¦æé†’çš„æ˜¯ï¼Œä¸Šé¢æ¼”ç¤ºçš„æŠ€å·§å¯¹äºçœŸå®çš„å¯¹è±¡/æ˜ å°„å…³ç³»è€Œè¨€ï¼Œæ˜¯ååˆ†å¹¼ç¨šçš„ã€‚ä½¿ç”¨ <strong>@DBTable</strong> çš„æ³¨è§£æ¥è·å–è¡¨çš„åç§°ï¼Œè¿™ä½¿å¾—å¦‚æœè¦ä¿®æ”¹è¡¨çš„åå­—ï¼Œåˆ™è¿«ä½¿ä½ é‡æ–°ç¼–è¯‘ Java ä»£ç ã€‚è¿™ç§æ•ˆæœå¹¶ä¸ç†æƒ³ã€‚ç°åœ¨å·²ç»æœ‰äº†å¾ˆå¤šå¯ç”¨çš„æ¡†æ¶ï¼Œç”¨äºå°†å¯¹è±¡æ˜ å°„åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”è¶Šæ¥è¶Šå¤šçš„æ¡†æ¶å¼€å§‹ä½¿ç”¨æ³¨è§£äº†ã€‚</p><!-- Using javac to Process Annotations --><h2 id="ä½¿ç”¨javacå¤„ç†æ³¨è§£"><a href="#ä½¿ç”¨javacå¤„ç†æ³¨è§£" class="headerlink" title="ä½¿ç”¨javacå¤„ç†æ³¨è§£"></a>ä½¿ç”¨javacå¤„ç†æ³¨è§£</h2><p>é€šè¿‡ <strong>javac</strong>ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºç¼–è¯‘æ—¶ï¼ˆcompile-timeï¼‰æ³¨è§£å¤„ç†å™¨åœ¨ Java æºæ–‡ä»¶ä¸Šä½¿ç”¨æ³¨è§£ï¼Œè€Œä¸æ˜¯ç¼–è¯‘ä¹‹åçš„ class æ–‡ä»¶ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé‡å¤§é™åˆ¶ï¼šä½ ä¸èƒ½é€šè¿‡å¤„ç†å™¨æ¥æ”¹å˜æºä»£ç ã€‚å”¯ä¸€å½±å“è¾“å‡ºçš„æ–¹å¼å°±æ˜¯åˆ›å»ºæ–°çš„æ–‡ä»¶ã€‚</p><p>å¦‚æœä½ çš„æ³¨è§£å¤„ç†å™¨åˆ›å»ºäº†æ–°çš„æºæ–‡ä»¶ï¼Œåœ¨æ–°ä¸€è½®å¤„ç†ä¸­æ³¨è§£ä¼šæ£€æŸ¥æºæ–‡ä»¶æœ¬èº«ã€‚å·¥å…·åœ¨æ£€æµ‹ä¸€è½®ä¹‹åæŒç»­å¾ªç¯ï¼Œç›´åˆ°ä¸å†æœ‰æ–°çš„æºæ–‡ä»¶äº§ç”Ÿã€‚ç„¶åå®ƒç¼–è¯‘æ‰€æœ‰çš„æºæ–‡ä»¶ã€‚</p><p>æ¯ä¸€ä¸ªä½ ç¼–å†™çš„æ³¨è§£éƒ½éœ€è¦å¤„ç†å™¨ï¼Œä½†æ˜¯ <strong>javac</strong> å¯ä»¥éå¸¸å®¹æ˜“çš„å°†å¤šä¸ªæ³¨è§£å¤„ç†å™¨åˆå¹¶åœ¨ä¸€èµ·ã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ªéœ€è¦å¤„ç†çš„ç±»ï¼Œå¹¶ä¸”ä½ å¯ä»¥æ·»åŠ ç›‘å¬å™¨ç”¨äºç›‘å¬æ³¨è§£å¤„ç†å®Œæˆåæ¥åˆ°é€šçŸ¥ã€‚</p><p>æœ¬èŠ‚ä¸­çš„ç¤ºä¾‹å°†å¸®åŠ©ä½ å¼€å§‹å­¦ä¹ ï¼Œä½†å¦‚æœä½ å¿…é¡»æ·±å…¥å­¦ä¹ ï¼Œè¯·åšå¥½åå¤å­¦ä¹ ï¼Œå¤§é‡è®¿é—® Google å’ŒStackOverflow çš„å‡†å¤‡ã€‚</p><h3 id="æœ€ç®€å•çš„å¤„ç†å™¨"><a href="#æœ€ç®€å•çš„å¤„ç†å™¨" class="headerlink" title="æœ€ç®€å•çš„å¤„ç†å™¨"></a>æœ€ç®€å•çš„å¤„ç†å™¨</h3><p>è®©æˆ‘ä»¬å¼€å§‹å®šä¹‰æˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„å¤„ç†å™¨ï¼Œåªæ˜¯ä¸ºäº†ç¼–è¯‘å’Œæµ‹è¯•ã€‚å¦‚ä¸‹æ˜¯æ³¨è§£çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/simplest/Simple.java</span></span><br><span class="line"><span class="comment">// A bare-bones annotation</span></span><br><span class="line"><span class="keyword">package</span> annotations.simplest;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD,</span><br><span class="line">        ElementType.CONSTRUCTOR,</span><br><span class="line">        ElementType.ANNOTATION_TYPE,</span><br><span class="line">        ElementType.PACKAGE, ElementType.FIELD,</span><br><span class="line">        ElementType.LOCAL_VARIABLE&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Simple &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> "-<span class="keyword">default</span>-"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@Retention</strong> çš„å‚æ•°ç°åœ¨ä¸º <strong>SOURCE</strong>ï¼Œè¿™æ„å‘³ç€æ³¨è§£ä¸ä¼šå†å­˜ç•™åœ¨ç¼–è¯‘åçš„ä»£ç ã€‚è¿™åœ¨ç¼–è¯‘æ—¶å¤„ç†æ³¨è§£æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå®ƒåªæ˜¯æŒ‡å‡ºï¼Œåœ¨è¿™é‡Œï¼Œ<strong>javac</strong> æ˜¯å”¯ä¸€æœ‰æœºä¼šå¤„ç†æ³¨è§£çš„ä»£ç†ã€‚</p><p><strong>@Target</strong> å£°æ˜äº†å‡ ä¹æ‰€æœ‰çš„ç›®æ ‡ç±»å‹ï¼ˆé™¤äº† <strong>PACKAGE</strong>ï¼‰ ï¼ŒåŒæ ·æ˜¯ä¸ºäº†æ¼”ç¤ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ç¤ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/simplest/SimpleTest.java</span></span><br><span class="line"><span class="comment">// Test the "Simple" annotation</span></span><br><span class="line"><span class="comment">// &#123;java annotations.simplest.SimpleTest&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations.simplest;</span><br><span class="line"><span class="meta">@Simple</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Simple</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">@Simple</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleTest</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Simple</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SimpleTest.foo()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Simple</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(String s, <span class="keyword">int</span> i, <span class="keyword">float</span> f)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SimpleTest.bar()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Simple</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Simple</span></span><br><span class="line">        SimpleTest st = <span class="keyword">new</span> SimpleTest();</span><br><span class="line">        st.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleTest.foo()</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <strong>@Simple</strong> æ³¨è§£äº†æ‰€æœ‰ <strong>@Target</strong> å£°æ˜å…è®¸çš„åœ°æ–¹ã€‚</p><p><strong>SimpleTest.java</strong> åªéœ€è¦ <strong>Simple.java</strong> å°±å¯ä»¥ç¼–è¯‘æˆåŠŸã€‚å½“æˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿã€‚</p><p><strong>javac</strong> å…è®¸ <strong>@Simple</strong> æ³¨è§£ï¼ˆåªè¦å®ƒå­˜åœ¨ï¼‰åœ¨æˆ‘ä»¬åˆ›å»ºå¤„ç†å™¨å¹¶å°†å…¶ hook åˆ°ç¼–è¯‘å™¨ä¹‹å‰ï¼Œä¸åšä»»ä½•äº‹æƒ…ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªååˆ†ç®€å•çš„å¤„ç†å™¨ï¼Œå…¶æ‰€ä½œçš„äº‹æƒ…å°±æ˜¯æŠŠæ³¨è§£ç›¸å…³çš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/simplest/SimpleProcessor.java</span></span><br><span class="line"><span class="comment">// A bare-bones annotation processor</span></span><br><span class="line"><span class="keyword">package</span> annotations.simplest;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.*;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.SourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(</span><br><span class="line">        <span class="string">"annotations.simplest.Simple"</span>)</span><br><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleProcessor</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Set&lt;? extends TypeElement&gt; annotations,</span></span></span><br><span class="line"><span class="function"><span class="params">            RoundEnvironment env)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(TypeElement t : annotations)</span><br><span class="line">            System.out.println(t);</span><br><span class="line">        <span class="keyword">for</span>(Element el :</span><br><span class="line">                env.getElementsAnnotatedWith(Simple.class))</span><br><span class="line">            display(el);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">(Element el)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"==== "</span> + el + <span class="string">" ===="</span>);</span><br><span class="line">        System.out.println(el.getKind() +</span><br><span class="line">                <span class="string">" : "</span> + el.getModifiers() +</span><br><span class="line">                <span class="string">" : "</span> + el.getSimpleName() +</span><br><span class="line">                <span class="string">" : "</span> + el.asType());</span><br><span class="line">        <span class="keyword">if</span>(el.getKind().equals(ElementKind.CLASS)) &#123;</span><br><span class="line">            TypeElement te = (TypeElement)el;</span><br><span class="line">            System.out.println(te.getQualifiedName());</span><br><span class="line">            System.out.println(te.getSuperclass());</span><br><span class="line">            System.out.println(te.getEnclosedElements());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(el.getKind().equals(ElementKind.METHOD)) &#123;</span><br><span class="line">            ExecutableElement ex = (ExecutableElement)el;</span><br><span class="line">            System.out.print(ex.getReturnType() + <span class="string">" "</span>);</span><br><span class="line">            System.out.print(ex.getSimpleName() + <span class="string">"("</span>);</span><br><span class="line">            System.out.println(ex.getParameters() + <span class="string">")"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆæ—§çš„ï¼Œå¤±æ•ˆçš„ï¼‰<strong>apt</strong> ç‰ˆæœ¬çš„å¤„ç†å™¨éœ€è¦é¢å¤–çš„æ–¹æ³•æ¥ç¡®å®šæ”¯æŒå“ªäº›æ³¨è§£ä»¥åŠæ”¯æŒçš„ Java ç‰ˆæœ¬ã€‚ä¸è¿‡ï¼Œä½ ç°åœ¨å¯ä»¥ç®€å•çš„ä½¿ç”¨ <strong>@SupportedAnnotationTypes</strong> å’Œ <strong>@SupportedSourceVersion</strong> æ³¨è§£ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç¤ºä¾‹å…³äºæ³¨è§£å¦‚ä½•ç®€åŒ–ä½ çš„ä»£ç ï¼‰ã€‚</p><p>ä½ å”¯ä¸€éœ€è¦å®ç°çš„æ–¹æ³•å°±æ˜¯ <code>process()</code>ï¼Œè¿™é‡Œæ˜¯æ‰€æœ‰è¡Œä¸ºå‘ç”Ÿçš„åœ°æ–¹ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å‘Šè¯‰ä½ å“ªä¸ªæ³¨è§£æ˜¯å­˜åœ¨çš„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¿ç•™äº†å‰©ä½™ä¿¡æ¯ã€‚æˆ‘ä»¬æ‰€åšçš„äº‹æƒ…åªæ˜¯æ‰“å°äº†æ³¨è§£ï¼ˆè¿™é‡Œåªå­˜åœ¨ä¸€ä¸ªï¼‰ï¼Œå¯ä»¥çœ‹ <strong>TypeElement</strong> æ–‡æ¡£ä¸­çš„å…¶ä»–è¡Œä¸ºã€‚é€šè¿‡ä½¿ç”¨ <code>process()</code> çš„ç¬¬äºŒä¸ªæ“ä½œï¼Œæˆ‘ä»¬å¾ªç¯æ‰€æœ‰è¢« <strong>@Simple</strong> æ³¨è§£çš„å…ƒç´ ï¼Œå¹¶ä¸”é’ˆå¯¹æ¯ä¸€ä¸ªå…ƒç´ è°ƒç”¨æˆ‘ä»¬çš„ <code>display()</code> æ–¹æ³•ã€‚æ‰€æœ‰ <strong>Element</strong> å±•ç¤ºäº†æœ¬èº«çš„åŸºæœ¬ä¿¡æ¯ï¼›ä¾‹å¦‚ï¼Œ<code>getModifiers()</code> å‘Šè¯‰ä½ å®ƒæ˜¯å¦ä¸º <strong>public</strong> å’Œ <strong>static</strong> çš„ã€‚</p><p><strong>Element</strong> åªèƒ½æ‰§è¡Œé‚£äº›ç¼–è¯‘å™¨è§£æçš„æ‰€æœ‰åŸºæœ¬å¯¹è±¡å…±æœ‰çš„æ“ä½œï¼Œè€Œç±»å’Œæ–¹æ³•ä¹‹ç±»çš„ä¸œè¥¿æœ‰é¢å¤–çš„ä¿¡æ¯éœ€è¦æå–ã€‚æ‰€ä»¥ï¼ˆå¦‚æœä½ é˜…è¯»äº†æ­£ç¡®çš„æ–‡æ¡£ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åœ¨ä»»ä½•æ–‡æ¡£ä¸­æ‰¾åˆ°â€”â€”æˆ‘ä¸å¾—ä¸é€šè¿‡ StackOverflow å¯»æ‰¾çº¿ç´¢ï¼‰ä½ æ£€æŸ¥å®ƒæ˜¯å“ªç§ <strong>ElementKind</strong>ï¼Œç„¶åå°†å…¶å‘ä¸‹è½¬æ¢ä¸ºæ›´å…·ä½“çš„å…ƒç´ ç±»å‹ï¼Œæ³¨å…¥é’ˆå¯¹ CLASS çš„ TypeElement å’Œ é’ˆå¯¹ METHOD çš„ExecutableElementã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä¸ºè¿™äº›å…ƒç´ è°ƒç”¨å…¶ä»–æ–¹æ³•ã€‚</p><p>åŠ¨æ€å‘ä¸‹è½¬å‹ï¼ˆåœ¨ç¼–è¯‘æœŸä¸è¿›è¡Œæ£€æŸ¥ï¼‰å¹¶ä¸åƒæ˜¯ Java çš„åšäº‹æ–¹å¼ï¼Œè¿™éå¸¸ä¸ç›´è§‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»æœªæƒ³è¿‡è¦è¿™æ ·åšäº‹ã€‚ç›¸åï¼Œæˆ‘èŠ±äº†å¥½å‡ å¤©çš„æ—¶é—´ï¼Œè¯•å›¾å‘ç°ä½ åº”è¯¥å¦‚ä½•è®¿é—®è¿™äº›ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯è‡³å°‘åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯ç”¨ä¸èµ·ä½œç”¨çš„æ°å½“æ–¹æ³•ç®€å•æ˜äº†çš„ã€‚æˆ‘è¿˜æ²¡æœ‰é‡åˆ°ä»»ä½•ä¸œè¥¿è¯´ä¸Šé¢æ˜¯è§„èŒƒçš„å½¢å¼ï¼Œä½†åœ¨æˆ‘çœ‹æ¥æ˜¯ã€‚</p><p>å¦‚æœåªæ˜¯é€šè¿‡å¹³å¸¸çš„æ–¹å¼æ¥ç¼–è¯‘ <strong>SimpleTest.java</strong>ï¼Œä½ ä¸ä¼šå¾—åˆ°ä»»ä½•ç»“æœã€‚ä¸ºäº†å¾—åˆ°æ³¨è§£è¾“å‡ºï¼Œä½ å¿…é¡»å¢åŠ ä¸€ä¸ª <strong>processor</strong> æ ‡å¿—å¹¶ä¸”è¿æ¥æ³¨è§£å¤„ç†å™¨ç±»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -processor annotations.simplest.SimpleProcessor SimpleTest.java</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç¼–è¯‘å™¨æœ‰äº†è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">annotations.simplest.Simple</span><br><span class="line">==== annotations.simplest.SimpleTest ====</span><br><span class="line">CLASS : [public] : SimpleTest : annotations.simplest.SimpleTest</span><br><span class="line">annotations.simplest.SimpleTest</span><br><span class="line">java.lang.Object</span><br><span class="line">i,SimpleTest(),foo(),bar(java.lang.String,int,float),main(java.lang.String[])</span><br><span class="line">==== i ====</span><br><span class="line">FIELD : [] : i : int</span><br><span class="line">==== SimpleTest() ====</span><br><span class="line">CONSTRUCTOR : [public] : &lt;init&gt; : ()void</span><br><span class="line">==== foo() ====</span><br><span class="line">METHOD : [public] : foo : ()void</span><br><span class="line">void foo()</span><br><span class="line">==== bar(java.lang.String,int,float) ====</span><br><span class="line">METHOD : [public] : bar : (java.lang.String,int,float)void</span><br><span class="line">void bar(s,i,f)</span><br><span class="line">==== main(java.lang.String[]) ====</span><br><span class="line">METHOD : [public, static] : main : (java.lang.String[])void</span><br><span class="line">void main(args)</span><br></pre></td></tr></table></figure><p>è¿™ç»™äº†ä½ ä¸€äº›å¯ä»¥å‘ç°çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬å‚æ•°åå’Œç±»å‹ã€è¿”å›å€¼ç­‰ã€‚</p><h3 id="æ›´å¤æ‚çš„å¤„ç†å™¨"><a href="#æ›´å¤æ‚çš„å¤„ç†å™¨" class="headerlink" title="æ›´å¤æ‚çš„å¤„ç†å™¨"></a>æ›´å¤æ‚çš„å¤„ç†å™¨</h3><p>å½“ä½ åˆ›å»ºç”¨äº javac æ³¨è§£å¤„ç†å™¨æ—¶ï¼Œä½ ä¸èƒ½ä½¿ç”¨ Java çš„åå°„ç‰¹æ€§ï¼Œå› ä¸ºä½ å¤„ç†çš„æ˜¯æºä»£ç ï¼Œè€Œå¹¶éæ˜¯ç¼–è¯‘åçš„ class æ–‡ä»¶ã€‚å„ç§ mirror[^3 ] è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡å…è®¸ä½ åœ¨æœªç¼–è¯‘çš„æºä»£ç ä¸­æŸ¥çœ‹æ–¹æ³•ã€å­—æ®µå’Œç±»å‹ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨äºæå–ç±»ä¸­æ–¹æ³•çš„æ³¨è§£ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è¢«æŠ½å–æˆä¸ºä¸€ä¸ªæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/ifx/ExtractInterface.java</span></span><br><span class="line"><span class="comment">// javac-based annotation processing</span></span><br><span class="line"><span class="keyword">package</span> annotations.ifx;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ExtractInterface &#123;</span><br><span class="line">    <span class="function">String <span class="title">interfaceName</span><span class="params">()</span> <span class="keyword">default</span> "-!!-"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>RetentionPolicy</strong> çš„å€¼ä¸º <strong>SOURCE</strong>ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨æå–ç±»ä¸­çš„æ¥å£ä¹‹åä¸å†å°†æ³¨è§£ä¿¡æ¯ä¿ç•™åœ¨ class æ–‡ä»¶ä¸­ã€‚æ¥ä¸‹æ¥çš„æµ‹è¯•ç±»æä¾›äº†ä¸€äº›å…¬ç”¨æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æˆä¸ºæ¥å£çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/ifx/Multiplier.java</span></span><br><span class="line"><span class="comment">// javac-based annotation processing</span></span><br><span class="line"><span class="comment">// &#123;java annotations.ifx.Multiplier&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations.ifx;</span><br><span class="line"><span class="meta">@ExtractInterface</span>(interfaceName=<span class="string">"IMultiplier"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Multiplier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; x; i++)</span><br><span class="line">            total = add(total, y);</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fortySeven</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">47</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">timesTen</span><span class="params">(<span class="keyword">double</span> arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg * <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Multiplier m = <span class="keyword">new</span> Multiplier();</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"11 * 16 = "</span> + m.multiply(<span class="number">11</span>, <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11</span> * <span class="number">16</span> = <span class="number">176</span></span><br></pre></td></tr></table></figure><p><strong>Multiplier</strong> ç±»ï¼ˆåªèƒ½å¤„ç†æ­£æ•´æ•°ï¼‰æ‹¥æœ‰ä¸€ä¸ª <code>multiply()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨ç§æœ‰æ–¹æ³• <code>add()</code> æ¥æ¨¡æ‹Ÿä¹˜æ³•æ“ä½œã€‚<code>add()</code> æ˜¯ç§æœ‰æ–¹æ³•ï¼Œå› æ­¤ä¸èƒ½æˆä¸ºæ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å…¶ä»–çš„æ–¹æ³•æä¾›äº†è¯­æ³•å¤šæ ·æ€§ã€‚æ³¨è§£è¢«èµ‹äºˆ <strong>IMultiplier</strong> çš„ <strong>InterfaceName</strong> ä½œä¸ºè¦åˆ›å»ºçš„æ¥å£çš„åç§°ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªç¼–è¯‘æ—¶å¤„ç†å™¨ç”¨äºæå–æœ‰è¶£çš„æ–¹æ³•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ interface æºä»£ç æ–‡ä»¶ï¼ˆè¿™ä¸ªæºæ–‡ä»¶å°†ä¼šåœ¨ä¸‹ä¸€è½®ä¸­è¢«è‡ªåŠ¨ç¼–è¯‘ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/ifx/IfaceExtractorProcessor.java</span></span><br><span class="line"><span class="comment">// javac-based annotation processing</span></span><br><span class="line"><span class="keyword">package</span> annotations.ifx;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.processing.*;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.SourceVersion;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.*;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(</span><br><span class="line">        <span class="string">"annotations.ifx.ExtractInterface"</span>)</span><br><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IfaceExtractorProcessor</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Element&gt;</span><br><span class="line">            interfaceMethods = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Elements elementUtils;</span><br><span class="line">    <span class="keyword">private</span> ProcessingEnvironment processingEnv;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            ProcessingEnvironment processingEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.processingEnv = processingEnv;</span><br><span class="line">        elementUtils = processingEnv.getElementUtils();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Set&lt;? extends TypeElement&gt; annotations,</span></span></span><br><span class="line"><span class="function"><span class="params">            RoundEnvironment env)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Element elem:env.getElementsAnnotatedWith(</span><br><span class="line">                ExtractInterface.class)) &#123;</span><br><span class="line">            String interfaceName = elem.getAnnotation(</span><br><span class="line">                    ExtractInterface.class).interfaceName();</span><br><span class="line">            <span class="keyword">for</span>(Element enclosed :</span><br><span class="line">                    elem.getEnclosedElements()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(enclosed.getKind()</span><br><span class="line">                        .equals(ElementKind.METHOD) &amp;&amp;</span><br><span class="line">                        enclosed.getModifiers()</span><br><span class="line">                                .contains(Modifier.PUBLIC) &amp;&amp;</span><br><span class="line">                        !enclosed.getModifiers()</span><br><span class="line">                                .contains(Modifier.STATIC)) &#123;</span><br><span class="line">                    interfaceMethods.add(enclosed);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(interfaceMethods.size() &gt; <span class="number">0</span>)</span><br><span class="line">                writeInterfaceFile(interfaceName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span></span><br><span class="line">    writeInterfaceFile(String interfaceName) &#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                Writer writer = processingEnv.getFiler()</span><br><span class="line">                        .createSourceFile(interfaceName)</span><br><span class="line">                        .openWriter()</span><br><span class="line">        ) &#123;</span><br><span class="line">            String packageName = elementUtils</span><br><span class="line">                    .getPackageOf(interfaceMethods</span><br><span class="line">                            .get(<span class="number">0</span>)).toString();</span><br><span class="line">            writer.write(</span><br><span class="line">                    <span class="string">"package "</span> + packageName + <span class="string">";\n"</span>);</span><br><span class="line">            writer.write(<span class="string">"public interface "</span> +</span><br><span class="line">                    interfaceName + <span class="string">" &#123;\n"</span>);</span><br><span class="line">            <span class="keyword">for</span>(Element elem : interfaceMethods) &#123;</span><br><span class="line">                ExecutableElement method =</span><br><span class="line">                        (ExecutableElement)elem;</span><br><span class="line">                String signature = <span class="string">" public "</span>;</span><br><span class="line">                signature += method.getReturnType() + <span class="string">" "</span>;</span><br><span class="line">                signature += method.getSimpleName();</span><br><span class="line">                signature += createArgList(</span><br><span class="line">                        method.getParameters());</span><br><span class="line">                System.out.println(signature);</span><br><span class="line">                writer.write(signature + <span class="string">";\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            writer.write(<span class="string">"&#125;"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">createArgList</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            List&lt;? extends VariableElement&gt; parameters)</span> </span>&#123;</span><br><span class="line">        String args = parameters.stream()</span><br><span class="line">                .map(p -&gt; p.asType() + <span class="string">" "</span> + p.getSimpleName())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"("</span> + args + <span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Elements</strong> å¯¹è±¡å®ä¾‹ <strong>elementUtils</strong> æ˜¯ä¸€ç»„é™æ€æ–¹æ³•çš„å·¥å…·ï¼›æˆ‘ä»¬ç”¨å®ƒæ¥å¯»æ‰¾ <strong>writeInterfaceFile()</strong> ä¸­å«æœ‰çš„åŒ…åã€‚</p><p><code>getEnclosedElements()</code>æ–¹æ³•ä¼šé€šè¿‡æŒ‡å®šçš„å…ƒç´ ç”Ÿæˆæ‰€æœ‰çš„â€œé—­åŒ…â€å…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œè¿™ä¸ªç±»é—­åŒ…äº†å®ƒçš„æ‰€æœ‰å…ƒç´ ã€‚é€šè¿‡ä½¿ç”¨ <code>getKind()</code> æˆ‘ä»¬ä¼šæ‰¾åˆ°æ‰€æœ‰çš„ <strong>public</strong> å’Œ <strong>static</strong> æ–¹æ³•ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° <strong>interfaceMethods</strong> åˆ—è¡¨ä¸­ã€‚æ¥ä¸‹æ¥ <code>writeInterfaceFile()</code> ä½¿ç”¨ <strong>interfaceMethods</strong> åˆ—è¡¨é‡Œé¢çš„å€¼ç”Ÿæˆæ–°çš„æ¥å£å®šä¹‰ã€‚æ³¨æ„ï¼Œåœ¨ <code>writeInterfaceFile()</code> ä½¿ç”¨äº†å‘ä¸‹è½¬å‹åˆ° <strong>ExecutableElement</strong>ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥è·å–æ‰€æœ‰çš„æ–¹æ³•ä¿¡æ¯ã€‚<strong>createArgList()</strong> æ˜¯ä¸€ä¸ªå¸®åŠ©æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆå‚æ•°åˆ—è¡¨ã€‚</p><p><strong>Filer</strong>æ˜¯ <code>getFiler()</code> ç”Ÿæˆçš„ï¼Œå¹¶ä¸”æ˜¯ <strong>PrintWriter</strong> çš„ä¸€ç§å®ä¾‹ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºæ–°æ–‡ä»¶ã€‚æˆ‘ä»¬ä½¿ç”¨ <strong>Filer</strong> å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŸç”Ÿçš„ <strong>PrintWriter</strong> åŸå› æ˜¯ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¿è¡Œ <strong>javac</strong> è¿½è¸ªä½ åˆ›å»ºçš„æ–°æ–‡ä»¶ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥åœ¨æ–°ä¸€è½®ä¸­æ£€æŸ¥æ–°æ–‡ä»¶ä¸­çš„æ³¨è§£å¹¶ç¼–è¯‘æ–‡ä»¶ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨å¤„ç†å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -processor annotations.ifx.IfaceExtractorProcessor Multiplier.java</span><br></pre></td></tr></table></figure><p>æ–°ç”Ÿæˆçš„ <strong>IMultiplier.java</strong> çš„æ–‡ä»¶ï¼Œæ­£å¦‚ä½ é€šè¿‡æŸ¥çœ‹ä¸Šé¢å¤„ç†å™¨çš„ <code>println()</code> è¯­å¥æ‰€çŒœæµ‹çš„é‚£æ ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotations.ifx;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMultiplier</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fortySeven</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">timesTen</span><span class="params">(<span class="keyword">double</span> arg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»åŒæ ·ä¼šè¢« <strong>javac</strong> ç¼–è¯‘ï¼ˆåœ¨æŸä¸€è½®ä¸­ï¼‰ï¼Œæ‰€ä»¥ä½ ä¼šåœ¨åŒä¸€ä¸ªç›®å½•ä¸­çœ‹åˆ° <strong>IMultiplier.class</strong> æ–‡ä»¶ã€‚</p><!-- Annotation-Based Unit Testing --><h2 id="åŸºäºæ³¨è§£çš„å•å…ƒæµ‹è¯•"><a href="#åŸºäºæ³¨è§£çš„å•å…ƒæµ‹è¯•" class="headerlink" title="åŸºäºæ³¨è§£çš„å•å…ƒæµ‹è¯•"></a>åŸºäºæ³¨è§£çš„å•å…ƒæµ‹è¯•</h2><p>å•å…ƒæµ‹è¯•æ˜¯å¯¹ç±»ä¸­æ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµ‹è¯•çš„ä¸€ç§äº‹ä»¶ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æœ‰è§„å¾‹çš„æµ‹è¯•ä¸€ä¸ªç±»ä¸­æ¯ä¸ªéƒ¨åˆ†æ˜¯å¦å…·å¤‡æ­£ç¡®çš„è¡Œä¸ºã€‚åœ¨ Java ä¸­ï¼Œæœ€è‘—åçš„å•å…ƒæµ‹è¯•å·¥å…·å°±æ˜¯ <strong>JUnit</strong>ã€‚<strong>JUnit</strong> 4 ç‰ˆæœ¬å·²ç»åŒ…å«äº†æ³¨è§£ã€‚åœ¨æ³¨è§£ç‰ˆæœ¬ä¹‹å‰çš„ JUnit ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œä¸ºäº†å¯åŠ¨å’Œè¿è¡Œ <strong>JUnit</strong> æµ‹è¯•ï¼Œæœ‰å¤§é‡çš„â€œä»ªå¼â€éœ€è¦æ ‡æ³¨ã€‚è¿™ç§è´Ÿæ‹…å·²ç»å‡è½»äº†ä¸€äº›ï¼Œ<strong>ä½†æ˜¯</strong>æ³¨è§£ä½¿å¾—æµ‹è¯•æ›´æ¥è¿‘â€œå¯ä»¥å·¥ä½œçš„æœ€ç®€å•çš„æµ‹è¯•ç³»ç»Ÿâ€ã€‚</p><p>åœ¨æ³¨è§£ç‰ˆæœ¬ä¹‹å‰çš„ JUnitï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æ¥ä¿å­˜å•å…ƒæµ‹è¯•ã€‚é€šè¿‡æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å•å…ƒæµ‹è¯•é›†æˆåœ¨éœ€è¦è¢«æµ‹è¯•çš„ç±»ä¸­ï¼Œä»è€Œå°†å•å…ƒæµ‹è¯•çš„æ—¶é—´å’Œéº»çƒ¦é™åˆ°äº†æœ€ä½ã€‚è¿™ç§æ–¹å¼æœ‰é¢å¤–çš„å¥½å¤„ï¼Œå°±æ˜¯ä½¿å¾—æµ‹è¯•ç§æœ‰æ–¹æ³•å’Œå…¬æœ‰æ–¹æ³•å˜çš„ä¸€æ ·å®¹æ˜“ã€‚</p><p>è¿™ä¸ªåŸºäºæ³¨è§£çš„æµ‹è¯•æ¡†æ¶å«åš <strong>@Unit</strong>ã€‚å…¶æœ€åŸºæœ¬çš„æµ‹è¯•å½¢å¼ï¼Œå¯èƒ½ä¹Ÿæ˜¯ä½ ä½¿ç”¨çš„æœ€å¤šçš„ä¸€ä¸ªæ³¨è§£æ˜¯ <strong>@Test</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>@Test</strong> æ¥æ ‡è®°æµ‹è¯•æ–¹æ³•ã€‚æµ‹è¯•æ–¹æ³•ä¸å¸¦å‚æ•°ï¼Œå¹¶è¿”å› <strong>boolean</strong> ç»“æœæ¥è¯´æ˜æµ‹è¯•æ–¹æ³•æˆåŠŸæˆ–è€…å¤±è´¥ã€‚ä½ å¯ä»¥ä»»æ„å‘½åå®ƒçš„æµ‹è¯•æ–¹æ³•ã€‚åŒæ—¶ <strong>@Unit</strong> æµ‹è¯•æ–¹æ³•å¯ä»¥æ˜¯ä»»æ„ä½ å–œæ¬¢çš„è®¿é—®ä¿®é¥°æ–¹æ³•ï¼ŒåŒ…æ‹¬ <strong>private</strong>ã€‚</p><p>è¦ä½¿ç”¨ <strong>@Unit</strong>ï¼Œä½ å¿…é¡»å¯¼å…¥ <strong>onjava.atunit</strong> åŒ…ï¼Œå¹¶ä¸”ä½¿ç”¨ <strong>@Unit</strong> çš„æµ‹è¯•æ ‡è®°ä¸ºåˆé€‚çš„æ–¹æ³•å’Œå­—æ®µæ‰“ä¸Šæ ‡ç­¾ï¼ˆåœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ä½ ä¼šå­¦åˆ°ï¼‰ï¼Œç„¶åè®©ä½ çš„æ„å»ºç³»ç»Ÿå¯¹ç¼–è¯‘åçš„ç±»è¿è¡Œ <strong>@Unit</strong>ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AtUnitExample1.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AtUnitExample1.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnitExample1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">methodOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This is methodOne"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">methodTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is methodTwo"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">methodOneTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> methodOne().equals(<span class="string">"This is methodOne"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">m2</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> methodTwo() == <span class="number">2</span>; &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">m3</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">true</span>; &#125;</span><br><span class="line">    <span class="comment">// Shows output for failure:</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">failureTest</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">anotherDisappointment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">annotations.AtUnitExample1</span><br><span class="line">. m3</span><br><span class="line">. methodOneTest</span><br><span class="line">. m2 This is methodTwo</span><br><span class="line">. failureTest (failed)</span><br><span class="line">. anotherDisappointment (failed)</span><br><span class="line">(<span class="number">5</span> tests)</span><br><span class="line">&gt;&gt;&gt; <span class="number">2</span> FAILURES &lt;&lt;&lt;</span><br><span class="line">annotations.AtUnitExample1: failureTest</span><br><span class="line">annotations.AtUnitExample1: anotherDisappointment</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <strong>@Unit</strong> è¿›è¡Œæµ‹è¯•çš„ç±»å¿…é¡»å®šä¹‰åœ¨æŸä¸ªåŒ…ä¸­ï¼ˆå³å¿…é¡»åŒ…æ‹¬ <strong>package</strong> å£°æ˜ï¼‰ã€‚</p><p><strong>@Test</strong> æ³¨è§£è¢«ç½®äº <code>methodOneTest()</code>ã€ <code>m2()</code>ã€<code>m3()</code>ã€<code>failureTest()</code> ä»¥åŠ a<code>notherDisappointment()</code> æ–¹æ³•ä¹‹å‰ï¼Œå®ƒä»¬å‘Šè¯‰ <strong>@Unit</strong> æ–¹æ³•ä½œä¸ºå•å…ƒæµ‹è¯•æ¥è¿è¡Œã€‚åŒæ—¶ <strong>@Test</strong> ç¡®ä¿è¿™äº›æ–¹æ³•æ²¡æœ‰ä»»ä½•å‚æ•°å¹¶ä¸”è¿”å›å€¼ä¸º <strong>boolean</strong> æˆ–è€… <strong>void</strong>ã€‚å½“ä½ å¡«å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œå”¯ä¸€éœ€è¦åšçš„å°±æ˜¯å†³å®šæµ‹è¯•æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œï¼ˆå¯¹äºè¿”å›å€¼ä¸º <strong>boolean</strong> çš„æ–¹æ³•ï¼‰åº”è¯¥è¿”å› <strong>ture</strong> è¿˜æ˜¯ <strong>false</strong>ã€‚</p><p>å¦‚æœä½ ç†Ÿæ‚‰ <strong>JUnit</strong>ï¼Œä½ è¿˜å°†æ³¨æ„åˆ° <strong>@Unit</strong> è¾“å‡ºçš„ä¿¡æ¯æ›´å¤šã€‚ä½ ä¼šçœ‹åˆ°ç°åœ¨æ­£åœ¨è¿è¡Œçš„æµ‹è¯•çš„è¾“å‡ºæ›´æœ‰ç”¨ï¼Œæœ€åå®ƒä¼šå‘Šè¯‰ä½ å¯¼è‡´å¤±è´¥çš„ç±»å’Œæµ‹è¯•ã€‚</p><p>ä½ å¹¶éå¿…é¡»å°†æµ‹è¯•æ–¹æ³•åµŒå…¥åˆ°åŸæ¥çš„ç±»ä¸­ï¼Œæœ‰æ—¶å€™è¿™ç§äº‹æƒ…æ ¹æœ¬åšä¸åˆ°ã€‚è¦ç”Ÿäº§ä¸€ä¸ªéåµŒå…¥å¼çš„æµ‹è¯•ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç»§æ‰¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AUExternalTest.java</span></span><br><span class="line"><span class="comment">// Creating non-embedded tests</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AUExternalTest.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AUExternalTest</span> <span class="keyword">extends</span> <span class="title">AtUnitExample1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">_MethodOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> methodOne().equals(<span class="string">"This is methodOne"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">_MethodTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> methodTwo() == <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">annotations.AUExternalTest</span><br><span class="line">. tMethodOne</span><br><span class="line">. tMethodTwo This is methodTwo</span><br><span class="line">OK (<span class="number">2</span> tests)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹è¿˜è¡¨ç°å‡ºçµæ´»å‘½åçš„ä»·å€¼ã€‚åœ¨è¿™é‡Œï¼Œ<strong>@Test</strong> æ–¹æ³•è¢«å‘½åä¸ºä¸‹åˆ’çº¿å‰ç¼€åŠ ä¸Šè¦æµ‹è¯•çš„æ–¹æ³•åç§°ï¼ˆæˆ‘å¹¶ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ç§ç†æƒ³çš„å‘½åå½¢å¼ï¼Œè¿™åªæ˜¯è¡¨ç°ä¸€ç§å¯èƒ½æ€§ç½¢äº†ï¼‰ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç»„åˆæ¥åˆ›å»ºéåµŒå…¥å¼çš„æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AUComposition.java</span></span><br><span class="line"><span class="comment">// Creating non-embedded tests</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AUComposition.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AUComposition</span> </span>&#123;</span><br><span class="line">    AtUnitExample1 testObject = <span class="keyword">new</span> AtUnitExample1();</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tMethodOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testObject.methodOne()</span><br><span class="line">                .equals(<span class="string">"This is methodOne"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tMethodTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testObject.methodTwo() == <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">annotations.AUComposition</span><br><span class="line">. tMethodTwo This is methodTwo</span><br><span class="line">. tMethodOne</span><br><span class="line">OK (<span class="number">2</span> tests)</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨æ¯ä¸€ä¸ªæµ‹è¯•é‡Œé¢éƒ½ä¼šåˆ›å»º <strong>AUComposition</strong> å¯¹è±¡ï¼Œæ‰€ä»¥åˆ›å»ºæ–°çš„æˆå‘˜å˜é‡ <strong>testObject</strong> ç”¨äºä»¥åçš„æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ã€‚</p><p>å› ä¸º <strong>@Unit</strong> ä¸­æ²¡æœ‰ <strong>JUnit</strong> ä¸­ç‰¹æ®Šçš„ <strong>assert</strong> æ–¹æ³•ï¼Œä¸è¿‡å¦ä¸€ç§å½¢å¼çš„ <strong>@Test</strong> æ–¹æ³•ä»ç„¶å…è®¸è¿”å›å€¼ä¸º <strong>void</strong>ï¼ˆå¦‚æœä½ è¿˜æƒ³ä½¿ç”¨ <strong>true</strong> æˆ–è€… <strong>false</strong> çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>boolean</strong> ä½œä¸ºæ–¹æ³•è¿”å›å€¼ç±»å‹ï¼‰ã€‚ä¸ºäº†è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ Java çš„ <strong>assert</strong> è¯­å¥ã€‚Java æ–­è¨€æœºåˆ¶éœ€è¦ä½ åœ¨ java å‘½ä»¤è¡Œè¡ŒåŠ ä¸Š <strong>-ea</strong> æ ‡å¿—æ¥å¼€å¯ï¼Œä½†æ˜¯ <strong>@Unit</strong> å·²ç»è‡ªåŠ¨å¼€å¯äº†è¯¥åŠŸèƒ½ã€‚è¦è¡¨ç¤ºæµ‹è¯•å¤±è´¥çš„è¯ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨å¼‚å¸¸ã€‚<strong>@Unit</strong> çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€å°±æ˜¯å°½å¯èƒ½å‡å°‘æ·»åŠ é¢å¤–çš„è¯­æ³•ï¼Œè€Œ Java çš„ <strong>assert</strong> å’Œå¼‚å¸¸å¯¹äºæŠ¥å‘Šé”™è¯¯è€Œè¨€ï¼Œå³å·²ç»è¶³å¤Ÿäº†ã€‚ä¸€ä¸ªå¤±è´¥çš„ <strong>assert</strong> æˆ–è€…ä»æ–¹æ³•ä»æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¢«è§†ä¸ºæµ‹è¯•å¤±è´¥ï¼Œä½†æ˜¯ <strong>@Unit</strong> ä¸ä¼šåœ¨è¿™ä¸ªå¤±è´¥çš„æµ‹è¯•ä¸Šå¡ä½ï¼Œå®ƒä¼šç»§ç»­è¿è¡Œï¼Œç›´åˆ°æ‰€æœ‰æµ‹è¯•å®Œæ¯•ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AtUnitExample2.java</span></span><br><span class="line"><span class="comment">// Assertions and exceptions can be used in @Tests</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AtUnitExample2.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnitExample2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">methodOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This is methodOne"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">methodTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is methodTwo"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">assertExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">methodOne</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"This is methodOne"</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">assertFailureExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">2</span>: <span class="string">"What a surprise!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exceptionExample</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(FileInputStream fis =</span><br><span class="line">                    <span class="keyword">new</span> FileInputStream(<span class="string">"nofile.txt"</span>)) &#123;&#125; <span class="comment">// Throws</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">assertAndReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Assertion with message:</span></span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">methodTwo</span><span class="params">()</span> </span>== <span class="number">2</span>: <span class="string">"methodTwo must equal 2"</span>;</span><br><span class="line">        <span class="keyword">return</span> methodOne().equals(<span class="string">"This is methodOne"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">annotations.AtUnitExample2</span><br><span class="line">. exceptionExample java.io.FileNotFoundException:</span><br><span class="line">nofile.txt (The system cannot find the file specified)</span><br><span class="line">(failed)</span><br><span class="line">. assertExample</span><br><span class="line">. assertAndReturn This is methodTwo</span><br><span class="line">. assertFailureExample java.lang.AssertionError: What</span><br><span class="line">a surprise!</span><br><span class="line">(failed)</span><br><span class="line">(<span class="number">4</span> tests)</span><br><span class="line">&gt;&gt;&gt; <span class="number">2</span> FAILURES &lt;&lt;&lt;</span><br><span class="line">annotations.AtUnitExample2: exceptionExample</span><br><span class="line">annotations.AtUnitExample2: assertFailureExample</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨éåµŒå…¥å¼æµ‹è¯•çš„ä¾‹å­ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ–­è¨€ï¼Œå®ƒå°†ä¼šå¯¹ <strong>java.util.HashSet</strong> è¿›è¡Œä¸€äº›ç®€å•çš„æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/HashSetTest.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/HashSetTest.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSetTest</span> </span>&#123;</span><br><span class="line">    HashSet&lt;String&gt; testObject = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> testObject.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">_Contains</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        testObject.add(<span class="string">"one"</span>);</span><br><span class="line">        <span class="keyword">assert</span> testObject.contains(<span class="string">"one"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">_Remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        testObject.add(<span class="string">"one"</span>);</span><br><span class="line">        testObject.remove(<span class="string">"one"</span>);</span><br><span class="line">        <span class="keyword">assert</span> testObject.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼å¯èƒ½ä¼šæ›´ç®€å•ï¼Œä¹Ÿæ²¡æœ‰ä¸€äº›å…¶ä»–çš„çº¦æŸã€‚</p><p>å¯¹æ¯ä¸€ä¸ªå•å…ƒæµ‹è¯•è€Œè¨€ï¼Œ<strong>@Unit</strong> éƒ½ä¼šä½¿ç”¨é»˜è®¤çš„æ— å‚æ„é€ å™¨ï¼Œä¸ºè¯¥æµ‹è¯•ç±»æ‰€å±çš„ç±»åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¹¶åœ¨æ­¤æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šè¿è¡Œæµ‹è¯•ï¼Œç„¶åä¸¢å¼ƒè¯¥å¯¹è±¡ï¼Œä»¥å…å¯¹å…¶ä»–æµ‹è¯•äº§ç”Ÿå‰¯ä½œç”¨ã€‚å¦‚æ­¤åˆ›å»ºå¯¹è±¡å¯¼è‡´æˆ‘ä»¬ä¾èµ–äºç±»çš„é»˜è®¤æ„é€ å™¨ã€‚å¦‚æœä½ çš„ç±»æ²¡æœ‰é»˜è®¤æ„é€ å™¨ï¼Œæˆ–è€…å¯¹è±¡éœ€è¦å¤æ‚çš„æ„é€ è¿‡ç¨‹ï¼Œé‚£ä¹ˆä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <strong>static</strong> æ–¹æ³•ä¸“é—¨è´Ÿè´£æ„é€ å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <strong>@TestObjectCreate</strong> æ³¨è§£æ ‡è®°è¯¥æ–¹æ³•ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AtUnitExample3.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AtUnitExample3.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnitExample3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtUnitExample3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">this</span>.n = n; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getN</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> n; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">methodOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This is methodOne"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">methodTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is methodTwo"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@TestObjectCreate</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> AtUnitExample3 <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AtUnitExample3(<span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">initialization</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> n == <span class="number">47</span>; &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">methodOneTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> methodOne().equals(<span class="string">"This is methodOne"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">m2</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> methodTwo() == <span class="number">2</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">annotations.AtUnitExample3</span><br><span class="line">. initialization</span><br><span class="line">. m2 This is methodTwo</span><br><span class="line">. methodOneTest</span><br><span class="line">OK (<span class="number">3</span> tests)</span><br></pre></td></tr></table></figure><p><strong>@TestObjectCreate</strong> ä¿®é¥°çš„æ–¹æ³•å¿…é¡»å£°æ˜ä¸º <strong>static</strong> ï¼Œä¸”å¿…é¡»è¿”å›ä¸€ä¸ªä½ æ­£åœ¨æµ‹è¯•çš„ç±»å‹å¯¹è±¡ï¼Œè¿™ä¸€åˆ‡éƒ½ç”± <strong>@Unit</strong> è´Ÿè´£ç¡®ä¿æˆç«‹ã€‚</p><p>æœ‰çš„æ—¶å€™ï¼Œä½ éœ€è¦å‘å•å…ƒæµ‹è¯•ä¸­å¢åŠ ä¸€äº›å­—æ®µã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ <strong>@TestProperty</strong> æ³¨è§£ï¼Œç”±å®ƒæ³¨è§£çš„å­—æ®µè¡¨ç¤ºåªåœ¨å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨ï¼ˆå› æ­¤ï¼Œåœ¨ä½ å°†äº§å“å‘å¸ƒç»™å®¢æˆ·ä¹‹å‰ï¼Œä»–ä»¬åº”è¯¥è¢«åˆ é™¤ï¼‰ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ª <strong>String</strong> é€šè¿‡ <code>String.split()</code> æ–¹æ³•è¿›è¡Œåˆ†å‰²ï¼Œä»å…¶ä¸­è¯»å–ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°†ä¼šè¢«ç”Ÿæˆæµ‹è¯•å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AtUnitExample4.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AtUnitExample4.class&#125;</span></span><br><span class="line"><span class="comment">// &#123;VisuallyInspectOutput&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnitExample4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> String theory = <span class="string">"All brontosauruses "</span> +</span><br><span class="line">            <span class="string">"are thin at one end, much MUCH thicker in the "</span> +</span><br><span class="line">            <span class="string">"middle, and then thin again at the far end."</span>;</span><br><span class="line">    <span class="keyword">private</span> String word;</span><br><span class="line">    <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random(); <span class="comment">// Time-based seed</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtUnitExample4</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.word = word;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWord</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> word; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scrambleWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Character&gt; chars = Arrays.asList(</span><br><span class="line">                ConvertTo.boxed(word.toCharArray()));</span><br><span class="line">        Collections.shuffle(chars, rand);</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> ch : chars)</span><br><span class="line">            result.append(ch);</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@TestProperty</span></span><br><span class="line">    <span class="keyword">static</span> List&lt;String&gt; input =</span><br><span class="line">            Arrays.asList(theory.split(<span class="string">" "</span>));</span><br><span class="line">    <span class="meta">@TestProperty</span></span><br><span class="line">    <span class="keyword">static</span> Iterator&lt;String&gt; words = input.iterator();</span><br><span class="line">    <span class="meta">@TestObjectCreate</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> AtUnitExample4 <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(words.hasNext())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AtUnitExample4(words.next());</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">words</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"'"</span> + getWord() + <span class="string">"'"</span>);</span><br><span class="line">        <span class="keyword">return</span> getWord().equals(<span class="string">"are"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">scramble1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// Use specific seed to get verifiable results:</span></span><br><span class="line">        rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">        System.out.println(<span class="string">"'"</span> + getWord() + <span class="string">"'"</span>);</span><br><span class="line">        String scrambled = scrambleWord();</span><br><span class="line">        System.out.println(scrambled);</span><br><span class="line">        <span class="keyword">return</span> scrambled.equals(<span class="string">"lAl"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">scramble2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        rand = <span class="keyword">new</span> Random(<span class="number">74</span>);</span><br><span class="line">        System.out.println(<span class="string">"'"</span> + getWord() + <span class="string">"'"</span>);</span><br><span class="line">        String scrambled = scrambleWord();</span><br><span class="line">        System.out.println(scrambled);</span><br><span class="line">        <span class="keyword">return</span> scrambled.equals(<span class="string">"tsaeborornussu"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">annotations.AtUnitExample4</span><br><span class="line">. words <span class="string">'All'</span></span><br><span class="line">(failed)</span><br><span class="line">. scramble1 <span class="string">'brontosauruses'</span></span><br><span class="line">ntsaueorosurbs</span><br><span class="line">(failed)</span><br><span class="line">. scramble2 <span class="string">'are'</span></span><br><span class="line">are</span><br><span class="line">(failed)</span><br><span class="line">(<span class="number">3</span> tests)</span><br><span class="line">&gt;&gt;&gt; <span class="number">3</span> FAILURES &lt;&lt;&lt;</span><br><span class="line">annotations.AtUnitExample4: words</span><br><span class="line">annotations.AtUnitExample4: scramble1</span><br><span class="line">annotations.AtUnitExample4: scramble2</span><br></pre></td></tr></table></figure><p><strong>@TestProperty</strong> ä¹Ÿå¯ä»¥ç”¨æ¥æ ‡è®°é‚£äº›åªåœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬æœ¬èº«ä¸æ˜¯æµ‹è¯•æ–¹æ³•ã€‚</p><p>å¦‚æœä½ çš„æµ‹è¯•å¯¹è±¡éœ€è¦æ‰§è¡ŒæŸäº›åˆå§‹åŒ–å·¥ä½œï¼Œå¹¶ä¸”ä½¿ç”¨å®Œæˆä¹‹åè¿˜éœ€è¦æ‰§è¡Œæ¸…ç†å·¥ä½œï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä½¿ç”¨ <strong>static</strong> çš„  <strong>@TestObjectCleanup</strong> æ–¹æ³•ï¼Œå½“æµ‹è¯•å¯¹è±¡ä½¿ç”¨ç»“æŸä¹‹åï¼Œè¯¥æ–¹æ³•ä¼šä¸ºä½ æ‰§è¡Œæ¸…ç†å·¥ä½œã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<strong>@TestObjectCleanup</strong> ä¸ºæ¯ä¸€ä¸ªæµ‹è¯•å¯¹è±¡éƒ½æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå› æ­¤å¿…é¡»åœ¨ä¸¢å¼ƒæµ‹è¯•çš„æ—¶å€™å…³é—­è¯¥æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/AtUnitExample5.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/AtUnitExample5.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnitExample5</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtUnitExample5</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> text; &#125;</span><br><span class="line">    <span class="meta">@TestProperty</span></span><br><span class="line">    <span class="keyword">static</span> PrintWriter output;</span><br><span class="line">    <span class="meta">@TestProperty</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> counter;</span><br><span class="line">    <span class="meta">@TestObjectCreate</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> AtUnitExample5 <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String id = Integer.toString(counter++);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            output = <span class="keyword">new</span> PrintWriter(<span class="string">"Test"</span> + id + <span class="string">".txt"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AtUnitExample5(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@TestObjectCleanup</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">(AtUnitExample5 tobj)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Running cleanup"</span>);</span><br><span class="line">        output.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        output.print(<span class="string">"test1"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        output.print(<span class="string">"test2"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        output.print(<span class="string">"test3"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">annotations.AtUnitExample5</span><br><span class="line">. test1</span><br><span class="line">Running cleanup</span><br><span class="line">. test3</span><br><span class="line">Running cleanup</span><br><span class="line">. test2</span><br><span class="line">Running cleanup</span><br><span class="line">OK (<span class="number">3</span> tests)</span><br></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¸…ç†æ–¹æ³•ä¼šåœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç»“æŸä¹‹åè‡ªåŠ¨è¿è¡Œã€‚</p><h3 id="åœ¨-Unit-ä¸­ä½¿ç”¨æ³›å‹"><a href="#åœ¨-Unit-ä¸­ä½¿ç”¨æ³›å‹" class="headerlink" title="åœ¨ @Unit ä¸­ä½¿ç”¨æ³›å‹"></a>åœ¨ @Unit ä¸­ä½¿ç”¨æ³›å‹</h3><p>æ³›å‹ä¸º <strong>@Unit</strong> å‡ºäº†ä¸€ä¸ªéš¾é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½â€œé€šç”¨æµ‹è¯•â€ã€‚æˆ‘ä»¬å¿…é¡»é’ˆå¯¹æŸä¸ªç‰¹å®šç±»å‹çš„å‚æ•°æˆ–è€…å‚æ•°é›†æ‰èƒ½è¿›è¡Œæµ‹è¯•ã€‚è§£å†³æ–¹æ³•ååˆ†ç®€å•ï¼Œè®©æµ‹è¯•ç±»ç»§æ‰¿è‡ªæ³›å‹ç±»çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬å³å¯ï¼š</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ª <strong>stack</strong> çš„ç®€å•å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/StackL.java</span></span><br><span class="line"><span class="comment">// A stack built on a LinkedList</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackL</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;T&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T v)</span> </span>&#123; list.addFirst(v); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">top</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> list.getFirst(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> list.removeFirst(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æµ‹è¯• String ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥è®©æµ‹è¯•ç±»ç»§æ‰¿ä¸€ä¸ª Stack&lt;String&gt; ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/StackLStringTst.java</span></span><br><span class="line"><span class="comment">// Applying @Unit to generics</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit</span></span><br><span class="line"><span class="comment">// build/classes/main/annotations/StackLStringTst.class&#125;</span></span><br><span class="line"><span class="keyword">package</span> annotations;</span><br><span class="line"><span class="keyword">import</span> onjava.atunit.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"><span class="title">StackLStringTst</span> <span class="keyword">extends</span> <span class="title">StackL</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tPush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        push(<span class="string">"one"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">top</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"one"</span>)</span></span>;</span><br><span class="line">        push(<span class="string">"two"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">top</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"two"</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tPop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        push(<span class="string">"one"</span>);</span><br><span class="line">        push(<span class="string">"two"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">pop</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"two"</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">pop</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"one"</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tTop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        push(<span class="string">"A"</span>);</span><br><span class="line">        push(<span class="string">"B"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">top</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"B"</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">top</span><span class="params">()</span>.<span class="title">equals</span><span class="params">(<span class="string">"B"</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">annotations.StackLStringTst</span><br><span class="line">. tTop</span><br><span class="line">. tPush</span><br><span class="line">. tPop</span><br><span class="line">OK (<span class="number">3</span> tests)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•å­˜åœ¨çš„å”¯ä¸€ç¼ºç‚¹æ˜¯ï¼Œç»§æ‰¿ä½¿æˆ‘ä»¬å¤±å»äº†è®¿é—®è¢«æµ‹è¯•çš„ç±»ä¸­ <strong>private</strong> æ–¹æ³•çš„èƒ½åŠ›ã€‚è¿™å¯¹ä½ éå¸¸é‡è¦ï¼Œé‚£ä½ è¦ä¹ˆæŠŠ private æ–¹æ³•å˜ä¸º <strong>protected</strong>ï¼Œè¦ä¹ˆæ·»åŠ ä¸€ä¸ªé <strong>private</strong> çš„ <strong>@TestProperty</strong> æ–¹æ³•ï¼Œç”±å®ƒæ¥è°ƒç”¨ <strong>private</strong> æ–¹æ³•ï¼ˆç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œ<strong>AtUnitRemover</strong> ä¼šåˆ é™¤äº§å“ä¸­çš„ <strong>@TestProperty</strong> æ–¹æ³•ï¼‰ã€‚</p><p><strong>@Unit</strong> æœç´¢é‚£äº›åŒ…å«åˆé€‚æ³¨è§£çš„ç±»æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ <strong>@Test</strong> æ–¹æ³•ã€‚æˆ‘çš„ä¸»è¦ç›®æ ‡å°±æ˜¯è®© <strong>@Unit</strong> æµ‹è¯•ç³»ç»Ÿå°½å¯èƒ½çš„é€æ˜ï¼Œä½¿å¾—äººä»¬ä½¿ç”¨å®ƒçš„æ—¶å€™åªéœ€è¦æ·»åŠ  <strong>@Test</strong> æ³¨è§£ï¼Œè€Œä¸éœ€è¦ç‰¹æ®Šçš„ç¼–ç å’ŒçŸ¥è¯†ï¼ˆç°åœ¨ç‰ˆæœ¬çš„ <strong>JUnit</strong> ç¬¦åˆè¿™ä¸ªå®è·µï¼‰ã€‚ä¸è¿‡ï¼Œå¦‚æœè¯´ç¼–å†™æµ‹è¯•ä¸ä¼šé‡åˆ°ä»»ä½•å›°éš¾ï¼Œä¹Ÿä¸å¤ªå¯èƒ½ï¼Œå› æ­¤ <strong>@Unit</strong> ä¼šå°½é‡è®©è¿™äº›å›°éš¾å˜çš„å¾®ä¸è¶³é“ï¼Œå¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ ä»¬ä¼šæ›´ä¹æ„ç¼–å†™æµ‹è¯•ã€‚</p><h3 id="å®ç°-Unit"><a href="#å®ç°-Unit" class="headerlink" title="å®ç° @Unit"></a>å®ç° @Unit</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰æ‰€æœ‰çš„æ³¨è§£ç±»å‹ã€‚è¿™äº›éƒ½æ˜¯ç®€å•çš„æ ‡ç­¾ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•å­—æ®µã€‚@Test æ ‡ç­¾åœ¨æœ¬ç« å¼€å¤´å·²ç»å®šä¹‰è¿‡äº†ï¼Œè¿™é‡Œæ˜¯å…¶ä»–æ‰€éœ€è¦çš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/TestObjectCreate.java</span></span><br><span class="line"><span class="comment">// The @Unit @TestObjectCreate tag</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestObjectCreate &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/TestObjectCleanup.java</span></span><br><span class="line"><span class="comment">// The @Unit @TestObjectCleanup tag</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestObjectCleanup &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/TestProperty.java</span></span><br><span class="line"><span class="comment">// The @Unit @TestProperty tag</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="comment">// Both fields and methods can be tagged as properties:</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.FIELD, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestProperty &#123;&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰æµ‹è¯•çš„ä¿ç•™å±æ€§éƒ½ä¸º <strong>RUNTIME</strong>ï¼Œè¿™æ˜¯å› ä¸º <strong>@Unit</strong> å¿…é¡»åœ¨ç¼–è¯‘åçš„ä»£ç ä¸­å‘ç°è¿™äº›æ³¨è§£ã€‚</p><p>è¦å®ç°ç³»ç»Ÿå¹¶è¿è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åå°„æœºåˆ¶æ¥æå–æ³¨è§£ã€‚ä¸‹é¢è¿™ä¸ªç¨‹åºé€šè¿‡æ³¨è§£ä¸­çš„ä¿¡æ¯ï¼Œå†³å®šå¦‚ä½•æ„é€ æµ‹è¯•å¯¹è±¡ï¼Œå¹¶åœ¨æµ‹è¯•å¯¹è±¡ä¸Šè¿è¡Œæµ‹è¯•ã€‚æ­£æ˜¯ç”±äºæ³¨è§£å¸®åŠ©ï¼Œè¿™ä¸ªç¨‹åºæ‰ä¼šå¦‚æ­¤çŸ­å°è€Œç›´æ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/AtUnit.java</span></span><br><span class="line"><span class="comment">// An annotation-based unit-test framework</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.AtUnit&#125;</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtUnit</span> <span class="keyword">implements</span> <span class="title">ProcessFiles</span>.<span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Class&lt;?&gt; testClass;</span><br><span class="line">    <span class="keyword">static</span> List&lt;String&gt; failedTests= <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> testsRun = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> failures = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">    main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ClassLoader.getSystemClassLoader()</span><br><span class="line">                .setDefaultAssertionStatus(<span class="keyword">true</span>); <span class="comment">// Enable assert</span></span><br><span class="line">        <span class="keyword">new</span> ProcessFiles(<span class="keyword">new</span> AtUnit(), <span class="string">"class"</span>).start(args);</span><br><span class="line">        <span class="keyword">if</span>(failures == <span class="number">0</span>)</span><br><span class="line">            System.out.println(<span class="string">"OK ("</span> + testsRun + <span class="string">" tests)"</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"("</span> + testsRun + <span class="string">" tests)"</span>);</span><br><span class="line">            System.out.println(</span><br><span class="line">                    <span class="string">"\n&gt;&gt;&gt; "</span> + failures + <span class="string">" FAILURE"</span> +</span><br><span class="line">                            (failures &gt; <span class="number">1</span> ? <span class="string">"S"</span> : <span class="string">""</span>) + <span class="string">" &lt;&lt;&lt;"</span>);</span><br><span class="line">            <span class="keyword">for</span>(String failed : failedTests)</span><br><span class="line">                System.out.println(<span class="string">" "</span> + failed);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(File cFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String cName = ClassNameFinder.thisClass(</span><br><span class="line">                    Files.readAllBytes(cFile.toPath()));</span><br><span class="line">            <span class="keyword">if</span>(!cName.startsWith(<span class="string">"public:"</span>))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            cName = cName.split(<span class="string">":"</span>)[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(!cName.contains(<span class="string">"."</span>))</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// Ignore unpackaged classes</span></span><br><span class="line">            testClass = Class.forName(cName);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        TestMethods testMethods = <span class="keyword">new</span> TestMethods();</span><br><span class="line">        Method creator = <span class="keyword">null</span>;</span><br><span class="line">        Method cleanup = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(Method m : testClass.getDeclaredMethods()) &#123;</span><br><span class="line">            testMethods.addIfTestMethod(m);</span><br><span class="line">            <span class="keyword">if</span>(creator == <span class="keyword">null</span>)</span><br><span class="line">                creator = checkForCreatorMethod(m);</span><br><span class="line">            <span class="keyword">if</span>(cleanup == <span class="keyword">null</span>)</span><br><span class="line">                cleanup = checkForCleanupMethod(m);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(testMethods.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(creator == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!Modifier.isPublic(testClass</span><br><span class="line">                            .getDeclaredConstructor()</span><br><span class="line">                            .getModifiers())) &#123;</span><br><span class="line">                        System.out.println(<span class="string">"Error: "</span> + testClass +</span><br><span class="line">                                <span class="string">" no-arg constructor must be public"</span>);</span><br><span class="line">                        System.exit(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(NoSuchMethodException e) &#123;</span><br><span class="line"><span class="comment">// Synthesized no-arg constructor; OK</span></span><br><span class="line">                &#125;</span><br><span class="line">            System.out.println(testClass.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Method m : testMethods) &#123;</span><br><span class="line">            System.out.print(<span class="string">" . "</span> + m.getName() + <span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Object testObject = createTestObject(creator);</span><br><span class="line">                <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(m.getReturnType().equals(<span class="keyword">boolean</span>.class))</span><br><span class="line">                        success = (Boolean)m.invoke(testObject);</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        m.invoke(testObject);</span><br><span class="line">                        success = <span class="keyword">true</span>; <span class="comment">// If no assert fails</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(InvocationTargetException e) &#123;</span><br><span class="line"><span class="comment">// Actual exception is inside e:</span></span><br><span class="line">                    System.out.println(e.getCause());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(success ? <span class="string">""</span> : <span class="string">"(failed)"</span>);</span><br><span class="line">                testsRun++;</span><br><span class="line">                <span class="keyword">if</span>(!success) &#123;</span><br><span class="line">                    failures++;</span><br><span class="line">                    failedTests.add(testClass.getName() +</span><br><span class="line">                            <span class="string">": "</span> + m.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(cleanup != <span class="keyword">null</span>)</span><br><span class="line">                    cleanup.invoke(testObject, testObject);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(IllegalAccessException |</span><br><span class="line">                    IllegalArgumentException |</span><br><span class="line">                    InvocationTargetException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestMethods</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Method</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addIfTestMethod</span><span class="params">(Method m)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(m.getAnnotation(Test.class) == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span>(!(m.getReturnType().equals(<span class="keyword">boolean</span>.class) ||</span><br><span class="line">                    m.getReturnType().equals(<span class="keyword">void</span>.class)))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@Test method"</span> +</span><br><span class="line">                        <span class="string">" must return boolean or void"</span>);</span><br><span class="line">            m.setAccessible(<span class="keyword">true</span>); <span class="comment">// If it's private, etc.</span></span><br><span class="line">            add(m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span></span><br><span class="line">    <span class="function">Method <span class="title">checkForCreatorMethod</span><span class="params">(Method m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(m.getAnnotation(TestObjectCreate.class) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!m.getReturnType().equals(testClass))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@TestObjectCreate "</span> +</span><br><span class="line">                    <span class="string">"must return instance of Class to be tested"</span>);</span><br><span class="line">        <span class="keyword">if</span>((m.getModifiers() &amp;</span><br><span class="line">                java.lang.reflect.Modifier.STATIC) &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@TestObjectCreate "</span> +</span><br><span class="line">                    <span class="string">"must be static."</span>);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span></span><br><span class="line">    <span class="function">Method <span class="title">checkForCleanupMethod</span><span class="params">(Method m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(m.getAnnotation(TestObjectCleanup.class) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!m.getReturnType().equals(<span class="keyword">void</span>.class))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@TestObjectCleanup "</span> +</span><br><span class="line">                    <span class="string">"must return void"</span>);</span><br><span class="line">        <span class="keyword">if</span>((m.getModifiers() &amp;</span><br><span class="line">                java.lang.reflect.Modifier.STATIC) &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@TestObjectCleanup "</span> +</span><br><span class="line">                    <span class="string">"must be static."</span>);</span><br><span class="line">        <span class="keyword">if</span>(m.getParameterTypes().length == <span class="number">0</span> ||</span><br><span class="line">                m.getParameterTypes()[<span class="number">0</span>] != testClass)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"@TestObjectCleanup "</span> +</span><br><span class="line">                    <span class="string">"must take an argument of the tested type."</span>);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object</span><br><span class="line">    createTestObject(Method creator) &#123;</span><br><span class="line">        <span class="keyword">if</span>(creator != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> creator.invoke(testClass);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(IllegalAccessException |</span><br><span class="line">                    IllegalArgumentException |</span><br><span class="line">                    InvocationTargetException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Couldn't run "</span> +</span><br><span class="line">                        <span class="string">"@TestObject (creator) method."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// Use the no-arg constructor:</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> testClass.newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span>(InstantiationException |</span><br><span class="line">                    IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                        <span class="string">"Couldn't create a test object. "</span> +</span><br><span class="line">                                <span class="string">"Try using a @TestObject method."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶å®ƒå¯èƒ½æ˜¯â€œè¿‡æ—©çš„é‡æ„â€ï¼ˆå› ä¸ºå®ƒåªåœ¨ä¹¦ä¸­ä½¿ç”¨è¿‡ä¸€æ¬¡ï¼‰ï¼Œ<strong>AtUnit.java</strong> ä½¿ç”¨äº† <strong>ProcessFiles</strong> å·¥å…·é€æ­¥åˆ¤æ–­å‘½ä»¤è¡Œä¸­çš„å‚æ•°ï¼Œå†³å®šå®ƒæ˜¯ä¸€ä¸ªç›®å½•è¿˜æ˜¯æ–‡ä»¶ï¼Œå¹¶é‡‡å–ç›¸åº”çš„è¡Œä¸ºã€‚è¿™å¯ä»¥åº”ç”¨äºä¸åŒçš„è§£å†³æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®ƒåŒ…å«äº†ä¸€ä¸ª å¯ç”¨äºè‡ªå®šä¹‰çš„ <strong>Strategy</strong> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/ProcessFiles.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessFiles</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(File file)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Strategy strategy;</span><br><span class="line">    <span class="keyword">private</span> String ext;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProcessFiles</span><span class="params">(Strategy strategy, String ext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">        <span class="keyword">this</span>.ext = ext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(args.length == <span class="number">0</span>)</span><br><span class="line">                processDirectoryTree(<span class="keyword">new</span> File(<span class="string">"."</span>));</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span>(String arg : args) &#123;</span><br><span class="line">                    File fileArg = <span class="keyword">new</span> File(arg);</span><br><span class="line">                    <span class="keyword">if</span>(fileArg.isDirectory())</span><br><span class="line">                        processDirectoryTree(fileArg);</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// Allow user to leave off extension:</span></span><br><span class="line">                        <span class="keyword">if</span>(!arg.endsWith(<span class="string">"."</span> + ext))</span><br><span class="line">                            arg += <span class="string">"."</span> + ext;</span><br><span class="line">                        strategy.process(</span><br><span class="line">                                <span class="keyword">new</span> File(arg).getCanonicalFile());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processDirectoryTree</span><span class="params">(File root)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        PathMatcher matcher = FileSystems.getDefault()</span><br><span class="line">                .getPathMatcher(<span class="string">"glob:**/*.&#123;"</span> + ext + <span class="string">"&#125;"</span>);</span><br><span class="line">        Files.walk(root.toPath())</span><br><span class="line">                .filter(matcher::matches)</span><br><span class="line">                .forEach(p -&gt; strategy.process(p.toFile()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>AtUnit</strong> ç±»å®ç°äº† <strong>ProcessFiles.Strategy</strong>ï¼Œå…¶åŒ…å«äº†ä¸€ä¸ª <code>process()</code> æ–¹æ³•ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œ<strong>AtUnit</strong> å®ä¾‹å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <strong>ProcessFiles</strong> æ„é€ å™¨ã€‚ç¬¬äºŒä¸ªæ„é€ å™¨çš„å‚æ•°å‘Šè¯‰ <strong>ProcessFiles</strong> å¦‚å¯»æ‰¾æ‰€æœ‰åŒ…å« â€œclassâ€ æ‹“å±•åçš„æ–‡ä»¶ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// annotations/DemoProcessFiles.java</span></span><br><span class="line"><span class="keyword">import</span> onjava.ProcessFiles;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoProcessFiles</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ProcessFiles(file -&gt; System.out.println(file),</span><br><span class="line">                <span class="string">"java"</span>).start(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.\AtUnitExample1.java</span><br><span class="line">.\AtUnitExample2.java</span><br><span class="line">.\AtUnitExample3.java</span><br><span class="line">.\AtUnitExample4.java</span><br><span class="line">.\AtUnitExample5.java</span><br><span class="line">.\AUComposition.java</span><br><span class="line">.\AUExternalTest.java</span><br><span class="line">.\database\Constraints.java</span><br><span class="line">.\database\DBTable.java</span><br><span class="line">.\database\Member.java</span><br><span class="line">.\database\SQLInteger.java</span><br><span class="line">.\database\SQLString.java</span><br><span class="line">.\database\TableCreator.java</span><br><span class="line">.\database\Uniqueness.java</span><br><span class="line">.\DemoProcessFiles.java</span><br><span class="line">.\HashSetTest.java</span><br><span class="line">.\ifx\ExtractInterface.java</span><br><span class="line">.\ifx\IfaceExtractorProcessor.java</span><br><span class="line">.\ifx\Multiplier.java</span><br><span class="line">.\PasswordUtils.java</span><br><span class="line">.\simplest\Simple.java</span><br><span class="line">.\simplest\SimpleProcessor.java</span><br><span class="line">.\simplest\SimpleTest.java</span><br><span class="line">.\SimulatingNull.java</span><br><span class="line">.\StackL.java</span><br><span class="line">.\StackLStringTst.java</span><br><span class="line">.\Testable.java</span><br><span class="line">.\UseCase.java</span><br><span class="line">.\UseCaseTracker.java</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™ä¸ªç¨‹åºä¼šéå†å½“å‰çš„ç›®å½•æ ‘ã€‚ä½ è¿˜å¯ä»¥æä¾›å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥æ˜¯ç±»æ–‡ä»¶ï¼ˆå¸¦æˆ–ä¸å¸¦.classæ‰©å±•åï¼‰æˆ–ç›®å½•ã€‚</p><p>å›åˆ°æˆ‘ä»¬å¯¹ <strong>AtUnit.java</strong> çš„è®¨è®ºï¼Œå› ä¸º <strong>@Unit</strong> ä¼šè‡ªåŠ¨æ‰¾åˆ°å¯æµ‹è¯•çš„ç±»å’Œæ–¹æ³•ï¼Œæ‰€ä»¥ä¸éœ€è¦â€œå¥—ä»¶â€æœºåˆ¶ã€‚</p><p><strong>AtUnit.java</strong> ä¸­å­˜åœ¨çš„ä¸€ä¸ªæˆ‘ä»¬å¿…é¡»è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå½“å®ƒå‘ç°ç±»æ–‡ä»¶æ—¶ï¼Œç±»æ–‡ä»¶åä¸­çš„é™å®šç±»åï¼ˆåŒ…æ‹¬åŒ…ï¼‰ä¸æ˜æ˜¾ã€‚ä¸ºäº†å‘ç°è¿™ä¸ªä¿¡æ¯ï¼Œå¿…é¡»è§£æç±»æ–‡ä»¶ - è¿™ä¸æ˜¯å¾®ä¸è¶³é“çš„ï¼Œä½†ä¹Ÿä¸æ˜¯ä¸å¯èƒ½çš„ã€‚ æ‰¾åˆ° .class æ–‡ä»¶æ—¶ï¼Œä¼šæ‰“å¼€å®ƒå¹¶è¯»å–å…¶äºŒè¿›åˆ¶æ•°æ®å¹¶å°†å…¶ä¼ é€’ç»™ <code>ClassNameFinder.thisClass()</code>ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ­£åœ¨è¿›å…¥â€œå­—èŠ‚ç å·¥ç¨‹â€é¢†åŸŸï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ­£åœ¨åˆ†æç±»æ–‡ä»¶çš„å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/atunit/ClassNameFinder.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.atunit.ClassNameFinder&#125;</span></span><br><span class="line"><span class="keyword">package</span> onjava.atunit;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassNameFinder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">thisClass</span><span class="params">(<span class="keyword">byte</span>[] classBytes)</span> </span>&#123;</span><br><span class="line">        Map&lt;Integer,Integer&gt; offsetTable = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Map&lt;Integer,String&gt; classNameTable = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DataInputStream data = <span class="keyword">new</span> DataInputStream(</span><br><span class="line">                    <span class="keyword">new</span> ByteArrayInputStream(classBytes));</span><br><span class="line">            <span class="keyword">int</span> magic = data.readInt(); <span class="comment">// 0xcafebabe</span></span><br><span class="line">            <span class="keyword">int</span> minorVersion = data.readShort();</span><br><span class="line">            <span class="keyword">int</span> majorVersion = data.readShort();</span><br><span class="line">            <span class="keyword">int</span> constantPoolCount = data.readShort();</span><br><span class="line">            <span class="keyword">int</span>[] constantPool = <span class="keyword">new</span> <span class="keyword">int</span>[constantPoolCount];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; constantPoolCount; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> tag = data.read();</span><br><span class="line">                <span class="comment">// int tableSize;</span></span><br><span class="line">                <span class="keyword">switch</span>(tag) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// UTF</span></span><br><span class="line">                        <span class="keyword">int</span> length = data.readShort();</span><br><span class="line">                        <span class="keyword">char</span>[] bytes = <span class="keyword">new</span> <span class="keyword">char</span>[length];</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bytes.length; k++)</span><br><span class="line">                            bytes[k] = (<span class="keyword">char</span>)data.read();</span><br><span class="line">                        String className = <span class="keyword">new</span> String(bytes);</span><br><span class="line">                        classNameTable.put(i, className);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">5</span>: <span class="comment">// LONG</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">// DOUBLE</span></span><br><span class="line">                        data.readLong(); <span class="comment">// discard 8 bytes</span></span><br><span class="line">                        i++; <span class="comment">// Special skip necessary</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">7</span>: <span class="comment">// CLASS</span></span><br><span class="line">                        <span class="keyword">int</span> offset = data.readShort();</span><br><span class="line">                        offsetTable.put(i, offset);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">// STRING</span></span><br><span class="line">                        data.readShort(); <span class="comment">// discard 2 bytes</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// INTEGER</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">// FLOAT</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">9</span>: <span class="comment">// FIELD_REF</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">10</span>: <span class="comment">// METHOD_REF</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">11</span>: <span class="comment">// INTERFACE_METHOD_REF</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">12</span>: <span class="comment">// NAME_AND_TYPE</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">18</span>: <span class="comment">// Invoke Dynamic</span></span><br><span class="line">                        data.readInt(); <span class="comment">// discard 4 bytes</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">15</span>: <span class="comment">// Method Handle</span></span><br><span class="line">                        data.readByte();</span><br><span class="line">                        data.readShort();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">16</span>: <span class="comment">// Method Type</span></span><br><span class="line">                        data.readShort();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">throw</span></span><br><span class="line">                                <span class="keyword">new</span> RuntimeException(<span class="string">"Bad tag "</span> + tag);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">short</span> accessFlags = data.readShort();</span><br><span class="line">            String access = (accessFlags &amp; <span class="number">0x0001</span>) == <span class="number">0</span> ?</span><br><span class="line">                    <span class="string">"nonpublic:"</span> : <span class="string">"public:"</span>;</span><br><span class="line">            <span class="keyword">int</span> thisClass = data.readShort();</span><br><span class="line">            <span class="keyword">int</span> superClass = data.readShort();</span><br><span class="line">            <span class="keyword">return</span> access + classNameTable.get(</span><br><span class="line">                    offsetTable.get(thisClass)).replace(<span class="string">'/'</span>, <span class="string">'.'</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException | RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Demonstration:</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        PathMatcher matcher = FileSystems.getDefault()</span><br><span class="line">                .getPathMatcher(<span class="string">"glob:**/*.class"</span>);</span><br><span class="line"><span class="comment">// Walk the entire tree:</span></span><br><span class="line">        Files.walk(Paths.get(<span class="string">"."</span>))</span><br><span class="line">                .filter(matcher::matches)</span><br><span class="line">                .map(p -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> thisClass(Files.readAllBytes(p));</span><br><span class="line">                    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .filter(s -&gt; s.startsWith(<span class="string">"public:"</span>))</span><br><span class="line"><span class="comment">// .filter(s -&gt; s.indexOf('$') &gt;= 0)</span></span><br><span class="line">                .map(s -&gt; s.split(<span class="string">":"</span>)[<span class="number">1</span>])</span><br><span class="line">                .filter(s -&gt; !s.startsWith(<span class="string">"enums."</span>))</span><br><span class="line">                .filter(s -&gt; s.contains(<span class="string">"."</span>))</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">onjava.ArrayShow</span><br><span class="line">onjava.atunit.AtUnit$TestMethods</span><br><span class="line">onjava.atunit.AtUnit</span><br><span class="line">onjava.atunit.ClassNameFinder</span><br><span class="line">onjava.atunit.Test</span><br><span class="line">onjava.atunit.TestObjectCleanup</span><br><span class="line">onjava.atunit.TestObjectCreate</span><br><span class="line">onjava.atunit.TestProperty</span><br><span class="line">onjava.BasicSupplier</span><br><span class="line">onjava.CollectionMethodDifferences</span><br><span class="line">onjava.ConvertTo</span><br><span class="line">onjava.Count$Boolean</span><br><span class="line">onjava.Count$Byte</span><br><span class="line">onjava.Count$Character</span><br><span class="line">onjava.Count$Double</span><br><span class="line">onjava.Count$Float</span><br><span class="line">onjava.Count$Integer</span><br><span class="line">onjava.Count$Long</span><br><span class="line">onjava.Count$Pboolean</span><br><span class="line">onjava.Count$Pbyte</span><br><span class="line">onjava.Count$Pchar</span><br><span class="line">onjava.Count$Pdouble</span><br><span class="line">onjava.Count$Pfloat</span><br><span class="line">onjava.Count$Pint</span><br><span class="line">onjava.Count$Plong</span><br><span class="line">onjava.Count$Pshort</span><br><span class="line">onjava.Count$Short</span><br><span class="line">onjava.Count</span><br><span class="line">onjava.CountingIntegerList</span><br><span class="line">onjava.CountMap</span><br><span class="line">onjava.Countries</span><br><span class="line">onjava.Enums</span><br><span class="line">onjava.FillMap</span><br><span class="line">onjava.HTMLColors</span><br><span class="line">onjava.MouseClick</span><br><span class="line">onjava.Nap</span><br><span class="line">onjava.Null</span><br><span class="line">onjava.Operations</span><br><span class="line">onjava.OSExecute</span><br><span class="line">onjava.OSExecuteException</span><br><span class="line">onjava.Pair</span><br><span class="line">onjava.ProcessFiles$Strategy</span><br><span class="line">onjava.ProcessFiles</span><br><span class="line">onjava.Rand$Boolean</span><br><span class="line">onjava.Rand$Byte</span><br><span class="line">onjava.Rand$Character</span><br><span class="line">onjava.Rand$Double</span><br><span class="line">onjava.Rand$Float</span><br><span class="line">onjava.Rand$Integer</span><br><span class="line">onjava.Rand$Long</span><br><span class="line">onjava.Rand$Pboolean</span><br><span class="line">onjava.Rand$Pbyte</span><br><span class="line">onjava.Rand$Pchar</span><br><span class="line">onjava.Rand$Pdouble</span><br><span class="line">onjava.Rand$Pfloat</span><br><span class="line">onjava.Rand$Pint</span><br><span class="line">onjava.Rand$Plong</span><br><span class="line">onjava.Rand$Pshort</span><br><span class="line">onjava.Rand$Short</span><br><span class="line">onjava.Rand$String</span><br><span class="line">onjava.Rand</span><br><span class="line">onjava.Range</span><br><span class="line">onjava.Repeat</span><br><span class="line">onjava.RmDir</span><br><span class="line">onjava.Sets</span><br><span class="line">onjava.Stack</span><br><span class="line">onjava.Suppliers</span><br><span class="line">onjava.TimedAbort</span><br><span class="line">onjava.Timer</span><br><span class="line">onjava.Tuple</span><br><span class="line">onjava.Tuple2</span><br><span class="line">onjava.Tuple3</span><br><span class="line">onjava.Tuple4</span><br><span class="line">onjava.Tuple5</span><br><span class="line">onjava.TypeCounter</span><br></pre></td></tr></table></figure><p> è™½ç„¶æ— æ³•åœ¨è¿™é‡Œä»‹ç»å…¶ä¸­æ‰€æœ‰çš„ç»†èŠ‚ï¼Œä½†æ˜¯æ¯ä¸ªç±»æ–‡ä»¶éƒ½å¿…é¡»éµå¾ªä¸€å®šçš„æ ¼å¼ï¼Œè€Œæˆ‘å·²ç»å°½åŠ›ç”¨æœ‰æ„ä¹‰çš„å­—æ®µæ¥è¡¨ç¤ºè¿™äº›ä» <strong>ByteArrayInputStream</strong> ä¸­æå–å‡ºæ¥çš„æ•°æ®ç‰‡æ®µã€‚é€šè¿‡æ–½åŠ åœ¨è¾“å…¥æµä¸Šçš„è¯»æ“ä½œï¼Œä½ èƒ½çœ‹å‡ºæ¯ä¸ªä¿¡æ¯ç‰‡çš„å¤§å°ã€‚ä¾‹å¦‚æ¯ä¸€ä¸ªç±»çš„å¤´ 32 ä¸ª bit æ€»æ˜¯ä¸€ä¸ª â€œç¥ç§˜æ•°å­—â€ <strong>0xcafebabe</strong>ï¼Œè€Œæ¥ä¸‹æ¥çš„ä¸¤ä¸ª <strong>short</strong> å€¼æ˜¯ç‰ˆæœ¬ä¿¡æ¯ã€‚å¸¸é‡æ± åŒ…å«äº†ç¨‹åºçš„å¸¸é‡ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ã€‚æ¥ä¸‹æ¥çš„ <strong>short</strong> å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå¸¸é‡æ± æœ‰å¤šå¤§ï¼Œç„¶åæˆ‘ä»¬ä¸ºå…¶åˆ›å»ºä¸€ä¸ªå°ºå¯¸åˆé€‚çš„æ•°ç»„ã€‚å¸¸é‡æ± ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå…¶é•¿åº¦å¯èƒ½æ˜¯å›ºå®šå¼ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯å˜çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ£€æŸ¥æ¯ä¸€ä¸ªå¸¸é‡çš„èµ·å§‹æ ‡è®°ï¼Œç„¶åæ‰èƒ½çŸ¥é“è¯¥æ€ä¹ˆåšï¼Œè¿™å°±æ˜¯ switch è¯­å¥çš„å·¥ä½œã€‚æˆ‘ä»¬å¹¶ä¸æ‰“ç®—ç²¾ç¡®çš„åˆ†æç±»ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œä»…ä»…æ˜¯ä»æ–‡ä»¶çš„èµ·å§‹ä¸€æ­¥ä¸€æ­¥çš„èµ°ï¼Œç›´åˆ°å–å¾—æˆ‘ä»¬æ‰€éœ€çš„ä¿¡æ¯ï¼Œå› æ­¤ä½ ä¼šå‘ç°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸¢å¼ƒäº†å¤§é‡çš„æ•°æ®ã€‚å…³äºç±»çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨ <strong>classNameTable</strong> å’Œ <strong>offsetTable</strong> ä¸­ã€‚åœ¨è¯»å–å¸¸é‡æ± ä¹‹åï¼Œå°±æ‰¾åˆ°äº† <strong>this_class</strong> ä¿¡æ¯ï¼Œè¿™æ˜¯ <strong>offsetTable</strong> çš„ä¸€ä¸ªåæ ‡ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°è¿›å…¥  <strong>classNameTable</strong> çš„åæ ‡ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æ‰€éœ€çš„ç±»çš„åå­—äº†ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ° <strong>AtUtil.java</strong> ä¸­ï¼Œprocess() æ–¹æ³•ä¸­æ‹¥æœ‰äº†ç±»çš„åå­—ï¼Œç„¶åæ£€æŸ¥å®ƒæ˜¯å¦åŒ…å«â€œ.â€ï¼Œå¦‚æœæœ‰å°±è¡¨ç¤ºè¯¥ç±»å®šä¹‰äºä¸€ä¸ªåŒ…ä¸­ã€‚æ²¡æœ‰åŒ…çš„ç±»ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœä¸€ä¸ªç±»åœ¨åŒ…ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ç±»åŠ è½½å™¨é€šè¿‡ <code>Class.forName()</code>  å°†å…¶åŠ è½½è¿›æ¥ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªç±»è¿›è¡Œ <strong>@Unit</strong> æ³¨è§£çš„åˆ†æå·¥ä½œäº†ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸‰ä»¶äº‹ï¼šé¦–å…ˆæ˜¯ <strong>@Test</strong> æ–¹æ³•ï¼Œå®ƒä»¬è¢«ä¿å­˜åœ¨ <strong>TestMehtods</strong> åˆ—è¡¨ä¸­ï¼Œç„¶åæ£€æŸ¥å…¶æ˜¯å¦å…·æœ‰ @TestObjectCreate å’Œ <strong>@TestObjectCleanup****</strong> æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ç›¸åº”çš„æ–¹æ³•æ¥æŸ¥è¯¢æ³¨è§£ä»è€Œæ‰¾åˆ°è¿™äº›æ–¹æ³•ã€‚</p><p>æ¯æ‰¾åˆ°ä¸€ä¸ª @Test æ–¹æ³•ï¼Œå°±æ‰“å°å‡ºæ¥å½“å‰ç±»çš„åå­—ï¼Œäºæ˜¯è§‚å¯Ÿè€…ç«‹åˆ»å°±å¯ä»¥çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ¥ä¸‹æ¥å¼€å§‹æ‰§è¡Œæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯æ‰“å°å‡ºæ–¹æ³•åï¼Œç„¶åè°ƒç”¨ createTestObject() ï¼ˆå¦‚æœå­˜åœ¨ä¸€ä¸ªåŠ äº† @TestObjectCreate æ³¨è§£çš„æ–¹æ³•ï¼‰ï¼Œæˆ–è€…è°ƒç”¨é»˜è®¤æ„é€ å™¨ã€‚ä¸€æ—¦åˆ›å»ºå‡ºæ¥æµ‹è¯•å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨å…¶ä¸Šçš„æµ‹è¯•æ–¹æ³•ã€‚å¦‚æœæµ‹è¯•çš„è¿”å›å€¼ä¸º booleanï¼Œå°±æ•è·è¯¥ç»“æœã€‚å¦‚æœæµ‹è¯•æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œæˆ‘ä»¬å°±å‡è®¾æµ‹è¯•æˆåŠŸï¼Œåä¹‹ï¼Œå¦‚æœå½“ assert å¤±è´¥æˆ–è€…æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™ï¼Œå°±è¯´æ˜æµ‹è¯•å¤±è´¥ï¼Œè¿™æ—¶å°†å¼‚å¸¸ä¿¡æ¯æ‰“å°å‡ºæ¥ä»¥æ˜¾ç¤ºé”™è¯¯çš„åŸå› ã€‚å¦‚æœæœ‰å¤±è´¥çš„æµ‹è¯•å‘ç”Ÿï¼Œé‚£ä¹ˆè¿˜è¦ç»Ÿè®¡å¤±è´¥çš„æ¬¡æ•°ï¼Œå¹¶å°†å¤±è´¥æ‰€å±çš„ç±»å’Œæ–¹æ³•åŠ å…¥åˆ° failedTests ä¸­ï¼Œä»¥ä¾¿æœ€åæŠ¥å‘Šç»™ç”¨æˆ·ã€‚</p><!-- Summary --><h2 id="æœ¬ç« å°ç»“"><a href="#æœ¬ç« å°ç»“" class="headerlink" title="æœ¬ç« å°ç»“"></a>æœ¬ç« å°ç»“</h2><p>æ³¨è§£æ˜¯ Java å¼•å…¥çš„ä¸€é¡¹éå¸¸å—æ¬¢è¿çš„è¡¥å……ï¼Œå®ƒæä¾›äº†ä¸€ç§ç»“æ„åŒ–ï¼Œå¹¶ä¸”å…·æœ‰ç±»å‹æ£€æŸ¥èƒ½åŠ›çš„æ–°é€”å¾„ï¼Œä»è€Œä½¿å¾—ä½ èƒ½å¤Ÿä¸ºä»£ç ä¸­åŠ å…¥å…ƒæ•°æ®ï¼Œè€Œä¸”ä¸ä¼šå¯¼è‡´ä»£ç æ‚ä¹±å¹¶éš¾ä»¥é˜…è¯»ã€‚ä½¿ç”¨æ³¨è§£èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬é¿å…ç¼–å†™ç´¯èµ˜çš„éƒ¨ç½²æè¿°æ€§æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–çš„ç”Ÿæˆæ–‡ä»¶ã€‚è€Œ Javadoc ä¸­çš„ @deprecated è¢« @Deprecated æ³¨è§£æ‰€æ›¿ä»£çš„äº‹å®ä¹Ÿè¯´æ˜ï¼Œä¸æ³¨é‡Šæ€§æ–‡å­—ç›¸æ¯”ï¼Œæ³¨è§£ç»å¯¹æ›´é€‚ç”¨äºæè¿°ç±»ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>Java æä¾›äº†å¾ˆå°‘çš„å†…ç½®æ³¨è§£ã€‚è¿™æ„å‘³ç€å¦‚æœä½ åœ¨åˆ«å¤„æ‰¾ä¸åˆ°å¯ç”¨çš„ç±»åº“ï¼Œé‚£ä¹ˆå°±åªèƒ½è‡ªå·±åˆ›å»ºæ–°çš„æ³¨è§£ä»¥åŠç›¸åº”çš„å¤„ç†å™¨ã€‚é€šè¿‡å°†æ³¨è§£å¤„ç†å™¨é“¾æ¥åˆ° javacï¼Œä½ å¯ä»¥ä¸€æ­¥å®Œæˆç¼–è¯‘æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼Œç®€åŒ–äº†æ„é€ è¿‡ç¨‹ã€‚</p><p>API çš„æä¾›æ–¹å’Œæ¡†æ¶å°†ä¼šå°†æ³¨è§£ä½œä¸ºä»–ä»¬å·¥å…·çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ @Unit ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œæ³¨è§£ä¼šæå¤§çš„æ”¹å˜æˆ‘ä»¬çš„ Java ç¼–ç¨‹ä½“éªŒã€‚</p><!-- åˆ†é¡µ --><div style="page-break-after: always;"></div><p>[^3 ]: The Java designers coyly suggest that a mirror is where you find a reflection.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥å£å’ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§å°†æ¥å£ä¸å®ç°åˆ†ç¦»çš„æ›´åŠ ç»“æ„åŒ–çš„æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaç¼–ç¨‹æ€æƒ³-ç¬¬äºŒåç«  æ³›å‹é˜…è¯»ç¬”è®°</title>
    <link href="http://yoursite.com/2020/06/28/Java%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3-%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0%20%E6%B3%9B%E5%9E%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2020/06/28/Javaç¼–ç¨‹æ€æƒ³-ç¬¬äºŒåç«  æ³›å‹é˜…è¯»ç¬”è®°/</id>
    <published>2020-06-28T02:53:12.000Z</published>
    <updated>2020-06-29T06:23:02.363Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥å£å’ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§å°†æ¥å£ä¸å®ç°åˆ†ç¦»çš„æ›´åŠ ç»“æ„åŒ–çš„æ–¹æ³•ã€‚</p><a id="more"></a><p>[TOC]</p><!-- Generics --><h1 id="ç¬¬äºŒåç« -æ³›å‹"><a href="#ç¬¬äºŒåç« -æ³›å‹" class="headerlink" title="ç¬¬äºŒåç«  æ³›å‹"></a>ç¬¬äºŒåç«  æ³›å‹</h1><blockquote><p>æ™®é€šçš„ç±»å’Œæ–¹æ³•åªèƒ½ä½¿ç”¨ç‰¹å®šçš„ç±»å‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹æˆ–ç±»ç±»å‹ã€‚å¦‚æœç¼–å†™çš„ä»£ç éœ€è¦åº”ç”¨äºå¤šç§ç±»å‹ï¼Œè¿™ç§ä¸¥è‹›çš„é™åˆ¶å¯¹ä»£ç çš„æŸç¼šå°±ä¼šå¾ˆå¤§ã€‚</p></blockquote><p>å¤šæ€æ˜¯ä¸€ç§é¢å‘å¯¹è±¡æ€æƒ³çš„æ³›åŒ–æœºåˆ¶ã€‚å¯ä»¥å°†æ–¹æ³•çš„å‚æ•°ç±»å‹è®¾ä¸ºåŸºç±»ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å¯ä»¥æ¥å—ä»»ä½•æ´¾ç”Ÿç±»ä½œä¸ºå‚æ•°ï¼ŒåŒ…æ‹¬æš‚æ—¶è¿˜ä¸å­˜åœ¨çš„ç±»ã€‚è¿™æ ·çš„æ–¹æ³•æ›´é€šç”¨ï¼Œåº”ç”¨èŒƒå›´æ›´å¹¿ã€‚åœ¨ç±»å†…éƒ¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåœ¨ä»»ä½•ä½¿ç”¨ç‰¹å®šç±»å‹çš„åœ°æ–¹ï¼ŒåŸºç±»æ„å‘³ç€æ›´å¤§çš„çµæ´»æ€§ã€‚é™¤äº† <code>final</code> ç±»ï¼ˆæˆ–åªæä¾›ç§æœ‰æ„é€ å‡½æ•°çš„ç±»ï¼‰ä»»ä½•ç±»å‹éƒ½å¯è¢«æ‰©å±•ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™è¿™ç§çµæ´»æ€§æ˜¯è‡ªå¸¦çš„ã€‚</p><p>æ‹˜æ³¥äºå•ä¸€çš„ç»§æ‰¿ä½“ç³»å¤ªè¿‡å±€é™ï¼Œå› ä¸ºåªæœ‰ç»§æ‰¿ä½“ç³»ä¸­çš„å¯¹è±¡æ‰èƒ½é€‚ç”¨åŸºç±»ä½œä¸ºå‚æ•°çš„æ–¹æ³•ä¸­ã€‚å¦‚æœæ–¹æ³•ä»¥æ¥å£è€Œä¸æ˜¯ç±»ä½œä¸ºå‚æ•°ï¼Œé™åˆ¶å°±å®½æ¾å¤šäº†ï¼Œåªè¦å®ç°äº†æ¥å£å°±å¯ä»¥ã€‚è¿™ç»™äºˆè°ƒç”¨æ–¹ä¸€ç§é€‰é¡¹ï¼Œé€šè¿‡è°ƒæ•´ç°æœ‰çš„ç±»æ¥å®ç°æ¥å£ï¼Œæ»¡è¶³æ–¹æ³•å‚æ•°è¦æ±‚ã€‚æ¥å£å¯ä»¥çªç ´ç»§æ‰¿ä½“ç³»çš„é™åˆ¶ã€‚</p><p>å³ä¾¿æ˜¯æ¥å£ä¹Ÿè¿˜æ˜¯æœ‰è¯¸å¤šé™åˆ¶ã€‚ä¸€æ—¦æŒ‡å®šäº†æ¥å£ï¼Œå®ƒå°±è¦æ±‚æˆ‘ä»¬çš„ä»£ç å¿…é¡»ä½¿ç”¨ç‰¹å®šçš„æ¥å£ã€‚è€Œæˆ‘ä»¬å¸Œæœ›ç¼–å†™æ›´é€šç”¨çš„ä»£ç ï¼Œèƒ½å¤Ÿé€‚ç”¨â€œéç‰¹å®šçš„ç±»å‹â€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ¥å£æˆ–ç±»ã€‚</p><p>è¿™å°±æ˜¯æ³›å‹çš„æ¦‚å¿µï¼Œæ˜¯ Java 5 çš„é‡å¤§å˜åŒ–ä¹‹ä¸€ã€‚æ³›å‹å®ç°äº†<em>å‚æ•°åŒ–ç±»å‹</em>ï¼Œè¿™æ ·æˆ‘ä»¬ç¼–å†™çš„ç»„ä»¶ï¼ˆé€šå¸¸æ˜¯é›†åˆï¼‰å¯ä»¥é€‚ç”¨äºå¤šç§ç±»å‹ã€‚â€œæ³›å‹â€è¿™ä¸ªæœ¯è¯­çš„å«ä¹‰æ˜¯â€œé€‚ç”¨äºå¾ˆå¤šç±»å‹â€ã€‚ç¼–ç¨‹è¯­è¨€ä¸­æ³›å‹å‡ºç°çš„åˆè¡·æ˜¯é€šè¿‡è§£è€¦ç±»æˆ–æ–¹æ³•ä¸æ‰€ä½¿ç”¨çš„ç±»å‹ä¹‹é—´çš„çº¦æŸï¼Œä½¿å¾—ç±»æˆ–æ–¹æ³•å…·å¤‡æœ€å®½æ³›çš„è¡¨è¾¾åŠ›ã€‚éšåæˆ‘ä»¬ä¼šå‘ç° Java ä¸­æ³›å‹çš„å®ç°å¹¶æ²¡æœ‰é‚£ä¹ˆâ€œæ³›â€ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè´¨ç–‘â€œæ³›å‹â€è¿™ä¸ªè¯æ˜¯å¦åˆé€‚ç”¨æ¥æè¿°è¿™ä¸€åŠŸèƒ½ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»æœªæ¥è§¦è¿‡å‚æ•°åŒ–ç±»å‹æœºåˆ¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ³›å‹å¯¹ Java è¯­è¨€ç¡®å®æ˜¯ä¸ªå¾ˆæœ‰ç›Šçš„è¡¥å……ã€‚åœ¨æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªç±»å‹å‚æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè´Ÿè´£è½¬å‹å¹¶ç¡®ä¿ç±»å‹çš„æ­£ç¡®æ€§ã€‚è¿™æ˜¯ä¸€å¤§è¿›æ­¥ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬äº†è§£å…¶ä»–è¯­è¨€ï¼ˆä¾‹å¦‚ C++ ï¼‰çš„å‚æ•°åŒ–æœºåˆ¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼ŒJava æ³›å‹å¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰çš„é¢„æœŸã€‚ä½¿ç”¨åˆ«äººåˆ›å»ºå¥½çš„æ³›å‹ç›¸å¯¹å®¹æ˜“ï¼Œä½†æ˜¯åˆ›å»ºè‡ªå·±çš„æ³›å‹æ—¶ï¼Œå°±ä¼šé‡åˆ°å¾ˆå¤šæ„æ–™ä¹‹å¤–çš„éº»çƒ¦ã€‚</p><p>è¿™å¹¶ä¸æ˜¯è¯´ Java æ³›å‹æ¯«æ— ç”¨å¤„ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥ä½¿ä»£ç æ›´ç›´æ¥æ›´ä¼˜é›…ã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬è§è¯†è¿‡é‚£ç§å®ç°äº†æ›´çº¯ç²¹çš„æ³›å‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆï¼ŒJava å¯èƒ½ä¼šä»¤æˆ‘ä»¬å¤±æœ›ã€‚æœ¬ç« ä¼šä»‹ç» Java æ³›å‹çš„ä¼˜ç‚¹ä¸å±€é™ã€‚æˆ‘ä¼šè§£é‡Š Java çš„æ³›å‹æ˜¯å¦‚ä½•å‘å±•æˆç°åœ¨è¿™æ ·çš„ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´æœ‰æ•ˆåœ°ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚</p><h3 id="ä¸-C-çš„æ¯”è¾ƒ"><a href="#ä¸-C-çš„æ¯”è¾ƒ" class="headerlink" title="ä¸ C++ çš„æ¯”è¾ƒ"></a>ä¸ C++ çš„æ¯”è¾ƒ</h3><p>Java çš„è®¾è®¡è€…æ›¾è¯´è¿‡ï¼Œè¿™é—¨è¯­è¨€çš„çµæ„Ÿä¸»è¦æ¥è‡ª C++ ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå­¦ä¹  Java æ—¶åŸºæœ¬ä¸ç”¨å‚è€ƒ C++ ã€‚</p><p>ä½†æ˜¯ï¼ŒJava ä¸­çš„æ³›å‹éœ€è¦ä¸ C++ è¿›è¡Œå¯¹æ¯”ï¼Œç†ç”±æœ‰ä¸¤ä¸ªï¼šé¦–å…ˆï¼Œç†è§£ C++ <em>æ¨¡æ¿</em>ï¼ˆæ³›å‹çš„ä¸»è¦çµæ„Ÿæ¥æºï¼ŒåŒ…æ‹¬åŸºæœ¬è¯­æ³•ï¼‰çš„æŸäº›ç‰¹æ€§ï¼Œæœ‰åŠ©äºç†è§£æ³›å‹çš„åŸºç¡€ç†å¿µã€‚åŒæ—¶ï¼Œéå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ Java æ³›å‹çš„å±€é™æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å±€é™ã€‚æœ€ç»ˆçš„ç›®æ ‡æ˜¯æ˜ç¡® Java æ³›å‹çš„è¾¹ç•Œï¼Œè®©æˆ‘ä»¬æˆä¸ºä¸€ä¸ªç¨‹åºé«˜æ‰‹ã€‚åªæœ‰çŸ¥é“äº†æŸä¸ªæŠ€æœ¯ä¸èƒ½åšä»€ä¹ˆï¼Œæˆ‘ä»¬æ‰èƒ½æ›´å¥½åœ°åšåˆ°æ‰€èƒ½åšçš„ï¼ˆéƒ¨åˆ†åŸå› æ˜¯ï¼Œä¸å¿…æµªè´¹æ—¶é—´åœ¨æ­»èƒ¡åŒé‡Œï¼‰ã€‚</p><p>ç¬¬äºŒä¸ªåŸå› æ˜¯ï¼Œåœ¨ Java ç¤¾åŒºä¸­ï¼Œå¤§å®¶æ™®éå¯¹ C++ æ¨¡æ¿æœ‰ä¸€ç§è¯¯è§£ï¼Œè€Œè¿™ç§è¯¯è§£å¯èƒ½ä¼šä»¤æˆ‘ä»¬åœ¨ç†è§£æ³›å‹çš„æ„å›¾æ—¶äº§ç”Ÿåå·®ã€‚</p><p>å› æ­¤ï¼Œæœ¬ç« ä¸­ä¼šä»‹ç»å°‘é‡ C++ æ¨¡æ¿çš„ä¾‹å­ï¼Œä»…å½“å®ƒä»¬ç¡®å®å¯ä»¥åŠ æ·±ç†è§£æ—¶æ‰ä¼šå¼•å…¥ã€‚</p><!-- Simple Generics --><h2 id="ç®€å•æ³›å‹"><a href="#ç®€å•æ³›å‹" class="headerlink" title="ç®€å•æ³›å‹"></a>ç®€å•æ³›å‹</h2><p>ä¿ƒæˆæ³›å‹å‡ºç°çš„æœ€ä¸»è¦çš„åŠ¨æœºä¹‹ä¸€æ˜¯ä¸ºäº†åˆ›å»º<em>é›†åˆç±»</em>ï¼Œå‚è§ é›†åˆ ç« èŠ‚ã€‚é›†åˆç”¨äºå­˜æ”¾è¦ä½¿ç”¨åˆ°çš„å¯¹è±¡ã€‚æ•°ç»„ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸è¿‡é›†åˆæ¯”æ•°ç»„æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œã€‚å‡ ä¹æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­éƒ½ä¼šæ¶‰åŠåˆ°ä¸€ç»„å¯¹è±¡ï¼Œå› æ­¤é›†åˆæ˜¯å¯å¤ç”¨æ€§æœ€é«˜çš„ç±»åº“ä¹‹ä¸€ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªåªèƒ½æŒæœ‰å•ä¸ªå¯¹è±¡çš„ç±»ã€‚è¿™ä¸ªç±»å¯ä»¥æ˜ç¡®æŒ‡å®šå…¶æŒæœ‰çš„å¯¹è±¡çš„ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Holder1.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Automobile</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Automobile a;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Holder1</span><span class="params">(Automobile a)</span> </span>&#123; <span class="keyword">this</span>.a = a; &#125;</span><br><span class="line">    <span class="function">Automobile <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»çš„å¯å¤ç”¨æ€§ä¸é«˜ï¼Œå®ƒæ— æ³•æŒæœ‰å…¶ä»–ç±»å‹çš„å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä¸å¸Œæœ›ä¸ºç¢°åˆ°çš„æ¯ä¸ªç±»å‹éƒ½ç¼–å†™ä¸€ä¸ªæ–°çš„ç±»ã€‚</p><p>åœ¨ Java 5 ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿™ä¸ªç±»ç›´æ¥æŒæœ‰ <code>Object</code> ç±»å‹çš„å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ObjectHolder.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectHolder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object a;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObjectHolder</span><span class="params">(Object a)</span> </span>&#123; <span class="keyword">this</span>.a = a; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(Object a)</span> </span>&#123; <span class="keyword">this</span>.a = a; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ObjectHolder h2 = <span class="keyword">new</span> ObjectHolder(<span class="keyword">new</span> Automobile());</span><br><span class="line">        Automobile a = (Automobile)h2.get();</span><br><span class="line">        h2.set(<span class="string">"Not an Automobile"</span>);</span><br><span class="line">        String s = (String)h2.get();</span><br><span class="line">        h2.set(<span class="number">1</span>); <span class="comment">// è‡ªåŠ¨è£…ç®±ä¸º Integer</span></span><br><span class="line">        Integer x = (Integer)h2.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œ<code>ObjectHolder</code> å¯ä»¥æŒæœ‰ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ª <code>ObjectHolder</code> å…ˆåæŒæœ‰äº†ä¸‰ç§ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</p><p>ä¸€ä¸ªé›†åˆä¸­å­˜å‚¨å¤šç§ä¸åŒç±»å‹çš„å¯¹è±¡çš„æƒ…å†µå¾ˆå°‘è§ï¼Œé€šå¸¸è€Œè¨€ï¼Œæˆ‘ä»¬åªä¼šç”¨é›†åˆå­˜å‚¨åŒä¸€ç§ç±»å‹çš„å¯¹è±¡ã€‚æ³›å‹çš„ä¸»è¦ç›®çš„ä¹‹ä¸€å°±æ˜¯ç”¨æ¥çº¦å®šé›†åˆè¦å­˜å‚¨ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡ç¼–è¯‘å™¨ç¡®ä¿è§„çº¦å¾—ä»¥æ»¡è¶³ã€‚</p><p>å› æ­¤ï¼Œä¸å…¶ä½¿ç”¨ <code>Object</code> ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›å…ˆæŒ‡å®šä¸€ä¸ªç±»å‹å ä½ç¬¦ï¼Œç¨åå†å†³å®šå…·ä½“ä½¿ç”¨ä»€ä¹ˆç±»å‹ã€‚è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œéœ€è¦ä½¿ç”¨<em>ç±»å‹å‚æ•°</em>ï¼Œç”¨å°–æ‹¬å·æ‹¬ä½ï¼Œæ”¾åœ¨ç±»ååé¢ã€‚ç„¶ååœ¨ä½¿ç”¨è¿™ä¸ªç±»æ—¶ï¼Œå†ç”¨å®é™…çš„ç±»å‹æ›¿æ¢æ­¤ç±»å‹å‚æ•°ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ<code>T</code> å°±æ˜¯ç±»å‹å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericHolder.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericHolder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T a;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericHolder</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T a)</span> </span>&#123; <span class="keyword">this</span>.a = a; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericHolder&lt;Automobile&gt; h3 = <span class="keyword">new</span> GenericHolder&lt;Automobile&gt;();</span><br><span class="line">        h3.set(<span class="keyword">new</span> Automobile()); <span class="comment">// æ­¤å¤„æœ‰ç±»å‹æ ¡éªŒ</span></span><br><span class="line">        Automobile a = h3.get();  <span class="comment">// æ— éœ€ç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="comment">//- h3.set("Not an Automobile"); // æŠ¥é”™</span></span><br><span class="line">        <span class="comment">//- h3.set(1);  // æŠ¥é”™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»º <code>GenericHolder</code> å¯¹è±¡æ—¶ï¼Œå¿…é¡»æŒ‡æ˜è¦æŒæœ‰çš„å¯¹è±¡çš„ç±»å‹ï¼Œå°†å…¶ç½®äºå°–æ‹¬å·å†…ï¼Œå°±åƒ <code>main()</code> ä¸­é‚£æ ·ä½¿ç”¨ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±åªèƒ½åœ¨ <code>GenericHolder</code> ä¸­å­˜å‚¨è¯¥ç±»å‹ï¼ˆæˆ–å…¶å­ç±»ï¼Œå› ä¸ºå¤šæ€ä¸æ³›å‹ä¸å†²çªï¼‰çš„å¯¹è±¡äº†ã€‚å½“æˆ‘ä»¬è°ƒç”¨ <code>get()</code> å–å€¼æ—¶ï¼Œç›´æ¥å°±æ˜¯æ­£ç¡®çš„ç±»å‹ã€‚</p><p>è¿™å°±æ˜¯ Java æ³›å‹çš„æ ¸å¿ƒæ¦‚å¿µï¼šæˆ‘ä»¬åªéœ€å‘Šè¯‰ç¼–è¯‘å™¨è¦ä½¿ç”¨ä»€ä¹ˆç±»å‹ï¼Œå‰©ä¸‹çš„ç»†èŠ‚äº¤ç»™å®ƒæ¥å¤„ç†ã€‚</p><p>æˆ‘ä»¬å¯èƒ½æ³¨æ„åˆ° <code>h3</code> çš„å®šä¹‰éå¸¸ç¹å¤ã€‚åœ¨ <code>=</code> å·¦è¾¹æœ‰ <code>GenericHolder&lt;Automobile&gt;</code>, å³è¾¹åˆé‡å¤äº†ä¸€æ¬¡ã€‚åœ¨ Java 5 ä¸­ï¼Œè¿™ç§å†™æ³•è¢«è§£é‡Šæˆâ€œå¿…è¦çš„â€ï¼Œä½†åœ¨ Java 7 ä¸­è®¾è®¡è€…ä¿®æ­£äº†è¿™ä¸ªé—®é¢˜ï¼ˆæ–°çš„ç®€å†™è¯­æ³•éšåæˆä¸ºå¤‡å—æ¬¢è¿çš„ç‰¹æ€§ï¼‰ã€‚ä»¥ä¸‹æ˜¯ç®€å†™çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Diamond.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bob</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Diamond</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericHolder&lt;Bob&gt; h3 = <span class="keyword">new</span> GenericHolder&lt;&gt;();</span><br><span class="line">        h3.set(<span class="keyword">new</span> Bob());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨ <code>h3</code> çš„å®šä¹‰å¤„ï¼Œ<code>=</code> å³è¾¹çš„å°–æ‹¬å·æ˜¯ç©ºçš„ï¼ˆç§°ä¸ºâ€œé’»çŸ³è¯­æ³•â€ï¼‰ï¼Œè€Œä¸æ˜¯é‡å¤å·¦è¾¹çš„ç±»å‹ä¿¡æ¯ã€‚åœ¨æœ¬ä¹¦å‰©ä½™éƒ¨åˆ†éƒ½ä¼šä½¿ç”¨è¿™ç§è¯­æ³•ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ³›å‹å’Œå…¶ä»–ç±»å‹å·®ä¸å¤šï¼Œåªä¸è¿‡å®ƒä»¬ç¢°å·§æœ‰ç±»å‹å‚æ•°ç½¢äº†ã€‚åœ¨ä½¿ç”¨æ³›å‹æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‡å®šå®ƒä»¬çš„åç§°å’Œç±»å‹å‚æ•°åˆ—è¡¨å³å¯ã€‚</p><h3 id="ä¸€ä¸ªå…ƒç»„ç±»åº“"><a href="#ä¸€ä¸ªå…ƒç»„ç±»åº“" class="headerlink" title="ä¸€ä¸ªå…ƒç»„ç±»åº“"></a>ä¸€ä¸ªå…ƒç»„ç±»åº“</h3><p>æœ‰æ—¶ä¸€ä¸ªæ–¹æ³•éœ€è¦èƒ½è¿”å›å¤šä¸ªå¯¹è±¡ã€‚è€Œ <strong>return</strong> è¯­å¥åªèƒ½è¿”å›å•ä¸ªå¯¹è±¡ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç”¨å®ƒæ‰“åŒ…æƒ³è¦è¿”å›çš„å¤šä¸ªå¯¹è±¡ã€‚å½“ç„¶ï¼Œå¯ä»¥åœ¨æ¯æ¬¡éœ€è¦çš„æ—¶å€™ï¼Œä¸“é—¨åˆ›å»ºä¸€ä¸ªç±»æ¥å®Œæˆè¿™æ ·çš„å·¥ä½œã€‚ä½†æ˜¯æœ‰äº†æ³›å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸€åŠ³æ°¸é€¸ã€‚åŒæ—¶ï¼Œè¿˜è·å¾—äº†ç¼–è¯‘æ—¶çš„ç±»å‹å®‰å…¨ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µç§°ä¸º<em>å…ƒç»„*ï¼Œå®ƒæ˜¯å°†ä¸€ç»„å¯¹è±¡ç›´æ¥æ‰“åŒ…å­˜å‚¨äºå•ä¸€å¯¹è±¡ä¸­ã€‚å¯ä»¥ä»è¯¥å¯¹è±¡è¯»å–å…¶ä¸­çš„å…ƒç´ ï¼Œä½†ä¸å…è®¸å‘å…¶ä¸­å­˜å‚¨æ–°å¯¹è±¡ï¼ˆè¿™ä¸ªæ¦‚å¿µä¹Ÿç§°ä¸º *æ•°æ®ä¼ è¾“å¯¹è±¡</em> æˆ– <em>ä¿¡ä½¿</em> ï¼‰ã€‚</p><p>é€šå¸¸ï¼Œå…ƒç»„å¯ä»¥å…·æœ‰ä»»æ„é•¿åº¦ï¼Œå…ƒç»„ä¸­çš„å¯¹è±¡å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸ºæ¯ä¸ªå¯¹è±¡æŒ‡æ˜ç±»å‹ï¼Œå¹¶ä¸”ä»å…ƒç»„ä¸­è¯»å–å‡ºæ¥æ—¶ï¼Œèƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„ç±»å‹ã€‚è¦å¤„ç†ä¸åŒé•¿åº¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¤šä¸ªä¸åŒçš„å…ƒç»„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨ä¸¤ä¸ªå¯¹è±¡çš„å…ƒç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Tuple2.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple2</span>&lt;<span class="title">A</span>, <span class="title">B</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> A a1;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> B a2;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple2</span><span class="params">(A a, B b)</span> </span>&#123; a1 = a; a2 = b; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">rep</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a1 + <span class="string">", "</span> + a2; &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"("</span> + rep() + <span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°ä¼ å…¥è¦å­˜å‚¨çš„å¯¹è±¡ã€‚è¿™ä¸ªå…ƒç»„éšå¼åœ°ä¿æŒäº†å…¶ä¸­å…ƒç´ çš„æ¬¡åºã€‚</p><p>åˆæ¬¡é˜…è¯»ä¸Šé¢çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½è®¤ä¸ºè¿™è¿åäº† Java ç¼–ç¨‹çš„å°è£…åŸåˆ™ã€‚<code>a1</code> å’Œ <code>a2</code> åº”è¯¥å£°æ˜ä¸º <strong>private</strong>ï¼Œç„¶åæä¾› <code>getFirst()</code> å’Œ <code>getSecond()</code> å–å€¼æ–¹æ³•æ‰å¯¹å‘€ï¼Ÿè€ƒè™‘ä¸‹è¿™æ ·åšèƒ½æä¾›çš„â€œå®‰å…¨æ€§â€æ˜¯ä»€ä¹ˆï¼šå…ƒç»„çš„ä½¿ç”¨ç¨‹åºå¯ä»¥è¯»å– <code>a1</code> å’Œ <code>a2</code> ç„¶åå¯¹å®ƒä»¬æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä½†æ— æ³•å¯¹ <code>a1</code> å’Œ <code>a2</code> é‡æ–°èµ‹å€¼ã€‚ä¾‹å­ä¸­çš„ <code>final</code> å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœï¼Œå¹¶ä¸”æ›´ä¸ºç®€æ´æ˜äº†ã€‚</p><p>å¦ä¸€ç§è®¾è®¡æ€è·¯æ˜¯å…è®¸å…ƒç»„çš„ç”¨æˆ·ç»™ <code>a1</code> å’Œ <code>a2</code> é‡æ–°èµ‹å€¼ã€‚ç„¶è€Œï¼Œé‡‡ç”¨ä¸Šä¾‹ä¸­çš„å½¢å¼æ— ç–‘æ›´åŠ å®‰å…¨ï¼Œå¦‚æœç”¨æˆ·æƒ³å­˜å‚¨ä¸åŒçš„å…ƒç´ ï¼Œå°±ä¼šå¼ºåˆ¶ä»–ä»¬åˆ›å»ºæ–°çš„ <code>Tuple2</code> å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç»§æ‰¿æœºåˆ¶å®ç°é•¿åº¦æ›´é•¿çš„å…ƒç»„ã€‚æ·»åŠ æ›´å¤šçš„ç±»å‹å‚æ•°å°±è¡Œäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Tuple3.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple3</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>&gt; <span class="keyword">extends</span> <span class="title">Tuple2</span>&lt;<span class="title">A</span>, <span class="title">B</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> C a3;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple3</span><span class="params">(A a, B b, C c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(a, b);</span><br><span class="line">        a3 = c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">rep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.rep() + <span class="string">", "</span> + a3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// onjava/Tuple4.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple4</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">Tuple3</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> D a4;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple4</span><span class="params">(A a, B b, C c, D d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(a, b, c);</span><br><span class="line">        a4 = d;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">rep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.rep() + <span class="string">", "</span> + a4;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// onjava/Tuple5.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple5</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>, <span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">Tuple4</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E a5;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple5</span><span class="params">(A a, B b, C c, D d, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(a, b, c, d);</span><br><span class="line">        a5 = e;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">rep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.rep() + <span class="string">", "</span> + a5;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºéœ€è¦ï¼Œå†å®šä¹‰ä¸¤ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Amphibian.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Amphibian</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/Vehicle.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å…ƒç»„æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªé•¿åº¦é€‚åˆçš„å…ƒç»„ï¼Œå°†å…¶ä½œä¸ºè¿”å›å€¼å³å¯ã€‚æ³¨æ„ä¸‹é¢ä¾‹å­ä¸­æ–¹æ³•çš„è¿”å›ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/TupleTest.java</span></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TupleTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple2&lt;String, Integer&gt; <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 47 è‡ªåŠ¨è£…ç®±ä¸º Integer</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple3&lt;Amphibian, String, Integer&gt; <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple3&lt;&gt;(<span class="keyword">new</span> Amphibian(), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple4&lt;Vehicle, Amphibian, String, Integer&gt; <span class="title">h</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple4&lt;&gt;(<span class="keyword">new</span> Vehicle(), <span class="keyword">new</span> Amphibian(), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple5&lt;Vehicle, Amphibian, String, Integer, Double&gt; <span class="title">k</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple5&lt;&gt;(<span class="keyword">new</span> Vehicle(), <span class="keyword">new</span> Amphibian(), <span class="string">"hi"</span>, <span class="number">47</span>, <span class="number">11.1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tuple2&lt;String, Integer&gt; ttsi = f();</span><br><span class="line">        System.out.println(ttsi);</span><br><span class="line">        <span class="comment">// ttsi.a1 = "there"; // ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸º final ä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br><span class="line">        System.out.println(g());</span><br><span class="line">        System.out.println(h());</span><br><span class="line">        System.out.println(k());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"> (hi, 47)</span></span><br><span class="line"><span class="comment"> (Amphibian@1540e19d, hi, 47)</span></span><br><span class="line"><span class="comment"> (Vehicle@7f31245a, Amphibian@6d6f6e28, hi, 47)</span></span><br><span class="line"><span class="comment"> (Vehicle@330bedb4, Amphibian@2503dbd3, hi, 47, 11.1)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†æ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºå…ƒç»„ï¼Œä»¤å…¶è¿”å›ä¸€ç»„ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚</p><p>é€šè¿‡ <code>ttsi.a1 = &quot;there&quot;</code> è¯­å¥çš„æŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<strong>final</strong> å£°æ˜ç¡®å®å¯ä»¥ç¡®ä¿ <strong>public</strong> å­—æ®µåœ¨å¯¹è±¡è¢«æ„é€ å‡ºæ¥ä¹‹åå°±ä¸èƒ½é‡æ–°èµ‹å€¼äº†ã€‚</p><p>åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œ<code>new</code> è¡¨è¾¾å¼æœ‰äº›å•°å—¦ã€‚æœ¬ç« ç¨åä¼šä»‹ç»ï¼Œå¦‚ä½•åˆ©ç”¨ <em>æ³›å‹æ–¹æ³•</em> ç®€åŒ–å®ƒä»¬ã€‚</p><h3 id="ä¸€ä¸ªå †æ ˆç±»"><a href="#ä¸€ä¸ªå †æ ˆç±»" class="headerlink" title="ä¸€ä¸ªå †æ ˆç±»"></a>ä¸€ä¸ªå †æ ˆç±»</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼šå †æ ˆã€‚åœ¨ <a href="book/12-Collections.md">é›†åˆ</a> ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>LinkedList</code> å®ç°äº† <code>onjava.Stack</code> ç±»ã€‚åœ¨é‚£ä¸ªä¾‹å­ä¸­ï¼Œ<code>LinkedList</code> æœ¬èº«å·²ç»å…·å¤‡äº†åˆ›å»ºå †æ ˆæ‰€éœ€çš„æ–¹æ³•ã€‚<code>Stack</code> æ˜¯é€šè¿‡ä¸¤ä¸ªæ³›å‹ç±» <code>Stack&lt;T&gt;</code> å’Œ <code>LinkedList&lt;T&gt;</code> çš„ç»„åˆæ¥åˆ›å»ºã€‚æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ³›å‹åªä¸è¿‡æ˜¯ä¸€ç§ç±»å‹ç½¢äº†ï¼ˆç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›ä¾‹å¤–çš„æƒ…å†µï¼‰ã€‚</p><p>è¿™æ¬¡æˆ‘ä»¬ä¸ç”¨ <code>LinkedList</code> æ¥å®ç°è‡ªå·±çš„å†…éƒ¨é“¾å¼å­˜å‚¨æœºåˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/LinkedStack.java</span></span><br><span class="line"><span class="comment">// ç”¨é“¾å¼ç»“æ„å®ç°çš„å †æ ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">U</span>&gt; </span>&#123;</span><br><span class="line">        U item;</span><br><span class="line">        Node&lt;U&gt; next;</span><br><span class="line">    </span><br><span class="line">        Node() &#123; item = <span class="keyword">null</span>; next = <span class="keyword">null</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        Node(U item, Node&lt;U&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.item = item;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item == <span class="keyword">null</span> &amp;&amp; next == <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; top = <span class="keyword">new</span> Node&lt;&gt;();  <span class="comment">// æ ˆé¡¶</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        top = <span class="keyword">new</span> Node&lt;&gt;(item, top);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T result = top.item;</span><br><span class="line">        <span class="keyword">if</span> (!top.end()) &#123;</span><br><span class="line">            top = top.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LinkedStack&lt;String&gt; lss = <span class="keyword">new</span> LinkedStack&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String s : <span class="string">"Phasers on stun!"</span>.split(<span class="string">" "</span>)) &#123;</span><br><span class="line">            lss.push(s);</span><br><span class="line">        &#125;</span><br><span class="line">        String s;</span><br><span class="line">        <span class="keyword">while</span> ((s = lss.pop()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stun!</span><br><span class="line">on</span><br><span class="line">Phasers</span><br></pre></td></tr></table></figure><p>å†…éƒ¨ç±» <code>Node</code> ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„ç±»å‹å‚æ•°ã€‚</p><p>è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ª <em>æœ«ç«¯æ ‡è¯†</em> (end sentinel) æ¥åˆ¤æ–­æ ˆä½•æ—¶ä¸ºç©ºã€‚è¿™ä¸ªæœ«ç«¯æ ‡è¯†æ˜¯åœ¨æ„é€  <code>LinkedStack</code> æ—¶åˆ›å»ºçš„ã€‚ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨ <code>push()</code> å°±ä¼šåˆ›å»ºä¸€ä¸ª <code>Node&lt;T&gt;</code> å¯¹è±¡ï¼Œå¹¶å°†å…¶é“¾æ¥åˆ°å‰ä¸€ä¸ª <code>Node&lt;T&gt;</code> å¯¹è±¡ã€‚å½“æˆ‘ä»¬è°ƒç”¨ <code>pop()</code> æ–¹æ³•æ—¶ï¼Œæ€»æ˜¯è¿”å› <code>top.item</code>ï¼Œç„¶åä¸¢å¼ƒå½“å‰ <code>top</code> æ‰€æŒ‡å‘çš„ <code>Node&lt;T&gt;</code>ï¼Œå¹¶å°† <code>top</code> æŒ‡å‘ä¸‹ä¸€ä¸ª <code>Node&lt;T&gt;</code>ï¼Œé™¤éåˆ°è¾¾æœ«ç«¯æ ‡è¯†ï¼Œè¿™æ—¶å°±ä¸èƒ½å†ç§»åŠ¨ <code>top</code> äº†ã€‚å¦‚æœå·²ç»åˆ°è¾¾æœ«ç«¯ï¼Œç¨‹åºè¿˜ç»§ç»­è°ƒç”¨ <code>pop()</code> æ–¹æ³•ï¼Œå®ƒåªèƒ½å¾—åˆ° <code>null</code>ï¼Œè¯´æ˜æ ˆå·²ç»ç©ºäº†ã€‚</p><h3 id="RandomList"><a href="#RandomList" class="headerlink" title="RandomList"></a>RandomList</h3><p>ä½œä¸ºå®¹å™¨çš„å¦ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒæœ‰ç‰¹å®šç±»å‹å¯¹è±¡çš„åˆ—è¡¨ï¼Œæ¯æ¬¡è°ƒç”¨å®ƒçš„ <code>select()</code> æ–¹æ³•æ—¶éƒ½éšæœºè¿”å›ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœå¸Œæœ›è¿™ç§åˆ—è¡¨å¯ä»¥é€‚ç”¨äºå„ç§ç±»å‹ï¼Œå°±éœ€è¦ä½¿ç”¨æ³›å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/RandomList.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(rand.nextInt(size()));</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RandomList&lt;String&gt; rs = <span class="keyword">new</span> RandomList&lt;&gt;();</span><br><span class="line">        Arrays.stream(<span class="string">"The quick brown fox jumped over the lazy brown dog"</span>.split(<span class="string">" "</span>)).forEach(rs::add);</span><br><span class="line">        IntStream.range(<span class="number">0</span>, <span class="number">11</span>).forEach(i -&gt; </span><br><span class="line">            System.out.print(rs.select() + <span class="string">" "</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brown over fox quick quick dog brown The brown lazy brown</span><br></pre></td></tr></table></figure><p><code>RandomList</code> ç»§æ‰¿äº† <code>ArrayList</code> çš„æ‰€æœ‰æ–¹æ³•ã€‚æœ¬ä¾‹ä¸­åªæ·»åŠ äº† <code>select()</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><!-- Generic Interfaces --><h2 id="æ³›å‹æ¥å£"><a href="#æ³›å‹æ¥å£" class="headerlink" title="æ³›å‹æ¥å£"></a>æ³›å‹æ¥å£</h2><p>æ³›å‹ä¹Ÿå¯ä»¥åº”ç”¨äºæ¥å£ã€‚ä¾‹å¦‚ <em>ç”Ÿæˆå™¨*ï¼Œè¿™æ˜¯ä¸€ç§ä¸“é—¨è´Ÿè´£åˆ›å»ºå¯¹è±¡çš„ç±»ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ *å·¥å‚æ–¹æ³•</em> è®¾è®¡æ¨¡å¼çš„ä¸€ç§åº”ç”¨ã€‚ä¸è¿‡ï¼Œå½“ä½¿ç”¨ç”Ÿæˆå™¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶ï¼Œå®ƒä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œè€Œå·¥å‚æ–¹æ³•ä¸€èˆ¬éœ€è¦å‚æ•°ã€‚ç”Ÿæˆå™¨æ— éœ€é¢å¤–çš„ä¿¡æ¯å°±çŸ¥é“å¦‚ä½•åˆ›å»ºæ–°å¯¹è±¡ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªç”Ÿæˆå™¨åªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡ã€‚ä¾‹å¦‚ <code>java.util.function</code> ç±»åº“ä¸­çš„ <code>Supplier</code> å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè°ƒç”¨å…¶ <code>get()</code> è·å–å¯¹è±¡ã€‚<code>get()</code> æ˜¯æ³›å‹æ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºç±»å‹å‚æ•° <code>T</code>ã€‚</p><p>ä¸ºäº†æ¼”ç¤º <code>Supplier</code>ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ ä¸ªç±»ã€‚ä¸‹é¢æ˜¯ä¸ªå’–å•¡ç›¸å…³çš„ç»§æ‰¿ä½“ç³»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/coffee/Coffee.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName() + <span class="string">" "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/coffee/Latte.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Latte</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/coffee/Mocha.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mocha</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/coffee/Cappuccino.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cappuccino</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/coffee/Americano.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Americano</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// generics/coffee/Breve.java</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Breve</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç° <code>Supplier&lt;Coffee&gt;</code> æ¥å£ï¼Œå®ƒèƒ½å¤Ÿéšæœºç”Ÿæˆä¸åŒç±»å‹çš„ <code>Coffee</code> å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/coffee/CoffeeSupplier.java</span></span><br><span class="line"><span class="comment">// &#123;java generics.coffee.CoffeeSupplier&#125;</span></span><br><span class="line"><span class="keyword">package</span> generics.coffee;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoffeeSupplier</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Coffee</span>&gt;, <span class="title">Iterable</span>&lt;<span class="title">Coffee</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt;[] types = &#123; Latte.class, Mocha.class, </span><br><span class="line">        Cappuccino.class, Americano.class, Breve.class &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CoffeeSupplier</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// For iteration:</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CoffeeSupplier</span><span class="params">(<span class="keyword">int</span> sz)</span> </span>&#123; size = sz; &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Coffee <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Coffee) types[rand.nextInt(types.length)].newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">CoffeeIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Coffee</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = size;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> count &gt; <span class="number">0</span>; &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Coffee <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            count--;</span><br><span class="line">            <span class="keyword">return</span> CoffeeSupplier.<span class="keyword">this</span>.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Coffee&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CoffeeIterator();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.generate(<span class="keyword">new</span> CoffeeSupplier())</span><br><span class="line">              .limit(<span class="number">5</span>)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">        <span class="keyword">for</span> (Coffee c : <span class="keyword">new</span> CoffeeSupplier(<span class="number">5</span>)) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Americano <span class="number">0</span></span><br><span class="line">Latte <span class="number">1</span></span><br><span class="line">Americano <span class="number">2</span></span><br><span class="line">Mocha <span class="number">3</span></span><br><span class="line">Mocha <span class="number">4</span></span><br><span class="line">Breve <span class="number">5</span></span><br><span class="line">Americano <span class="number">6</span></span><br><span class="line">Latte <span class="number">7</span></span><br><span class="line">Cappuccino <span class="number">8</span></span><br><span class="line">Cappuccino <span class="number">9</span></span><br></pre></td></tr></table></figure><p>å‚æ•°åŒ–çš„ <code>Supplier</code> æ¥å£ç¡®ä¿ <code>get()</code> è¿”å›å€¼æ˜¯å‚æ•°çš„ç±»å‹ã€‚<code>CoffeeSupplier</code> åŒæ—¶è¿˜å®ç°äº† <code>Iterable</code> æ¥å£ï¼Œæ‰€ä»¥èƒ½ç”¨äº <em>for-in</em> è¯­å¥ã€‚ä¸è¿‡ï¼Œå®ƒè¿˜éœ€è¦çŸ¥é“ä½•æ—¶ç»ˆæ­¢å¾ªç¯ï¼Œè¿™æ­£æ˜¯ç¬¬äºŒä¸ªæ„é€ å‡½æ•°çš„ä½œç”¨ã€‚</p><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå®ç° <code>Supplier&lt;T&gt;</code> æ¥å£çš„ä¾‹å­ï¼Œå®ƒè´Ÿè´£ç”Ÿæˆ Fibonacci æ•°åˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Fibonacci.java</span></span><br><span class="line"><span class="comment">// Generate a Fibonacci sequence</span></span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> fib(count++); &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.generate(<span class="keyword">new</span> Fibonacci())</span><br><span class="line">              .limit(<span class="number">18</span>)</span><br><span class="line">              .map(n -&gt; n + <span class="string">" "</span>)</span><br><span class="line">              .forEach(System.out::print);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">13</span> <span class="number">21</span> <span class="number">34</span> <span class="number">55</span> <span class="number">89</span> <span class="number">144</span> <span class="number">233</span> <span class="number">377</span> <span class="number">610</span> <span class="number">987</span> <span class="number">1597</span> <span class="number">2584</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä»¬åœ¨ <code>Fibonacci</code> ç±»çš„é‡Œé‡Œå¤–å¤–ä½¿ç”¨çš„éƒ½æ˜¯ <code>int</code> ç±»å‹ï¼Œä½†æ˜¯å…¶å‚æ•°ç±»å‹å´æ˜¯ <code>Integer</code>ã€‚è¿™ä¸ªä¾‹å­å¼•å‡ºäº† Java æ³›å‹çš„ä¸€ä¸ªå±€é™æ€§ï¼šåŸºæœ¬ç±»å‹æ— æ³•ä½œä¸ºç±»å‹å‚æ•°ã€‚ä¸è¿‡ Java 5 å…·å¤‡è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±çš„åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨åŸºæœ¬ç±»å‹å’Œç›¸åº”çš„åŒ…è£…ç±»ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ä¸­ <code>Fibonacci</code> ç±»å¯¹ <code>int</code> çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¿™ç§æ•ˆæœã€‚</p><p>å¦‚æœè¿˜æƒ³æ›´è¿›ä¸€æ­¥ï¼Œç¼–å†™ä¸€ä¸ªå®ç°äº† <code>Iterable</code> çš„ <code>Fibnoacci</code> ç”Ÿæˆå™¨ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªé€‰æ‹©æ˜¯é‡å†™è¿™ä¸ªç±»ï¼Œä»¤å…¶å®ç° <code>Iterable</code> æ¥å£ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ€»èƒ½æ‹¥æœ‰æºä»£ç çš„æ§åˆ¶æƒï¼Œå¹¶ä¸”ï¼Œé™¤éå¿…é¡»è¿™ä¹ˆåšï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬ä¹Ÿä¸æ„¿æ„é‡å†™ä¸€ä¸ªç±»ã€‚è€Œä¸”æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª <em>é€‚é…å™¨</em> (Adapter) æ¥å®ç°æ‰€éœ€çš„æ¥å£ï¼Œæˆ‘ä»¬åœ¨å‰é¢ä»‹ç»è¿‡è¿™ä¸ªè®¾è®¡æ¨¡å¼ã€‚</p><p>æœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°é€‚é…å™¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿æ¥åˆ›å»ºé€‚é…å™¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/IterableFibonacci.java</span></span><br><span class="line"><span class="comment">// Adapt the Fibonacci class to make it Iterable</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterableFibonacci</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">Fibonacci</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IterableFibonacci</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123; n = count; &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> n &gt; <span class="number">0</span>; &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                n--;</span><br><span class="line">                <span class="keyword">return</span> IterableFibonacci.<span class="keyword">this</span>.get();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; <span class="comment">// Not implemented</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i : <span class="keyword">new</span> IterableFibonacci(<span class="number">18</span>))</span><br><span class="line">            System.out.print(i + <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">13</span> <span class="number">21</span> <span class="number">34</span> <span class="number">55</span> <span class="number">89</span> <span class="number">144</span> <span class="number">233</span> <span class="number">377</span> <span class="number">610</span> <span class="number">987</span> <span class="number">1597</span> <span class="number">2584</span></span><br></pre></td></tr></table></figure><p>åœ¨ <em>for-in</em> è¯­å¥ä¸­ä½¿ç”¨ <code>IterableFibonacci</code>ï¼Œå¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­æä¾›ä¸€ä¸ªè¾¹ç•Œå€¼ï¼Œè¿™æ · <code>hasNext()</code> æ‰çŸ¥é“ä½•æ—¶è¿”å› <strong>false</strong>ï¼Œç»“æŸå¾ªç¯ã€‚</p><!-- Generic Methods --><h2 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç ”ç©¶äº†å‚æ•°åŒ–æ•´ä¸ªç±»ã€‚å…¶å®è¿˜å¯ä»¥å‚æ•°åŒ–ç±»ä¸­çš„æ–¹æ³•ã€‚ç±»æœ¬èº«å¯èƒ½æ˜¯æ³›å‹çš„ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œä¸è¿‡è¿™ä¸å®ƒçš„æ–¹æ³•æ˜¯å¦æ˜¯æ³›å‹çš„å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚</p><p>æ³›å‹æ–¹æ³•ç‹¬ç«‹äºç±»è€Œæ”¹å˜æ–¹æ³•ã€‚ä½œä¸ºå‡†åˆ™ï¼Œè¯·â€œå°½å¯èƒ½â€ä½¿ç”¨æ³›å‹æ–¹æ³•ã€‚é€šå¸¸å°†å•ä¸ªæ–¹æ³•æ³›å‹åŒ–è¦æ¯”å°†æ•´ä¸ªç±»æ³›å‹åŒ–æ›´æ¸…æ™°æ˜“æ‡‚ã€‚</p><p>å¦‚æœæ–¹æ³•æ˜¯ <strong>static</strong> çš„ï¼Œåˆ™æ— æ³•è®¿é—®è¯¥ç±»çš„æ³›å‹ç±»å‹å‚æ•°ï¼Œå› æ­¤ï¼Œå¦‚æœä½¿ç”¨äº†æ³›å‹ç±»å‹å‚æ•°ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯æ³›å‹æ–¹æ³•ã€‚</p><p>è¦å®šä¹‰æ³›å‹æ–¹æ³•ï¼Œè¯·å°†æ³›å‹å‚æ•°åˆ—è¡¨æ”¾ç½®åœ¨è¿”å›å€¼ä¹‹å‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericMethods.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericMethods</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        System.out.println(x.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericMethods gm = <span class="keyword">new</span> GenericMethods();</span><br><span class="line">        gm.f(<span class="string">""</span>);</span><br><span class="line">        gm.f(<span class="number">1</span>);</span><br><span class="line">        gm.f(<span class="number">1.0</span>);</span><br><span class="line">        gm.f(<span class="number">1.0F</span>);</span><br><span class="line">        gm.f(<span class="string">'c'</span>);</span><br><span class="line">        gm.f(gm);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">java.lang.String</span></span><br><span class="line"><span class="comment">java.lang.Integer</span></span><br><span class="line"><span class="comment">java.lang.Double</span></span><br><span class="line"><span class="comment">java.lang.Float</span></span><br><span class="line"><span class="comment">java.lang.Character</span></span><br><span class="line"><span class="comment">GenericMethods</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å°½ç®¡å¯ä»¥åŒæ—¶å¯¹ç±»åŠå…¶æ–¹æ³•è¿›è¡Œå‚æ•°åŒ–ï¼Œä½†è¿™é‡Œæœªå°† <strong>GenericMethods</strong> ç±»å‚æ•°åŒ–ã€‚åªæœ‰æ–¹æ³• <code>f()</code> å…·æœ‰ç±»å‹å‚æ•°ï¼Œè¯¥å‚æ•°ç”±æ–¹æ³•è¿”å›ç±»å‹ä¹‹å‰çš„å‚æ•°åˆ—è¡¨æŒ‡ç¤ºã€‚</p><p>å¯¹äºæ³›å‹ç±»ï¼Œå¿…é¡»åœ¨å®ä¾‹åŒ–è¯¥ç±»æ—¶æŒ‡å®šç±»å‹å‚æ•°ã€‚ä½¿ç”¨æ³›å‹æ–¹æ³•æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦æŒ‡å®šå‚æ•°ç±»å‹ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šæ‰¾å‡ºè¿™äº›ç±»å‹ã€‚ è¿™ç§°ä¸º <em>ç±»å‹å‚æ•°æ¨æ–­</em>ã€‚å› æ­¤ï¼Œå¯¹ <code>f()</code> çš„è°ƒç”¨çœ‹èµ·æ¥åƒæ™®é€šçš„æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸” <code>f()</code> çœ‹èµ·æ¥åƒè¢«é‡è½½äº†æ— æ•°æ¬¡ä¸€æ ·ã€‚å®ƒç”šè‡³ä¼šæ¥å— <strong>GenericMethods</strong> ç±»å‹çš„å‚æ•°ã€‚</p><p>å¦‚æœä½¿ç”¨åŸºæœ¬ç±»å‹è°ƒç”¨ <code>f()</code> ï¼Œè‡ªåŠ¨è£…ç®±å°±å¼€å§‹èµ·ä½œç”¨ï¼Œè‡ªåŠ¨å°†åŸºæœ¬ç±»å‹åŒ…è£…åœ¨å®ƒä»¬å¯¹åº”çš„åŒ…è£…ç±»å‹ä¸­ã€‚</p><!-- Varargs and Generic Methods --><h3 id="å˜é•¿å‚æ•°å’Œæ³›å‹æ–¹æ³•"><a href="#å˜é•¿å‚æ•°å’Œæ³›å‹æ–¹æ³•" class="headerlink" title="å˜é•¿å‚æ•°å’Œæ³›å‹æ–¹æ³•"></a>å˜é•¿å‚æ•°å’Œæ³›å‹æ–¹æ³•</h3><p>æ³›å‹æ–¹æ³•å’Œå˜é•¿å‚æ•°åˆ—è¡¨å¯ä»¥å¾ˆå¥½åœ°å…±å­˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericVarargs.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericVarargs</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SafeVarargs</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">makeList</span><span class="params">(T... args)</span> </span>&#123;</span><br><span class="line">        List&lt;T&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (T item : args)</span><br><span class="line">            result.add(item);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; ls = makeList(<span class="string">"A"</span>);</span><br><span class="line">        System.out.println(ls);</span><br><span class="line">        ls = makeList(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>);</span><br><span class="line">        System.out.println(ls);</span><br><span class="line">        ls = makeList(</span><br><span class="line">                <span class="string">"ABCDEFFHIJKLMNOPQRSTUVWXYZ"</span>.split(<span class="string">""</span>));</span><br><span class="line">        System.out.println(ls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[A]</span></span><br><span class="line"><span class="comment">[A, B, C]</span></span><br><span class="line"><span class="comment">[A, B, C, D, E, F, F, H, I, J, K, L, M, N, O, P, Q, R,</span></span><br><span class="line"><span class="comment">S, T, U, V, W, X, Y, Z]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„æ˜¾ç¤ºçš„ <code>makeList()</code> æ–¹æ³•äº§ç”Ÿçš„åŠŸèƒ½ä¸æ ‡å‡†åº“çš„ <code>java.util.Arrays.asList()</code> æ–¹æ³•ç›¸åŒã€‚</p><p><code>@SafeVarargs</code> æ³¨è§£ä¿è¯æˆ‘ä»¬ä¸ä¼šå¯¹å˜é•¿å‚æ•°åˆ—è¡¨è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªä»ä¸­è¯»å–ã€‚å¦‚æœæ²¡æœ‰æ­¤æ³¨è§£ï¼Œç¼–è¯‘å™¨å°†æ— æ³•çŸ¥é“è¿™äº›å¹¶ä¼šå‘å‡ºè­¦å‘Šã€‚</p><!-- A General-Purpose Supplier --><h3 id="ä¸€ä¸ªæ³›å‹çš„-Supplier"><a href="#ä¸€ä¸ªæ³›å‹çš„-Supplier" class="headerlink" title="ä¸€ä¸ªæ³›å‹çš„ Supplier"></a>ä¸€ä¸ªæ³›å‹çš„ Supplier</h3><p>è¿™æ˜¯ä¸€ä¸ªä¸ºä»»æ„å…·æœ‰æ— å‚æ„é€ æ–¹æ³•çš„ç±»ç”Ÿæˆ <strong>Supplier</strong> çš„ç±»ã€‚ä¸ºäº†å‡å°‘é”®å…¥ï¼Œå®ƒè¿˜åŒ…æ‹¬ä¸€ä¸ªç”¨äºç”Ÿæˆ <strong>BasicSupplier</strong> çš„æ³›å‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/BasicSupplier.java</span></span><br><span class="line"><span class="comment">// Supplier from a class with a no-arg constructor</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicSupplier</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicSupplier</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Assumes type is a public class:</span></span><br><span class="line">            <span class="keyword">return</span> type.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException |</span><br><span class="line">                IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Produce a default Supplier from a type token:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Supplier&lt;T&gt; <span class="title">create</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BasicSupplier&lt;&gt;(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ç±»æä¾›äº†äº§ç”Ÿä»¥ä¸‹å¯¹è±¡çš„åŸºæœ¬å®ç°ï¼š</p><ol><li><p>æ˜¯ <strong>public</strong> çš„ã€‚ å› ä¸º <strong>BasicSupplier</strong> åœ¨å•ç‹¬çš„åŒ…ä¸­ï¼Œæ‰€ä»¥ç›¸å…³çš„ç±»å¿…é¡»å…·æœ‰ <strong>public</strong> æƒé™ï¼Œè€Œä¸ä»…ä»…æ˜¯åŒ…çº§è®¿é—®æƒé™ã€‚</p></li><li><p>å…·æœ‰æ— å‚æ„é€ æ–¹æ³•ã€‚è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ <strong>BasicSupplier</strong> å¯¹è±¡ï¼Œè¯·è°ƒç”¨ <code>create()</code> æ–¹æ³•ï¼Œå¹¶å°†è¦ç”Ÿæˆç±»å‹çš„ç±»å‹ä»¤ç‰Œä¼ é€’ç»™å®ƒã€‚é€šç”¨çš„ <code>create()</code> æ–¹æ³•æä¾›äº† <code>BasicSupplier.create(MyType.class)</code> è¿™ç§è¾ƒç®€æ´çš„è¯­æ³•æ¥ä»£æ›¿è¾ƒç¬¨æ‹™çš„ <code>new BasicSupplier &lt;MyType&gt;(MyType.class)</code>ã€‚</p></li></ol><p>ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªå…·æœ‰æ— å‚æ„é€ æ–¹æ³•çš„ç®€å•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CountedObject.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountedObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"CountedObject "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CountedObject</strong> ç±»å¯ä»¥è·Ÿè¸ªè‡ªèº«åˆ›å»ºäº†å¤šå°‘ä¸ªå®ä¾‹ï¼Œå¹¶é€šè¿‡ <code>toString()</code> æŠ¥å‘Šè¿™äº›å®ä¾‹çš„æ•°é‡ã€‚ <strong>BasicSupplier</strong> å¯ä»¥è½»æ¾åœ°ä¸º <strong>CountedObject</strong> åˆ›å»º <strong>Supplier</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// generics/BasicSupplierDemo.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.BasicSupplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicSupplierDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.generate(</span><br><span class="line">                BasicSupplier.create(CountedObject.class))</span><br><span class="line">                .limit(<span class="number">5</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">CountedObject 0</span></span><br><span class="line"><span class="comment">CountedObject 1</span></span><br><span class="line"><span class="comment">CountedObject 2</span></span><br><span class="line"><span class="comment">CountedObject 3</span></span><br><span class="line"><span class="comment">CountedObject 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ³›å‹æ–¹æ³•å‡å°‘äº†äº§ç”Ÿ <strong>Supplier</strong> å¯¹è±¡æ‰€éœ€çš„ä»£ç é‡ã€‚ Java æ³›å‹å¼ºåˆ¶ä¼ é€’ <strong>Class</strong> å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ <code>create()</code> æ–¹æ³•ä¸­å°†å…¶ç”¨äºç±»å‹æ¨æ–­ã€‚</p><!-- Simplifying Tuple Use --><h3 id="ç®€åŒ–å…ƒç»„çš„ä½¿ç”¨"><a href="#ç®€åŒ–å…ƒç»„çš„ä½¿ç”¨" class="headerlink" title="ç®€åŒ–å…ƒç»„çš„ä½¿ç”¨"></a>ç®€åŒ–å…ƒç»„çš„ä½¿ç”¨</h3><p>ä½¿ç”¨ç±»å‹å‚æ•°æ¨æ–­å’Œé™æ€å¯¼å…¥ï¼Œæˆ‘ä»¬å°†æŠŠæ—©æœŸçš„å…ƒç»„é‡å†™ä¸ºæ›´é€šç”¨çš„åº“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨é‡è½½çš„é™æ€æ–¹æ³•åˆ›å»ºå…ƒç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Tuple.java</span></span><br><span class="line"><span class="comment">// Tuple library using type argument inference</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A, B&gt; <span class="function">Tuple2&lt;A, B&gt; <span class="title">tuple</span><span class="params">(A a, B b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A, B, C&gt; Tuple3&lt;A, B, C&gt;</span><br><span class="line">    tuple(A a, B b, C c) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple3&lt;&gt;(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A, B, C, D&gt; Tuple4&lt;A, B, C, D&gt;</span><br><span class="line">    tuple(A a, B b, C c, D d) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple4&lt;&gt;(a, b, c, d);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A, B, C, D, E&gt;</span><br><span class="line">    <span class="function">Tuple5&lt;A, B, C, D, E&gt; <span class="title">tuple</span><span class="params">(A a, B b, C c, D d, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple5&lt;&gt;(a, b, c, d, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹ <strong>TupleTest.java</strong> æ¥æµ‹è¯• <strong>Tuple.java</strong> :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/TupleTest2.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.Tuple2;</span><br><span class="line"><span class="keyword">import</span> onjava.Tuple3;</span><br><span class="line"><span class="keyword">import</span> onjava.Tuple4;</span><br><span class="line"><span class="keyword">import</span> onjava.Tuple5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.Tuple.tuple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TupleTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple2&lt;String, Integer&gt; <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tuple(<span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple2 <span class="title">f2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tuple(<span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple3&lt;Amphibian, String, Integer&gt; <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tuple(<span class="keyword">new</span> Amphibian(), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Tuple4&lt;Vehicle, Amphibian, String, Integer&gt; <span class="title">h</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tuple(</span><br><span class="line">                <span class="keyword">new</span> Vehicle(), <span class="keyword">new</span> Amphibian(), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Tuple5&lt;Vehicle, Amphibian,</span><br><span class="line">            String, Integer, Double&gt; k() &#123;</span><br><span class="line">        <span class="keyword">return</span> tuple(<span class="keyword">new</span> Vehicle(), <span class="keyword">new</span> Amphibian(),</span><br><span class="line">                <span class="string">"hi"</span>, <span class="number">47</span>, <span class="number">11.1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tuple2&lt;String, Integer&gt; ttsi = f();</span><br><span class="line">        System.out.println(ttsi);</span><br><span class="line">        System.out.println(f2());</span><br><span class="line">        System.out.println(g());</span><br><span class="line">        System.out.println(h());</span><br><span class="line">        System.out.println(k());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">(hi, 47)</span></span><br><span class="line"><span class="comment">(hi, 47)</span></span><br><span class="line"><span class="comment">(Amphibian@14ae5a5, hi, 47)</span></span><br><span class="line"><span class="comment">(Vehicle@135fbaa4, Amphibian@45ee12a7, hi, 47)</span></span><br><span class="line"><span class="comment">(Vehicle@4b67cf4d, Amphibian@7ea987ac, hi, 47, 11.1)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>f()</code> è¿”å›ä¸€ä¸ªå‚æ•°åŒ–çš„ <strong>Tuple2</strong> å¯¹è±¡ï¼Œè€Œ <code>f2()</code> è¿”å›ä¸€ä¸ªæœªå‚æ•°åŒ–çš„ <strong>Tuple2</strong> å¯¹è±¡ã€‚ç¼–è¯‘å™¨ä¸ä¼šåœ¨è¿™é‡Œè­¦å‘Š <code>f2()</code> ï¼Œå› ä¸ºè¿”å›å€¼æœªä»¥å‚æ•°åŒ–æ–¹å¼ä½¿ç”¨ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒè¢«â€œå‘ä¸Šè½¬å‹â€ä¸ºä¸€ä¸ªæœªå‚æ•°åŒ–çš„ <strong>Tuple2</strong> ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°è¯•å°† <code>f2()</code> çš„ç»“æœæ”¾å…¥åˆ°å‚æ•°åŒ–çš„ <strong>Tuple2</strong> ä¸­ï¼Œåˆ™ç¼–è¯‘å™¨å°†å‘å‡ºè­¦å‘Šã€‚</p><!-- A Set Utility --><h3 id="ä¸€ä¸ª-Set-å·¥å…·"><a href="#ä¸€ä¸ª-Set-å·¥å…·" class="headerlink" title="ä¸€ä¸ª Set å·¥å…·"></a>ä¸€ä¸ª Set å·¥å…·</h3><p>å¯¹äºæ³›å‹æ–¹æ³•çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯·è€ƒè™‘ç”± <strong>Set</strong> è¡¨ç¤ºçš„æ•°å­¦å…³ç³»ã€‚è¿™äº›è¢«æ–¹ä¾¿åœ°å®šä¹‰ä¸ºå¯ç”¨äºæ‰€æœ‰ä¸åŒç±»å‹çš„æ³›å‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Sets.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">union</span><span class="params">(Set&lt;T&gt; a, Set&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        Set&lt;T&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;(a);</span><br><span class="line">        result.addAll(b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;</span><br><span class="line">    <span class="function">Set&lt;T&gt; <span class="title">intersection</span><span class="params">(Set&lt;T&gt; a, Set&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        Set&lt;T&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;(a);</span><br><span class="line">        result.retainAll(b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Subtract subset from superset:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Set&lt;T&gt;</span><br><span class="line">    difference(Set&lt;T&gt; superset, Set&lt;T&gt; subset) &#123;</span><br><span class="line">        Set&lt;T&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;(superset);</span><br><span class="line">        result.removeAll(subset);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reflexive--everything not in the intersection:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">complement</span><span class="params">(Set&lt;T&gt; a, Set&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> difference(union(a, b), intersection(a, b));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ä¸‰ä¸ªæ–¹æ³•é€šè¿‡å°†ç¬¬ä¸€ä¸ªå‚æ•°çš„å¼•ç”¨å¤åˆ¶åˆ°æ–°çš„ <strong>HashSet</strong> å¯¹è±¡ä¸­æ¥å¤åˆ¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤ä¸ä¼šç›´æ¥ä¿®æ”¹å‚æ•°é›†åˆã€‚å› æ­¤ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ–°çš„ <strong>Set</strong> å¯¹è±¡ã€‚</p><p>è¿™å››ç§æ–¹æ³•ä»£è¡¨æ•°å­¦é›†åˆæ“ä½œï¼š <code>union()</code> è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå‚æ•°å¹¶é›†çš„ <strong>Set</strong> ï¼Œ <code>intersection()</code> è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå‚æ•°é›†åˆäº¤é›†çš„ <strong>Set</strong> ï¼Œ <code>difference()</code> ä» <strong>superset</strong> ä¸­å‡å» <strong>subset</strong> çš„å…ƒç´  ï¼Œè€Œ <code>complement()</code> è¿”å›æ‰€æœ‰ä¸åœ¨äº¤é›†ä¸­çš„å…ƒç´ çš„ <strong>Set</strong>ã€‚ä½œä¸ºæ˜¾ç¤ºè¿™äº›æ–¹æ³•æ•ˆæœçš„ç®€å•ç¤ºä¾‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«ä¸åŒæ°´å½©åç§°çš„ <strong>enum</strong> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/watercolors/Watercolors.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> watercolors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Watercolors &#123;</span><br><span class="line">    ZINC, LEMON_YELLOW, MEDIUM_YELLOW, DEEP_YELLOW,</span><br><span class="line">    ORANGE, BRILLIANT_RED, CRIMSON, MAGENTA,</span><br><span class="line">    ROSE_MADDER, VIOLET, CERULEAN_BLUE_HUE,</span><br><span class="line">    PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE,</span><br><span class="line">    PERMANENT_GREEN, VIRIDIAN_HUE, SAP_GREEN,</span><br><span class="line">    YELLOW_OCHRE, BURNT_SIENNA, RAW_UMBER,</span><br><span class="line">    BURNT_UMBER, PAYNES_GRAY, IVORY_BLACK</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ˆä¸å¿…å…¨é™å®šæ‰€æœ‰åç§°ï¼‰ï¼Œå°†å…¶é™æ€å¯¼å…¥åˆ°ä»¥ä¸‹ç¤ºä¾‹ä¸­ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨ <strong>EnumSet</strong> è½»æ¾ä» <strong>enum</strong> ä¸­åˆ›å»º <strong>Set</strong> ã€‚ï¼ˆå¯ä»¥åœ¨<a href="book/22-Enumerations.md">ç¬¬äºŒåäºŒç«  æšä¸¾</a>ä¸€ç« ä¸­äº†è§£æœ‰å…³ <strong>EnumSet</strong> çš„æ›´å¤šä¿¡æ¯ã€‚ï¼‰åœ¨è¿™é‡Œï¼Œé™æ€æ–¹æ³• <code>EnumSet.range()</code> è¦æ±‚æä¾›æ‰€è¦åœ¨ç»“æœ <strong>Set</strong> ä¸­åˆ›å»ºçš„å…ƒç´ èŒƒå›´çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/WatercolorSets.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> watercolors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EnumSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> watercolors.Watercolors.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.Sets.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WatercolorSets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;Watercolors&gt; set1 =</span><br><span class="line">                EnumSet.range(BRILLIANT_RED, VIRIDIAN_HUE);</span><br><span class="line">        Set&lt;Watercolors&gt; set2 =</span><br><span class="line">                EnumSet.range(CERULEAN_BLUE_HUE, BURNT_UMBER);</span><br><span class="line">        System.out.println(<span class="string">"set1: "</span> + set1);</span><br><span class="line">        System.out.println(<span class="string">"set2: "</span> + set2);</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"union(set1, set2): "</span> + union(set1, set2));</span><br><span class="line">        Set&lt;Watercolors&gt; subset = intersection(set1, set2);</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"intersection(set1, set2): "</span> + subset);</span><br><span class="line">        System.out.println(<span class="string">"difference(set1, subset): "</span> +</span><br><span class="line">                difference(set1, subset));</span><br><span class="line">        System.out.println(<span class="string">"difference(set2, subset): "</span> +</span><br><span class="line">                difference(set2, subset));</span><br><span class="line">        System.out.println(<span class="string">"complement(set1, set2): "</span> +</span><br><span class="line">                complement(set1, set2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">set1: [BRILLIANT_RED, CRIMSON, MAGENTA, ROSE_MADDER,</span></span><br><span class="line"><span class="comment">VIOLET, CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE,</span></span><br><span class="line"><span class="comment">COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE]</span></span><br><span class="line"><span class="comment">set2: [CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE,</span></span><br><span class="line"><span class="comment">COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE,</span></span><br><span class="line"><span class="comment">SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, RAW_UMBER,</span></span><br><span class="line"><span class="comment">BURNT_UMBER]</span></span><br><span class="line"><span class="comment">union(set1, set2): [BURNT_SIENNA, BRILLIANT_RED,</span></span><br><span class="line"><span class="comment">YELLOW_OCHRE, MAGENTA, SAP_GREEN, CERULEAN_BLUE_HUE,</span></span><br><span class="line"><span class="comment">ULTRAMARINE, VIRIDIAN_HUE, VIOLET, RAW_UMBER,</span></span><br><span class="line"><span class="comment">ROSE_MADDER, PERMANENT_GREEN, BURNT_UMBER,</span></span><br><span class="line"><span class="comment">PHTHALO_BLUE, CRIMSON, COBALT_BLUE_HUE]</span></span><br><span class="line"><span class="comment">intersection(set1, set2): [PERMANENT_GREEN,</span></span><br><span class="line"><span class="comment">CERULEAN_BLUE_HUE, ULTRAMARINE, VIRIDIAN_HUE,</span></span><br><span class="line"><span class="comment">PHTHALO_BLUE, COBALT_BLUE_HUE]</span></span><br><span class="line"><span class="comment">difference(set1, subset): [BRILLIANT_RED, MAGENTA,</span></span><br><span class="line"><span class="comment">VIOLET, CRIMSON, ROSE_MADDER]</span></span><br><span class="line"><span class="comment">difference(set2, subset): [BURNT_SIENNA, YELLOW_OCHRE,</span></span><br><span class="line"><span class="comment">BURNT_UMBER, SAP_GREEN, RAW_UMBER]</span></span><br><span class="line"><span class="comment">complement(set1, set2): [BURNT_SIENNA, BRILLIANT_RED,</span></span><br><span class="line"><span class="comment">YELLOW_OCHRE, MAGENTA, SAP_GREEN, VIOLET, RAW_UMBER,</span></span><br><span class="line"><span class="comment">ROSE_MADDER, BURNT_UMBER, CRIMSON]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„ä¾‹å­ä½¿ç”¨ <code>Sets.difference()</code> æ–¹æ³•æ¥å±•ç¤º <strong>java.util</strong> åŒ…ä¸­å„ç§ <strong>Collection</strong> å’Œ <strong>Map</strong> ç±»ä¹‹é—´çš„æ–¹æ³•å·®å¼‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/CollectionMethodDifferences.java</span></span><br><span class="line"><span class="comment">// &#123;java onjava.CollectionMethodDifferences&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionMethodDifferences</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Set&lt;String&gt; <span class="title">methodSet</span><span class="params">(Class&lt;?&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(type.getMethods())</span><br><span class="line">                .map(Method::getName)</span><br><span class="line">                .collect(Collectors.toCollection(TreeSet::<span class="keyword">new</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">interfaces</span><span class="params">(Class&lt;?&gt; type)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"Interfaces in "</span> +</span><br><span class="line">                type.getSimpleName() + <span class="string">": "</span>);</span><br><span class="line">        System.out.println(</span><br><span class="line">                Arrays.stream(type.getInterfaces())</span><br><span class="line">                        .map(Class::getSimpleName)</span><br><span class="line">                        .collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Set&lt;String&gt; object = methodSet(Object.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        object.add(<span class="string">"clone"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">    difference(Class&lt;?&gt; superset, Class&lt;?&gt; subset) &#123;</span><br><span class="line">        System.out.print(superset.getSimpleName() +</span><br><span class="line">                <span class="string">" extends "</span> + subset.getSimpleName() +</span><br><span class="line">                <span class="string">", adds: "</span>);</span><br><span class="line">        Set&lt;String&gt; comp = Sets.difference(</span><br><span class="line">                methodSet(superset), methodSet(subset));</span><br><span class="line">        comp.removeAll(object); <span class="comment">// Ignore 'Object' methods</span></span><br><span class="line">        System.out.println(comp);</span><br><span class="line">        interfaces(superset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Collection: "</span> +</span><br><span class="line">                methodSet(Collection.class));</span><br><span class="line">        interfaces(Collection.class);</span><br><span class="line">        difference(Set.class, Collection.class);</span><br><span class="line">        difference(HashSet.class, Set.class);</span><br><span class="line">        difference(LinkedHashSet.class, HashSet.class);</span><br><span class="line">        difference(TreeSet.class, Set.class);</span><br><span class="line">        difference(List.class, Collection.class);</span><br><span class="line">        difference(ArrayList.class, List.class);</span><br><span class="line">        difference(LinkedList.class, List.class);</span><br><span class="line">        difference(Queue.class, Collection.class);</span><br><span class="line">        difference(PriorityQueue.class, Queue.class);</span><br><span class="line">        System.out.println(<span class="string">"Map: "</span> + methodSet(Map.class));</span><br><span class="line">        difference(HashMap.class, Map.class);</span><br><span class="line">        difference(LinkedHashMap.class, HashMap.class);</span><br><span class="line">        difference(SortedMap.class, Map.class);</span><br><span class="line">        difference(TreeMap.class, Map.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Collection: [add, addAll, clear, contains, containsAll,</span></span><br><span class="line"><span class="comment">equals, forEach, hashCode, isEmpty, iterator,</span></span><br><span class="line"><span class="comment">parallelStream, remove, removeAll, removeIf, retainAll,</span></span><br><span class="line"><span class="comment">size, spliterator, stream, toArray]</span></span><br><span class="line"><span class="comment">Interfaces in Collection: [Iterable]</span></span><br><span class="line"><span class="comment">Set extends Collection, adds: []</span></span><br><span class="line"><span class="comment">Interfaces in Set: [Collection]</span></span><br><span class="line"><span class="comment">HashSet extends Set, adds: []</span></span><br><span class="line"><span class="comment">Interfaces in HashSet: [Set, Cloneable, Serializable]</span></span><br><span class="line"><span class="comment">LinkedHashSet extends HashSet, adds: []</span></span><br><span class="line"><span class="comment">Interfaces in LinkedHashSet: [Set, Cloneable,</span></span><br><span class="line"><span class="comment">Serializable]</span></span><br><span class="line"><span class="comment">TreeSet extends Set, adds: [headSet,</span></span><br><span class="line"><span class="comment">descendingIterator, descendingSet, pollLast, subSet,</span></span><br><span class="line"><span class="comment">floor, tailSet, ceiling, last, lower, comparator,</span></span><br><span class="line"><span class="comment">pollFirst, first, higher]</span></span><br><span class="line"><span class="comment">Interfaces in TreeSet: [NavigableSet, Cloneable,</span></span><br><span class="line"><span class="comment">Serializable]</span></span><br><span class="line"><span class="comment">List extends Collection, adds: [replaceAll, get,</span></span><br><span class="line"><span class="comment">indexOf, subList, set, sort, lastIndexOf, listIterator]</span></span><br><span class="line"><span class="comment">Interfaces in List: [Collection]</span></span><br><span class="line"><span class="comment">ArrayList extends List, adds: [trimToSize,</span></span><br><span class="line"><span class="comment">ensureCapacity]</span></span><br><span class="line"><span class="comment">Interfaces in ArrayList: [List, RandomAccess,</span></span><br><span class="line"><span class="comment">Cloneable, Serializable]</span></span><br><span class="line"><span class="comment">LinkedList extends List, adds: [offerFirst, poll,</span></span><br><span class="line"><span class="comment">getLast, offer, getFirst, removeFirst, element,</span></span><br><span class="line"><span class="comment">removeLastOccurrence, peekFirst, peekLast, push,</span></span><br><span class="line"><span class="comment">pollFirst, removeFirstOccurrence, descendingIterator,</span></span><br><span class="line"><span class="comment">pollLast, removeLast, pop, addLast, peek, offerLast,</span></span><br><span class="line"><span class="comment">addFirst]</span></span><br><span class="line"><span class="comment">Interfaces in LinkedList: [List, Deque, Cloneable,</span></span><br><span class="line"><span class="comment">Serializable]</span></span><br><span class="line"><span class="comment">Queue extends Collection, adds: [poll, peek, offer,</span></span><br><span class="line"><span class="comment">element]</span></span><br><span class="line"><span class="comment">Interfaces in Queue: [Collection]</span></span><br><span class="line"><span class="comment">PriorityQueue extends Queue, adds: [comparator]</span></span><br><span class="line"><span class="comment">Interfaces in PriorityQueue: [Serializable]</span></span><br><span class="line"><span class="comment">Map: [clear, compute, computeIfAbsent,</span></span><br><span class="line"><span class="comment">computeIfPresent, containsKey, containsValue, entrySet,</span></span><br><span class="line"><span class="comment">equals, forEach, get, getOrDefault, hashCode, isEmpty,</span></span><br><span class="line"><span class="comment">keySet, merge, put, putAll, putIfAbsent, remove,</span></span><br><span class="line"><span class="comment">replace, replaceAll, size, values]</span></span><br><span class="line"><span class="comment">HashMap extends Map, adds: []</span></span><br><span class="line"><span class="comment">Interfaces in HashMap: [Map, Cloneable, Serializable]</span></span><br><span class="line"><span class="comment">LinkedHashMap extends HashMap, adds: []</span></span><br><span class="line"><span class="comment">Interfaces in LinkedHashMap: [Map]</span></span><br><span class="line"><span class="comment">SortedMap extends Map, adds: [lastKey, subMap,</span></span><br><span class="line"><span class="comment">comparator, firstKey, headMap, tailMap]</span></span><br><span class="line"><span class="comment">Interfaces in SortedMap: [Map]</span></span><br><span class="line"><span class="comment">TreeMap extends Map, adds: [descendingKeySet,</span></span><br><span class="line"><span class="comment">navigableKeySet, higherEntry, higherKey, floorKey,</span></span><br><span class="line"><span class="comment">subMap, ceilingKey, pollLastEntry, firstKey, lowerKey,</span></span><br><span class="line"><span class="comment">headMap, tailMap, lowerEntry, ceilingEntry,</span></span><br><span class="line"><span class="comment">descendingMap, pollFirstEntry, lastKey, firstEntry,</span></span><br><span class="line"><span class="comment">floorEntry, comparator, lastEntry]</span></span><br><span class="line"><span class="comment">Interfaces in TreeMap: [NavigableMap, Cloneable,</span></span><br><span class="line"><span class="comment">Serializable]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬åäºŒç«  <a href="book/12-Collections.md#æœ¬ç« å°ç»“">é›†åˆçš„æœ¬ç« å°ç»“</a> éƒ¨åˆ†å°†ä¼šç”¨åˆ°è¿™é‡Œçš„è¾“å‡ºç»“æœã€‚</p><!-- Building Complex Models --><h2 id="æ„å»ºå¤æ‚æ¨¡å‹"><a href="#æ„å»ºå¤æ‚æ¨¡å‹" class="headerlink" title="æ„å»ºå¤æ‚æ¨¡å‹"></a>æ„å»ºå¤æ‚æ¨¡å‹</h2><p>æ³›å‹çš„ä¸€ä¸ªé‡è¦å¥½å¤„æ˜¯èƒ½å¤Ÿç®€å•å®‰å…¨åœ°åˆ›å»ºå¤æ‚æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/TupleList.java</span></span><br><span class="line"><span class="comment">// Combining generic types to make complex generic types</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.Tuple4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TupleList</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Tuple4</span>&lt;<span class="title">A</span>, <span class="title">B</span>, <span class="title">C</span>, <span class="title">D</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TupleList&lt;Vehicle, Amphibian, String, Integer&gt; tl =</span><br><span class="line">                <span class="keyword">new</span> TupleList&lt;&gt;();</span><br><span class="line">        tl.add(TupleTest2.h());</span><br><span class="line">        tl.add(TupleTest2.h());</span><br><span class="line">        tl.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">(Vehicle@7cca494b, Amphibian@7ba4f24f, hi, 47)</span></span><br><span class="line"><span class="comment">(Vehicle@3b9a45b3, Amphibian@7699a589, hi, 47)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿™å°†äº§ç”Ÿä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ•°æ®ç»“æ„ï¼Œè€Œæ— éœ€å¤ªå¤šä»£ç ã€‚</p><p>ä¸‹é¢æ˜¯ç¬¬äºŒä¸ªä¾‹å­ã€‚æ¯ä¸ªç±»éƒ½æ˜¯ç»„æˆå—ï¼Œæ€»ä½“åŒ…å«å¾ˆå¤šä¸ªå—ã€‚åœ¨è¿™é‡Œï¼Œè¯¥æ¨¡å‹æ˜¯ä¸€ä¸ªå…·æœ‰è¿‡é“ï¼Œè´§æ¶å’Œäº§å“çš„é›¶å”®å•†åº—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Store.java</span></span><br><span class="line"><span class="comment">// Building a complex model using generic collections</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.Suppliers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    Product(<span class="keyword">int</span> idNumber, String descr, <span class="keyword">double</span> price) &#123;</span><br><span class="line">        id = idNumber;</span><br><span class="line">        description = descr;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">        System.out.println(toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id + <span class="string">": "</span> + description +</span><br><span class="line">                <span class="string">", price: $"</span> + price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priceChange</span><span class="params">(<span class="keyword">double</span> change)</span> </span>&#123;</span><br><span class="line">        price += change;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Supplier&lt;Product&gt; generator =</span><br><span class="line">            <span class="keyword">new</span> Supplier&lt;Product&gt;() &#123;</span><br><span class="line">                <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Product <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Product(rand.nextInt(<span class="number">1000</span>), <span class="string">"Test"</span>,</span><br><span class="line">                            Math.round(</span><br><span class="line">                                    rand.nextDouble() * <span class="number">1000.0</span>) + <span class="number">0.99</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shelf</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Product</span>&gt; </span>&#123;</span><br><span class="line">    Shelf(<span class="keyword">int</span> nProducts) &#123;</span><br><span class="line">        Suppliers.fill(<span class="keyword">this</span>, Product.generator, nProducts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Aisle</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Shelf</span>&gt; </span>&#123;</span><br><span class="line">    Aisle(<span class="keyword">int</span> nShelves, <span class="keyword">int</span> nProducts) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nShelves; i++)</span><br><span class="line">            add(<span class="keyword">new</span> Shelf(nProducts));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckoutStand</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Office</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Store</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Aisle</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;CheckoutStand&gt; checkouts =</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Office office = <span class="keyword">new</span> Office();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Store</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> nAisles, <span class="keyword">int</span> nShelves, <span class="keyword">int</span> nProducts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nAisles; i++)</span><br><span class="line">            add(<span class="keyword">new</span> Aisle(nShelves, nProducts));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (Aisle a : <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">for</span> (Shelf s : a)</span><br><span class="line">                <span class="keyword">for</span> (Product p : s) &#123;</span><br><span class="line">                    result.append(p);</span><br><span class="line">                    result.append(<span class="string">"\n"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Store(<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output: (First 8 Lines)</span></span><br><span class="line"><span class="comment">258: Test, price: $400.99</span></span><br><span class="line"><span class="comment">861: Test, price: $160.99</span></span><br><span class="line"><span class="comment">868: Test, price: $417.99</span></span><br><span class="line"><span class="comment">207: Test, price: $268.99</span></span><br><span class="line"><span class="comment">551: Test, price: $114.99</span></span><br><span class="line"><span class="comment">278: Test, price: $804.99</span></span><br><span class="line"><span class="comment">520: Test, price: $554.99</span></span><br><span class="line"><span class="comment">140: Test, price: $530.99</span></span><br><span class="line"><span class="comment">                  ...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>Store.toString()</code> æ˜¾ç¤ºäº†ç»“æœï¼šå°½ç®¡æœ‰å¤æ‚çš„å±‚æ¬¡ç»“æ„ï¼Œä½†å¤šå±‚çš„é›†åˆä»ç„¶æ˜¯ç±»å‹å®‰å…¨çš„å’Œå¯ç®¡ç†çš„ã€‚ä»¤äººå°è±¡æ·±åˆ»çš„æ˜¯ï¼Œç»„è£…è¿™æ ·çš„æ¨¡å‹å¹¶ä¸éœ€è¦è€—è´¹è¿‡å¤šç²¾åŠ›ã€‚</p><p><strong>Shelf</strong> ä½¿ç”¨ <code>Suppliers.fill()</code> è¿™ä¸ªå®ç”¨ç¨‹åºï¼Œè¯¥å®ç”¨ç¨‹åºæ¥å— <strong>Collection</strong> ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œå¹¶ä½¿ç”¨ <strong>Supplier</strong> ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œä»¥å…ƒç´ çš„æ•°é‡ä¸º <strong>n</strong> ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰æ¥å¡«å……å®ƒã€‚ <strong>Suppliers</strong> ç±»å°†ä¼šåœ¨æœ¬ç« æœ«å°¾å®šä¹‰ï¼Œå…¶ä¸­çš„æ–¹æ³•éƒ½æ˜¯åœ¨æ‰§è¡ŒæŸç§å¡«å……æ“ä½œï¼Œå¹¶åœ¨æœ¬ç« çš„å…¶ä»–ç¤ºä¾‹ä¸­ä½¿ç”¨ã€‚</p><!-- The Mystery of Erasure --><h2 id="æ³›å‹æ“¦é™¤"><a href="#æ³›å‹æ“¦é™¤" class="headerlink" title="æ³›å‹æ“¦é™¤"></a>æ³›å‹æ“¦é™¤</h2><p>å½“æˆ‘ä»¬å¼€å§‹æ›´æ·±å…¥åœ°é’»ç ”æ³›å‹æ—¶ï¼Œä¼šå‘ç°æœ‰å¤§é‡çš„ä¸œè¥¿åˆçœ‹èµ·æ¥æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œå°½ç®¡å¯ä»¥è¯´  <code>ArrayList.class</code>ï¼Œä½†ä¸èƒ½è¯´æˆ <code>ArrayList&lt;Integer&gt;.class</code>ã€‚è€ƒè™‘ä¸‹é¢çš„æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ErasedTypeEquivalence.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErasedTypeEquivalence</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Class c1 = <span class="keyword">new</span> ArrayList&lt;String&gt;().getClass();</span><br><span class="line">        Class c2 = <span class="keyword">new</span> ArrayList&lt;Integer&gt;().getClass();</span><br><span class="line">        System.out.println(c1 == c2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>ArrayList&lt;String&gt;</code> å’Œ <code>ArrayList&lt;Integer&gt;</code> åº”è¯¥æ˜¯ä¸åŒçš„ç±»å‹ã€‚ä¸åŒçš„ç±»å‹ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°è¯•å‘ <code>ArrayList&lt;String&gt;</code> ä¸­æ”¾å…¥ä¸€ä¸ª <code>Integer</code>ï¼Œæ‰€å¾—åˆ°çš„è¡Œä¸ºï¼ˆå¤±è´¥ï¼‰å’Œå‘ <code>ArrayList&lt;Integer&gt;</code> ä¸­æ”¾å…¥ä¸€ä¸ª <code>Integer</code> æ‰€å¾—åˆ°çš„è¡Œä¸ºï¼ˆæˆåŠŸï¼‰å®Œå…¨ä¸åŒã€‚ç„¶è€Œä¸Šé¢çš„ç¨‹åºè®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ç±»å‹ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­æ˜¯å¯¹è¯¥è°œé¢˜çš„è¡¥å……ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/LostInformation.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frob</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fnorkle</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quark</span>&lt;<span class="title">Q</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Particle</span>&lt;<span class="title">POSITION</span>, <span class="title">MOMENTUM</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LostInformation</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Frob&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Map&lt;Frob, Fnorkle&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Quark&lt;Fnorkle&gt; quark = <span class="keyword">new</span> Quark&lt;&gt;();</span><br><span class="line">        Particle&lt;Long, Double&gt; p = <span class="keyword">new</span> Particle&lt;&gt;();</span><br><span class="line">        System.out.println(Arrays.toString(list.getClass().getTypeParameters()));</span><br><span class="line">        System.out.println(Arrays.toString(map.getClass().getTypeParameters()));</span><br><span class="line">        System.out.println(Arrays.toString(quark.getClass().getTypeParameters()));</span><br><span class="line">        System.out.println(Arrays.toString(p.getClass().getTypeParameters()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[E]</span></span><br><span class="line"><span class="comment">[K,V]</span></span><br><span class="line"><span class="comment">[Q]</span></span><br><span class="line"><span class="comment">[POSITION,MOMENTUM]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ ¹æ® JDK æ–‡æ¡£ï¼Œ<strong>Class.getTypeParameters()</strong> â€œè¿”å›ä¸€ä¸ª <strong>TypeVariable</strong> å¯¹è±¡æ•°ç»„ï¼Œè¡¨ç¤ºæ³›å‹å£°æ˜ä¸­å£°æ˜çš„ç±»å‹å‚æ•°â€¦â€ è¿™æš—ç¤ºæˆ‘ä»¬å¯ä»¥å‘ç°è¿™äº›å‚æ•°ç±»å‹ã€‚ä½†æ˜¯æ­£å¦‚ä¸Šä¾‹ä¸­è¾“å‡ºæ‰€ç¤ºï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°ç”¨ä½œå‚æ•°å ä½ç¬¦çš„æ ‡è¯†ç¬¦ï¼Œè¿™å¹¶éæœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p>æ®‹é…·çš„ç°å®æ˜¯ï¼š</p><p>åœ¨æ³›å‹ä»£ç å†…éƒ¨ï¼Œæ— æ³•è·å–ä»»ä½•æœ‰å…³æ³›å‹å‚æ•°ç±»å‹çš„ä¿¡æ¯ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚ç±»å‹å‚æ•°æ ‡è¯†ç¬¦å’Œæ³›å‹è¾¹ç•Œè¿™äº›ä¿¡æ¯ï¼Œä½†æ— æ³•å¾—çŸ¥å®é™…çš„ç±»å‹å‚æ•°ä»è€Œç”¨æ¥åˆ›å»ºç‰¹å®šçš„å®ä¾‹ã€‚å¦‚æœæˆ‘ä»¬æ›¾æ˜¯ C++ ç¨‹åºå‘˜ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹å®ä¼šè®©æˆ‘ä»¬å¾ˆæ²®ä¸§ï¼Œåœ¨ä½¿ç”¨ Java æ³›å‹å·¥ä½œæ—¶ï¼Œå®ƒæ˜¯å¿…é¡»å¤„ç†çš„æœ€åŸºæœ¬çš„é—®é¢˜ã€‚</p><p>Java æ³›å‹æ˜¯ä½¿ç”¨æ“¦é™¤å®ç°çš„ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬åœ¨ä½¿ç”¨æ³›å‹æ—¶ï¼Œä»»ä½•å…·ä½“çš„ç±»å‹ä¿¡æ¯éƒ½è¢«æ“¦é™¤äº†ï¼Œæˆ‘ä»¬å”¯ä¸€çŸ¥é“çš„å°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚å› æ­¤ï¼Œ<code>List&lt;String&gt;</code> å’Œ <code>List&lt;Integer&gt;</code> åœ¨è¿è¡Œæ—¶å®é™…ä¸Šæ˜¯ç›¸åŒçš„ç±»å‹ã€‚å®ƒä»¬éƒ½è¢«æ“¦é™¤æˆåŸç”Ÿç±»å‹ <code>List</code>ã€‚</p><p>ç†è§£æ“¦é™¤å¹¶çŸ¥é“å¦‚ä½•å¤„ç†å®ƒï¼Œæ˜¯æˆ‘ä»¬åœ¨å­¦ä¹  Java æ³›å‹æ—¶é¢ä¸´çš„æœ€å¤§éšœç¢ä¹‹ä¸€ã€‚è¿™ä¹Ÿæ˜¯æœ¬èŠ‚å°†è¦æ¢è®¨çš„å†…å®¹ã€‚</p><h3 id="C-çš„æ–¹å¼"><a href="#C-çš„æ–¹å¼" class="headerlink" title="C++ çš„æ–¹å¼"></a>C++ çš„æ–¹å¼</h3><p>ä¸‹é¢æ˜¯ä½¿ç”¨æ¨¡ç‰ˆçš„ C++ ç¤ºä¾‹ã€‚æˆ‘ä»¬ä¼šçœ‹åˆ°ç±»å‹å‚æ•°çš„è¯­æ³•ååˆ†ç›¸ä¼¼ï¼Œå› ä¸º Java æ˜¯å— C++ å¯å‘çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Templates.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">Manipulator</span> &#123;</span></span><br><span class="line">    T obj;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Manipulator(T x) &#123; obj = x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">manipulate</span><span class="params">()</span> </span>&#123; obj.f(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HasF</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"HasF::f()"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HasF hf;</span><br><span class="line">    Manipulator&lt;HasF&gt; manipulator(hf);</span><br><span class="line">    manipulator.manipulate();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">HasF::f()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>Manipulator</strong> ç±»å­˜å‚¨äº†ä¸€ä¸ª <strong>T</strong> ç±»å‹çš„å¯¹è±¡ã€‚<code>manipulate()</code> æ–¹æ³•ä¼šè°ƒç”¨ <strong>obj</strong> ä¸Šçš„ <code>f()</code> æ–¹æ³•ã€‚å®ƒæ˜¯å¦‚ä½•çŸ¥é“ç±»å‹å‚æ•° <strong>T</strong> ä¸­å­˜åœ¨ <code>f()</code> æ–¹æ³•çš„å‘¢ï¼ŸC++ ç¼–è¯‘å™¨ä¼šåœ¨æˆ‘ä»¬å®ä¾‹åŒ–æ¨¡ç‰ˆæ—¶è¿›è¡Œæ£€æŸ¥ï¼Œæ‰€ä»¥åœ¨ <code>Manipulator&lt;HasF&gt;</code> å®ä¾‹åŒ–çš„é‚£ä¸€åˆ»ï¼Œå®ƒçœ‹åˆ° <strong>HasF</strong> ä¸­å«æœ‰ä¸€ä¸ªæ–¹æ³• <code>f()</code>ã€‚å¦‚æœæƒ…å†µå¹¶éå¦‚æ­¤ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘æœŸé”™è¯¯ï¼Œä¿æŒç±»å‹å®‰å…¨ã€‚</p><p>ç”¨ C++ ç¼–å†™è¿™ç§ä»£ç å¾ˆç®€å•ï¼Œå› ä¸ºå½“æ¨¡ç‰ˆè¢«å®ä¾‹åŒ–æ—¶ï¼Œæ¨¡ç‰ˆä»£ç å°±çŸ¥é“æ¨¡ç‰ˆå‚æ•°çš„ç±»å‹ã€‚Java æ³›å‹å°±ä¸åŒäº†ã€‚ä¸‹é¢æ˜¯ <strong>HasF</strong> çš„ Java ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/HasF.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HasF</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"HasF.f()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å°†ç¤ºä¾‹çš„å…¶ä½™ä»£ç ç”¨ Java å®ç°ï¼Œå°±ä¸ä¼šé€šè¿‡ç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Manipulation.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manipulator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T obj;</span><br><span class="line">    </span><br><span class="line">    Manipulator(T x) &#123;</span><br><span class="line">        obj = x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Error: cannot find symbol: method f():</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">manipulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        obj.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manipulation</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        HasF hf = <span class="keyword">new</span> HasF();</span><br><span class="line">        Manipulator&lt;HasF&gt; manipulator = <span class="keyword">new</span> Manipulator&lt;&gt;(hf);</span><br><span class="line">        manipulator.manipulate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ“¦é™¤ï¼ŒJava ç¼–è¯‘å™¨æ— æ³•å°† <code>manipulate()</code> æ–¹æ³•å¿…é¡»èƒ½è°ƒç”¨ <strong>obj</strong> çš„ <code>f()</code> æ–¹æ³•è¿™ä¸€éœ€æ±‚æ˜ å°„åˆ° HasF å…·æœ‰ <code>f()</code> æ–¹æ³•è¿™ä¸ªäº‹å®ä¸Šã€‚ä¸ºäº†è°ƒç”¨ <code>f()</code>ï¼Œæˆ‘ä»¬å¿…é¡»ååŠ©æ³›å‹ç±»ï¼Œç»™å®šæ³›å‹ç±»ä¸€ä¸ªè¾¹ç•Œï¼Œä»¥æ­¤å‘Šè¯‰ç¼–è¯‘å™¨åªèƒ½æ¥å—éµå¾ªè¿™ä¸ªè¾¹ç•Œçš„ç±»å‹ã€‚è¿™é‡Œé‡ç”¨äº† <strong>extends</strong> å…³é”®å­—ã€‚ç”±äºæœ‰äº†è¾¹ç•Œï¼Œä¸‹é¢çš„ä»£ç å°±èƒ½é€šè¿‡ç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manipulator2</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasF</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T obj;</span><br><span class="line"></span><br><span class="line">    Manipulator2(T x) &#123;</span><br><span class="line">        obj = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">manipulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        obj.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾¹ç•Œ <code>&lt;T extends HasF&gt;</code> å£°æ˜ T å¿…é¡»æ˜¯ HasF ç±»å‹æˆ–å…¶å­ç±»ã€‚å¦‚æœæƒ…å†µç¡®å®å¦‚æ­¤ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨ <strong>obj</strong> ä¸Šè°ƒç”¨ <code>f()</code> æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬è¯´æ³›å‹ç±»å‹å‚æ•°ä¼šæ“¦é™¤åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªè¾¹ç•Œï¼ˆå¯èƒ½æœ‰å¤šä¸ªè¾¹ç•Œï¼Œç¨åæˆ‘ä»¬å°†çœ‹åˆ°ï¼‰ã€‚æˆ‘ä»¬è¿˜æåˆ°äº†ç±»å‹å‚æ•°çš„æ“¦é™¤ã€‚ç¼–è¯‘å™¨å®é™…ä¸Šä¼šæŠŠç±»å‹å‚æ•°æ›¿æ¢ä¸ºå®ƒçš„æ“¦é™¤ï¼Œå°±åƒä¸Šé¢çš„ç¤ºä¾‹ï¼Œ<strong>T</strong> æ“¦é™¤åˆ°äº† <strong>HasF</strong>ï¼Œå°±åƒåœ¨ç±»çš„å£°æ˜ä¸­ç”¨ <strong>HasF</strong> æ›¿æ¢äº† <strong>T</strong> ä¸€æ ·ã€‚</p><p>æˆ‘ä»¬å¯èƒ½æ­£ç¡®åœ°è§‚å¯Ÿåˆ°äº†æ³›å‹åœ¨ <strong>Manipulator2.java</strong> ä¸­æ²¡æœ‰è´¡çŒ®ä»»ä½•äº‹ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è‡ªå·±å»æ‰§è¡Œæ“¦é™¤ï¼Œç”Ÿæˆæ²¡æœ‰æ³›å‹çš„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Manipulator3.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manipulator3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HasF obj;</span><br><span class="line">    </span><br><span class="line">    Manipulator3(HasF x) &#123;</span><br><span class="line">        obj = x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">manipulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        obj.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æå‡ºäº†å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼šæ³›å‹åªæœ‰åœ¨ç±»å‹å‚æ•°æ¯”æŸä¸ªå…·ä½“ç±»å‹ï¼ˆä»¥åŠå…¶å­ç±»ï¼‰æ›´åŠ â€œæ³›åŒ–â€â€”â€”ä»£ç èƒ½è·¨å¤šä¸ªç±»å·¥ä½œæ—¶æ‰æœ‰ç”¨ã€‚å› æ­¤ï¼Œç±»å‹å‚æ•°å’Œå®ƒä»¬åœ¨æœ‰ç”¨çš„æ³›å‹ä»£ç ä¸­çš„åº”ç”¨ï¼Œé€šå¸¸æ¯”ç®€å•çš„ç±»æ›¿æ¢æ›´åŠ å¤æ‚ã€‚ä½†æ˜¯ï¼Œä¸èƒ½å› æ­¤è®¤ä¸ºä½¿ç”¨ <code>&lt;T extends HasF&gt;</code> å½¢å¼å°±æ˜¯æœ‰ç¼ºé™·çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªç±»æœ‰ä¸€ä¸ªè¿”å› <strong>T</strong> çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ³›å‹å°±æœ‰æ‰€å¸®åŠ©ï¼Œå› ä¸ºå®ƒä»¬ä¹‹åå°†è¿”å›ç¡®åˆ‡çš„ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ReturnGenericType.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnGenericType</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasF</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T obj;</span><br><span class="line">    </span><br><span class="line">    ReturnGenericType(T x) &#123;</span><br><span class="line">        obj = x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¿…é¡»æŸ¥çœ‹æ‰€æœ‰çš„ä»£ç ï¼Œä»è€Œç¡®å®šä»£ç æ˜¯å¦å¤æ‚åˆ°å¿…é¡»ä½¿ç”¨æ³›å‹çš„ç¨‹åº¦ã€‚</p><p>æˆ‘ä»¬å°†åœ¨æœ¬ç« ç¨åçœ‹åˆ°æœ‰å…³è¾¹ç•Œçš„æ›´å¤šç»†èŠ‚ã€‚</p><h3 id="è¿ç§»å…¼å®¹æ€§"><a href="#è¿ç§»å…¼å®¹æ€§" class="headerlink" title="è¿ç§»å…¼å®¹æ€§"></a>è¿ç§»å…¼å®¹æ€§</h3><p>ä¸ºäº†å‡å°‘æ½œåœ¨çš„å…³äºæ“¦é™¤çš„å›°æƒ‘ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥šåœ°è®¤è¯†åˆ°è¿™ä¸æ˜¯ä¸€ä¸ªè¯­è¨€ç‰¹æ€§ã€‚å®ƒæ˜¯ Java å®ç°æ³›å‹çš„ä¸€ç§å¦¥åï¼Œå› ä¸ºæ³›å‹ä¸æ˜¯ Java è¯­è¨€å‡ºç°æ—¶å°±æœ‰çš„ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç§å¦¥åã€‚å®ƒä¼šä½¿æˆ‘ä»¬ç—›è‹¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½æ—©ä¹ æƒ¯å®ƒå¹¶äº†è§£ä¸ºä»€ä¹ˆå®ƒä¼šè¿™æ ·ã€‚</p><p>å¦‚æœ Java 1.0 å°±å«æœ‰æ³›å‹çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹æ€§å°±ä¸ä¼šä½¿ç”¨æ“¦é™¤æ¥å®ç°â€”â€”å®ƒä¼šä½¿ç”¨å…·ä½“åŒ–ï¼Œä¿æŒå‚æ•°ç±»å‹ä¸ºç¬¬ä¸€ç±»å®ä½“ï¼Œå› æ­¤æˆ‘ä»¬å°±èƒ½åœ¨ç±»å‹å‚æ•°ä¸Šæ‰§è¡ŒåŸºäºç±»å‹çš„è¯­è¨€æ“ä½œå’Œåå°„æ“ä½œã€‚æœ¬ç« ç¨åæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œæ“¦é™¤å‡å°‘äº†æ³›å‹çš„æ³›åŒ–æ€§ã€‚æ³›å‹åœ¨ Java ä¸­ä»ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œåªæ˜¯ä¸å¦‚å®ƒä»¬æœ¬æ¥è®¾æƒ³çš„é‚£ä¹ˆæœ‰ç”¨ï¼Œè€ŒåŸå› å°±æ˜¯æ“¦é™¤ã€‚</p><p>åœ¨åŸºäºæ“¦é™¤çš„å®ç°ä¸­ï¼Œæ³›å‹ç±»å‹è¢«å½“ä½œç¬¬äºŒç±»ç±»å‹å¤„ç†ï¼Œå³ä¸èƒ½åœ¨æŸäº›é‡è¦çš„ä¸Šä¸‹æ–‡ä½¿ç”¨æ³›å‹ç±»å‹ã€‚æ³›å‹ç±»å‹åªæœ‰åœ¨é™æ€ç±»å‹æ£€æµ‹æœŸé—´æ‰å‡ºç°ï¼Œåœ¨æ­¤ä¹‹åï¼Œç¨‹åºä¸­çš„æ‰€æœ‰æ³›å‹ç±»å‹éƒ½å°†è¢«æ“¦é™¤ï¼Œæ›¿æ¢ä¸ºå®ƒä»¬çš„éæ³›å‹ä¸Šç•Œã€‚ä¾‹å¦‚ï¼Œ <code>List&lt;T&gt;</code> è¿™æ ·çš„ç±»å‹æ³¨è§£ä¼šè¢«æ“¦é™¤ä¸º <strong>List</strong>ï¼Œæ™®é€šçš„ç±»å‹å˜é‡åœ¨æœªæŒ‡å®šè¾¹ç•Œçš„æƒ…å†µä¸‹ä¼šè¢«æ“¦é™¤ä¸º <strong>Object</strong>ã€‚</p><p>æ“¦é™¤çš„æ ¸å¿ƒåŠ¨æœºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æ³›åŒ–çš„å®¢æˆ·ç«¯ä¸Šä½¿ç”¨éæ³›å‹çš„ç±»åº“ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™ç»å¸¸è¢«ç§°ä¸ºâ€œè¿ç§»å…¼å®¹æ€§â€ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äº‹ç‰©å°†åœ¨æŒ‡å®šçš„æŸå¤©è¢«æ³›åŒ–ã€‚åœ¨ç°å®ä¸­ï¼Œå³ä½¿ç¨‹åºå‘˜åªç¼–å†™æ³›å‹ä»£ç ï¼Œä»–ä»¬ä¹Ÿå¿…é¡»å¤„ç† Java 5 ä¹‹å‰ç¼–å†™çš„éæ³›å‹ç±»åº“ã€‚è¿™äº›ç±»åº“çš„ä½œè€…å¯èƒ½ä»æ²¡æƒ³è¿‡è¦æ³›åŒ–ä»–ä»¬çš„ä»£ç ï¼Œæˆ–è®¸ä»–ä»¬å¯èƒ½åˆšåˆšå¼€å§‹æ¥è§¦æ³›å‹ã€‚</p><p>å› æ­¤ Java æ³›å‹ä¸ä»…å¿…é¡»æ”¯æŒå‘åå…¼å®¹æ€§â€”â€”ç°æœ‰çš„ä»£ç å’Œç±»æ–‡ä»¶ä»ç„¶åˆæ³•ï¼Œç»§ç»­ä¿æŒä¹‹å‰çš„å«ä¹‰â€”â€”è€Œä¸”è¿˜å¿…é¡»æ”¯æŒè¿ç§»å…¼å®¹æ€§ï¼Œä½¿å¾—ç±»åº“èƒ½æŒ‰ç…§å®ƒä»¬è‡ªå·±çš„æ­¥è°ƒå˜ä¸ºæ³›å‹ï¼Œå½“æŸä¸ªç±»åº“å˜ä¸ºæ³›å‹æ—¶ï¼Œä¸ä¼šç ´åä¾èµ–äºå®ƒçš„ä»£ç å’Œåº”ç”¨ã€‚åœ¨ç¡®å®šäº†è¿™ä¸ªç›®æ ‡åï¼ŒJava è®¾è®¡è€…ä»¬å’Œä»äº‹æ­¤é—®é¢˜ç›¸å…³å·¥ä½œçš„å„ä¸ªå›¢é˜Ÿå†³ç­–è®¤ä¸ºæ“¦é™¤æ˜¯å”¯ä¸€å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚æ“¦é™¤ä½¿å¾—è¿™ç§å‘æ³›å‹çš„è¿ç§»æˆä¸ºå¯èƒ½ï¼Œå…è®¸éæ³›å‹çš„ä»£ç å’Œæ³›å‹ä»£ç å…±å­˜ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªåº”ç”¨ä½¿ç”¨äº†ä¸¤ä¸ªç±»åº“ <strong>X</strong> å’Œ <strong>Y</strong>ï¼Œ<strong>Y</strong> ä½¿ç”¨äº†ç±»åº“ <strong>Z</strong>ã€‚éšç€ Java 5 çš„å‡ºç°ï¼Œè¿™ä¸ªåº”ç”¨å’Œè¿™äº›ç±»åº“çš„åˆ›å»ºè€…æœ€ç»ˆå¯èƒ½å¸Œæœ›è¿ç§»åˆ°æ³›å‹ä¸Šã€‚ä½†æ˜¯å½“è¿›è¡Œè¿ç§»æ—¶ï¼Œå®ƒä»¬æœ‰ç€ä¸åŒçš„åŠ¨æœºå’Œé™åˆ¶ã€‚ä¸ºäº†å®ç°è¿ç§»å…¼å®¹æ€§ï¼Œæ¯ä¸ªç±»åº“ä¸åº”ç”¨å¿…é¡»ä¸å…¶ä»–æ‰€æœ‰çš„éƒ¨åˆ†æ˜¯å¦ä½¿ç”¨æ³›å‹æ— å…³ã€‚å› æ­¤ï¼Œå®ƒä»¬ä¸èƒ½æ¢æµ‹å…¶ä»–ç±»åº“æ˜¯å¦ä½¿ç”¨äº†æ³›å‹ã€‚å› æ­¤ï¼ŒæŸä¸ªç‰¹å®šçš„ç±»åº“ä½¿ç”¨äº†æ³›å‹è¿™æ ·çš„è¯æ®å¿…é¡»è¢«â€æ“¦é™¤â€œã€‚</p><p>å¦‚æœæ²¡æœ‰æŸç§ç±»å‹çš„è¿ç§»é€”å¾„ï¼Œæ‰€æœ‰å·²ç»æ„å»ºäº†å¾ˆé•¿æ—¶é—´çš„ç±»åº“å°±éœ€è¦ä¸å¸Œæœ›è¿ç§»åˆ° Java æ³›å‹ä¸Šçš„å¼€å‘è€…ä»¬è¯´å†è§äº†ã€‚ç±»åº“æ¯«æ— äº‰è®®æ˜¯ç¼–ç¨‹è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹ç”Ÿäº§æ•ˆç‡æœ‰ç€æå¤§çš„å½±å“ï¼Œæ‰€ä»¥è¿™ç§ä»£ç æ— æ³•æ¥å—ã€‚æ“¦é™¤æ˜¯å¦æ˜¯æœ€ä½³çš„æˆ–å”¯ä¸€çš„è¿ç§»é€”å¾„ï¼Œè¿˜å¾…æ—¶é—´æ¥è¯æ˜ã€‚</p><h3 id="æ“¦é™¤çš„é—®é¢˜"><a href="#æ“¦é™¤çš„é—®é¢˜" class="headerlink" title="æ“¦é™¤çš„é—®é¢˜"></a>æ“¦é™¤çš„é—®é¢˜</h3><p>å› æ­¤ï¼Œæ“¦é™¤ä¸»è¦çš„æ­£å½“ç†ç”±æ˜¯ä»éæ³›åŒ–ä»£ç åˆ°æ³›åŒ–ä»£ç çš„è½¬å˜è¿‡ç¨‹ï¼Œä»¥åŠåœ¨ä¸ç ´åç°æœ‰ç±»åº“çš„æƒ…å†µä¸‹å°†æ³›å‹èå…¥åˆ°è¯­è¨€ä¸­ã€‚æ“¦é™¤å…è®¸æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ç°æœ‰çš„éæ³›å‹å®¢æˆ·ç«¯ä»£ç ï¼Œç›´è‡³å®¢æˆ·ç«¯å‡†å¤‡å¥½ç”¨æ³›å‹é‡å†™è¿™äº›ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªå´‡é«˜çš„åŠ¨æœºï¼Œå› ä¸ºå®ƒä¸ä¼šéª¤ç„¶ç ´åæ‰€æœ‰ç°æœ‰çš„ä»£ç ã€‚</p><p>æ“¦é™¤çš„ä»£ä»·æ˜¯æ˜¾è‘—çš„ã€‚æ³›å‹ä¸èƒ½ç”¨äºæ˜¾å¼åœ°å¼•ç”¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚è½¬å‹ã€<strong>instanceof</strong> æ“ä½œå’Œ <strong>new</strong> è¡¨è¾¾å¼ã€‚å› ä¸ºæ‰€æœ‰å…³äºå‚æ•°çš„ç±»å‹ä¿¡æ¯éƒ½ä¸¢å¤±äº†ï¼Œå½“æˆ‘ä»¬åœ¨ç¼–å†™æ³›å‹ä»£ç æ—¶ï¼Œå¿…é¡»æ—¶åˆ»æé†’è‡ªå·±ï¼Œæˆ‘ä»¬åªæ˜¯çœ‹èµ·æ¥æ‹¥æœ‰æœ‰å…³å‚æ•°çš„ç±»å‹ä¿¡æ¯è€Œå·²ã€‚</p><p>è€ƒè™‘å¦‚ä¸‹çš„ä»£ç æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T var;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>Foo</strong> å®ä¾‹æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foo&lt;Cat&gt; f = <span class="keyword">new</span> Foo&lt;&gt;();</span><br></pre></td></tr></table></figure><p><strong>class</strong> <strong>Foo</strong> ä¸­çš„ä»£ç åº”è¯¥çŸ¥é“ç°åœ¨å·¥ä½œäº <strong>Cat</strong> ä¹‹ä¸Šã€‚æ³›å‹è¯­æ³•ä¹Ÿåœ¨å¼ºçƒˆæš—ç¤ºæ•´ä¸ªç±»ä¸­æ‰€æœ‰ T å‡ºç°çš„åœ°æ–¹éƒ½è¢«æ›¿æ¢ï¼Œå°±åƒåœ¨ C++ ä¸­ä¸€æ ·ã€‚ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ï¼Œå½“æˆ‘ä»¬åœ¨ç¼–å†™è¿™ä¸ªç±»çš„ä»£ç æ—¶ï¼Œå¿…é¡»æé†’è‡ªå·±ï¼šâ€œä¸ï¼Œè¿™åªæ˜¯ä¸€ä¸ª <strong>Object</strong>â€œã€‚</p><p>å¦å¤–ï¼Œæ“¦é™¤å’Œè¿ç§»å…¼å®¹æ€§æ„å‘³ç€ï¼Œä½¿ç”¨æ³›å‹å¹¶ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œå°½ç®¡æˆ‘ä»¬å¯èƒ½å¸Œæœ›è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ErasureAndInheritance.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericBase</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T element;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">        element = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived1</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">GenericBase</span>&lt;<span class="title">T</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived2</span> <span class="keyword">extends</span> <span class="title">GenericBase</span> </span>&#123;&#125; <span class="comment">// No warning</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class Derived3 extends GenericBase&lt;?&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">// Strange error:</span></span><br><span class="line"><span class="comment">// unexpected type</span></span><br><span class="line"><span class="comment">// required: class or interface without bounds</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErasureAndInteritance</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Derived2 d2 = <span class="keyword">new</span> Derived2();</span><br><span class="line">        Object obj = d2.get();</span><br><span class="line">        d2.set(obj); <span class="comment">// Warning here!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Derived2</strong> ç»§æ‰¿è‡ª <strong>GenericBase</strong>ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•ç±»å‹å‚æ•°ï¼Œç¼–è¯‘å™¨æ²¡æœ‰å‘å‡ºä»»ä½•è­¦å‘Šã€‚ç›´åˆ°è°ƒç”¨ <code>set()</code> æ–¹æ³•æ—¶æ‰å‡ºç°è­¦å‘Šã€‚</p><p>ä¸ºäº†å…³é—­è­¦å‘Šï¼ŒJava æä¾›äº†ä¸€ä¸ªæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ³¨è§£æ”¾ç½®åœ¨äº§ç”Ÿè­¦å‘Šçš„æ–¹æ³•ä¸Šï¼Œè€Œä¸æ˜¯æ•´ä¸ªç±»ä¸Šã€‚å½“æˆ‘ä»¬è¦å…³é—­è­¦å‘Šæ—¶ï¼Œæœ€å¥½å°½å¯èƒ½åœ°â€œèšç„¦â€ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºè¿‡äºå®½æ³›åœ°å…³é—­è­¦å‘Šï¼Œè€Œå¯¼è‡´æ„å¤–åœ°é®è”½æ‰çœŸæ­£çš„é—®é¢˜ã€‚</p><p>å¯ä»¥æ¨æ–­ï¼Œ<strong>Derived3</strong> äº§ç”Ÿçš„é”™è¯¯æ„å‘³ç€ç¼–è¯‘å™¨æœŸæœ›å¾—åˆ°ä¸€ä¸ªåŸç”ŸåŸºç±»ã€‚</p><p>å½“æˆ‘ä»¬å¸Œæœ›å°†ç±»å‹å‚æ•°ä¸ä»…ä»…å½“ä½œ Object å¤„ç†æ—¶ï¼Œå°±éœ€è¦ä»˜å‡ºé¢å¤–åŠªåŠ›æ¥ç®¡ç†è¾¹ç•Œï¼Œå¹¶ä¸”ä¸åœ¨ C++ã€Ada å’Œ Eiffel è¿™æ ·çš„è¯­è¨€ä¸­è·å¾—å‚æ•°åŒ–ç±»å‹ç›¸æ¯”ï¼Œæˆ‘ä»¬éœ€è¦ä»˜å‡ºå¤šå¾—å¤šçš„åŠªåŠ›æ¥è·å¾—å°‘å¾—å¤šçš„å›æŠ¥ã€‚è¿™å¹¶ä¸æ˜¯è¯´ï¼Œå¯¹äºå¤§å¤šæ•°çš„ç¼–ç¨‹é—®é¢˜è€Œè¨€ï¼Œè¿™äº›è¯­è¨€é€šå¸¸éƒ½ä¼šæ¯” Java æ›´å¾—å¿ƒåº”æ‰‹ï¼Œåªæ˜¯è¯´å®ƒä»¬çš„å‚æ•°åŒ–ç±»å‹æœºåˆ¶ç›¸æ¯” Java æ›´çµæ´»ã€æ›´å¼ºå¤§ã€‚</p><h3 id="è¾¹ç•Œå¤„çš„åŠ¨ä½œ"><a href="#è¾¹ç•Œå¤„çš„åŠ¨ä½œ" class="headerlink" title="è¾¹ç•Œå¤„çš„åŠ¨ä½œ"></a>è¾¹ç•Œå¤„çš„åŠ¨ä½œ</h3><p>å› ä¸ºæ“¦é™¤ï¼Œæˆ‘å‘ç°äº†æ³›å‹æœ€ä»¤äººå›°æƒ‘çš„æ–¹é¢æ˜¯å¯ä»¥è¡¨ç¤ºæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„äº‹ç‰©ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ArrayMaker.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayMaker</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; kind;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayMaker</span><span class="params">(Class&lt;T&gt; kind)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kind = kind;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    T[] create(<span class="keyword">int</span> size) &#123;</span><br><span class="line">        <span class="keyword">return</span> (T[]) Array.newInstance(kind, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayMaker&lt;String&gt; stringMaker = <span class="keyword">new</span> ArrayMaker&lt;&gt;(String.class);</span><br><span class="line">        String[] stringArray = stringMaker.create(<span class="number">9</span>);</span><br><span class="line">        System.out.println(Arrays.toString(stringArray));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output</span></span><br><span class="line"><span class="comment">[null,null,null,null,null,null,null,null,null]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å³ä½¿ <strong>kind</strong> è¢«å­˜å‚¨ä¸º <code>Class&lt;T&gt;</code>ï¼Œæ“¦é™¤ä¹Ÿæ„å‘³ç€å®ƒå®é™…è¢«å­˜å‚¨ä¸ºæ²¡æœ‰ä»»ä½•å‚æ•°çš„ <strong>Class</strong>ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒæ—¶ï¼Œä¾‹å¦‚åˆ›å»ºæ•°ç»„ï¼Œ<code>Array.newInstance()</code> å®é™…ä¸Šå¹¶æœªæ‹¥æœ‰ <strong>kind</strong> æ‰€è•´å«çš„ç±»å‹ä¿¡æ¯ã€‚æ‰€ä»¥å®ƒä¸ä¼šäº§ç”Ÿå…·ä½“çš„ç»“æœï¼Œå› è€Œå¿…é¡»è½¬å‹ï¼Œè¿™ä¼šäº§ç”Ÿä¸€æ¡ä»¤æˆ‘ä»¬æ— æ³•æ»¡æ„çš„è­¦å‘Šã€‚</p><p>æ³¨æ„ï¼Œå¯¹äºåœ¨æ³›å‹ä¸­åˆ›å»ºæ•°ç»„ï¼Œä½¿ç”¨ <code>Array.newInstance()</code> æ˜¯æ¨èçš„æ–¹å¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé›†åˆè€Œä¸æ˜¯æ•°ç»„ï¼Œæƒ…å†µå°±ä¸åŒäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ListMaker.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListMaker</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ListMaker&lt;String&gt; stringMaker = <span class="keyword">new</span> ListMaker&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; stringList = stringMaker.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸ä¼šç»™å‡ºä»»ä½•è­¦å‘Šï¼Œå°½ç®¡æˆ‘ä»¬çŸ¥é“ï¼ˆä»æ“¦é™¤ä¸­ï¼‰åœ¨ <code>create()</code> å†…éƒ¨çš„ <code>new ArrayList&lt;&gt;()</code> ä¸­çš„ <code>&lt;T&gt;</code> è¢«ç§»é™¤äº†â€”â€”åœ¨è¿è¡Œæ—¶ï¼Œç±»å†…éƒ¨æ²¡æœ‰ä»»ä½• <code>&lt;T&gt;</code>ï¼Œå› æ­¤è¿™çœ‹èµ·æ¥æ¯«æ— æ„ä¹‰ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬éµä»è¿™ç§æ€è·¯ï¼Œå¹¶å°†è¿™ä¸ªè¡¨è¾¾å¼æ”¹ä¸º <code>new ArrayList()</code>ï¼Œç¼–è¯‘å™¨å°±ä¼šå‘å‡ºè­¦å‘Šã€‚</p><p>æœ¬ä¾‹ä¸­è¿™ä¹ˆåšçœŸçš„æ¯«æ— æ„ä¹‰å—ï¼Ÿå¦‚æœåœ¨åˆ›å»º <strong>List</strong> çš„åŒæ—¶å‘å…¶ä¸­æ”¾å…¥ä¸€äº›å¯¹è±¡å‘¢ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/FilledList.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilledList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    FilledList(Supplier&lt;T&gt; gen, <span class="keyword">int</span> size) &#123;</span><br><span class="line">        Suppliers.fill(<span class="keyword">this</span>, gen, size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilledList</span><span class="params">(T t, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> FilledList&lt;&gt;(<span class="string">"Hello"</span>, <span class="number">4</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="comment">// Supplier version:</span></span><br><span class="line">        List&lt;Integer&gt; ilist = <span class="keyword">new</span> FilledList&lt;&gt;(() -&gt; <span class="number">47</span>, <span class="number">4</span>);</span><br><span class="line">        System.out.println(ilist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Hello,Hello,Hello,Hello]</span></span><br><span class="line"><span class="comment">[47,47,47,47]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å³ä½¿ç¼–è¯‘å™¨æ— æ³•å¾—çŸ¥ <code>add()</code> ä¸­çš„ <strong>T</strong> çš„ä»»ä½•ä¿¡æ¯ï¼Œä½†å®ƒä»å¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®ä¿æˆ‘ä»¬æ”¾å…¥ <strong>FilledList</strong> ä¸­çš„å¯¹è±¡æ˜¯ <strong>T</strong> ç±»å‹ã€‚å› æ­¤ï¼Œå³ä½¿æ“¦é™¤ç§»é™¤äº†æ–¹æ³•æˆ–ç±»ä¸­çš„å®é™…ç±»å‹çš„ä¿¡æ¯ï¼Œç¼–è¯‘å™¨ä»å¯ä»¥ç¡®ä¿æ–¹æ³•æˆ–ç±»ä¸­ä½¿ç”¨çš„ç±»å‹çš„å†…éƒ¨ä¸€è‡´æ€§ã€‚</p><p>å› ä¸ºæ“¦é™¤ç§»é™¤äº†æ–¹æ³•ä½“ä¸­çš„ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶çš„é—®é¢˜å°±æ˜¯<em>è¾¹ç•Œ</em>ï¼šå³å¯¹è±¡è¿›å…¥å’Œç¦»å¼€æ–¹æ³•çš„åœ°ç‚¹ã€‚è¿™äº›æ­£æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸæ‰§è¡Œç±»å‹æ£€æŸ¥å¹¶æ’å…¥è½¬å‹ä»£ç çš„åœ°ç‚¹ã€‚</p><p>è€ƒè™‘å¦‚ä¸‹è¿™æ®µéæ³›å‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SimpleHolder.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHolder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHolder holder = <span class="keyword">new</span> SimpleHolder();</span><br><span class="line">        holder.set(<span class="string">"Item"</span>);</span><br><span class="line">        String s = (String) holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨ <strong>javap -c SimpleHolder</strong> åç¼–è¯‘è¿™ä¸ªç±»ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼ˆç»è¿‡ç¼–è¾‘ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(java.lang.Object)</span></span>;</span><br><span class="line">   <span class="number">0</span>: aload_0</span><br><span class="line">   <span class="number">1</span>: aload_1</span><br><span class="line">   2: putfield #2; // Field obj:Object;</span><br><span class="line">   <span class="number">5</span>: <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> java.lang.<span class="function">Object <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="number">0</span>: aload_0</span><br><span class="line">   1: getfield #2; // Field obj:Object;</span><br><span class="line">   <span class="number">4</span>: areturn</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">   0: new #3; // class SimpleHolder</span><br><span class="line">   <span class="number">3</span>: dup</span><br><span class="line">   4: invokespecial #4; // Method "&lt;init&gt;":()V</span><br><span class="line">   <span class="number">7</span>: astore_1</span><br><span class="line">   <span class="number">8</span>: aload_1</span><br><span class="line">   9: ldc #5; // String Item</span><br><span class="line">   11: invokevirtual #6; // Method set:(Object;)V</span><br><span class="line">   <span class="number">14</span>: aload_1</span><br><span class="line">   15: invokevirtual #7; // Method get:()Object;</span><br><span class="line">   18: checkcast #8; // class java/lang/String</span><br><span class="line">   <span class="number">21</span>: astore_2</span><br><span class="line">   <span class="number">22</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p><code>set()</code> å’Œ <code>get()</code> æ–¹æ³•å­˜å‚¨å’Œäº§ç”Ÿå€¼ï¼Œè½¬å‹åœ¨è°ƒç”¨ <code>get()</code> æ—¶æ¥å—æ£€æŸ¥ã€‚</p><p>ç°åœ¨å°†æ³›å‹èå…¥ä¸Šä¾‹ä»£ç ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericHolder2.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericHolder2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T obj;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericHolder2&lt;String&gt; holder =  <span class="keyword">new</span> GenericHolder2&lt;&gt;();</span><br><span class="line">        holder.set(<span class="string">"Item"</span>);</span><br><span class="line">        String s = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä» <code>get()</code> è¿”å›åçš„è½¬å‹æ¶ˆå¤±äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜çŸ¥é“ä¼ é€’ç»™ <code>set()</code> çš„å€¼åœ¨ç¼–è¯‘æœŸä¼šè¢«æ£€æŸ¥ã€‚ä¸‹é¢æ˜¯ç›¸å…³çš„å­—èŠ‚ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(java.lang.Object)</span></span>;</span><br><span class="line">   <span class="number">0</span>: aload_0</span><br><span class="line">   <span class="number">1</span>: aload_1</span><br><span class="line">   2: putfield #2; // Field obj:Object;</span><br><span class="line">   <span class="number">5</span>: <span class="keyword">return</span></span><br><span class="line">       </span><br><span class="line"><span class="keyword">public</span> java.lang.<span class="function">Object <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="number">0</span>: aload_0</span><br><span class="line">   1: getfield #2; // Field obj:Object;</span><br><span class="line">   <span class="number">4</span>: areturn</span><br><span class="line">       </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">   0: new #3; // class GenericHolder2</span><br><span class="line">   <span class="number">3</span>: dup</span><br><span class="line">   4: invokespecial #4; // Method "&lt;init&gt;":()V</span><br><span class="line">   <span class="number">7</span>: astore_1</span><br><span class="line">   <span class="number">8</span>: aload_1</span><br><span class="line">   9: ldc #5; // String Item</span><br><span class="line">   11: invokevirtual #6; // Method set:(Object;)V</span><br><span class="line">   <span class="number">14</span>: aload_1</span><br><span class="line">   15: invokevirtual #7; // Method get:()Object;</span><br><span class="line">   18: checkcast #8; // class java/lang/String</span><br><span class="line">   <span class="number">21</span>: astore_2</span><br><span class="line">   <span class="number">22</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>æ‰€äº§ç”Ÿçš„å­—èŠ‚ç æ˜¯ç›¸åŒçš„ã€‚å¯¹è¿›å…¥ <code>set()</code> çš„ç±»å‹è¿›è¡Œæ£€æŸ¥æ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºè¿™å°†ç”±ç¼–è¯‘å™¨æ‰§è¡Œã€‚è€Œå¯¹ <code>get()</code> è¿”å›çš„å€¼è¿›è¡Œè½¬å‹ä»ç„¶æ˜¯éœ€è¦çš„ï¼Œåªä¸è¿‡ä¸éœ€è¦æˆ‘ä»¬æ¥æ“ä½œï¼Œå®ƒç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨ç¼–å†™ï¼ˆé˜…è¯»ï¼‰æ‚ä¹±çš„ä»£ç ã€‚</p><p><code>get()</code> å’Œ <code>set()</code> äº§ç”Ÿäº†ç›¸åŒçš„å­—èŠ‚ç ï¼Œè¿™å°±å‘Šè¯‰æˆ‘ä»¬æ³›å‹çš„æ‰€æœ‰åŠ¨ä½œéƒ½å‘ç”Ÿåœ¨è¾¹ç•Œå¤„â€”â€”å¯¹å…¥å‚çš„ç¼–è¯‘å™¨æ£€æŸ¥å’Œå¯¹è¿”å›å€¼çš„è½¬å‹ã€‚è¿™æœ‰åŠ©äºæ¾„æ¸…å¯¹æ“¦é™¤çš„å›°æƒ‘ï¼Œè®°ä½ï¼šâ€œè¾¹ç•Œå°±æ˜¯åŠ¨ä½œå‘ç”Ÿçš„åœ°æ–¹â€ã€‚</p><!-- Compensating for Erasure --><h2 id="è¡¥å¿æ“¦é™¤"><a href="#è¡¥å¿æ“¦é™¤" class="headerlink" title="è¡¥å¿æ“¦é™¤"></a>è¡¥å¿æ“¦é™¤</h2><p>å› ä¸ºæ“¦é™¤ï¼Œæˆ‘ä»¬å°†å¤±å»æ‰§è¡Œæ³›å‹ä»£ç ä¸­æŸäº›æ“ä½œçš„èƒ½åŠ›ã€‚æ— æ³•åœ¨è¿è¡Œæ—¶çŸ¥é“ç¡®åˆ‡ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Erased.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Erased</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// error: illegal generic type for instanceof</span></span><br><span class="line">        <span class="keyword">if</span> (arg <span class="keyword">instanceof</span> T) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// error: unexpected type</span></span><br><span class="line">        T var = <span class="keyword">new</span> T();</span><br><span class="line">        <span class="comment">// error: generic array creation</span></span><br><span class="line">        T[] array = <span class="keyword">new</span> T[SIZE];</span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked cast</span></span><br><span class="line">        T[] array = (T[]) <span class="keyword">new</span> Object[SIZE];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›é—®é¢˜è¿›è¡Œç¼–ç¨‹ï¼Œä½†æ˜¯æœ‰æ—¶å¿…é¡»é€šè¿‡å¼•å…¥ç±»å‹æ ‡ç­¾æ¥è¡¥å¿æ“¦é™¤ã€‚è¿™æ„å‘³ç€ä¸ºæ‰€éœ€çš„ç±»å‹æ˜¾å¼ä¼ é€’ä¸€ä¸ª <strong>Class</strong> å¯¹è±¡ï¼Œä»¥åœ¨ç±»å‹è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒã€‚</p><p>ä¾‹å¦‚ï¼Œç”±äºæ“¦é™¤äº†ç±»å‹ä¿¡æ¯ï¼Œå› æ­¤åœ¨ä¸Šä¸€ä¸ªç¨‹åºä¸­å°è¯•ä½¿ç”¨ <strong>instanceof</strong> å°†ä¼šå¤±è´¥ã€‚ç±»å‹æ ‡ç­¾å¯ä»¥ä½¿ç”¨åŠ¨æ€ <code>isInstance()</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ClassTypeCapture.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Building</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">House</span> <span class="keyword">extends</span> <span class="title">Building</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassTypeCapture</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    Class&lt;T&gt; kind;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClassTypeCapture</span><span class="params">(Class&lt;T&gt; kind)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kind = kind;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">f</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> kind.isInstance(arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassTypeCapture&lt;Building&gt; ctt1 =</span><br><span class="line">                <span class="keyword">new</span> ClassTypeCapture&lt;&gt;(Building.class);</span><br><span class="line">        System.out.println(ctt1.f(<span class="keyword">new</span> Building()));</span><br><span class="line">        System.out.println(ctt1.f(<span class="keyword">new</span> House()));</span><br><span class="line">        ClassTypeCapture&lt;House&gt; ctt2 =</span><br><span class="line">                <span class="keyword">new</span> ClassTypeCapture&lt;&gt;(House.class);</span><br><span class="line">        System.out.println(ctt2.f(<span class="keyword">new</span> Building()));</span><br><span class="line">        System.out.println(ctt2.f(<span class="keyword">new</span> House()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">false</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨æ¥ä¿è¯ç±»å‹æ ‡ç­¾ä¸æ³›å‹å‚æ•°ç›¸åŒ¹é…ã€‚</p><!-- Creating Instances of Types --><h3 id="åˆ›å»ºç±»å‹çš„å®ä¾‹"><a href="#åˆ›å»ºç±»å‹çš„å®ä¾‹" class="headerlink" title="åˆ›å»ºç±»å‹çš„å®ä¾‹"></a>åˆ›å»ºç±»å‹çš„å®ä¾‹</h3><p>è¯•å›¾åœ¨ <strong>Erased.java</strong> ä¸­ <code>new T()</code> æ˜¯è¡Œä¸é€šçš„ï¼Œéƒ¨åˆ†åŸå› æ˜¯ç”±äºæ“¦é™¤ï¼Œéƒ¨åˆ†åŸå› æ˜¯ç¼–è¯‘å™¨æ— æ³•éªŒè¯ <strong>T</strong> æ˜¯å¦å…·æœ‰é»˜è®¤ï¼ˆæ— å‚ï¼‰æ„é€ å‡½æ•°ã€‚ä½†æ˜¯åœ¨ C++ ä¸­ï¼Œæ­¤æ“ä½œè‡ªç„¶ï¼Œç›´æ¥ä¸”å®‰å…¨ï¼ˆåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/InstantiateGenericType.cpp</span></span><br><span class="line"><span class="comment">// C++, not Java!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">  T x; <span class="comment">// Create a field of type T</span></span><br><span class="line">  T* y; <span class="comment">// Pointer to T</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// Initialize the pointer:</span></span><br><span class="line">  Foo() &#123; y = <span class="keyword">new</span> T(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> &#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Foo&lt;Bar&gt; fb;</span><br><span class="line">  Foo&lt;<span class="keyword">int</span>&gt; fi; <span class="comment">// ... and it works with primitives</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Java ä¸­çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¼ å…¥ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡åˆ›å»ºæ–°å®ä¾‹ã€‚æ–¹ä¾¿çš„å·¥å‚å¯¹è±¡åªæ˜¯ <strong>Class</strong> å¯¹è±¡ï¼Œå› æ­¤ï¼Œå¦‚æœä½¿ç”¨ç±»å‹æ ‡è®°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>newInstance()</code> åˆ›å»ºè¯¥ç±»å‹çš„æ–°å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/InstantiateGenericType.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassAsFactory</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    Class&lt;T&gt; kind;</span><br><span class="line"></span><br><span class="line">    ClassAsFactory(Class&lt;T&gt; kind) &#123;</span><br><span class="line">        <span class="keyword">this</span>.kind = kind;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> kind.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException |</span><br><span class="line">                IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Employee"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstantiateGenericType</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassAsFactory&lt;Employee&gt; fe =</span><br><span class="line">                <span class="keyword">new</span> ClassAsFactory&lt;&gt;(Employee.class);</span><br><span class="line">        System.out.println(fe.get());</span><br><span class="line">        ClassAsFactory&lt;Integer&gt; fi =</span><br><span class="line">                <span class="keyword">new</span> ClassAsFactory&lt;&gt;(Integer.class);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(fi.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Employee</span></span><br><span class="line"><span class="comment">java.lang.InstantiationException: java.lang.Integer</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥ç¼–è¯‘ï¼Œä½†å¯¹äº <code>ClassAsFactory&lt;Integer&gt;</code> ä¼šå¤±è´¥ï¼Œè¿™æ˜¯å› ä¸º <strong>Integer</strong> æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°ã€‚ç”±äºé”™è¯¯ä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ•è·çš„ï¼Œå› æ­¤è¯­è¨€åˆ›å»ºè€…ä¸èµæˆè¿™ç§æ–¹æ³•ã€‚ä»–ä»¬å»ºè®®ä½¿ç”¨æ˜¾å¼å·¥å‚ï¼ˆ<strong>Supplier</strong>ï¼‰å¹¶çº¦æŸç±»å‹ï¼Œä»¥ä¾¿åªæœ‰å®ç°è¯¥å·¥å‚çš„ç±»å¯ä»¥è¿™æ ·åˆ›å»ºå¯¹è±¡ã€‚è¿™æ˜¯åˆ›å»ºå·¥å‚çš„ä¸¤ç§ä¸åŒæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/FactoryConstraint.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.Suppliers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerFactory</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    Widget(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        id = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Widget "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Widget</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Widget <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Widget(++i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fudge</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n = count++;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Fudge "</span> + n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; x = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Foo2(Supplier&lt;T&gt; factory) &#123;</span><br><span class="line">        Suppliers.fill(x, factory, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryConstraint</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="keyword">new</span> Foo2&lt;&gt;(<span class="keyword">new</span> IntegerFactory()));</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="keyword">new</span> Foo2&lt;&gt;(<span class="keyword">new</span> Widget.Factory()));</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="keyword">new</span> Foo2&lt;&gt;(Fudge::<span class="keyword">new</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[Widget 1, Widget 2, Widget 3, Widget 4, Widget 5]</span></span><br><span class="line"><span class="comment">[Fudge 1, Fudge 2, Fudge 3, Fudge 4, Fudge 5]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>IntegerFactory</strong> æœ¬èº«å°±æ˜¯é€šè¿‡å®ç° <code>Supplier&lt;Integer&gt;</code> çš„å·¥å‚ã€‚ <strong>Widget</strong> åŒ…å«ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¥å‚ã€‚è¿˜è¦æ³¨æ„ï¼Œ<strong>Fudge</strong> å¹¶æ²¡æœ‰åšä»»ä½•ç±»ä¼¼äºå·¥å‚çš„æ“ä½œï¼Œå¹¶ä¸”ä¼ é€’ <code>Fudge::new</code> ä»ç„¶ä¼šäº§ç”Ÿå·¥å‚è¡Œä¸ºï¼Œå› ä¸ºç¼–è¯‘å™¨å°†å¯¹å‡½æ•°æ–¹æ³• <code>::new</code> çš„è°ƒç”¨è½¬æ¢ä¸ºå¯¹ <code>get()</code> çš„è°ƒç”¨ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ<code>create()</code> æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­è¢«é‡å†™ä»¥ç”Ÿæˆè¯¥ç±»å‹çš„å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CreatorGeneric.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericWithCreate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> T element;</span><br><span class="line"></span><br><span class="line">    GenericWithCreate() &#123;</span><br><span class="line">        element = create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> T <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCreator</span> <span class="keyword">extends</span> <span class="title">GenericWithCreate</span>&lt;<span class="title">X</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">X <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> X();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">                element.getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreatorGeneric</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        XCreator xc = <span class="keyword">new</span> XCreator();</span><br><span class="line">        xc.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">X</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>GenericWithCreate</strong> åŒ…å« <code>element</code> å­—æ®µï¼Œå¹¶é€šè¿‡æ— å‚æ„é€ å‡½æ•°å¼ºåˆ¶å…¶åˆå§‹åŒ–ï¼Œè¯¥æ„é€ å‡½æ•°åˆè°ƒç”¨æŠ½è±¡çš„ <code>create()</code> æ–¹æ³•ã€‚è¿™ç§åˆ›å»ºæ–¹å¼å¯ä»¥åœ¨å­ç±»ä¸­å®šä¹‰ï¼ŒåŒæ—¶å»ºç«‹ <strong>T</strong> çš„ç±»å‹ã€‚</p><!-- Arrays of Generics --><h3 id="æ³›å‹æ•°ç»„"><a href="#æ³›å‹æ•°ç»„" class="headerlink" title="æ³›å‹æ•°ç»„"></a>æ³›å‹æ•°ç»„</h3><p>æ­£å¦‚åœ¨ <strong>Erased.java</strong> ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„ã€‚é€šç”¨è§£å†³æ–¹æ¡ˆæ˜¯åœ¨è¯•å›¾åˆ›å»ºæ³›å‹æ•°ç»„çš„æ—¶å€™ä½¿ç”¨ <strong>ArrayList</strong> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ListOfGenerics.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListOfGenerics</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; array = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        array.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšå¯ä»¥è·å¾—æ•°ç»„çš„è¡Œä¸ºï¼Œå¹¶ä¸”è¿˜å…·æœ‰æ³›å‹æä¾›çš„ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ€§ã€‚</p><p>æœ‰æ—¶ï¼Œä»ç„¶ä¼šåˆ›å»ºæ³›å‹ç±»å‹çš„æ•°ç»„ï¼ˆä¾‹å¦‚ï¼Œ <strong>ArrayList</strong> åœ¨å†…éƒ¨ä½¿ç”¨æ•°ç»„ï¼‰ã€‚å¯ä»¥é€šè¿‡ä½¿ç¼–è¯‘å™¨æ»¡æ„çš„æ–¹å¼å®šä¹‰å¯¹æ•°ç»„çš„é€šç”¨å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ArrayOfGenericReference.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generic</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOfGenericReference</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Generic&lt;Integer&gt;[] gia;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨æ¥å—æ­¤æ“ä½œè€Œä¸äº§ç”Ÿè­¦å‘Šã€‚ä½†æ˜¯æˆ‘ä»¬æ°¸è¿œæ— æ³•åˆ›å»ºå…·æœ‰è¯¥ç¡®åˆ‡ç±»å‹ï¼ˆåŒ…æ‹¬ç±»å‹å‚æ•°ï¼‰çš„æ•°ç»„ï¼Œå› æ­¤æœ‰ç‚¹ä»¤äººå›°æƒ‘ã€‚ç”±äºæ‰€æœ‰æ•°ç»„ï¼Œæ— è®ºå®ƒä»¬æŒæœ‰ä»€ä¹ˆç±»å‹ï¼Œéƒ½å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼ˆæ¯ä¸ªæ•°ç»„æ’æ§½çš„å¤§å°å’Œæ•°ç»„å¸ƒå±€ï¼‰ï¼Œå› æ­¤ä¼¼ä¹å¯ä»¥åˆ›å»ºä¸€ä¸ª <strong>Object</strong> æ•°ç»„å¹¶å°†å…¶è½¬æ¢ä¸ºæ‰€éœ€çš„æ•°ç»„ç±»å‹ã€‚å®é™…ä¸Šï¼Œè¿™ç¡®å®å¯ä»¥ç¼–è¯‘ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿ <strong>ClassCastException</strong> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ArrayOfGeneric.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOfGeneric</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span> Generic&lt;Integer&gt;[] gia;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            gia = (Generic&lt;Integer&gt;[]) <span class="keyword">new</span> Object[SIZE];</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Runtime type is the raw (erased) type:</span></span><br><span class="line">        gia = (Generic&lt;Integer&gt;[]) <span class="keyword">new</span> Generic[SIZE];</span><br><span class="line">        System.out.println(gia.getClass().getSimpleName());</span><br><span class="line">        gia[<span class="number">0</span>] = <span class="keyword">new</span> Generic&lt;&gt;();</span><br><span class="line">        <span class="comment">//- gia[1] = new Object(); // Compile-time error</span></span><br><span class="line">        <span class="comment">// Discovers type mismatch at compile time:</span></span><br><span class="line">        <span class="comment">//- gia[2] = new Generic&lt;Double&gt;();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Ljava.lang.Object; cannot be cast to [LGeneric;</span></span><br><span class="line"><span class="comment">Generic[]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>é—®é¢˜åœ¨äºæ•°ç»„ä¼šè·Ÿè¸ªå…¶å®é™…ç±»å‹ï¼Œè€Œè¯¥ç±»å‹æ˜¯åœ¨åˆ›å»ºæ•°ç»„æ—¶å»ºç«‹çš„ã€‚å› æ­¤ï¼Œå³ä½¿ <code>gia</code> è¢«å¼ºåˆ¶è½¬æ¢ä¸º <code>Generic&lt;Integer&gt;[]</code> ï¼Œè¯¥ä¿¡æ¯ä¹Ÿä»…åœ¨ç¼–è¯‘æ—¶å­˜åœ¨ï¼ˆå¹¶ä¸”æ²¡æœ‰ <strong>@SuppressWarnings</strong> æ³¨è§£ï¼Œå°†ä¼šæ”¶åˆ°æœ‰å…³è¯¥å¼ºåˆ¶è½¬æ¢çš„è­¦å‘Šï¼‰ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ª <strong>Object</strong> æ•°ç»„ï¼Œè¿™ä¼šå¼•èµ·é—®é¢˜ã€‚æˆåŠŸåˆ›å»ºæ³›å‹ç±»å‹çš„æ•°ç»„çš„å”¯ä¸€æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå·²æ“¦é™¤ç±»å‹çš„æ–°æ•°ç»„ï¼Œå¹¶å°†å…¶å¼ºåˆ¶è½¬æ¢ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ã€‚è€ƒè™‘ä¸€ä¸ªåŒ…è£…æ•°ç»„çš„ç®€å•æ³›å‹åŒ…è£…å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericArray.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericArray</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericArray</span><span class="params">(<span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">        array = (T[]) <span class="keyword">new</span> Object[sz];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> index, T item)</span> </span>&#123;</span><br><span class="line">        array[index] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Method that exposes the underlying representation:</span></span><br><span class="line">    <span class="keyword">public</span> T[] rep() &#123;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericArray&lt;Integer&gt; gai = <span class="keyword">new</span> GenericArray&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Integer[] ia = gai.rep();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// This is OK:</span></span><br><span class="line">        Object[] oa = gai.rep();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Ljava.lang.Object; cannot be cast to</span></span><br><span class="line"><span class="comment">[Ljava.lang.Integer;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸èƒ½è¯´ <code>T[] array = new T[sz]</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <strong>Object</strong> æ•°ç»„å¹¶å°†å…¶å¼ºåˆ¶è½¬æ¢ã€‚</p><p><code>rep()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>T[]</code> ï¼Œåœ¨ä¸»æ–¹æ³•ä¸­å®ƒåº”è¯¥æ˜¯ <code>gai</code> çš„ <code>Integer[]</code>ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨å®ƒå¹¶å°è¯•å°†ç»“æœè½¬æ¢ä¸º <code>Integer[]</code> å¼•ç”¨ï¼Œåˆ™ä¼šå¾—åˆ° <strong>ClassCastException</strong> ï¼Œè¿™å†æ¬¡æ˜¯å› ä¸ºå®é™…çš„è¿è¡Œæ—¶ç±»å‹ä¸º <code>Object[]</code> ã€‚</p><p>å¦‚æœå†æ³¨é‡Šæ‰ <strong>@SuppressWarnings</strong> æ³¨è§£åç¼–è¯‘ <strong>GenericArray.java</strong> ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šäº§ç”Ÿè­¦å‘Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GenericArray.java uses unchecked or unsafe operations.</span><br><span class="line">Recompile with -Xlint:unchecked <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€ä¸ªè­¦å‘Šï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯æœ‰å…³å¼ºåˆ¶è½¬æ¢çš„ã€‚</p><p>ä½†æ˜¯è¦çœŸæ­£ç¡®å®šï¼Œè¯·ä½¿ç”¨ <code>-Xlintï¼šunchecked</code> è¿›è¡Œç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GenericArray.java:<span class="number">7</span>: warning: [unchecked] unchecked cast    array = (T[])<span class="keyword">new</span> Object[sz];                 ^  required: T[]  found:    Object[]  where T is a type-variable:    T extends Object declared in <span class="class"><span class="keyword">class</span> <span class="title">GenericArray</span> 1 <span class="title">warning</span></span></span><br></pre></td></tr></table></figure><p>ç¡®å®æ˜¯åœ¨æŠ±æ€¨é‚£ä¸ªå¼ºåˆ¶è½¬æ¢ã€‚ç”±äºè­¦å‘Šä¼šå˜æˆå™ªéŸ³ï¼Œå› æ­¤ï¼Œä¸€æ—¦æˆ‘ä»¬ç¡®è®¤é¢„æœŸä¼šå‡ºç°ç‰¹å®šè­¦å‘Šï¼Œæˆ‘ä»¬å¯ä»¥åšçš„æœ€å¥½çš„åŠæ³•å°±æ˜¯ä½¿ç”¨ <strong>@SuppressWarnings</strong> å°†å…¶å…³é—­ã€‚è¿™æ ·ï¼Œå½“è­¦å‘Šç¡®å®å‡ºç°æ—¶ï¼Œæˆ‘ä»¬å°†è¿›è¡Œå®é™…è°ƒæŸ¥ã€‚</p><p>ç”±äºæ“¦é™¤ï¼Œæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹åªèƒ½æ˜¯ <code>Object[]</code> ã€‚ å¦‚æœæˆ‘ä»¬ç«‹å³å°†å…¶è½¬æ¢ä¸º <code>T[]</code> ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ä¼šä¸¢å¤±æ•°ç»„çš„å®é™…ç±»å‹ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨å¯èƒ½ä¼šé”™è¿‡ä¸€äº›æ½œåœ¨çš„é”™è¯¯æ£€æŸ¥ã€‚å› æ­¤ï¼Œæœ€å¥½åœ¨é›†åˆä¸­ä½¿ç”¨ <code>Object[]</code> ï¼Œå¹¶åœ¨ä½¿ç”¨æ•°ç»„å…ƒç´ æ—¶å‘ <strong>T</strong> æ·»åŠ å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ <strong>GenericArray.java</strong> ç¤ºä¾‹ä¸­ä¼šæ˜¯æ€ä¹ˆæ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericArray2.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericArray2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object[] array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericArray2</span><span class="params">(<span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> Object[sz];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> index, T item)</span> </span>&#123;</span><br><span class="line">        array[index] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> T[] rep() &#123;</span><br><span class="line">        <span class="keyword">return</span> (T[]) array; <span class="comment">// Unchecked cast</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericArray2&lt;Integer&gt; gai =</span><br><span class="line">                <span class="keyword">new</span> GenericArray2&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            gai.put(i, i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            System.out.print(gai.get(i) + <span class="string">" "</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Integer[] ia = gai.rep();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">java.lang.ClassCastException: [Ljava.lang.Object;</span></span><br><span class="line"><span class="comment">cannot be cast to [Ljava.lang.Integer;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æœ€åˆï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰å¤ªå¤§ä¸åŒï¼Œåªæ˜¯è½¬æ¢çš„ä½ç½®ç§»åŠ¨äº†ã€‚æ²¡æœ‰ <strong>@SuppressWarnings</strong> æ³¨è§£ï¼Œä»ç„¶ä¼šæ”¶åˆ°â€œuncheckedâ€è­¦å‘Šã€‚ä½†æ˜¯ï¼Œå†…éƒ¨è¡¨ç¤ºç°åœ¨æ˜¯ <code>Object[]</code> è€Œä¸æ˜¯ <code>T[]</code> ã€‚ è°ƒç”¨ <code>get()</code> æ—¶ï¼Œå®ƒå°†å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸º <strong>T</strong> ï¼Œå®é™…ä¸Šè¿™æ˜¯æ­£ç¡®çš„ç±»å‹ï¼Œå› æ­¤å¾ˆå®‰å…¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœè°ƒç”¨ <code>rep()</code> ï¼Œå®ƒå°†å†æ¬¡å°è¯•å°† <code>Object[]</code> å¼ºåˆ¶è½¬æ¢ä¸º <code>T[]</code> ï¼Œä½†ä»ç„¶ä¸æ­£ç¡®ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆè­¦å‘Šï¼Œå¹¶åœ¨è¿è¡Œæ—¶ç”Ÿæˆå¼‚å¸¸ã€‚å› æ­¤ï¼Œæ— æ³•ç ´ååŸºç¡€æ•°ç»„çš„ç±»å‹ï¼Œè¯¥åŸºç¡€æ•°ç»„åªèƒ½æ˜¯ <code>Object[]</code> ã€‚åœ¨å†…éƒ¨å°†æ•°ç»„è§†ä¸º <code>Object[]</code> è€Œä¸æ˜¯ <code>T[]</code> çš„ä¼˜ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸å¤ªå¯èƒ½ä¼šå¿˜è®°æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹å¹¶æ„å¤–åœ°å¼•å…¥äº†bugï¼Œå°½ç®¡å¤§å¤šæ•°ï¼ˆä¹Ÿè®¸æ˜¯å…¨éƒ¨ï¼‰æ­¤ç±»é”™è¯¯ä¼šåœ¨è¿è¡Œæ—¶è¢«è¿…é€Ÿæ£€æµ‹åˆ°ã€‚</p><p>å¯¹äºæ–°ä»£ç ï¼Œè¯·ä¼ å…¥ç±»å‹æ ‡è®°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>GenericArray</strong> å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericArrayWithTypeToken.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericArrayWithTypeToken</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericArrayWithTypeToken</span><span class="params">(Class&lt;T&gt; type, <span class="keyword">int</span> sz)</span> </span>&#123;</span><br><span class="line">        array = (T[]) Array.newInstance(type, sz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> index, T item)</span> </span>&#123;</span><br><span class="line">        array[index] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Expose the underlying representation:</span></span><br><span class="line">    <span class="keyword">public</span> T[] rep() &#123;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericArrayWithTypeToken&lt;Integer&gt; gai =</span><br><span class="line">                <span class="keyword">new</span> GenericArrayWithTypeToken&lt;&gt;(</span><br><span class="line">                        Integer.class, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// This now works:</span></span><br><span class="line">        Integer[] ia = gai.rep();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»å‹æ ‡è®° <strong>Class&lt;T&gt;</strong> è¢«ä¼ é€’åˆ°æ„é€ å‡½æ•°ä¸­ä»¥ä»æ“¦é™¤ä¸­æ¢å¤ï¼Œå› æ­¤å°½ç®¡å¿…é¡»ä½¿ç”¨ <strong>@SuppressWarnings</strong> å…³é—­æ¥è‡ªå¼ºåˆ¶ç±»å‹è½¬æ¢çš„è­¦å‘Šï¼Œä½†æˆ‘ä»¬ä»å¯ä»¥åˆ›å»ºæ‰€éœ€çš„å®é™…æ•°ç»„ç±»å‹ã€‚ä¸€æ—¦è·å¾—äº†å®é™…çš„ç±»å‹ï¼Œå°±å¯ä»¥è¿”å›å®ƒå¹¶äº§ç”Ÿæ‰€éœ€çš„ç»“æœï¼Œå¦‚åœ¨ä¸»æ–¹æ³•ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯ç¡®åˆ‡çš„ç±»å‹ <code>T[]</code> ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæŸ¥çœ‹ Java æ ‡å‡†åº“ä¸­çš„æºä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°åˆ°å¤„éƒ½æœ‰ä» <strong>Object</strong> æ•°ç»„åˆ°å‚æ•°åŒ–ç±»å‹çš„è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯<strong>ArrayList</strong> ä¸­ï¼Œå¤åˆ¶ä¸€ä¸ª <strong>Collection</strong> çš„æ„é€ å‡½æ•°ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œå»é™¤äº†æºç ä¸­å¯¹æ­¤ä¸é‡è¦çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection c)</span> </span>&#123;</span><br><span class="line">  size = c.size();</span><br><span class="line">  elementData = (E[])<span class="keyword">new</span> Object[size];</span><br><span class="line">  c.toArray(elementData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æµè§ˆ <strong>ArrayList.java</strong> çš„ä»£ç ï¼Œå°†ä¼šå‘ç°å¾ˆå¤šæ­¤ç±»å¼ºåˆ¶è½¬æ¢ã€‚å½“æˆ‘ä»¬ç¼–è¯‘å®ƒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Note: ArrayList.java uses unchecked or unsafe operations</span><br><span class="line">Note: Recompile with -Xlint:unchecked <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure><p>æœç„¶ï¼Œæ ‡å‡†åº“ä¼šäº§ç”Ÿå¾ˆå¤šè­¦å‘Šã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿‡ C è¯­è¨€ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ ANSI C ä¹‹å‰çš„è¯­è¨€ï¼Œæˆ‘ä»¬ä¼šè®°ä½è­¦å‘Šçš„ç‰¹æ®Šæ•ˆæœï¼šå‘ç°è­¦å‘Šåï¼Œå¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚å› æ­¤ï¼Œé™¤éç¨‹åºå‘˜å¿…é¡»å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™æœ€å¥½ä¸è¦ä»ç¼–è¯‘å™¨å‘å‡ºä»»ä½•ç±»å‹çš„æ¶ˆæ¯ã€‚</p><p>Neal Gafterï¼ˆJava 5 çš„ä¸»è¦å¼€å‘äººå‘˜ä¹‹ä¸€ï¼‰åœ¨ä»–çš„åšå®¢ä¸­[^2]æŒ‡å‡ºï¼Œä»–åœ¨é‡å†™ Java åº“æ—¶æ˜¯å¾ˆéšæ„ã€é©¬è™çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥åƒä»–é‚£æ ·åšã€‚Neal è¿˜æŒ‡å‡ºï¼Œä»–åœ¨ä¸ç ´åç°æœ‰æ¥å£çš„æƒ…å†µä¸‹æ— æ³•ä¿®å¤æŸäº› Java åº“ä»£ç ã€‚å› æ­¤ï¼Œå³ä½¿åœ¨ Java åº“æºä»£ç ä¸­å‡ºç°äº†ä¸€äº›ä¹ æƒ¯ç”¨æ³•ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯æ­£ç¡®çš„åšæ³•ã€‚å½“æŸ¥çœ‹åº“ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è®¤ä¸ºè¿™å°±æ˜¯è¦åœ¨è‡ªå·±ä»£ç ä¸­å¿…é¡»éµå¾ªçš„ç¤ºä¾‹ã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨ Java æ–‡çŒ®ä¸­æ¨èä½¿ç”¨ç±»å‹æ ‡è®°æŠ€æœ¯ï¼Œä¾‹å¦‚ Gilad Bracha çš„è®ºæ–‡ã€ŠGenerics in the Java Programming Languageã€‹[^3]ï¼Œä»–æŒ‡å‡ºï¼šâ€œä¾‹å¦‚ï¼Œè¿™ç§ç”¨æ³•å·²å¹¿æ³›ç”¨äºæ–°çš„ API ä¸­ä»¥å¤„ç†æ³¨è§£ã€‚â€ æˆ‘å‘ç°æ­¤æŠ€æœ¯åœ¨äººä»¬å¯¹äºèˆ’é€‚åº¦çš„çœ‹æ³•æ–¹é¢å­˜åœ¨ä¸€äº›ä¸ä¸€è‡´ä¹‹å¤„ï¼›æœ‰äº›äººå¼ºçƒˆå–œæ¬¢æœ¬ç« å‰é¢ä»‹ç»çš„å·¥å‚æ–¹æ³•ã€‚</p><!-- Bounds --><h2 id="è¾¹ç•Œ"><a href="#è¾¹ç•Œ" class="headerlink" title="è¾¹ç•Œ"></a>è¾¹ç•Œ</h2><p><em>è¾¹ç•Œ</em>ï¼ˆboundsï¼‰åœ¨æœ¬ç« çš„å‰é¢è¿›è¡Œäº†ç®€è¦ä»‹ç»ã€‚è¾¹ç•Œå…è®¸æˆ‘ä»¬å¯¹æ³›å‹ä½¿ç”¨çš„å‚æ•°ç±»å‹æ–½åŠ çº¦æŸã€‚å°½ç®¡è¿™å¯ä»¥å¼ºåˆ¶æ‰§è¡Œæœ‰å…³åº”ç”¨äº†æ³›å‹ç±»å‹çš„è§„åˆ™ï¼Œä½†æ½œåœ¨çš„æ›´é‡è¦çš„æ•ˆæœæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ç»‘å®šçš„ç±»å‹ä¸­è°ƒç”¨æ–¹æ³•ã€‚</p><p>ç”±äºæ“¦é™¤ä¼šåˆ é™¤ç±»å‹ä¿¡æ¯ï¼Œå› æ­¤å”¯ä¸€å¯ç”¨äºæ— é™åˆ¶æ³›å‹å‚æ•°çš„æ–¹æ³•æ˜¯é‚£äº› <strong>Object</strong> å¯ç”¨çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†è¯¥å‚æ•°é™åˆ¶ä¸ºæŸç±»å‹çš„å­é›†ï¼Œåˆ™å¯ä»¥è°ƒç”¨è¯¥å­é›†ä¸­çš„æ–¹æ³•ã€‚ä¸ºäº†åº”ç”¨çº¦æŸï¼ŒJava æ³›å‹ä½¿ç”¨äº† <code>extends</code> å…³é”®å­—ã€‚</p><p>é‡è¦çš„æ˜¯è¦ç†è§£ï¼Œå½“ç”¨äºé™å®šæ³›å‹ç±»å‹æ—¶ï¼Œ<code>extends</code> çš„å«ä¹‰ä¸é€šå¸¸çš„æ„ä¹‰æˆªç„¶ä¸åŒã€‚æ­¤ç¤ºä¾‹å±•ç¤ºè¾¹ç•Œçš„åŸºç¡€åº”ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/BasicBounds.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">HasColor</span> </span>&#123;</span><br><span class="line">    java.awt.<span class="function">Color <span class="title">getColor</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithColor</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasColor</span>&gt; </span>&#123;</span><br><span class="line">    T item;</span><br><span class="line"></span><br><span class="line">    WithColor(T item) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The bound allows you to call a method:</span></span><br><span class="line">    java.awt.<span class="function">Color <span class="title">color</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.getColor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> x, y, z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This fails. Class must be first, then interfaces:</span></span><br><span class="line"><span class="comment">// class WithColorCoord&lt;T extends HasColor &amp; Coord&gt; &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Multiple bounds:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithColorCoord</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Coord</span> &amp; <span class="title">HasColor</span>&gt; </span>&#123;</span><br><span class="line">    T item;</span><br><span class="line"></span><br><span class="line">    WithColorCoord(T item) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    java.awt.<span class="function">Color <span class="title">color</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.getColor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getZ</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Weight</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">weight</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// As with inheritance, you can have only one</span></span><br><span class="line"><span class="comment">// concrete class but multiple interfaces:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solid</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Coord</span> &amp; <span class="title">HasColor</span> &amp; <span class="title">Weight</span>&gt; </span>&#123;</span><br><span class="line">    T item;</span><br><span class="line"></span><br><span class="line">    Solid(T item) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    java.awt.<span class="function">Color <span class="title">color</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.getColor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getZ</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.z;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">weight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.weight();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bounded</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">Coord</span> <span class="keyword">implements</span> <span class="title">HasColor</span>, <span class="title">Weight</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.awt.<span class="function">Color <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">weight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicBounds</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Solid&lt;Bounded&gt; solid =</span><br><span class="line">                <span class="keyword">new</span> Solid&lt;&gt;(<span class="keyword">new</span> Bounded());</span><br><span class="line">        solid.color();</span><br><span class="line">        solid.getY();</span><br><span class="line">        solid.weight();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯èƒ½ä¼šè§‚å¯Ÿåˆ° <strong>BasicBounds.java</strong> ä¸­ä¼¼ä¹åŒ…å«ä¸€äº›å†—ä½™ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥æ¶ˆé™¤ã€‚åœ¨è¿™é‡Œï¼Œæ¯ä¸ªç»§æ‰¿çº§åˆ«è¿˜æ·»åŠ äº†è¾¹ç•Œçº¦æŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/InheritBounds.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldItem</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T item;</span><br><span class="line"></span><br><span class="line">    HoldItem(T item) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithColor2</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasColor</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">HoldItem</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    WithColor2(T item) &#123;</span><br><span class="line">        <span class="keyword">super</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    java.awt.<span class="function">Color <span class="title">color</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.getColor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithColorCoord2</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Coord</span> &amp; <span class="title">HasColor</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">WithColor2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    WithColorCoord2(T item) &#123;</span><br><span class="line">        <span class="keyword">super</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getZ</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solid2</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Coord</span> &amp; <span class="title">HasColor</span> &amp; <span class="title">Weight</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">WithColorCoord2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    Solid2(T item) &#123;</span><br><span class="line">        <span class="keyword">super</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">weight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.weight();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritBounds</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Solid2&lt;Bounded&gt; solid2 =</span><br><span class="line">                <span class="keyword">new</span> Solid2&lt;&gt;(<span class="keyword">new</span> Bounded());</span><br><span class="line">        solid2.color();</span><br><span class="line">        solid2.getY();</span><br><span class="line">        solid2.weight();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>HoldItem</strong> æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤æ­¤è¡Œä¸ºå°†ç»§æ‰¿åˆ° <strong>WithColor2</strong> ä¸­ï¼Œè¿™ä¹Ÿéœ€è¦å…¶å‚æ•°ç¬¦åˆ <strong>HasColor</strong>ã€‚ <strong>WithColorCoord2</strong> å’Œ <strong>Solid2</strong> è¿›ä¸€æ­¥æ‰©å±•äº†å±‚æ¬¡ç»“æ„ï¼Œå¹¶åœ¨æ¯ä¸ªçº§åˆ«æ·»åŠ äº†è¾¹ç•Œã€‚ç°åœ¨ï¼Œè¿™äº›æ–¹æ³•å·²è¢«ç»§æ‰¿ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªç±»ä¸­ä¸å†é‡å¤ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå…·æœ‰æ›´å¤šå±‚æ¬¡çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/EpicBattle.java</span></span><br><span class="line"><span class="comment">// Bounds in Java generics</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SuperPower</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">XRayVision</span> <span class="keyword">extends</span> <span class="title">SuperPower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">seeThroughWalls</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SuperHearing</span> <span class="keyword">extends</span> <span class="title">SuperPower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hearSubtleNoises</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SuperSmell</span> <span class="keyword">extends</span> <span class="title">SuperPower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">trackBySmell</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperHero</span>&lt;<span class="title">POWER</span> <span class="keyword">extends</span> <span class="title">SuperPower</span>&gt; </span>&#123;</span><br><span class="line">    POWER power;</span><br><span class="line"></span><br><span class="line">    SuperHero(POWER power) &#123;</span><br><span class="line">        <span class="keyword">this</span>.power = power;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">POWER <span class="title">getPower</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> power;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperSleuth</span>&lt;<span class="title">POWER</span> <span class="keyword">extends</span> <span class="title">XRayVision</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">SuperHero</span>&lt;<span class="title">POWER</span>&gt; </span>&#123;</span><br><span class="line">    SuperSleuth(POWER power) &#123;</span><br><span class="line">        <span class="keyword">super</span>(power);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">see</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        power.seeThroughWalls();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"><span class="title">CanineHero</span>&lt;<span class="title">POWER</span> <span class="keyword">extends</span> <span class="title">SuperHearing</span> &amp; <span class="title">SuperSmell</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">SuperHero</span>&lt;<span class="title">POWER</span>&gt; </span>&#123;</span><br><span class="line">    CanineHero(POWER power) &#123;</span><br><span class="line">        <span class="keyword">super</span>(power);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        power.hearSubtleNoises();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">smell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        power.trackBySmell();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperHearSmell</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">SuperHearing</span>, <span class="title">SuperSmell</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hearSubtleNoises</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trackBySmell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogPerson</span> <span class="keyword">extends</span> <span class="title">CanineHero</span>&lt;<span class="title">SuperHearSmell</span>&gt; </span>&#123;</span><br><span class="line">    DogPerson() &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> SuperHearSmell());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EpicBattle</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Bounds in generic methods:</span></span><br><span class="line">    <span class="keyword">static</span> &lt;POWER extends SuperHearing&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">useSuperHearing</span><span class="params">(SuperHero&lt;POWER&gt; hero)</span> </span>&#123;</span><br><span class="line">        hero.getPower().hearSubtleNoises();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;POWER extends SuperHearing &amp; SuperSmell&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">superFind</span><span class="params">(SuperHero&lt;POWER&gt; hero)</span> </span>&#123;</span><br><span class="line">        hero.getPower().hearSubtleNoises();</span><br><span class="line">        hero.getPower().trackBySmell();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DogPerson dogPerson = <span class="keyword">new</span> DogPerson();</span><br><span class="line">        useSuperHearing(dogPerson);</span><br><span class="line">        superFind(dogPerson);</span><br><span class="line">        <span class="comment">// You can do this:</span></span><br><span class="line">        List&lt;? extends SuperHearing&gt; audioPeople;</span><br><span class="line">        <span class="comment">// But you can't do this:</span></span><br><span class="line">        <span class="comment">// List&lt;? extends SuperHearing &amp; SuperSmell&gt; dogPs;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°†è¦ç ”ç©¶çš„é€šé…ç¬¦å°†ä¼šæŠŠèŒƒå›´é™åˆ¶åœ¨å•ä¸ªç±»å‹ã€‚</p><!-- Wildcards --><h2 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h2><p>æˆ‘ä»¬å·²ç»åœ¨ <a href="book/12-Collections.md">é›†åˆ</a> ç« èŠ‚ä¸­çœ‹åˆ°äº†ä¸€äº›ç®€å•ç¤ºä¾‹ä½¿ç”¨äº†é€šé…ç¬¦â€”â€”åœ¨æ³›å‹å‚æ•°è¡¨è¾¾å¼ä¸­çš„é—®å·ï¼Œåœ¨ <a href="book/19-Type-Information.md">ç±»å‹ä¿¡æ¯</a> ä¸€ç« ä¸­è¿™ç§ç¤ºä¾‹æ›´å¤šã€‚æœ¬èŠ‚å°†æ›´æ·±å…¥åœ°æ¢è®¨è¿™ä¸ªç‰¹æ€§ã€‚</p><p>æˆ‘ä»¬çš„èµ·å§‹ç¤ºä¾‹è¦å±•ç¤ºæ•°ç»„çš„ä¸€ç§ç‰¹æ®Šè¡Œä¸ºï¼šæˆ‘ä»¬å¯ä»¥å°†æ´¾ç”Ÿç±»çš„æ•°ç»„èµ‹å€¼ç»™åŸºç±»çš„å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CovariantArrays.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jonathan</span> <span class="keyword">extends</span> <span class="title">Apple</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Orange</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CovariantArrays</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Fruit[] fruit = <span class="keyword">new</span> Apple[<span class="number">10</span>];</span><br><span class="line">        fruit[<span class="number">0</span>] = <span class="keyword">new</span> Apple(); <span class="comment">// OK</span></span><br><span class="line">        fruit[<span class="number">1</span>] = <span class="keyword">new</span> Jonathan(); <span class="comment">// OK</span></span><br><span class="line">        <span class="comment">// Runtime type is Apple[], not Fruit[] or Orange[]:</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Compiler allows you to add Fruit:</span></span><br><span class="line">            fruit[<span class="number">0</span>] = <span class="keyword">new</span> Fruit(); <span class="comment">// ArrayStoreException</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Compiler allows you to add Oranges:</span></span><br><span class="line">            fruit[<span class="number">0</span>] = <span class="keyword">new</span> Orange(); <span class="comment">// ArrayStoreException</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">java.lang.ArrayStoreException: Fruit</span></span><br><span class="line"><span class="comment">java.lang.ArrayStoreException: Orange</span></span><br></pre></td></tr></table></figure><p><code>main()</code> ä¸­çš„ç¬¬ä¸€è¡Œåˆ›å»ºäº† <strong>Apple</strong> æ•°ç»„ï¼Œå¹¶èµ‹å€¼ç»™ä¸€ä¸ª <strong>Fruit</strong> æ•°ç»„å¼•ç”¨ã€‚è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸º <strong>Apple</strong> ä¹Ÿæ˜¯ä¸€ç§ <strong>Fruit</strong>ï¼Œå› æ­¤ <strong>Apple</strong> æ•°ç»„åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ª <strong>Fruit</strong> æ•°ç»„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœå®é™…çš„æ•°ç»„ç±»å‹æ˜¯ <strong>Apple[]</strong>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½® <strong>Apple</strong> æˆ– <strong>Apple</strong> çš„å­ç±»å‹ï¼Œè¿™åœ¨ç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶éƒ½å¯ä»¥å·¥ä½œã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ•°ç»„ä¸­æ”¾ç½® <strong>Fruit</strong> å¯¹è±¡ã€‚è¿™å¯¹ç¼–è¯‘å™¨æ¥è¯´æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ª <strong>Fruit[]</strong> å¼•ç”¨â€”â€”å®ƒæœ‰ä»€ä¹ˆç†ç”±ä¸å…è®¸å°† <strong>Fruit</strong> å¯¹è±¡æˆ–ä»»ä½•ä» <strong>Fruit</strong> ç»§æ‰¿å‡ºæ¥çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ <strong>Orange</strong>ï¼‰ï¼Œæ”¾ç½®åˆ°è¿™ä¸ªæ•°ç»„ä¸­å‘¢ï¼Ÿå› æ­¤åœ¨ç¼–è¯‘æœŸï¼Œè¿™æ˜¯å…è®¸çš„ã€‚ç„¶è€Œï¼Œè¿è¡Œæ—¶çš„æ•°ç»„æœºåˆ¶çŸ¥é“å®ƒå¤„ç†çš„æ˜¯ <strong>Apple[]</strong>ï¼Œå› æ­¤ä¼šåœ¨å‘æ•°ç»„ä¸­æ”¾ç½®å¼‚æ„ç±»å‹æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>å‘ä¸Šè½¬å‹ç”¨åœ¨è¿™é‡Œä¸åˆé€‚ã€‚æˆ‘ä»¬çœŸæ­£åœ¨åšçš„æ˜¯å°†ä¸€ä¸ªæ•°ç»„èµ‹å€¼ç»™å¦ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„çš„è¡Œä¸ºæ˜¯æŒæœ‰å…¶ä»–å¯¹è±¡ï¼Œè¿™é‡Œåªæ˜¯å› ä¸ºæˆ‘ä»¬èƒ½å¤Ÿå‘ä¸Šè½¬å‹è€Œå·²ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œæ•°ç»„å¯¹è±¡å¯ä»¥ä¿ç•™æœ‰å…³å®ƒä»¬åŒ…å«çš„å¯¹è±¡ç±»å‹çš„è§„åˆ™ã€‚çœ‹èµ·æ¥å°±åƒæ•°ç»„å¯¹å®ƒä»¬æŒæœ‰çš„å¯¹è±¡æ˜¯æœ‰æ„è¯†çš„ï¼Œå› æ­¤åœ¨ç¼–è¯‘æœŸæ£€æŸ¥å’Œè¿è¡Œæ—¶æ£€æŸ¥ä¹‹é—´ï¼Œæˆ‘ä»¬ä¸èƒ½æ»¥ç”¨å®ƒä»¬ã€‚</p><p>æ•°ç»„çš„è¿™ç§èµ‹å€¼å¹¶ä¸æ˜¯é‚£ä¹ˆå¯æ€•ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°æ’å…¥äº†é”™è¯¯çš„ç±»å‹ã€‚ä½†æ˜¯æ³›å‹çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€æ˜¯å°†è¿™ç§é”™è¯¯æ£€æµ‹ç§»åˆ°ç¼–è¯‘æœŸã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¯•å›¾ä½¿ç”¨æ³›å‹é›†åˆä»£æ›¿æ•°ç»„æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/NonCovariantGenerics.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonCovariantGenerics</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Compile Error: incompatible types:</span></span><br><span class="line">    List&lt;Fruit&gt; flist = <span class="keyword">new</span> ArrayList&lt;Apple&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡æˆ‘ä»¬åœ¨é¦–æ¬¡é˜…è¯»è¿™æ®µä»£ç æ—¶ä¼šè®¤ä¸ºâ€œä¸èƒ½å°†ä¸€ä¸ª <strong>Apple</strong> é›†åˆèµ‹å€¼ç»™ä¸€ä¸ª <strong>Fruit</strong> é›†åˆâ€ã€‚è®°ä½ï¼Œæ³›å‹ä¸ä»…ä»…æ˜¯å…³äºé›†åˆï¼Œå®ƒçœŸæ­£è¦è¡¨è¾¾çš„æ˜¯â€œä¸èƒ½æŠŠä¸€ä¸ªæ¶‰åŠ <strong>Apple</strong> çš„æ³›å‹èµ‹å€¼ç»™ä¸€ä¸ªæ¶‰åŠ <strong>Fruit</strong> çš„æ³›å‹â€ã€‚å¦‚æœåƒåœ¨æ•°ç»„ä¸­çš„æƒ…å†µä¸€æ ·ï¼Œç¼–è¯‘å™¨å¯¹ä»£ç çš„äº†è§£è¶³å¤Ÿå¤šï¼Œå¯ä»¥ç¡®å®šæ‰€æ¶‰åŠåˆ°çš„é›†åˆï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¼šç•™ä¸‹ä¸€äº›ä½™åœ°ã€‚ä½†æ˜¯å®ƒä¸çŸ¥é“ä»»ä½•æœ‰å…³è¿™æ–¹é¢çš„ä¿¡æ¯ï¼Œå› æ­¤å®ƒæ‹’ç»å‘ä¸Šè½¬å‹ã€‚ç„¶è€Œå®é™…ä¸Šè¿™ä¹Ÿä¸æ˜¯å‘ä¸Šè½¬å‹â€”â€” <strong>Apple</strong> çš„ <strong>List</strong> ä¸æ˜¯ <strong>Fruit</strong> çš„ <strong>List</strong>ã€‚<strong>Apple</strong> çš„ <strong>List</strong> å°†æŒæœ‰ <strong>Apple</strong> å’Œ <strong>Apple</strong> çš„å­ç±»å‹ï¼Œ<strong>Fruit</strong> çš„ <strong>List</strong> å°†æŒæœ‰ä»»ä½•ç±»å‹çš„ <strong>Fruit</strong>ã€‚æ˜¯çš„ï¼Œè¿™åŒ…æ‹¬ <strong>Apple</strong>ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ª <strong>Apple</strong> çš„ <strong>List</strong>ï¼Œå®ƒä»ç„¶æ˜¯ <strong>Fruit</strong> çš„ <strong>List</strong>ã€‚<strong>Apple</strong> çš„ <strong>List</strong> åœ¨ç±»å‹ä¸Šä¸ç­‰ä»·äº <strong>Fruit</strong> çš„ <strong>List</strong>ï¼Œå³ä½¿ <strong>Apple</strong> æ˜¯ä¸€ç§ <strong>Fruit</strong> ç±»å‹ã€‚</p><p>çœŸæ­£çš„é—®é¢˜æ˜¯æˆ‘ä»¬åœ¨è®¨è®ºçš„é›†åˆç±»å‹ï¼Œè€Œä¸æ˜¯é›†åˆæŒæœ‰å¯¹è±¡çš„ç±»å‹ã€‚ä¸æ•°ç»„ä¸åŒï¼Œæ³›å‹æ²¡æœ‰å†…å»ºçš„åå˜ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„æ˜¯å®Œå…¨åœ¨è¯­è¨€ä¸­å®šä¹‰çš„ï¼Œå› æ­¤å¯ä»¥å…·æœ‰ç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶çš„å†…å»ºæ£€æŸ¥ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ³›å‹æ—¶ï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç³»ç»Ÿä¸çŸ¥é“æˆ‘ä»¬æƒ³ç”¨ç±»å‹åšä»€ä¹ˆï¼Œä»¥åŠåº”è¯¥é‡‡ç”¨ä»€ä¹ˆè§„åˆ™ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªç±»å‹é—´å»ºç«‹æŸç§å‘ä¸Šè½¬å‹å…³ç³»ã€‚é€šé…ç¬¦å¯ä»¥äº§ç”Ÿè¿™ç§å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericsAndCovariance.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsAndCovariance</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Wildcards allow covariance:</span></span><br><span class="line">        List&lt;? extends Fruit&gt; flist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// Compile Error: can't add any type of object:</span></span><br><span class="line">        <span class="comment">// flist.add(new Apple());</span></span><br><span class="line">        <span class="comment">// flist.add(new Fruit());</span></span><br><span class="line">        <span class="comment">// flist.add(new Object());</span></span><br><span class="line">        flist.add(<span class="keyword">null</span>); <span class="comment">// Legal but uninteresting</span></span><br><span class="line">        <span class="comment">// We know it returns at least Fruit:</span></span><br><span class="line">        Fruit f = flist.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>flist</strong> çš„ç±»å‹ç°åœ¨æ˜¯ <code>List&lt;? extends Fruit&gt;</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¯»ä½œâ€œä¸€ä¸ªå…·æœ‰ä»»ä½•ä» <strong>Fruit</strong> ç»§æ‰¿çš„ç±»å‹çš„åˆ—è¡¨â€ã€‚ç„¶è€Œï¼Œè¿™å®é™…ä¸Šå¹¶ä¸æ„å‘³ç€è¿™ä¸ª <strong>List</strong> å°†æŒæœ‰ä»»ä½•ç±»å‹çš„ <strong>Fruit</strong>ã€‚é€šé…ç¬¦å¼•ç”¨çš„æ˜¯æ˜ç¡®çš„ç±»å‹ï¼Œå› æ­¤å®ƒæ„å‘³ç€â€œæŸç§ <strong>flist</strong> å¼•ç”¨æ²¡æœ‰æŒ‡å®šçš„å…·ä½“ç±»å‹â€ã€‚å› æ­¤è¿™ä¸ªè¢«èµ‹å€¼çš„ <strong>List</strong> å¿…é¡»æŒæœ‰è¯¸å¦‚ <strong>Fruit</strong> æˆ– <strong>Apple</strong> è¿™æ ·çš„æŒ‡å®šç±»å‹ï¼Œä½†æ˜¯ä¸ºäº†å‘ä¸Šè½¬å‹ä¸º <strong>Fruit</strong>ï¼Œè¿™ä¸ªç±»å‹æ˜¯ä»€ä¹ˆæ²¡äººåœ¨æ„ã€‚</p><p><strong>List</strong> å¿…é¡»æŒæœ‰ä¸€ç§å…·ä½“çš„ <strong>Fruit</strong> æˆ– <strong>Fruit</strong> çš„å­ç±»å‹ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å¯¹è¿™æ ·çš„ <strong>List</strong> åšä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸çŸ¥é“ <strong>List</strong> ä¸­æŒæœ‰çš„å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæˆ‘ä»¬æ€èƒ½ä¿è¯å®‰å…¨åœ°å‘å…¶ä¸­æ·»åŠ å¯¹è±¡å‘¢ï¼Ÿå°±åƒåœ¨ <strong>CovariantArrays.java</strong> ä¸­å‘ä¸Šè½¬å‹ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸èƒ½ï¼Œé™¤éç¼–è¯‘å™¨è€Œä¸æ˜¯è¿è¡Œæ—¶ç³»ç»Ÿå¯ä»¥é˜»æ­¢è¿™ç§æ“ä½œçš„å‘ç”Ÿã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå‘ç°è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯èƒ½è®¤ä¸ºäº‹æƒ…å¼€å§‹å˜å¾—æœ‰ç‚¹èµ°æç«¯äº†ï¼Œå› ä¸ºç°åœ¨æˆ‘ä»¬ç”šè‡³ä¸èƒ½å‘åˆšåˆšå£°æ˜è¿‡å°†æŒæœ‰ <strong>Apple</strong> å¯¹è±¡çš„ <strong>List</strong> ä¸­æ”¾å…¥ä¸€ä¸ª <strong>Apple</strong> å¯¹è±¡ã€‚æ˜¯çš„ï¼Œä½†ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“è¿™ä¸€ç‚¹ã€‚<code>List&lt;? extends Fruit&gt;</code> å¯èƒ½åˆæ³•åœ°æŒ‡å‘ä¸€ä¸ª <code>List&lt;Orange&gt;</code>ã€‚ä¸€æ—¦æ‰§è¡Œè¿™ç§ç±»å‹çš„å‘ä¸Šè½¬å‹ï¼Œæˆ‘ä»¬å°±ä¸¢å¤±äº†å‘å…¶ä¸­ä¼ é€’ä»»ä½•å¯¹è±¡çš„èƒ½åŠ›ï¼Œç”šè‡³ä¼ é€’ <strong>Object</strong> ä¹Ÿä¸è¡Œã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨äº†ä¸€ä¸ªè¿”å› <strong>Fruit</strong> çš„æ–¹æ³•ï¼Œåˆ™æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“è¿™ä¸ª <strong>List</strong> ä¸­çš„ä»»ä½•å¯¹è±¡è‡³å°‘å…·æœ‰ <strong>Fruit</strong> ç±»å‹ï¼Œå› æ­¤ç¼–è¯‘å™¨å…è®¸è¿™ä¹ˆåšã€‚</p><h3 id="ç¼–è¯‘å™¨æœ‰å¤šèªæ˜"><a href="#ç¼–è¯‘å™¨æœ‰å¤šèªæ˜" class="headerlink" title="ç¼–è¯‘å™¨æœ‰å¤šèªæ˜"></a>ç¼–è¯‘å™¨æœ‰å¤šèªæ˜</h3><p>ç°åœ¨æˆ‘ä»¬å¯èƒ½ä¼šçŒœæƒ³è‡ªå·±ä¸èƒ½å»è°ƒç”¨ä»»ä½•æ¥å—å‚æ•°çš„æ–¹æ³•ï¼Œä½†æ˜¯è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CompilerIntelligence.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompilerIntelligence</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;? extends Fruit&gt; flist = Arrays.asList(<span class="keyword">new</span> Apple());</span><br><span class="line">        Apple a = (Apple) flist.get(<span class="number">0</span>); <span class="comment">// No warning</span></span><br><span class="line">        flist.contains(<span class="keyword">new</span> Apple()); <span class="comment">// Argument is 'Object'</span></span><br><span class="line">        flist.indexOf(<span class="keyword">new</span> Apple()); <span class="comment">// Argument is 'Object'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹ <code>contains()</code> å’Œ <code>indexOf()</code> çš„è°ƒç”¨æ¥å— <strong>Apple</strong> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œæ²¡é—®é¢˜ã€‚è¿™æ˜¯å¦æ„å‘³ç€ç¼–è¯‘å™¨å®é™…ä¸Šä¼šæ£€æŸ¥ä»£ç ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æœ‰æŸä¸ªç‰¹å®šçš„æ–¹æ³•ä¿®æ”¹äº†å®ƒçš„å¯¹è±¡ï¼Ÿ</p><p>é€šè¿‡æŸ¥çœ‹ <strong>ArrayList</strong> çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å‘ç°ç¼–è¯‘å™¨æ²¡æœ‰é‚£ä¹ˆèªæ˜ã€‚å°½ç®¡ <code>add()</code> æ¥å—ä¸€ä¸ªæ³›å‹å‚æ•°ç±»å‹çš„å‚æ•°ï¼Œä½† <code>contains()</code> å’Œ <code>indexOf()</code> æ¥å—çš„å‚æ•°ç±»å‹æ˜¯ <strong>Object</strong>ã€‚å› æ­¤å½“æˆ‘ä»¬æŒ‡å®šä¸€ä¸ª <code>ArrayList&lt;? extends Fruit&gt;</code> æ—¶ï¼Œ<code>add()</code> çš„å‚æ•°å°±å˜æˆäº†â€<strong>? extends Fruit</strong>â€œã€‚ä»è¿™ä¸ªæè¿°ä¸­ï¼Œç¼–è¯‘å™¨æ— æ³•å¾—çŸ¥è¿™é‡Œéœ€è¦ <strong>Fruit</strong> çš„å“ªä¸ªå…·ä½“å­ç±»å‹ï¼Œå› æ­¤å®ƒä¸ä¼šæ¥å—ä»»ä½•ç±»å‹çš„ <strong>Fruit</strong>ã€‚å¦‚æœæˆ‘ä»¬å…ˆæŠŠ <strong>Apple</strong> å‘ä¸Šè½¬å‹ä¸º <strong>Fruit</strong>ï¼Œä¹Ÿæ²¡æœ‰å…³ç³»â€”â€”ç¼–è¯‘å™¨ä»…ä»…ä¼šæ‹’ç»è°ƒç”¨åƒ <code>add()</code> è¿™æ ·å‚æ•°åˆ—è¡¨ä¸­æ¶‰åŠé€šé…ç¬¦çš„æ–¹æ³•ã€‚</p><p><code>contains()</code> å’Œ <code>indexOf()</code> çš„å‚æ•°ç±»å‹æ˜¯ <strong>Object</strong>ï¼Œä¸æ¶‰åŠé€šé…ç¬¦ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å…è®¸è°ƒç”¨å®ƒä»¬ã€‚è¿™æ„å‘³ç€å°†ç”±æ³›å‹ç±»çš„è®¾è®¡è€…æ¥å†³å®šå“ªäº›è°ƒç”¨æ˜¯â€œå®‰å…¨çš„â€ï¼Œå¹¶ä½¿ç”¨ <strong>Object</strong> ç±»ä½œä¸ºå®ƒä»¬çš„å‚æ•°ç±»å‹ã€‚ä¸ºäº†ç¦æ­¢å¯¹ç±»å‹ä¸­ä½¿ç”¨äº†é€šé…ç¬¦çš„æ–¹æ³•è°ƒç”¨ï¼Œéœ€è¦åœ¨å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨ç±»å‹å‚æ•°ã€‚</p><p>ä¸‹é¢å±•ç¤ºä¸€ä¸ªç®€å•çš„ <strong>Holder</strong> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Holder.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Holder</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Holder</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">        value = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">        value = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o <span class="keyword">instanceof</span> Holder &amp;&amp; Objects.equals(value, ((Holder) o).value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Holder&lt;Apple&gt; apple = <span class="keyword">new</span> Holder&lt;&gt;(<span class="keyword">new</span> Apple());</span><br><span class="line">        Apple d = apple.get();</span><br><span class="line">        apple.set(d);</span><br><span class="line">        <span class="comment">// Holder&lt;Fruit&gt; fruit = apple; // Cannot upcast</span></span><br><span class="line">        Holder&lt;? extends Fruit&gt; fruit = apple; <span class="comment">// OK</span></span><br><span class="line">        Fruit p = fruit.get();</span><br><span class="line">        d = (Apple) fruit.get();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Orange c = (Orange) fruit.get(); <span class="comment">// No warning</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// fruit.set(new Apple()); // Cannot call set()</span></span><br><span class="line">        <span class="comment">// fruit.set(new Fruit()); // Cannot call set()</span></span><br><span class="line">        System.out.println(fruit.equals(d)); <span class="comment">// OK</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output</span></span><br><span class="line"><span class="comment">java.lang.ClassCastException: Apple cannot be cast to Orange</span></span><br><span class="line"><span class="comment">false</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>Holder</strong> æœ‰ä¸€ä¸ªæ¥å— <strong>T</strong> ç±»å‹å¯¹è±¡çš„ <code>set()</code> æ–¹æ³•ï¼Œä¸€ä¸ªè¿”å› T å¯¹è±¡çš„ <code>get()</code> æ–¹æ³•å’Œä¸€ä¸ªæ¥å— Object å¯¹è±¡çš„ <code>equals()</code> æ–¹æ³•ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ª <code>Holder&lt;Apple&gt;</code>ï¼Œå°±ä¸èƒ½å°†å…¶å‘ä¸Šè½¬å‹ä¸º <code>Holder&lt;Fruit&gt;</code>ï¼Œä½†æ˜¯å¯ä»¥å‘ä¸Šè½¬å‹ä¸º <code>Holder&lt;? extends Fruit&gt;</code>ã€‚å¦‚æœè°ƒç”¨ <code>get()</code>ï¼Œåªèƒ½è¿”å›ä¸€ä¸ª <strong>Fruit</strong>â€”â€”è¿™å°±æ˜¯åœ¨ç»™å®šâ€œä»»ä½•æ‰©å±•è‡ª <strong>Fruit</strong> çš„å¯¹è±¡â€è¿™ä¸€è¾¹ç•Œåï¼Œå®ƒæ‰€èƒ½çŸ¥é“çš„ä¸€åˆ‡äº†ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“æ›´å¤šçš„ä¿¡æ¯ï¼Œå°±å¯ä»¥å°†å…¶è½¬å‹åˆ°æŸç§å…·ä½“çš„ <strong>Fruit</strong> è€Œä¸ä¼šå¯¼è‡´ä»»ä½•è­¦å‘Šï¼Œä½†æ˜¯å­˜åœ¨å¾—åˆ° <strong>ClassCastException</strong> çš„é£é™©ã€‚<code>set()</code> æ–¹æ³•ä¸èƒ½å·¥ä½œåœ¨ <strong>Apple</strong> å’Œ <strong>Fruit</strong> ä¸Šï¼Œå› ä¸º <code>set()</code> çš„å‚æ•°ä¹Ÿæ˜¯â€<strong>? extends Fruit</strong>â€œï¼Œæ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»ä½•äº‹ç‰©ï¼Œç¼–è¯‘å™¨æ— æ³•éªŒè¯â€œä»»ä½•äº‹ç‰©â€çš„ç±»å‹å®‰å…¨æ€§ã€‚</p><p>ä½†æ˜¯ï¼Œ<code>equals()</code> æ–¹æ³•å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå®ƒæ¥å—çš„å‚æ•°æ˜¯ <strong>Object</strong> è€Œä¸æ˜¯ <strong>T</strong> ç±»å‹ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨åªå…³æ³¨ä¼ é€’è¿›æ¥å’Œè¦è¿”å›çš„å¯¹è±¡ç±»å‹ã€‚å®ƒä¸ä¼šåˆ†æä»£ç ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æ‰§è¡Œäº†ä»»ä½•å®é™…çš„å†™å…¥å’Œè¯»å–æ“ä½œã€‚</p><p>Java 7 å¼•å…¥äº† <strong>java.util.Objects</strong> åº“ï¼Œä½¿åˆ›å»º <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–åŠŸèƒ½ã€‚<code>equals()</code> æ–¹æ³•çš„æ ‡å‡†å½¢å¼å‚è€ƒ <a href="book/Appendix-Understanding-equals-and-hashCode">é™„å½•ï¼šç†è§£ equals å’Œ hashCode æ–¹æ³•</a> ä¸€ç« ã€‚</p><h3 id="é€†å˜"><a href="#é€†å˜" class="headerlink" title="é€†å˜"></a>é€†å˜</h3><p>è¿˜å¯ä»¥èµ°å¦å¤–ä¸€æ¡è·¯ï¼Œå³ä½¿ç”¨è¶…ç±»å‹é€šé…ç¬¦ã€‚è¿™é‡Œï¼Œå¯ä»¥å£°æ˜é€šé…ç¬¦æ˜¯ç”±æŸä¸ªç‰¹å®šç±»çš„ä»»ä½•åŸºç±»æ¥ç•Œå®šçš„ï¼Œæ–¹æ³•æ˜¯æŒ‡å®š <code>&lt;ï¼Ÿsuper MyClass&gt;</code> ï¼Œæˆ–è€…ç”šè‡³ä½¿ç”¨ç±»å‹å‚æ•°ï¼š <code>&lt;ï¼Ÿsuper T&gt;</code>ï¼ˆå°½ç®¡æˆ‘ä»¬ä¸èƒ½å¯¹æ³›å‹å‚æ•°ç»™å‡ºä¸€ä¸ªè¶…ç±»å‹è¾¹ç•Œï¼›å³ä¸èƒ½å£°æ˜ <code>&lt;T super MyClass&gt;</code> ï¼‰ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä¼ é€’ä¸€ä¸ªç±»å‹å¯¹è±¡åˆ°æ³›å‹ç±»å‹ä¸­ã€‚å› æ­¤ï¼Œæœ‰äº†è¶…ç±»å‹é€šé…ç¬¦ï¼Œå°±å¯ä»¥å‘ <strong>Collection</strong> å†™å…¥äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SuperTypeWildcards.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperTypeWildcards</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(List&lt;? <span class="keyword">super</span> Apple&gt; apples)</span> </span>&#123;</span><br><span class="line">        apples.add(<span class="keyword">new</span> Apple());</span><br><span class="line">        apples.add(<span class="keyword">new</span> Jonathan());</span><br><span class="line">        <span class="comment">// apples.add(new Fruit()); // Error</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•° <strong>apples</strong> æ˜¯ <strong>Apple</strong> çš„æŸç§åŸºç±»å‹çš„ <strong>List</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“å‘å…¶ä¸­æ·»åŠ  <strong>Apple</strong> æˆ– <strong>Apple</strong> çš„å­ç±»å‹æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯å› ä¸º <strong>Apple</strong> æ˜¯ä¸‹ç•Œï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å‘è¿™æ ·çš„ <strong>List</strong> ä¸­æ·»åŠ  <strong>Fruit</strong> æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¿™å°†ä½¿è¿™ä¸ª <strong>List</strong> æ•å¼€å£å­ï¼Œä»è€Œå¯ä»¥å‘å…¶ä¸­æ·»åŠ é <strong>Apple</strong> ç±»å‹çš„å¯¹è±¡ï¼Œè€Œè¿™æ˜¯è¿åé™æ€ç±»å‹å®‰å…¨çš„ã€‚<br>ä¸‹é¢çš„ç¤ºä¾‹å¤ä¹ äº†ä¸€ä¸‹é€†å˜å’Œé€šé…ç¬¦çš„çš„ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericReading.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericReading</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Apple&gt; apples = Arrays.asList(<span class="keyword">new</span> Apple());</span><br><span class="line">    <span class="keyword">static</span> List&lt;Fruit&gt; fruit = Arrays.asList(<span class="keyword">new</span> Fruit());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">readExact</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// A static method adapts to each call:</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Apple a = readExact(apples);</span><br><span class="line">        Fruit f = readExact(fruit);</span><br><span class="line">        f = readExact(apples);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// A class type is established</span></span><br><span class="line">    <span class="comment">// when the class is instantiated:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Reader</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function">T <span class="title">readExact</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123; </span><br><span class="line">            <span class="keyword">return</span> list.get(<span class="number">0</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Reader&lt;Fruit&gt; fruitReader = <span class="keyword">new</span> Reader&lt;&gt;();</span><br><span class="line">        Fruit f = fruitReader.readExact(fruit);</span><br><span class="line">        <span class="comment">//- Fruit a = fruitReader.readExact(apples);</span></span><br><span class="line">        <span class="comment">// error: incompatible types: List&lt;Apple&gt;</span></span><br><span class="line">        <span class="comment">// cannot be converted to List&lt;Fruit&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CovariantReader</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function">T <span class="title">readCovariant</span><span class="params">(List&lt;? extends T&gt; list)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CovariantReader&lt;Fruit&gt; fruitReader = <span class="keyword">new</span> CovariantReader&lt;&gt;();</span><br><span class="line">        Fruit f = fruitReader.readCovariant(fruit);</span><br><span class="line">        Fruit a = fruitReader.readCovariant(apples);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        f1(); </span><br><span class="line">        f2(); </span><br><span class="line">        f3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>readExact()</code> æ–¹æ³•ä½¿ç”¨äº†ç²¾ç¡®çš„ç±»å‹ã€‚å¦‚æœä½¿ç”¨è¿™ä¸ªæ²¡æœ‰ä»»ä½•é€šé…ç¬¦çš„ç²¾ç¡®ç±»å‹ï¼Œå°±å¯ä»¥å‘ <strong>List</strong> ä¸­å†™å…¥å’Œè¯»å–è¿™ä¸ªç²¾ç¡®ç±»å‹ã€‚å¦å¤–ï¼Œå¯¹äºè¿”å›å€¼ï¼Œé™æ€çš„æ³›å‹æ–¹æ³• <code>readExact()</code> å¯ä»¥æœ‰æ•ˆåœ°â€œé€‚åº”â€æ¯ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶èƒ½å¤Ÿä» <code>List&lt;Apple&gt;</code> ä¸­è¿”å›ä¸€ä¸ª <strong>Apple</strong> ï¼Œä» <code>List&lt;Fruit&gt;</code> ä¸­è¿”å›ä¸€ä¸ª <strong>Fruit</strong> ï¼Œå°±åƒåœ¨ <code>f1()</code> ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚å› æ­¤ï¼Œå¦‚æœå¯ä»¥æ‘†è„±é™æ€æ³›å‹æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è¯»å–æ—¶å°±ä¸éœ€è¦åå˜ç±»å‹äº†ã€‚<br>ç„¶è€Œå¯¹äºæ³›å‹ç±»æ¥è¯´ï¼Œå½“æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œå°±è¦ä¸ºè¿™ä¸ªç±»ç¡®å®šå‚æ•°ã€‚å°±åƒåœ¨ <code>f2()</code> ä¸­çœ‹åˆ°çš„ï¼Œ<strong>fruitReader</strong> å®ä¾‹å¯ä»¥ä» <code>List&lt;Fruit&gt;</code> ä¸­è¯»å–ä¸€ä¸ª <strong>Fruit</strong> ï¼Œå› ä¸ºè¿™å°±æ˜¯å®ƒçš„ç¡®åˆ‡ç±»å‹ã€‚ä½†æ˜¯ <code>List&lt;Apple&gt;</code> ä¹Ÿåº”è¯¥äº§ç”Ÿ <strong>Fruit</strong> å¯¹è±¡ï¼Œè€Œ <strong>fruitReader</strong> ä¸å…è®¸è¿™ä¹ˆåšã€‚<br>ä¸ºäº†ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œ<code>CovariantReader.readCovariant()</code> æ–¹æ³•å°†æ¥å— <code>List&lt;ï¼Ÿextends T&gt;</code> ï¼Œå› æ­¤ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­è¯»å–ä¸€ä¸ª <strong>T</strong> æ˜¯å®‰å…¨çš„ï¼ˆæˆ‘ä»¬çŸ¥é“åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰å¯¹è±¡è‡³å°‘æ˜¯ä¸€ä¸ª <strong>T</strong> ï¼Œå¹¶ä¸”å¯èƒ½æ˜¯ä» T å¯¼å‡ºçš„æŸç§å¯¹è±¡ï¼‰ã€‚åœ¨ <code>f3()</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç°åœ¨å¯ä»¥ä» <code>List&lt;Apple&gt;</code> ä¸­è¯»å– <strong>Fruit</strong> äº†ã€‚</p><h3 id="æ— ç•Œé€šé…ç¬¦"><a href="#æ— ç•Œé€šé…ç¬¦" class="headerlink" title="æ— ç•Œé€šé…ç¬¦"></a>æ— ç•Œé€šé…ç¬¦</h3><p>æ— ç•Œé€šé…ç¬¦ <code>&lt;?&gt;</code> çœ‹èµ·æ¥æ„å‘³ç€â€œä»»ä½•äº‹ç‰©â€ï¼Œå› æ­¤ä½¿ç”¨æ— ç•Œé€šé…ç¬¦å¥½åƒç­‰ä»·äºä½¿ç”¨åŸç”Ÿç±»å‹ã€‚äº‹å®ä¸Šï¼Œç¼–è¯‘å™¨åˆçœ‹èµ·æ¥æ˜¯æ”¯æŒè¿™ç§åˆ¤æ–­çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/UnboundedWildcards1.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnboundedWildcards1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List list1;</span><br><span class="line">    <span class="keyword">static</span> List&lt;?&gt; list2;</span><br><span class="line">    <span class="keyword">static</span> List&lt;? extends Object&gt; list3;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign1</span><span class="params">(List list)</span> </span>&#123;</span><br><span class="line">        list1 = list;</span><br><span class="line">        list2 = list;</span><br><span class="line">        <span class="comment">//- list3 = list;</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">// list3 = list;</span></span><br><span class="line">        <span class="comment">//         ^</span></span><br><span class="line">        <span class="comment">// required: List&lt;? extends Object&gt;</span></span><br><span class="line">        <span class="comment">// found:    List</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign2</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        list1 = list;</span><br><span class="line">        list2 = list;</span><br><span class="line">        list3 = list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign3</span><span class="params">(List&lt;? extends Object&gt; list)</span> </span>&#123;</span><br><span class="line">        list1 = list;</span><br><span class="line">        list2 = list;</span><br><span class="line">        list3 = list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        assign1(<span class="keyword">new</span> ArrayList());</span><br><span class="line">        assign2(<span class="keyword">new</span> ArrayList());</span><br><span class="line">        <span class="comment">//- assign3(new ArrayList());</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method assign3 in class UnboundedWildcards1</span></span><br><span class="line">        <span class="comment">// is applied to given types</span></span><br><span class="line">        <span class="comment">// assign3(new ArrayList());</span></span><br><span class="line">        <span class="comment">//        ^</span></span><br><span class="line">        <span class="comment">// required: List&lt;? extends Object&gt;</span></span><br><span class="line">        <span class="comment">// found: ArrayList</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">// assign3(new ArrayList());</span></span><br><span class="line">        <span class="comment">//         ^</span></span><br><span class="line">        <span class="comment">// required: List&lt;? extends Object&gt;</span></span><br><span class="line">        <span class="comment">// found:    ArrayList</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line">        assign1(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        assign2(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        assign3(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        <span class="comment">// Both forms are acceptable as List&lt;?&gt;:</span></span><br><span class="line">        List&lt;?&gt; wildList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        wildList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        assign1(wildList);</span><br><span class="line">        assign2(wildList);</span><br><span class="line">        assign3(wildList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å¾ˆå¤šæƒ…å†µéƒ½å’Œæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æƒ…å†µç±»ä¼¼ï¼Œå³ç¼–è¯‘å™¨å¾ˆå°‘å…³å¿ƒä½¿ç”¨çš„æ˜¯åŸç”Ÿç±»å‹è¿˜æ˜¯ <code>&lt;?&gt;</code> ã€‚åœ¨è¿™äº›æƒ…å†µä¸­ï¼Œ<code>&lt;?&gt;</code> å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§è£…é¥°ï¼Œä½†æ˜¯å®ƒä»æ—§æ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œå› ä¸ºï¼Œå®é™…ä¸Šå®ƒæ˜¯åœ¨å£°æ˜ï¼šâ€œæˆ‘æ˜¯æƒ³ç”¨ Java çš„æ³›å‹æ¥ç¼–å†™è¿™æ®µä»£ç ï¼Œæˆ‘åœ¨è¿™é‡Œå¹¶ä¸æ˜¯è¦ç”¨åŸç”Ÿç±»å‹ï¼Œä½†æ˜¯åœ¨å½“å‰è¿™ç§æƒ…å†µä¸‹ï¼Œæ³›å‹å‚æ•°å¯ä»¥æŒæœ‰ä»»ä½•ç±»å‹ã€‚â€<br>ç¬¬äºŒä¸ªç¤ºä¾‹å±•ç¤ºäº†æ— ç•Œé€šé…ç¬¦çš„ä¸€ä¸ªé‡è¦åº”ç”¨ã€‚å½“æˆ‘ä»¬åœ¨å¤„ç†å¤šä¸ªæ³›å‹å‚æ•°æ—¶ï¼Œæœ‰æ—¶å…è®¸ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒæ—¶ä¸ºå…¶ä»–å‚æ•°ç¡®å®šæŸç§ç‰¹å®šç±»å‹çš„è¿™ç§èƒ½åŠ›ä¼šæ˜¾å¾—å¾ˆé‡è¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/UnboundedWildcards2.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnboundedWildcards2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Map map1;</span><br><span class="line">    <span class="keyword">static</span> Map&lt;?,?&gt; map2;</span><br><span class="line">    <span class="keyword">static</span> Map&lt;String,?&gt; map3;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign1</span><span class="params">(Map map)</span> </span>&#123; </span><br><span class="line">        map1 = map; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign2</span><span class="params">(Map&lt;?,?&gt; map)</span> </span>&#123; </span><br><span class="line">        map2 = map; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assign3</span><span class="params">(Map&lt;String,?&gt; map)</span> </span>&#123; </span><br><span class="line">        map3 = map; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        assign1(<span class="keyword">new</span> HashMap());</span><br><span class="line">        assign2(<span class="keyword">new</span> HashMap());</span><br><span class="line">        <span class="comment">//- assign3(new HashMap());</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method assign3 in class UnboundedWildcards2</span></span><br><span class="line">        <span class="comment">// is applied to given types</span></span><br><span class="line">        <span class="comment">//     assign3(new HashMap());</span></span><br><span class="line">        <span class="comment">//            ^</span></span><br><span class="line">        <span class="comment">//   required: Map&lt;String,?&gt;</span></span><br><span class="line">        <span class="comment">//   found: HashMap</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//     assign3(new HashMap());</span></span><br><span class="line">        <span class="comment">//             ^</span></span><br><span class="line">        <span class="comment">//   required: Map&lt;String,?&gt;</span></span><br><span class="line">        <span class="comment">//   found:    HashMap</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line">        assign1(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">        assign2(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">        assign3(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æ‹¥æœ‰çš„å…¨éƒ½æ˜¯æ— ç•Œé€šé…ç¬¦æ—¶ï¼Œå°±åƒåœ¨ <code>Map&lt;?,?&gt;</code> ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œç¼–è¯‘å™¨çœ‹èµ·æ¥å°±æ— æ³•å°†å…¶ä¸åŸç”Ÿ <strong>Map</strong> åŒºåˆ†å¼€äº†ã€‚å¦å¤–ï¼Œ <strong>UnboundedWildcards1.java</strong> å±•ç¤ºäº†ç¼–è¯‘å™¨å¤„ç†  <code>List&lt;?&gt;</code> å’Œ <code>List&lt;? extends Object&gt;</code> æ˜¯ä¸åŒçš„ã€‚<br>ä»¤äººå›°æƒ‘çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¹¶éæ€»æ˜¯å…³æ³¨åƒ <code>List</code> å’Œ <code>List&lt;?&gt;</code> ä¹‹é—´çš„è¿™ç§å·®å¼‚ï¼Œå› æ­¤å®ƒä»¬çœ‹èµ·æ¥å°±åƒæ˜¯ç›¸åŒçš„äº‹ç‰©ã€‚äº‹å®ä¸Šï¼Œå› ä¸ºæ³›å‹å‚æ•°æ“¦é™¤åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªè¾¹ç•Œï¼Œå› æ­¤ <code>List&lt;?&gt;</code> çœ‹èµ·æ¥ç­‰ä»·äº <code>List&lt;Object&gt;</code> ï¼Œè€Œ <strong>List</strong> å®é™…ä¸Šä¹Ÿæ˜¯ <code>List&lt;Object&gt;</code> â€”â€”é™¤éè¿™äº›è¯­å¥éƒ½ä¸ä¸ºçœŸã€‚<strong>List</strong> å®é™…ä¸Šè¡¨ç¤ºâ€œæŒæœ‰ä»»ä½• <strong>Object</strong> ç±»å‹çš„åŸç”Ÿ <strong>List ** â€ï¼Œè€Œ <code>List&lt;?&gt;</code> è¡¨ç¤ºâ€œå…·æœ‰æŸç§ç‰¹å®šç±»å‹çš„éåŸç”Ÿ **List</strong> ï¼Œåªæ˜¯æˆ‘ä»¬ä¸çŸ¥é“ç±»å‹æ˜¯ä»€ä¹ˆã€‚â€<br>ç¼–è¯‘å™¨ä½•æ—¶æ‰ä¼šå…³æ³¨åŸç”Ÿç±»å‹å’Œæ¶‰åŠæ— ç•Œé€šé…ç¬¦çš„ç±»å‹ä¹‹é—´çš„å·®å¼‚å‘¢ï¼Ÿä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨äº†å‰é¢å®šä¹‰çš„ <code>Holder&lt;T&gt;</code> ç±»ï¼Œå®ƒåŒ…å«æ¥å— <strong>Holder</strong> ä½œä¸ºå‚æ•°çš„å„ç§æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰ä¸åŒçš„å½¢å¼ï¼šä½œä¸ºåŸç”Ÿç±»å‹ï¼Œå…·æœ‰å…·ä½“çš„ç±»å‹å‚æ•°ä»¥åŠå…·æœ‰æ— ç•Œé€šé…ç¬¦å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Wildcards.java</span></span><br><span class="line"><span class="comment">// Exploring the meaning of wildcards</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wildcards</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Raw argument:</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rawArgs</span><span class="params">(Holder holder, Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//- holder.set(arg);</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked call to set(T)</span></span><br><span class="line">        <span class="comment">// as a member of the raw type Holder</span></span><br><span class="line">        <span class="comment">//     holder.set(arg);</span></span><br><span class="line">        <span class="comment">//               ^</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in class Holder</span></span><br><span class="line">        <span class="comment">// 1 warning</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can't do this; don't have any 'T':</span></span><br><span class="line">        <span class="comment">// T t = holder.get();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// OK, but type information is lost:</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Like rawArgs(), but errors instead of warnings:</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unboundedArg</span><span class="params">(Holder&lt;?&gt; holder, Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//- holder.set(arg);</span></span><br><span class="line">        <span class="comment">// error: method set in class Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     holder.set(arg);</span></span><br><span class="line">        <span class="comment">//           ^</span></span><br><span class="line">        <span class="comment">//   required: CAP#1</span></span><br><span class="line">        <span class="comment">//   found: Object</span></span><br><span class="line">        <span class="comment">//   reason: argument mismatch;</span></span><br><span class="line">        <span class="comment">//     Object cannot be converted to CAP#1</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in class Holder</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Object from capture of ?</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can't do this; don't have any 'T':</span></span><br><span class="line">        <span class="comment">// T t = holder.get();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// OK, but type information is lost:</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">exact1</span><span class="params">(Holder&lt;T&gt; holder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">exact2</span><span class="params">(Holder&lt;T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        holder.set(arg);</span><br><span class="line">        <span class="keyword">return</span> holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">wildSubtype</span><span class="params">(Holder&lt;? extends T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//- holder.set(arg);</span></span><br><span class="line">        <span class="comment">// error: method set in class Holder&lt;T#2&gt;</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     holder.set(arg);</span></span><br><span class="line">        <span class="comment">//           ^</span></span><br><span class="line">        <span class="comment">//   required: CAP#1</span></span><br><span class="line">        <span class="comment">//   found: T#1</span></span><br><span class="line">        <span class="comment">//   reason: argument mismatch;</span></span><br><span class="line">        <span class="comment">//     T#1 cannot be converted to CAP#1</span></span><br><span class="line">        <span class="comment">//   where T#1,T#2 are type-variables:</span></span><br><span class="line">        <span class="comment">//     T#1 extends Object declared in method</span></span><br><span class="line">        <span class="comment">//     &lt;T#1&gt;wildSubtype(Holder&lt;? extends T#1&gt;,T#1)</span></span><br><span class="line">        <span class="comment">//     T#2 extends Object declared in class Holder</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends T#1 from</span></span><br><span class="line">        <span class="comment">//       capture of ? extends T#1</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line">        <span class="keyword">return</span> holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">wildSupertype</span><span class="params">(Holder&lt;? <span class="keyword">super</span> T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        holder.set(arg);</span><br><span class="line">        <span class="comment">//- T t = holder.get();</span></span><br><span class="line">        <span class="comment">// error: incompatible types:</span></span><br><span class="line">        <span class="comment">// CAP#1 cannot be converted to T</span></span><br><span class="line">        <span class="comment">//     T t = holder.get();</span></span><br><span class="line">        <span class="comment">//                     ^</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in method</span></span><br><span class="line">        <span class="comment">//       &lt;T&gt;wildSupertype(Holder&lt;? super T&gt;,T)</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Object super:</span></span><br><span class="line">        <span class="comment">//       T from capture of ? super T</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// OK, but type information is lost:</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Holder raw = <span class="keyword">new</span> Holder&lt;&gt;();</span><br><span class="line">        <span class="comment">// Or:</span></span><br><span class="line">        raw = <span class="keyword">new</span> Holder();</span><br><span class="line">        Holder&lt;Long&gt; qualified = <span class="keyword">new</span> Holder&lt;&gt;();</span><br><span class="line">        Holder&lt;?&gt; unbounded = <span class="keyword">new</span> Holder&lt;&gt;();</span><br><span class="line">        Holder&lt;? extends Long&gt; bounded = <span class="keyword">new</span> Holder&lt;&gt;();</span><br><span class="line">        Long lng = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">        rawArgs(raw, lng);</span><br><span class="line">        rawArgs(qualified, lng);</span><br><span class="line">        rawArgs(unbounded, lng);</span><br><span class="line">        rawArgs(bounded, lng);</span><br><span class="line"></span><br><span class="line">        unboundedArg(raw, lng);</span><br><span class="line">        unboundedArg(qualified, lng);</span><br><span class="line">        unboundedArg(unbounded, lng);</span><br><span class="line">        unboundedArg(bounded, lng);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- Object r1 = exact1(raw);</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method exact1 in class Wildcards is applied</span></span><br><span class="line">        <span class="comment">// to given types</span></span><br><span class="line">        <span class="comment">//      Object r1 = exact1(raw);</span></span><br><span class="line">        <span class="comment">//                        ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//   found: Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;exact1(Holder&lt;T&gt;)</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//      Object r1 = exact1(raw);</span></span><br><span class="line">        <span class="comment">//                         ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//   found:    Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;exact1(Holder&lt;T&gt;)</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line"></span><br><span class="line">        Long r2 = exact1(qualified);</span><br><span class="line">        Object r3 = exact1(unbounded); <span class="comment">// Must return Object</span></span><br><span class="line">        Long r4 = exact1(bounded);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- Long r5 = exact2(raw, lng);</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method exact2 in class Wildcards is</span></span><br><span class="line">        <span class="comment">// applied to given types</span></span><br><span class="line">        <span class="comment">//     Long r5 = exact2(raw, lng);</span></span><br><span class="line">        <span class="comment">//                     ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder,Long</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//       method &lt;T&gt;exact2(Holder&lt;T&gt;,T)</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//     Long r5 = exact2(raw, lng);</span></span><br><span class="line">        <span class="comment">//                      ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//   found:    Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//       method &lt;T&gt;exact2(Holder&lt;T&gt;,T)</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line"></span><br><span class="line">        Long r6 = exact2(qualified, lng);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- Long r7 = exact2(unbounded, lng);</span></span><br><span class="line">        <span class="comment">// error: method exact2 in class Wildcards</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     Long r7 = exact2(unbounded, lng);</span></span><br><span class="line">        <span class="comment">//               ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder&lt;CAP#1&gt;,Long</span></span><br><span class="line">        <span class="comment">//   reason: inference variable T has</span></span><br><span class="line">        <span class="comment">//     incompatible bounds</span></span><br><span class="line">        <span class="comment">//     equality constraints: CAP#1</span></span><br><span class="line">        <span class="comment">//     lower bounds: Long</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//       method &lt;T&gt;exact2(Holder&lt;T&gt;,T)</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Object from capture of ?</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//- Long r8 = exact2(bounded, lng);</span></span><br><span class="line">        <span class="comment">// error: method exact2 in class Wildcards</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//      Long r8 = exact2(bounded, lng);</span></span><br><span class="line">        <span class="comment">//                ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder&lt;CAP#1&gt;,Long</span></span><br><span class="line">        <span class="comment">//   reason: inference variable T</span></span><br><span class="line">        <span class="comment">//     has incompatible bounds</span></span><br><span class="line">        <span class="comment">//     equality constraints: CAP#1</span></span><br><span class="line">        <span class="comment">//     lower bounds: Long</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//       method &lt;T&gt;exact2(Holder&lt;T&gt;,T)</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Long from</span></span><br><span class="line">        <span class="comment">//       capture of ? extends Long</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//- Long r9 = wildSubtype(raw, lng);</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method wildSubtype in class Wildcards</span></span><br><span class="line">        <span class="comment">// is applied to given types</span></span><br><span class="line">        <span class="comment">//     Long r9 = wildSubtype(raw, lng);</span></span><br><span class="line">        <span class="comment">//                          ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? extends T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder,Long</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSubtype(Holder&lt;? extends T&gt;,T)</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//     Long r9 = wildSubtype(raw, lng);</span></span><br><span class="line">        <span class="comment">//                           ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? extends T&gt;</span></span><br><span class="line">        <span class="comment">//   found:    Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSubtype(Holder&lt;? extends T&gt;,T)</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line"></span><br><span class="line">        Long r10 = wildSubtype(qualified, lng);</span><br><span class="line">        <span class="comment">// OK, but can only return Object:</span></span><br><span class="line">        Object r11 = wildSubtype(unbounded, lng);</span><br><span class="line">        Long r12 = wildSubtype(bounded, lng);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- wildSupertype(raw, lng);</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">//   method wildSupertype in class Wildcards</span></span><br><span class="line">        <span class="comment">//   is applied to given types</span></span><br><span class="line">        <span class="comment">//     wildSupertype(raw, lng);</span></span><br><span class="line">        <span class="comment">//                  ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? super T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder,Long</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSupertype(Holder&lt;? super T&gt;,T)</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//     wildSupertype(raw, lng);</span></span><br><span class="line">        <span class="comment">//                   ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? super T&gt;</span></span><br><span class="line">        <span class="comment">//   found:    Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSupertype(Holder&lt;? super T&gt;,T)</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line"></span><br><span class="line">        wildSupertype(qualified, lng);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- wildSupertype(unbounded, lng);</span></span><br><span class="line">        <span class="comment">// error: method wildSupertype in class Wildcards</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     wildSupertype(unbounded, lng);</span></span><br><span class="line">        <span class="comment">//     ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? super T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder&lt;CAP#1&gt;,Long</span></span><br><span class="line">        <span class="comment">//   reason: cannot infer type-variable(s) T</span></span><br><span class="line">        <span class="comment">//     (argument mismatch; Holder&lt;CAP#1&gt;</span></span><br><span class="line">        <span class="comment">//     cannot be converted to Holder&lt;? super T&gt;)</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSupertype(Holder&lt;? super T&gt;,T)</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Object from capture of ?</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//- wildSupertype(bounded, lng);</span></span><br><span class="line">        <span class="comment">// error: method wildSupertype in class Wildcards</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     wildSupertype(bounded, lng);</span></span><br><span class="line">        <span class="comment">//     ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;? super T&gt;,T</span></span><br><span class="line">        <span class="comment">//   found: Holder&lt;CAP#1&gt;,Long</span></span><br><span class="line">        <span class="comment">//   reason: cannot infer type-variable(s) T</span></span><br><span class="line">        <span class="comment">//     (argument mismatch; Holder&lt;CAP#1&gt;</span></span><br><span class="line">        <span class="comment">//     cannot be converted to Holder&lt;? super T&gt;)</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;wildSupertype(Holder&lt;? super T&gt;,T)</span></span><br><span class="line">        <span class="comment">//   where CAP#1 is a fresh type-variable:</span></span><br><span class="line">        <span class="comment">//     CAP#1 extends Long from capture of</span></span><br><span class="line">        <span class="comment">//     ? extends Long</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>rawArgs()</code> ä¸­ï¼Œç¼–è¯‘å™¨çŸ¥é“ <code>Holder</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œå› æ­¤å³ä½¿å®ƒåœ¨è¿™é‡Œè¢«è¡¨ç¤ºæˆä¸€ä¸ªåŸç”Ÿç±»å‹ï¼Œç¼–è¯‘å™¨ä»æ—§çŸ¥é“å‘ <code>set()</code> ä¼ é€’ä¸€ä¸ª <strong>Object</strong> æ˜¯ä¸å®‰å…¨çš„ã€‚ç”±äºå®ƒæ˜¯åŸç”Ÿç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»ä½•ç±»å‹çš„å¯¹è±¡ä¼ é€’ç»™ <code>set()</code> ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å°†è¢«å‘ä¸Šè½¬å‹ä¸º <strong>Object</strong> ã€‚å› æ­¤æ— è®ºä½•æ—¶ï¼Œåªè¦ä½¿ç”¨äº†åŸç”Ÿç±»å‹ï¼Œéƒ½ä¼šæ”¾å¼ƒç¼–è¯‘æœŸæ£€æŸ¥ã€‚å¯¹ <code>get()</code> çš„è°ƒç”¨è¯´æ˜äº†ç›¸åŒçš„é—®é¢˜ï¼šæ²¡æœ‰ä»»ä½• <strong>T</strong> ç±»å‹çš„å¯¹è±¡ï¼Œå› æ­¤ç»“æœåªèƒ½æ˜¯ä¸€ä¸ª <strong>Object</strong>ã€‚<br>äººä»¬å¾ˆè‡ªç„¶åœ°ä¼šå¼€å§‹è€ƒè™‘åŸç”Ÿ <code>Holder</code> ä¸ <code>Holder&lt;?&gt;</code> æ˜¯å¤§è‡´ç›¸åŒçš„äº‹ç‰©ã€‚ä½†æ˜¯ <code>unboundedArg()</code> å¼ºè°ƒå®ƒä»¬æ˜¯ä¸åŒçš„â€”â€”å®ƒæ­ç¤ºäº†ç›¸åŒçš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒå°†è¿™äº›é—®é¢˜ä½œä¸ºé”™è¯¯è€Œä¸æ˜¯è­¦å‘ŠæŠ¥å‘Šï¼Œå› ä¸ºåŸç”Ÿ <strong>Holder</strong> å°†æŒæœ‰ä»»ä½•ç±»å‹çš„ç»„åˆï¼Œè€Œ <code>Holder&lt;?&gt;</code> å°†æŒæœ‰å…·æœ‰æŸç§å…·ä½“ç±»å‹çš„åŒæ„é›†åˆï¼Œå› æ­¤ä¸èƒ½åªæ˜¯å‘å…¶ä¸­ä¼ é€’ <strong>Object</strong> ã€‚<br>åœ¨ <code>exact1()</code> å’Œ <code>exact2()</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†ç¡®åˆ‡çš„æ³›å‹å‚æ•°â€”â€”æ²¡æœ‰ä»»ä½•é€šé…ç¬¦ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œ<code>exact2()</code>ä¸ <code>exact1()</code> å…·æœ‰ä¸åŒçš„é™åˆ¶ï¼Œå› ä¸ºå®ƒæœ‰é¢å¤–çš„å‚æ•°ã€‚<br>åœ¨ <code>wildSubtype()</code> ä¸­ï¼Œåœ¨ <strong>Holder</strong> ç±»å‹ä¸Šçš„é™åˆ¶è¢«æ”¾æ¾ä¸ºåŒ…æ‹¬æŒæœ‰ä»»ä½•æ‰©å±•è‡ª <strong>T</strong> çš„å¯¹è±¡çš„ <strong>Holder</strong> ã€‚è¿™è¿˜æ˜¯æ„å‘³ç€å¦‚æœ T æ˜¯ <strong>Fruit</strong> ï¼Œé‚£ä¹ˆ <code>holder</code> å¯ä»¥æ˜¯ <code>Holder&lt;Apple&gt;</code> ï¼Œè¿™æ˜¯åˆæ³•çš„ã€‚ä¸ºäº†é˜²æ­¢å°† <strong>Orange</strong> æ”¾ç½®åˆ° <code>Holder&lt;Apple&gt;</code> ä¸­ï¼Œå¯¹ <code>set()</code> çš„è°ƒç”¨ï¼ˆæˆ–è€…å¯¹ä»»ä½•æ¥å—è¿™ä¸ªç±»å‹å‚æ•°ä¸ºå‚æ•°çš„æ–¹æ³•çš„è°ƒç”¨ï¼‰éƒ½æ˜¯ä¸å…è®¸çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»æ—§çŸ¥é“ä»»ä½•æ¥è‡ª <code>Holder&lt;ï¼Ÿextends Fruit&gt;</code> çš„å¯¹è±¡è‡³å°‘æ˜¯ <strong>Fruit</strong> ï¼Œå› æ­¤ <code>get()</code> ï¼ˆæˆ–è€…ä»»ä½•å°†äº§ç”Ÿå…·æœ‰è¿™ä¸ªç±»å‹å‚æ•°çš„è¿”å›å€¼çš„æ–¹æ³•ï¼‰éƒ½æ˜¯å…è®¸çš„ã€‚<br><code>wildSupertype()</code> å±•ç¤ºäº†è¶…ç±»å‹é€šé…ç¬¦ï¼Œè¿™ä¸ªæ–¹æ³•å±•ç¤ºäº†ä¸ <code>wildSubtype()</code> ç›¸åçš„è¡Œä¸ºï¼š<code>holder</code> å¯ä»¥æ˜¯æŒæœ‰ä»»ä½• T çš„åŸºç±»å‹çš„å®¹å™¨ã€‚å› æ­¤ï¼Œ <code>set()</code> å¯ä»¥æ¥å— <strong>T</strong> ï¼Œå› ä¸ºä»»ä½•å¯ä»¥å·¥ä½œäºåŸºç±»çš„å¯¹è±¡éƒ½å¯ä»¥å¤šæ€åœ°ä½œç”¨äºå¯¼å‡ºç±»ï¼ˆè¿™é‡Œå°±æ˜¯ <strong>T</strong> ï¼‰ã€‚ä½†æ˜¯ï¼Œå°è¯•ç€è°ƒç”¨ <code>get()</code> æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºç”± <code>holder</code> æŒæœ‰çš„ç±»å‹å¯ä»¥æ˜¯ä»»ä½•è¶…ç±»å‹ï¼Œå› æ­¤å”¯ä¸€å®‰å…¨çš„ç±»å‹å°±æ˜¯ <strong>Object</strong> ã€‚<br>è¿™ä¸ªç¤ºä¾‹è¿˜å±•ç¤ºäº†å¯¹äºåœ¨ <code>unbounded()</code> ä¸­ä½¿ç”¨æ— ç•Œé€šé…ç¬¦èƒ½å¤Ÿåšä»€ä¹ˆä¸èƒ½åšä»€ä¹ˆæ‰€åšå‡ºçš„é™åˆ¶ï¼šå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ <strong>T</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å°† <code>set()</code> æˆ– <code>get()</code> ä½œç”¨äº <strong>T</strong> ä¸Šã€‚</p><p>åœ¨ <code>main()</code> æ–¹æ³•ä¸­æˆ‘ä»¬çœ‹åˆ°äº†æŸäº›æ–¹æ³•åœ¨æ¥å—æŸäº›ç±»å‹çš„å‚æ•°æ—¶æ²¡æœ‰æŠ¥é”™å’Œè­¦å‘Šã€‚ä¸ºäº†è¿ç§»å…¼å®¹æ€§ï¼Œ<code>rawArgs()</code>  å°†æ¥å—æ‰€æœ‰ <strong>Holder</strong> çš„ä¸åŒå˜ä½“ï¼Œè€Œä¸ä¼šäº§ç”Ÿè­¦å‘Šã€‚<code>unboundedArg()</code> æ–¹æ³•ä¹Ÿå¯ä»¥æ¥å—ç›¸åŒçš„æ‰€æœ‰ç±»å‹ï¼Œå°½ç®¡å¦‚å‰æ‰€è¿°ï¼Œå®ƒåœ¨æ–¹æ³•ä½“å†…éƒ¨å¤„ç†è¿™äº›ç±»å‹çš„æ–¹å¼å¹¶ä¸ç›¸åŒã€‚</p><p>å¦‚æœå‘æ¥å—â€œç¡®åˆ‡â€æ³›å‹ç±»å‹ï¼ˆæ²¡æœ‰é€šé…ç¬¦ï¼‰çš„æ–¹æ³•ä¼ é€’ä¸€ä¸ªåŸç”Ÿ <strong>Holder</strong> å¼•ç”¨ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šï¼Œå› ä¸ºç¡®åˆ‡çš„å‚æ•°æœŸæœ›å¾—åˆ°åœ¨åŸç”Ÿç±»å‹ä¸­å¹¶ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚å¦‚æœå‘ <code>exact1()</code> ä¼ é€’ä¸€ä¸ªæ— ç•Œå¼•ç”¨ï¼Œå°±ä¸ä¼šæœ‰ä»»ä½•å¯ä»¥ç¡®å®šè¿”å›ç±»å‹çš„ç±»å‹ä¿¡æ¯ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œ<code>exact2()</code> å…·æœ‰æœ€å¤šçš„é™åˆ¶ï¼Œå› ä¸ºå®ƒå¸Œæœ›ç²¾ç¡®åœ°å¾—åˆ°ä¸€ä¸ª <code>Holder&lt;T&gt;</code> ï¼Œä»¥åŠä¸€ä¸ªå…·æœ‰ç±»å‹ <strong>T</strong> çš„å‚æ•°ï¼Œæ­£ç”±äºæ­¤ï¼Œå®ƒå°†äº§ç”Ÿé”™è¯¯æˆ–è­¦å‘Šï¼Œé™¤éæä¾›ç¡®åˆ‡çš„å‚æ•°ã€‚æœ‰æ—¶ï¼Œè¿™æ ·åšå¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœå®ƒè¿‡äºå—é™ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œè¿™å–å†³äºæ˜¯å¦æƒ³è¦ä»æ³›å‹å‚æ•°ä¸­è¿”å›ç±»å‹ç¡®å®šçš„è¿”å›å€¼ï¼ˆå°±åƒåœ¨ <code>wildSubtype()</code> ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼‰ï¼Œæˆ–è€…æ˜¯å¦æƒ³è¦å‘æ³›å‹å‚æ•°ä¼ é€’ç±»å‹ç¡®å®šçš„å‚æ•°ï¼ˆå°±åƒåœ¨ <code>wildSupertype()</code> ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼‰ã€‚<br>å› æ­¤ï¼Œä½¿ç”¨ç¡®åˆ‡ç±»å‹æ¥æ›¿ä»£é€šé…ç¬¦ç±»å‹çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç”¨æ³›å‹å‚æ•°æ¥åšæ›´å¤šçš„äº‹ï¼Œä½†æ˜¯ä½¿ç”¨é€šé…ç¬¦ä½¿å¾—æˆ‘ä»¬å¿…é¡»æ¥å—èŒƒå›´æ›´å®½çš„å‚æ•°åŒ–ç±»å‹ä½œä¸ºå‚æ•°ã€‚å› æ­¤ï¼Œå¿…é¡»é€ä¸ªæƒ…å†µåœ°æƒè¡¡åˆ©å¼Šï¼Œæ‰¾åˆ°æ›´é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚çš„æ–¹æ³•ã€‚</p><h3 id="æ•è·è½¬æ¢"><a href="#æ•è·è½¬æ¢" class="headerlink" title="æ•è·è½¬æ¢"></a>æ•è·è½¬æ¢</h3><p>æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µéœ€è¦ä½¿ç”¨ <code>&lt;?&gt;</code> è€Œä¸æ˜¯åŸç”Ÿç±»å‹ã€‚å¦‚æœå‘ä¸€ä¸ªä½¿ç”¨ <code>&lt;?&gt;</code> çš„æ–¹æ³•ä¼ é€’åŸç”Ÿç±»å‹ï¼Œé‚£ä¹ˆå¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œå¯èƒ½ä¼šæ¨æ–­å‡ºå®é™…çš„ç±»å‹å‚æ•°ï¼Œä½¿å¾—è¿™ä¸ªæ–¹æ³•å¯ä»¥å›è½¬å¹¶è°ƒç”¨å¦ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªç¡®åˆ‡ç±»å‹çš„æ–¹æ³•ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†è¿™ç§æŠ€æœ¯ï¼Œå®ƒè¢«ç§°ä¸ºæ•è·è½¬æ¢ï¼Œå› ä¸ºæœªæŒ‡å®šçš„é€šé…ç¬¦ç±»å‹è¢«æ•è·ï¼Œå¹¶è¢«è½¬æ¢ä¸ºç¡®åˆ‡ç±»å‹ã€‚è¿™é‡Œï¼Œæœ‰å…³è­¦å‘Šçš„æ³¨é‡Šåªæœ‰åœ¨ <code>@SuppressWarnings</code> æ³¨è§£è¢«ç§»é™¤ä¹‹åæ‰èƒ½èµ·ä½œç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CaptureConversion.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureConversion</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">f1</span><span class="params">(Holder&lt;T&gt; holder)</span> </span>&#123;</span><br><span class="line">        T t = holder.get();</span><br><span class="line">        System.out.println(t.getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f2</span><span class="params">(Holder&lt;?&gt; holder)</span> </span>&#123;</span><br><span class="line">        f1(holder); <span class="comment">// Call with captured type</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Holder raw = <span class="keyword">new</span> Holder&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        f1(raw);</span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked method invocation:</span></span><br><span class="line">        <span class="comment">// method f1 in class CaptureConversion</span></span><br><span class="line">        <span class="comment">// is applied to given types</span></span><br><span class="line">        <span class="comment">//     f1(raw);</span></span><br><span class="line">        <span class="comment">//       ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//   found: Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;f1(Holder&lt;T&gt;)</span></span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked conversion</span></span><br><span class="line">        <span class="comment">//     f1(raw);</span></span><br><span class="line">        <span class="comment">//        ^</span></span><br><span class="line">        <span class="comment">//   required: Holder&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//   found:    Holder</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in</span></span><br><span class="line">        <span class="comment">//     method &lt;T&gt;f1(Holder&lt;T&gt;)</span></span><br><span class="line">        <span class="comment">// 2 warnings</span></span><br><span class="line">        f2(raw); <span class="comment">// No warnings</span></span><br><span class="line">        </span><br><span class="line">        Holder rawBasic = <span class="keyword">new</span> Holder();</span><br><span class="line">        rawBasic.set(<span class="keyword">new</span> Object());</span><br><span class="line">        <span class="comment">// warning: [unchecked] unchecked call to set(T)</span></span><br><span class="line">        <span class="comment">// as a member of the raw type Holder</span></span><br><span class="line">        <span class="comment">//     rawBasic.set(new Object());</span></span><br><span class="line">        <span class="comment">//                 ^</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends Object declared in class Holder</span></span><br><span class="line">        <span class="comment">// 1 warning</span></span><br><span class="line">        f2(rawBasic); <span class="comment">// No warnings</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Upcast to Holder&lt;?&gt;, still figures it out:</span></span><br><span class="line">        Holder&lt;?&gt; wildcarded = <span class="keyword">new</span> Holder&lt;&gt;(<span class="number">1.0</span>);</span><br><span class="line">        f2(wildcarded);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Integer</span></span><br><span class="line"><span class="comment">Integer</span></span><br><span class="line"><span class="comment">Object</span></span><br><span class="line"><span class="comment">Double</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>f1()</code> ä¸­çš„ç±»å‹å‚æ•°éƒ½æ˜¯ç¡®åˆ‡çš„ï¼Œæ²¡æœ‰é€šé…ç¬¦æˆ–è¾¹ç•Œã€‚åœ¨ <code>f2()</code> ä¸­ï¼Œ<strong>Holder</strong> å‚æ•°æ˜¯ä¸€ä¸ªæ— ç•Œé€šé…ç¬¦ï¼Œå› æ­¤å®ƒçœ‹èµ·æ¥æ˜¯æœªçŸ¥çš„ã€‚ä½†æ˜¯ï¼Œåœ¨ <code>f2()</code> ä¸­è°ƒç”¨äº† <code>f1()</code>ï¼Œè€Œ <code>f1()</code> éœ€è¦ä¸€ä¸ªå·²çŸ¥å‚æ•°ã€‚è¿™é‡Œæ‰€å‘ç”Ÿçš„æ˜¯ï¼šåœ¨è°ƒç”¨ <code>f2()</code> çš„è¿‡ç¨‹ä¸­æ•è·äº†å‚æ•°ç±»å‹ï¼Œå¹¶åœ¨è°ƒç”¨ <code>f1()</code> æ—¶ä½¿ç”¨äº†è¿™ç§ç±»å‹ã€‚<br>æˆ‘ä»¬å¯èƒ½æƒ³çŸ¥é“è¿™é¡¹æŠ€æœ¯æ˜¯å¦å¯ä»¥ç”¨äºå†™å…¥ï¼Œä½†æ˜¯è¿™è¦æ±‚åœ¨ä¼ é€’ <code>Holder&lt;?&gt;</code> æ—¶åŒæ—¶ä¼ é€’ä¸€ä¸ªå…·ä½“ç±»å‹ã€‚æ•è·è½¬æ¢åªæœ‰åœ¨è¿™æ ·çš„æƒ…å†µä¸‹å¯ä»¥å·¥ä½œï¼šå³åœ¨æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¡®åˆ‡çš„ç±»å‹ã€‚æ³¨æ„ï¼Œä¸èƒ½ä» <code>f2()</code> ä¸­è¿”å› <strong>T</strong>ï¼Œå› ä¸º <strong>T</strong> å¯¹äº <code>f2()</code> æ¥è¯´æ˜¯æœªçŸ¥çš„ã€‚æ•è·è½¬æ¢ååˆ†æœ‰è¶£ï¼Œä½†æ˜¯éå¸¸å—é™ã€‚</p><!-- Issues --><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æœ¬èŠ‚å°†é˜è¿°åœ¨ä½¿ç”¨ Java æ³›å‹æ—¶ä¼šå‡ºç°çš„å„ç±»é—®é¢˜ã€‚</p><h3 id="ä»»ä½•åŸºæœ¬ç±»å‹éƒ½ä¸èƒ½ä½œä¸ºç±»å‹å‚æ•°"><a href="#ä»»ä½•åŸºæœ¬ç±»å‹éƒ½ä¸èƒ½ä½œä¸ºç±»å‹å‚æ•°" class="headerlink" title="ä»»ä½•åŸºæœ¬ç±»å‹éƒ½ä¸èƒ½ä½œä¸ºç±»å‹å‚æ•°"></a>ä»»ä½•åŸºæœ¬ç±»å‹éƒ½ä¸èƒ½ä½œä¸ºç±»å‹å‚æ•°</h3><p>æ­£å¦‚æœ¬ç« æ—©å…ˆæåˆ°çš„ï¼ŒJava æ³›å‹çš„é™åˆ¶ä¹‹ä¸€æ˜¯ä¸èƒ½å°†åŸºæœ¬ç±»å‹ç”¨ä½œç±»å‹å‚æ•°ã€‚å› æ­¤ï¼Œä¸èƒ½åˆ›å»º  <code>ArrayList&lt;int&gt;</code> ä¹‹ç±»çš„ä¸œè¥¿ã€‚<br>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨åŸºæœ¬ç±»å‹çš„åŒ…è£…å™¨ç±»ä»¥åŠè‡ªåŠ¨è£…ç®±æœºåˆ¶ã€‚å¦‚æœåˆ›å»ºä¸€ä¸ª <code>ArrayList&lt;Integer&gt;</code>ï¼Œå¹¶å°†åŸºæœ¬ç±»å‹ <strong>int</strong> åº”ç”¨äºè¿™ä¸ªé›†åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å‘ç°è‡ªåŠ¨è£…ç®±æœºåˆ¶å°†è‡ªåŠ¨åœ°å®ç° <strong>int</strong> åˆ° <strong>Integer</strong> çš„åŒå‘è½¬æ¢â€”â€”å› æ­¤ï¼Œè¿™å‡ ä¹å°±åƒæ˜¯æœ‰ä¸€ä¸ª <code>ArrayList&lt;int&gt;</code> ä¸€æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ListOfInt.java</span></span><br><span class="line"><span class="comment">// Autoboxing compensates for the inability</span></span><br><span class="line"><span class="comment">// to use primitives in generics</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListOfInt</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; li = IntStream.range(<span class="number">38</span>, <span class="number">48</span>)</span><br><span class="line">            .boxed() <span class="comment">// Converts ints to Integers</span></span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        System.out.println(li);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[38, 39, 40, 41, 42, 43, 44, 45, 46, 47]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆå·¥ä½œå¾—å¾ˆå¥½â€”â€”èƒ½å¤ŸæˆåŠŸåœ°å­˜å‚¨å’Œè¯»å– <strong>int</strong>ï¼Œè‡ªåŠ¨è£…ç®±éšè—äº†è½¬æ¢çš„è¿‡ç¨‹ã€‚ä½†æ˜¯å¦‚æœæ€§èƒ½æˆä¸ºé—®é¢˜çš„è¯ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸“é—¨ä¸ºåŸºæœ¬ç±»å‹é€‚é…çš„ç‰¹æ®Šç‰ˆæœ¬çš„é›†åˆï¼›ä¸€ä¸ªå¼€æºç‰ˆæœ¬çš„å®ç°æ˜¯ <strong>org.apache.commons.collections.primitives</strong>ã€‚<br>ä¸‹é¢æ˜¯å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå®ƒå¯ä»¥åˆ›å»ºæŒæœ‰ <strong>Byte</strong> çš„ <strong>Set</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ByteSet.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteSet</span> </span>&#123;</span><br><span class="line">    Byte[] possibles = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span> &#125;;</span><br><span class="line">    Set&lt;Byte&gt; mySet = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(possibles));</span><br><span class="line">    <span class="comment">// But you can't do this:</span></span><br><span class="line">    <span class="comment">// Set&lt;Byte&gt; mySet2 = new HashSet&lt;&gt;(</span></span><br><span class="line">    <span class="comment">// Arrays.&lt;Byte&gt;asList(1,2,3,4,5,6,7,8,9));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨è£…ç®±æœºåˆ¶è§£å†³äº†ä¸€äº›é—®é¢˜ï¼Œä½†å¹¶æ²¡æœ‰è§£å†³æ‰€æœ‰é—®é¢˜ã€‚</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<strong>FillArray</strong> æ¥å£åŒ…å«ä¸€äº›é€šç”¨æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä½¿ç”¨ <strong>Supplier</strong> æ¥ç”¨å¯¹è±¡å¡«å……æ•°ç»„ï¼ˆè¿™ä½¿å¾—ç±»æ³›å‹åœ¨æœ¬ä¾‹ä¸­æ— æ³•å·¥ä½œï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯é™æ€çš„ï¼‰ã€‚<strong>Supplier</strong> å®ç°æ¥è‡ª <a href="book/21-Arrays.md">æ•°ç»„</a> ä¸€ç« ,å¹¶ä¸”åœ¨ <code>main()</code> ä¸­ï¼Œå¯ä»¥çœ‹åˆ° <code>FillArray.fill()</code> ä½¿ç”¨å¯¹è±¡å¡«å……äº†æ•°ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/PrimitiveGenericTest.java</span></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fill an array using a generator:</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FillArray</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; T[] fill(T[] a, Supplier&lt;T&gt; gen) &#123;</span><br><span class="line">        Arrays.setAll(a, n -&gt; gen.get());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span>[] fill(<span class="keyword">int</span>[] a, IntSupplier gen) &#123;</span><br><span class="line">        Arrays.setAll(a, n -&gt; gen.getAsInt());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span>[] fill(<span class="keyword">long</span>[] a, LongSupplier gen) &#123;</span><br><span class="line">        Arrays.setAll(a, n -&gt; gen.getAsLong());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span>[] fill(<span class="keyword">double</span>[] a, DoubleSupplier gen) &#123;</span><br><span class="line">        Arrays.setAll(a, n -&gt; gen.getAsDouble());</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimitiveGenericTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] strings = FillArray.fill(</span><br><span class="line">            <span class="keyword">new</span> String[<span class="number">5</span>], <span class="keyword">new</span> Rand.String(<span class="number">9</span>));</span><br><span class="line">        System.out.println(Arrays.toString(strings));</span><br><span class="line">        <span class="keyword">int</span>[] integers = FillArray.fill(</span><br><span class="line">            <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">9</span>], <span class="keyword">new</span> Rand.Pint());</span><br><span class="line">        System.out.println(Arrays.toString(integers));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[btpenpccu, xszgvgmei, nneeloztd, vewcippcy, gpoalkljl]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479, 6656, 3768, 4948]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨è£…ç®±ä¸é€‚ç”¨äºæ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åˆ›å»º <code>FillArray.fill()</code> çš„é‡è½½ç‰ˆæœ¬ï¼Œæˆ–åˆ›å»ºäº§ç”Ÿ <strong>Wrapped</strong> è¾“å‡ºçš„ç”Ÿæˆå™¨ã€‚ <strong>FillArray</strong> ä»…æ¯” <code>java.util.Arrays.setAll()</code> æœ‰ç”¨ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒè¿”å›å¡«å……çš„æ•°ç»„ã€‚</p><h3 id="å®ç°å‚æ•°åŒ–æ¥å£"><a href="#å®ç°å‚æ•°åŒ–æ¥å£" class="headerlink" title="å®ç°å‚æ•°åŒ–æ¥å£"></a>å®ç°å‚æ•°åŒ–æ¥å£</h3><p>ä¸€ä¸ªç±»ä¸èƒ½å®ç°åŒä¸€ä¸ªæ³›å‹æ¥å£çš„ä¸¤ç§å˜ä½“ï¼Œç”±äºæ“¦é™¤çš„åŸå› ï¼Œè¿™ä¸¤ä¸ªå˜ä½“ä¼šæˆä¸ºç›¸åŒçš„æ¥å£ã€‚ä¸‹é¢æ˜¯äº§ç”Ÿè¿™ç§å†²çªçš„æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/MultipleInterfaceVariants.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"><span class="keyword">package</span> generics;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Payable</span>&lt;<span class="title">T</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Payable</span>&lt;<span class="title">Employee</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hourly</span> <span class="keyword">extends</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Payable</span>&lt;<span class="title">Hourly</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>Hourly</strong> ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸ºæ“¦é™¤ä¼šå°†  <code>Payable&lt;Employe&gt;</code> å’Œ <code>Payable&lt;Hourly&gt;</code> ç®€åŒ–ä¸ºç›¸åŒçš„ç±» <strong>Payable</strong>ï¼Œè¿™æ ·ï¼Œä¸Šé¢çš„ä»£ç å°±æ„å‘³ç€åœ¨é‡å¤ä¸¤æ¬¡åœ°å®ç°ç›¸åŒçš„æ¥å£ã€‚ååˆ†æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœä» <strong>Payable</strong> çš„ä¸¤ç§ç”¨æ³•ä¸­éƒ½ç§»é™¤æ‰æ³›å‹å‚æ•°ï¼ˆå°±åƒç¼–è¯‘å™¨åœ¨æ“¦é™¤é˜¶æ®µæ‰€åšçš„é‚£æ ·ï¼‰è¿™æ®µä»£ç å°±å¯ä»¥ç¼–è¯‘ã€‚</p><p>åœ¨ä½¿ç”¨æŸäº›æ›´åŸºæœ¬çš„ Java æ¥å£ï¼Œä¾‹å¦‚ <code>Comparable&lt;T&gt;</code> æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šå˜å¾—ååˆ†ä»¤äººæ¼ç«ï¼Œå°±åƒæˆ‘ä»¬åœ¨æœ¬èŠ‚ç¨åçœ‹åˆ°çš„é‚£æ ·ã€‚</p><h3 id="è½¬å‹å’Œè­¦å‘Š"><a href="#è½¬å‹å’Œè­¦å‘Š" class="headerlink" title="è½¬å‹å’Œè­¦å‘Š"></a>è½¬å‹å’Œè­¦å‘Š</h3><p>ä½¿ç”¨å¸¦æœ‰æ³›å‹ç±»å‹å‚æ•°çš„è½¬å‹æˆ– <strong>instanceof</strong> ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚ä¸‹é¢çš„é›†åˆåœ¨å†…éƒ¨å°†å„ä¸ªå€¼å­˜å‚¨ä¸º <strong>Object</strong>ï¼Œå¹¶åœ¨è·å–è¿™äº›å€¼æ—¶ï¼Œå†å°†å®ƒä»¬è½¬å‹å› <strong>T</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericCast.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FixedSizeStack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> Object[] storage;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    FixedSizeStack(<span class="keyword">int</span> size) &#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">        storage = <span class="keyword">new</span> Object[size];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; size)</span><br><span class="line">            storage[index++] = item;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index == <span class="number">0</span> ? <span class="keyword">null</span> : (T)storage[--index];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function">Stream&lt;T&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Stream&lt;T&gt;)Arrays.stream(storage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericCast</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> String[] letters = <span class="string">"ABCDEFGHIJKLMNOPQRS"</span>.split(<span class="string">""</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FixedSizeStack&lt;String&gt; strings =</span><br><span class="line">            <span class="keyword">new</span> FixedSizeStack&lt;&gt;(letters.length);</span><br><span class="line">        Arrays.stream(<span class="string">"ABCDEFGHIJKLMNOPQRS"</span>.split(<span class="string">""</span>))</span><br><span class="line">            .forEach(strings::push);</span><br><span class="line">        System.out.println(strings.pop());</span><br><span class="line">        strings.stream()</span><br><span class="line">            .map(s -&gt; s + <span class="string">" "</span>)</span><br><span class="line">            .forEach(System.out::print);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">S</span></span><br><span class="line"><span class="comment">A B C D E F G H I J K L M N O P Q R S</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ <strong>@SuppressWarnings</strong> æ³¨è§£ï¼Œç¼–è¯‘å™¨å°†å¯¹ <code>pop()</code> äº§ç”Ÿ â€œunchecked castâ€ è­¦å‘Šã€‚ç”±äºæ“¦é™¤çš„åŸå› ï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“è¿™ä¸ªè½¬å‹æ˜¯å¦æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸” <code>pop()</code> æ–¹æ³•å®é™…ä¸Šå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•è½¬å‹ã€‚<br>è¿™æ˜¯å› ä¸ºï¼Œ<strong>T</strong> è¢«æ“¦é™¤åˆ°å®ƒçš„ç¬¬ä¸€ä¸ªè¾¹ç•Œï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ <strong>Object</strong> ï¼Œå› æ­¤ <code>pop()</code> å®é™…ä¸Šåªæ˜¯å°† <strong>Object</strong> è½¬å‹ä¸º <strong>Object</strong>ã€‚<br>æœ‰æ—¶ï¼Œæ³›å‹æ²¡æœ‰æ¶ˆé™¤å¯¹è½¬å‹çš„éœ€è¦ï¼Œè¿™å°±ä¼šç”±ç¼–è¯‘å™¨äº§ç”Ÿè­¦å‘Šï¼Œè€Œè¿™ä¸ªè­¦å‘Šæ˜¯ä¸æ°å½“çš„ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/NeedCasting.java</span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NeedCasting</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">            <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]));</span><br><span class="line">        List&lt;Widget&gt; shapes = (List&lt;Widget&gt;)in.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚æˆ‘ä»¬å°†åœ¨ <a href="book/Appendix-Object-Serialization.md">é™„å½•ï¼šå¯¹è±¡åºåˆ—åŒ–</a> ä¸­å­¦åˆ°çš„é‚£æ ·ï¼Œ<code>readObject()</code> æ— æ³•çŸ¥é“å®ƒæ­£åœ¨è¯»å–çš„æ˜¯ä»€ä¹ˆï¼Œå› æ­¤å®ƒè¿”å›çš„æ˜¯å¿…é¡»è½¬å‹çš„å¯¹è±¡ã€‚ä½†æ˜¯å½“æ³¨é‡Šæ‰ <strong>@SuppressWarnings</strong> æ³¨è§£å¹¶ç¼–è¯‘è¿™ä¸ªç¨‹åºæ—¶ï¼Œå°±ä¼šå¾—åˆ°ä¸‹é¢çš„è­¦å‘Šã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NeedCasting.java uses unchecked or unsafe operations.</span><br><span class="line">Recompile with -Xlint:unchecked for details.</span><br><span class="line"></span><br><span class="line">And if you follow the instructions and recompile with  -</span><br><span class="line">Xlint:unchecked :(å¦‚æœéµå¾ªè¿™æ¡æŒ‡ç¤ºï¼Œä½¿ç”¨-Xlint:uncheckedæ¥é‡æ–°ç¼–è¯‘ï¼š)</span><br><span class="line"></span><br><span class="line">NeedCasting.java:10: warning: [unchecked] unchecked cast</span><br><span class="line">    List&lt;Widget&gt; shapes = (List&lt;Widget&gt;)in.readObject();</span><br><span class="line">    required: List&lt;Widget&gt;</span><br><span class="line">    found: Object</span><br><span class="line">1 warning</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šè¢«å¼ºåˆ¶è¦æ±‚è½¬å‹ï¼Œä½†æ˜¯åˆè¢«å‘ŠçŸ¥ä¸åº”è¯¥è½¬å‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨ Java 5 å¼•å…¥çš„æ–°çš„è½¬å‹å½¢å¼ï¼Œæ—¢é€šè¿‡æ³›å‹ç±»æ¥è½¬å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ClassCasting.java</span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassCasting</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">            <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]));</span><br><span class="line">        <span class="comment">// Won't Compile:</span></span><br><span class="line">        <span class="comment">//    List&lt;Widget&gt; lw1 =</span></span><br><span class="line">        <span class="comment">//    List&lt;&gt;.class.cast(in.readObject());</span></span><br><span class="line">        List&lt;Widget&gt; lw2 = List.class.cast(in.readObject());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œä¸èƒ½è½¬å‹åˆ°å®é™…ç±»å‹ï¼ˆ <code>List&lt;Widget&gt;</code> ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½å£°æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Widget&gt;.class.cast(in.readobject())</span><br></pre></td></tr></table></figure><p>ç”šè‡³å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„å¦ä¸€ä¸ªè½¬å‹æ—¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(List&lt;Widget&gt;)List.class.cast(in.readobject())</span><br></pre></td></tr></table></figure><p>ä»æ—§ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚</p><h3 id="é‡è½½"><a href="#é‡è½½" class="headerlink" title="é‡è½½"></a>é‡è½½</h3><p>ä¸‹é¢çš„ç¨‹åºæ˜¯ä¸èƒ½ç¼–è¯‘çš„ï¼Œå³ä½¿å®ƒçœ‹èµ·æ¥æ˜¯åˆç†çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/UseList.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseList</span>&lt;<span class="title">W</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(List&lt;T&gt; v)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(List&lt;W&gt; v)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ“¦é™¤ï¼Œæ‰€ä»¥é‡è½½æ–¹æ³•äº§ç”Ÿäº†ç›¸åŒçš„ç±»å‹ç­¾åã€‚</p><p>å› è€Œï¼Œå½“æ“¦é™¤åçš„å‚æ•°ä¸èƒ½äº§ç”Ÿå”¯ä¸€çš„å‚æ•°åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸åŒçš„æ–¹æ³•åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/UseList2.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseList2</span>&lt;<span class="title">W</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f1</span><span class="params">(List&lt;T&gt; v)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f2</span><span class="params">(List&lt;W&gt; v)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¸è¿çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¯ä»¥æ£€æµ‹åˆ°è¿™ç±»é—®é¢˜ã€‚</p><h3 id="åŸºç±»åŠ«æŒæ¥å£"><a href="#åŸºç±»åŠ«æŒæ¥å£" class="headerlink" title="åŸºç±»åŠ«æŒæ¥å£"></a>åŸºç±»åŠ«æŒæ¥å£</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå®ç°äº† <strong>Comparable</strong> æ¥å£çš„ <strong>Pet</strong> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ComparablePet.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComparablePet</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">ComparablePet</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(ComparablePet o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•ç¼©å° <strong>ComparablePet</strong> å­ç±»çš„æ¯”è¾ƒç±»å‹æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œ<strong>Cat</strong> ç±»å¯ä»¥ä¸å…¶ä»–çš„ <strong>Cat</strong> æ¯”è¾ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/HijackedInterface.java</span></span><br><span class="line"><span class="comment">// &#123;WillNotCompile&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">ComparablePet</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Cat</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// error: Comparable cannot be inherited with</span></span><br><span class="line">    <span class="comment">// different arguments: &lt;Cat&gt; and &lt;ComparablePet&gt;</span></span><br><span class="line">    <span class="comment">// class Cat</span></span><br><span class="line">    <span class="comment">// ^</span></span><br><span class="line">    <span class="comment">// 1 error</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Cat arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸èƒ½å·¥ä½œã€‚ä¸€æ—¦ <strong>Comparable</strong> çš„ç±»å‹å‚æ•°è®¾ç½®ä¸º <strong>ComparablePet</strong>ï¼Œå…¶ä»–çš„å®ç°ç±»åªèƒ½æ¯”è¾ƒ <strong>ComparablePet</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/RestrictedComparablePets.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hamster</span> <span class="keyword">extends</span> <span class="title">ComparablePet</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">ComparablePet</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(ComparablePet arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Or just:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gecko</span> <span class="keyword">extends</span> <span class="title">ComparablePet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(ComparablePet arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Hamster</strong> æ˜¾ç¤ºäº†é‡æ–°å®ç° <strong>ComparableSet</strong> ä¸­ç›¸åŒçš„æ¥å£æ˜¯å¯èƒ½çš„ï¼Œåªè¦æ¥å£å®Œå…¨ç›¸åŒï¼ŒåŒ…æ‹¬å‚æ•°ç±»å‹ã€‚ç„¶è€Œæ­£å¦‚ <strong>Gecko</strong> ä¸­æ‰€ç¤ºï¼Œè¿™ä¸ç›´æ¥è¦†å†™åŸºç±»çš„æ–¹æ³•å®Œå…¨ç›¸åŒã€‚</p><!-- Self-Bounded Types --><h2 id="è‡ªé™å®šçš„ç±»å‹"><a href="#è‡ªé™å®šçš„ç±»å‹" class="headerlink" title="è‡ªé™å®šçš„ç±»å‹"></a>è‡ªé™å®šçš„ç±»å‹</h2><p>åœ¨ Java æ³›å‹ä¸­ï¼Œæœ‰ä¸€ä¸ªä¼¼ä¹ç»å¸¸æ€§å‡ºç°çš„æƒ¯ç”¨æ³•ï¼Œå®ƒç›¸å½“ä»¤äººè´¹è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelfBounded</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123; <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è¿™å°±åƒä¸¤é¢é•œå­å½¼æ­¤ç…§å‘å¯¹æ–¹æ‰€å¼•èµ·çš„ç›®çœ©æ•ˆæœä¸€æ ·ï¼Œæ˜¯ä¸€ç§æ— é™åå°„ã€‚<strong>SelfBounded</strong> ç±»æ¥å—æ³›å‹å‚æ•° <strong>T</strong>ï¼Œè€Œ <strong>T</strong> ç”±ä¸€ä¸ªè¾¹ç•Œç±»é™å®šï¼Œè¿™ä¸ªè¾¹ç•Œå°±æ˜¯æ‹¥æœ‰ <strong>T</strong> ä½œä¸ºå…¶å‚æ•°çš„ <strong>SelfBounded</strong>ã€‚</p><p>å½“æˆ‘ä»¬é¦–æ¬¡çœ‹åˆ°å®ƒæ—¶ï¼Œå¾ˆéš¾å»è§£æå®ƒï¼Œå®ƒå¼ºè°ƒçš„æ˜¯å½“ <strong>extends</strong> å…³é”®å­—ç”¨äºè¾¹ç•Œä¸ç”¨æ¥åˆ›å»ºå­ç±»æ˜æ˜¾æ˜¯ä¸åŒçš„ã€‚</p><h3 id="å¤æ€ªçš„å¾ªç¯æ³›å‹"><a href="#å¤æ€ªçš„å¾ªç¯æ³›å‹" class="headerlink" title="å¤æ€ªçš„å¾ªç¯æ³›å‹"></a>å¤æ€ªçš„å¾ªç¯æ³›å‹</h3><p>ä¸ºäº†ç†è§£è‡ªé™å®šç±»å‹çš„å«ä¹‰ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªæƒ¯ç”¨æ³•çš„ä¸€ä¸ªç®€å•ç‰ˆæœ¬å…¥æ‰‹ï¼Œå®ƒæ²¡æœ‰è‡ªé™å®šçš„è¾¹ç•Œã€‚</p><p>ä¸èƒ½ç›´æ¥ç»§æ‰¿ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œä½†æ˜¯ï¼Œå¯ä»¥ç»§æ‰¿åœ¨å…¶è‡ªå·±çš„å®šä¹‰ä¸­ä½¿ç”¨è¿™ä¸ªæ³›å‹å‚æ•°çš„ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CuriouslyRecurringGeneric.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericType</span>&lt;<span class="title">T</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CuriouslyRecurringGeneric</span></span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">GenericType</span>&lt;<span class="title">CuriouslyRecurringGeneric</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¯ä»¥æŒ‰ç…§ Jim Coplien åœ¨ C++ ä¸­çš„<em>å¤æ€ªçš„å¾ªç¯æ¨¡ç‰ˆæ¨¡å¼</em>çš„å‘½åæ–¹å¼ï¼Œç§°ä¸ºå¤æ€ªçš„å¾ªç¯æ³›å‹ï¼ˆCRGï¼‰ã€‚â€œå¤æ€ªçš„å¾ªç¯â€æ˜¯æŒ‡ç±»ç›¸å½“å¤æ€ªåœ°å‡ºç°åœ¨å®ƒè‡ªå·±çš„åŸºç±»ä¸­è¿™ä¸€äº‹å®ã€‚<br>ä¸ºäº†ç†è§£å…¶å«ä¹‰ï¼ŒåŠªåŠ›å¤§å£°è¯´ï¼šâ€œæˆ‘åœ¨åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼Œå®ƒç»§æ‰¿è‡ªä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œè¿™ä¸ªæ³›å‹ç±»å‹æ¥å—æˆ‘çš„ç±»çš„åå­—ä½œä¸ºå…¶å‚æ•°ã€‚â€å½“ç»™å‡ºå¯¼å‡ºç±»çš„åå­—æ—¶ï¼Œè¿™ä¸ªæ³›å‹åŸºç±»èƒ½å¤Ÿå®ç°ä»€ä¹ˆå‘¢ï¼Ÿå¥½å§ï¼ŒJava ä¸­çš„æ³›å‹å…³ä¹å‚æ•°å’Œè¿”å›ç±»å‹ï¼Œå› æ­¤å®ƒèƒ½å¤Ÿäº§ç”Ÿä½¿ç”¨å¯¼å‡ºç±»ä½œä¸ºå…¶å‚æ•°å’Œè¿”å›ç±»å‹çš„åŸºç±»ã€‚å®ƒè¿˜èƒ½å°†å¯¼å‡ºç±»å‹ç”¨ä½œå…¶åŸŸç±»å‹ï¼Œå°½ç®¡è¿™äº›å°†è¢«æ“¦é™¤ä¸º <strong>Object</strong> çš„ç±»å‹ã€‚ä¸‹é¢æ˜¯è¡¨ç¤ºäº†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªæ³›å‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/BasicHolder.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicHolder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T element;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(T arg)</span> </span>&#123; element = arg; &#125;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> element; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(element.getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ³›å‹ç±»å‹ï¼Œå®ƒçš„ä¸€äº›æ–¹æ³•å°†æ¥å—å’Œäº§ç”Ÿå…·æœ‰å…¶å‚æ•°ç±»å‹çš„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•åœ¨å…¶å­˜å‚¨çš„åŸŸä¸Šæ‰§è¡Œæ“ä½œï¼ˆå°½ç®¡åªæ˜¯åœ¨è¿™ä¸ªåŸŸä¸Šæ‰§è¡Œ <strong>Object</strong> æ“ä½œï¼‰ã€‚<br>æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå¤æ€ªçš„å¾ªç¯æ³›å‹ä¸­ä½¿ç”¨ <strong>BasicHolder</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CRGWithBasicHolder.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subtype</span> <span class="keyword">extends</span> <span class="title">BasicHolder</span>&lt;<span class="title">Subtype</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CRGWithBasicHolder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Subtype st1 = <span class="keyword">new</span> Subtype(), st2 = <span class="keyword">new</span> Subtype();</span><br><span class="line">        st1.set(st2);</span><br><span class="line">        Subtype st3 = st1.get();</span><br><span class="line">        st1.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Subtype</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œæœ‰äº›ä¸œè¥¿å¾ˆé‡è¦ï¼šæ–°ç±» <strong>Subtype</strong> æ¥å—çš„å‚æ•°å’Œè¿”å›çš„å€¼å…·æœ‰ <strong>Subtype</strong> ç±»å‹è€Œä¸ä»…ä»…æ˜¯åŸºç±» <strong>BasicHolder</strong> ç±»å‹ã€‚è¿™å°±æ˜¯ CRG çš„æœ¬è´¨ï¼šåŸºç±»ç”¨å¯¼å‡ºç±»æ›¿ä»£å…¶å‚æ•°ã€‚è¿™æ„å‘³ç€æ³›å‹åŸºç±»å˜æˆäº†ä¸€ç§å…¶æ‰€æœ‰å¯¼å‡ºç±»çš„å…¬å…±åŠŸèƒ½çš„æ¨¡ç‰ˆï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½å¯¹äºå…¶æ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼ï¼Œå°†ä½¿ç”¨å¯¼å‡ºç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰€äº§ç”Ÿçš„ç±»ä¸­å°†ä½¿ç”¨ç¡®åˆ‡ç±»å‹è€Œä¸æ˜¯åŸºç±»å‹ã€‚å› æ­¤ï¼Œåœ¨<strong>Subtype</strong> ä¸­ï¼Œä¼ é€’ç»™ <code>set()</code> çš„å‚æ•°å’Œä» <code>get()</code> è¿”å›çš„ç±»å‹éƒ½æ˜¯ç¡®åˆ‡çš„ <strong>Subtype</strong>ã€‚</p><h3 id="è‡ªé™å®š"><a href="#è‡ªé™å®š" class="headerlink" title="è‡ªé™å®š"></a>è‡ªé™å®š</h3><p><strong>BasicHolder</strong> å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹ä½œä¸ºå…¶æ³›å‹å‚æ•°ï¼Œå°±åƒä¸‹é¢çœ‹åˆ°çš„é‚£æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Unconstrained.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Other</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicOther</span> <span class="keyword">extends</span> <span class="title">BasicHolder</span>&lt;<span class="title">Other</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Unconstrained</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BasicOther b = <span class="keyword">new</span> BasicOther();</span><br><span class="line">        BasicOther b2 = <span class="keyword">new</span> BasicOther();</span><br><span class="line">        b.set(<span class="keyword">new</span> Other());</span><br><span class="line">        Other other = b.get();</span><br><span class="line">        b.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Other</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>é™å®šå°†é‡‡å–é¢å¤–çš„æ­¥éª¤ï¼Œå¼ºåˆ¶æ³›å‹å½“ä½œå…¶è‡ªèº«çš„è¾¹ç•Œå‚æ•°æ¥ä½¿ç”¨ã€‚è§‚å¯Ÿæ‰€äº§ç”Ÿçš„ç±»å¯ä»¥å¦‚ä½•ä½¿ç”¨ä»¥åŠä¸å¯ä»¥å¦‚ä½•ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SelfBounding.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelfBounded</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    T element;</span><br><span class="line">    <span class="function">SelfBounded&lt;T&gt; <span class="title">set</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">        element = arg;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> element; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">A</span>&gt; </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">A</span>&gt; </span>&#123;&#125; <span class="comment">// Also OK</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">C</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">C <span class="title">setAndGet</span><span class="params">(C arg)</span> </span>&#123; </span><br><span class="line">        set(arg); </span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// Can't do this:</span></span><br><span class="line"><span class="comment">// class E extends SelfBounded&lt;D&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">// Compile error:</span></span><br><span class="line"><span class="comment">//   Type parameter D is not within its bound</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Alas, you can do this, so you cannot force the idiom:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfBounding</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        a.set(<span class="keyword">new</span> A());</span><br><span class="line">        a = a.set(<span class="keyword">new</span> A()).get();</span><br><span class="line">        a = a.get();</span><br><span class="line">        C c = <span class="keyword">new</span> C();</span><br><span class="line">        c = c.setAndGet(<span class="keyword">new</span> C());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªé™å®šæ‰€åšçš„ï¼Œå°±æ˜¯è¦æ±‚åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œåƒä¸‹é¢è¿™æ ·ä½¿ç”¨è¿™ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">SelfBounded</span>&lt;<span class="title">A</span>&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå¼ºåˆ¶è¦æ±‚å°†æ­£åœ¨å®šä¹‰çš„ç±»å½“ä½œå‚æ•°ä¼ é€’ç»™åŸºç±»ã€‚</p><p>è‡ªé™å®šçš„å‚æ•°æœ‰ä½•æ„ä¹‰å‘¢ï¼Ÿå®ƒå¯ä»¥ä¿è¯ç±»å‹å‚æ•°å¿…é¡»ä¸æ­£åœ¨è¢«å®šä¹‰çš„ç±»ç›¸åŒã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ B ç±»çš„å®šä¹‰ä¸­æ‰€çœ‹åˆ°çš„ï¼Œè¿˜å¯ä»¥ä»ä½¿ç”¨äº†å¦ä¸€ä¸ª <strong>SelfBounded</strong> å‚æ•°çš„ <strong>SelfBounded</strong> ä¸­å¯¼å‡ºï¼Œå°½ç®¡åœ¨ <strong>A</strong> ç±»çœ‹åˆ°çš„ç”¨æ³•çœ‹èµ·æ¥æ˜¯ä¸»è¦çš„ç”¨æ³•ã€‚å¯¹å®šä¹‰ <strong>E</strong> çš„å°è¯•è¯´æ˜ä¸èƒ½ä½¿ç”¨ä¸æ˜¯ <strong>SelfBounded</strong> çš„ç±»å‹å‚æ•°ã€‚<br>é—æ†¾çš„æ˜¯ï¼Œ <strong>F</strong> å¯ä»¥ç¼–è¯‘ï¼Œä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šï¼Œå› æ­¤è‡ªé™å®šæƒ¯ç”¨æ³•ä¸æ˜¯å¯å¼ºåˆ¶æ‰§è¡Œçš„ã€‚å¦‚æœå®ƒç¡®å®å¾ˆé‡è¦ï¼Œå¯ä»¥è¦æ±‚ä¸€ä¸ªå¤–éƒ¨å·¥å…·æ¥ç¡®ä¿ä¸ä¼šä½¿ç”¨åŸç”Ÿç±»å‹æ¥æ›¿ä»£å‚æ•°åŒ–ç±»å‹ã€‚<br>æ³¨æ„ï¼Œå¯ä»¥ç§»é™¤è‡ªé™å®šè¿™ä¸ªé™åˆ¶ï¼Œè¿™æ ·æ‰€æœ‰çš„ç±»ä»æ—§æ˜¯å¯ä»¥ç¼–è¯‘çš„ï¼Œä½†æ˜¯ <strong>E</strong> ä¹Ÿä¼šå› æ­¤è€Œå˜å¾—å¯ç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/NotSelfBounded.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotSelfBounded</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T element;</span><br><span class="line">    <span class="function">NotSelfBounded&lt;T&gt; <span class="title">set</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">        element = arg;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> element; &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A2</span> <span class="keyword">extends</span> <span class="title">NotSelfBounded</span>&lt;<span class="title">A2</span>&gt; </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B2</span> <span class="keyword">extends</span> <span class="title">NotSelfBounded</span>&lt;<span class="title">A2</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span> <span class="keyword">extends</span> <span class="title">NotSelfBounded</span>&lt;<span class="title">C2</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">C2 <span class="title">setAndGet</span><span class="params">(C2 arg)</span> </span>&#123; </span><br><span class="line">        set(arg); </span><br><span class="line">        <span class="keyword">return</span> get(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D2</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// Now this is OK:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E2</span> <span class="keyword">extends</span> <span class="title">NotSelfBounded</span>&lt;<span class="title">D2</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤å¾ˆæ˜æ˜¾ï¼Œè‡ªé™å®šé™åˆ¶åªèƒ½å¼ºåˆ¶ä½œç”¨äºç»§æ‰¿å…³ç³»ã€‚å¦‚æœä½¿ç”¨è‡ªé™å®šï¼Œå°±åº”è¯¥äº†è§£è¿™ä¸ªç±»æ‰€ç”¨çš„ç±»å‹å‚æ•°å°†ä¸ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„ç±»å…·æœ‰ç›¸åŒçš„åŸºç±»å‹ã€‚è¿™ä¼šå¼ºåˆ¶è¦æ±‚ä½¿ç”¨è¿™ä¸ªç±»çš„æ¯ä¸ªäººéƒ½è¦éµå¾ªè¿™ç§å½¢å¼ã€‚<br>è¿˜å¯ä»¥å°†è‡ªé™å®šç”¨äºæ³›å‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SelfBoundingMethods.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfBoundingMethods</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &lt;T extends SelfBounded&lt;T&gt;&gt; <span class="function">T <span class="title">f</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.set(arg).get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = f(<span class="keyword">new</span> A());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¯ä»¥é˜²æ­¢è¿™ä¸ªæ–¹æ³•è¢«åº”ç”¨äºé™¤ä¸Šè¿°å½¢å¼çš„è‡ªé™å®šå‚æ•°ä¹‹å¤–çš„ä»»ä½•äº‹ç‰©ä¸Šã€‚</p><h3 id="å‚æ•°åå˜"><a href="#å‚æ•°åå˜" class="headerlink" title="å‚æ•°åå˜"></a>å‚æ•°åå˜</h3><p>è‡ªé™å®šç±»å‹çš„ä»·å€¼åœ¨äºå®ƒä»¬å¯ä»¥äº§ç”Ÿ<em>åå˜å‚æ•°ç±»å‹</em>â€”â€”æ–¹æ³•å‚æ•°ç±»å‹ä¼šéšå­ç±»è€Œå˜åŒ–ã€‚</p><p>å°½ç®¡è‡ªé™å®šç±»å‹è¿˜å¯ä»¥äº§ç”Ÿä¸å­ç±»ç±»å‹ç›¸åŒçš„è¿”å›ç±»å‹ï¼Œä½†æ˜¯è¿™å¹¶ä¸ååˆ†é‡è¦ï¼Œå› ä¸º<em>åå˜è¿”å›ç±»å‹</em>æ˜¯åœ¨ Java 5 å¼•å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CovariantReturnTypes.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">OrdinaryGetter</span> </span>&#123;</span><br><span class="line">    <span class="function">Base <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">DerivedGetter</span> <span class="keyword">extends</span> <span class="title">OrdinaryGetter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Overridden method return type can vary:</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">Derived <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CovariantReturnTypes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(DerivedGetter d)</span> </span>&#123;</span><br><span class="line">        Derived d2 = d.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>DerivedGetter</strong> ä¸­çš„ <code>get()</code> æ–¹æ³•è¦†ç›–äº† <strong>OrdinaryGetter</strong> ä¸­çš„ <code>get()</code> ï¼Œå¹¶è¿”å›äº†ä¸€ä¸ªä» <code>OrdinaryGetter.get()</code> çš„è¿”å›ç±»å‹ä¸­å¯¼å‡ºçš„ç±»å‹ã€‚å°½ç®¡è¿™æ˜¯å®Œå…¨åˆä¹é€»è¾‘çš„äº‹æƒ…ï¼ˆå¯¼å‡ºç±»æ–¹æ³•åº”è¯¥èƒ½å¤Ÿè¿”å›æ¯”å®ƒè¦†ç›–çš„åŸºç±»æ–¹æ³•æ›´å…·ä½“çš„ç±»å‹ï¼‰ä½†æ˜¯è¿™åœ¨æ—©å…ˆçš„ Java ç‰ˆæœ¬ä¸­æ˜¯ä¸åˆæ³•çš„ã€‚</p><p>è‡ªé™å®šæ³›å‹äº‹å®ä¸Šå°†äº§ç”Ÿç¡®åˆ‡çš„å¯¼å‡ºç±»å‹ä½œä¸ºå…¶è¿”å›å€¼ï¼Œå°±åƒåœ¨ <code>get()</code> ä¸­æ‰€çœ‹åˆ°çš„ä¸€æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/GenericsAndReturnTypes.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Getter</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">Getter</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsAndReturnTypes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Getter g)</span> </span>&#123;</span><br><span class="line">        Getter result = g.get();</span><br><span class="line">        GenericGetter gg = g.get(); <span class="comment">// Also the base type</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™æ®µä»£ç ä¸èƒ½ç¼–è¯‘ï¼Œé™¤éæ˜¯ä½¿ç”¨å›Šæ‹¬äº†åå˜è¿”å›ç±»å‹çš„ Java 5ã€‚</p><p>ç„¶è€Œï¼Œåœ¨éæ³›å‹ä»£ç ä¸­ï¼Œå‚æ•°ç±»å‹ä¸èƒ½éšå­ç±»å‹å‘ç”Ÿå˜åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/OrdinaryArguments.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrdinarySetter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Base base)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"OrdinarySetter.set(Base)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DerivedSetter</span> <span class="keyword">extends</span> <span class="title">OrdinarySetter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Derived derived)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"DerivedSetter.set(Derived)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrdinaryArguments</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Base base = <span class="keyword">new</span> Base();</span><br><span class="line">        Derived derived = <span class="keyword">new</span> Derived();</span><br><span class="line">        DerivedSetter ds = <span class="keyword">new</span> DerivedSetter();</span><br><span class="line">        ds.set(derived);</span><br><span class="line">        <span class="comment">// Compiles--overloaded, not overridden!:</span></span><br><span class="line">        ds.set(base);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">DerivedSetter.set(Derived)</span></span><br><span class="line"><span class="comment">OrdinarySetter.set(Base)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>set(derived)</code> å’Œ <code>set(base)</code> éƒ½æ˜¯åˆæ³•çš„ï¼Œå› æ­¤ <code>DerivedSetter.set()</code> æ²¡æœ‰è¦†ç›– <code>OrdinarySetter.set()</code> ï¼Œè€Œæ˜¯é‡è½½äº†è¿™ä¸ªæ–¹æ³•ã€‚ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ <strong>DerivedSetter</strong> ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå› æ­¤åŸºç±»ç‰ˆæœ¬ä»æ—§æ˜¯å¯ç”¨çš„ï¼Œå› æ­¤å¯ä»¥è¯æ˜å®ƒè¢«é‡è½½è¿‡ã€‚<br>ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨è‡ªé™å®šç±»å‹æ—¶ï¼Œåœ¨å¯¼å‡ºç±»ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ¥å—å¯¼å‡ºç±»å‹è€Œä¸æ˜¯åŸºç±»å‹ä¸ºå‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SelfBoundingAndCovariantArguments.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SelfBoundSetter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">SelfBoundSetter</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(T arg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Setter</span> <span class="keyword">extends</span> <span class="title">SelfBoundSetter</span>&lt;<span class="title">Setter</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfBoundingAndCovariantArguments</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span></span><br><span class="line">    testA(Setter s1, Setter s2, SelfBoundSetter sbs) &#123;</span><br><span class="line">        s1.set(s2);</span><br><span class="line">        <span class="comment">//- s1.set(sbs);</span></span><br><span class="line">        <span class="comment">// error: method set in interface SelfBoundSetter&lt;T&gt;</span></span><br><span class="line">        <span class="comment">// cannot be applied to given types;</span></span><br><span class="line">        <span class="comment">//     s1.set(sbs);</span></span><br><span class="line">        <span class="comment">//       ^</span></span><br><span class="line">        <span class="comment">//   required: Setter</span></span><br><span class="line">        <span class="comment">//   found: SelfBoundSetter</span></span><br><span class="line">        <span class="comment">//   reason: argument mismatch;</span></span><br><span class="line">        <span class="comment">// SelfBoundSetter cannot be converted to Setter</span></span><br><span class="line">        <span class="comment">//   where T is a type-variable:</span></span><br><span class="line">        <span class="comment">//     T extends SelfBoundSetter&lt;T&gt; declared in</span></span><br><span class="line">        <span class="comment">//     interface SelfBoundSetter</span></span><br><span class="line">        <span class="comment">// 1 error</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸èƒ½è¯†åˆ«å°†åŸºç±»å‹å½“ä½œå‚æ•°ä¼ é€’ç»™ <code>set()</code> çš„å°è¯•ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æ–¹æ³•å…·æœ‰è¿™æ ·çš„ç­¾åã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå‚æ•°å·²ç»è¢«è¦†ç›–ã€‚<br>å¦‚æœä¸ä½¿ç”¨è‡ªé™å®šç±»å‹ï¼Œæ™®é€šçš„ç»§æ‰¿æœºåˆ¶å°±ä¼šä»‹å…¥ï¼Œè€Œæˆ‘ä»¬å°†èƒ½å¤Ÿé‡è½½ï¼Œå°±åƒåœ¨éæ³›å‹çš„æƒ…å†µä¸‹ä¸€æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/PlainGenericInheritance.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericSetter</span>&lt;<span class="title">T</span>&gt; </span>&#123; <span class="comment">// Not self-bounded</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"GenericSetter.set(Base)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DerivedGS</span> <span class="keyword">extends</span> <span class="title">GenericSetter</span>&lt;<span class="title">Base</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Derived derived)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"DerivedGS.set(Derived)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlainGenericInheritance</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Base base = <span class="keyword">new</span> Base();</span><br><span class="line">        Derived derived = <span class="keyword">new</span> Derived();</span><br><span class="line">        DerivedGS dgs = <span class="keyword">new</span> DerivedGS();</span><br><span class="line">        dgs.set(derived);</span><br><span class="line">        dgs.set(base); <span class="comment">// Overloaded, not overridden!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">DerivedGS.set(Derived)</span></span><br><span class="line"><span class="comment">GenericSetter.set(Base)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨æ¨¡ä»¿ <strong>OrdinaryArguments.java</strong>ï¼›åœ¨é‚£ä¸ªç¤ºä¾‹ä¸­ï¼Œ<strong>DerivedSetter</strong> ç»§æ‰¿è‡ªåŒ…å«ä¸€ä¸ª <code>set(Base)</code> çš„<strong>OrdinarySetter</strong> ã€‚è€Œè¿™é‡Œï¼Œ<strong>DerivedGS</strong> ç»§æ‰¿è‡ªæ³›å‹åˆ›å»ºçš„ä¹ŸåŒ…å«æœ‰ä¸€ä¸ª <code>set(Base)</code>çš„ <code>GenericSetter&lt;Base&gt;</code>ã€‚å°±åƒ <strong>OrdinaryArguments.java</strong> ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¾“å‡ºä¸­çœ‹åˆ°ï¼Œ <strong>DerivedGS</strong> åŒ…å«ä¸¤ä¸ª  <code>set()</code> çš„é‡è½½ç‰ˆæœ¬ã€‚å¦‚æœä¸ä½¿ç”¨è‡ªé™å®šï¼Œå°†é‡è½½å‚æ•°ç±»å‹ã€‚å¦‚æœä½¿ç”¨äº†è‡ªé™å®šï¼Œåªèƒ½è·å¾—æ–¹æ³•çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå°†æ¥å—ç¡®åˆ‡çš„å‚æ•°ç±»å‹ã€‚</p><!-- Dynamic Type Safety --><h2 id="åŠ¨æ€ç±»å‹å®‰å…¨"><a href="#åŠ¨æ€ç±»å‹å®‰å…¨" class="headerlink" title="åŠ¨æ€ç±»å‹å®‰å…¨"></a>åŠ¨æ€ç±»å‹å®‰å…¨</h2><p>å› ä¸ºå¯ä»¥å‘ Java 5 ä¹‹å‰çš„ä»£ç ä¼ é€’æ³›å‹é›†åˆï¼Œæ‰€ä»¥æ—§å¼ä»£ç ä»æ—§æœ‰å¯èƒ½ä¼šç ´åæˆ‘ä»¬çš„é›†åˆã€‚Java 5 çš„ <strong>java.util.Collections</strong> ä¸­æœ‰ä¸€ç»„ä¾¿åˆ©å·¥å…·ï¼Œå¯ä»¥è§£å†³åœ¨è¿™ç§æƒ…å†µä¸‹çš„ç±»å‹æ£€æŸ¥é—®é¢˜ï¼Œå®ƒä»¬æ˜¯ï¼šé™æ€æ–¹æ³• <code>checkedCollection()</code> ã€<code>checkedList()</code>ã€ <code>checkedMap()</code> ã€ <code>checkedSet()</code> ã€<code>checkedSortedMap()</code>å’Œ <code>checkedSortedSet()</code>ã€‚è¿™äº›æ–¹æ³•æ¯ä¸€ä¸ªéƒ½ä¼šå°†æˆ‘ä»¬å¸Œæœ›åŠ¨æ€æ£€æŸ¥çš„é›†åˆå½“ä½œç¬¬ä¸€ä¸ªå‚æ•°æ¥å—ï¼Œå¹¶å°†æˆ‘ä»¬å¸Œæœ›å¼ºåˆ¶è¦æ±‚çš„ç±»å‹ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ¥å—ã€‚</p><p>å—æ£€æŸ¥çš„é›†åˆåœ¨æˆ‘ä»¬è¯•å›¾æ’å…¥ç±»å‹ä¸æ­£ç¡®çš„å¯¹è±¡æ—¶æŠ›å‡º <strong>ClassCastException</strong> ï¼Œè¿™ä¸æ³›å‹ä¹‹å‰çš„ï¼ˆåŸç”Ÿï¼‰é›†åˆå½¢æˆäº†å¯¹æ¯”ï¼Œå¯¹äºåè€…æ¥è¯´ï¼Œå½“æˆ‘ä»¬å°†å¯¹è±¡ä»é›†åˆä¸­å–å‡ºæ—¶ï¼Œæ‰ä¼šé€šçŸ¥æˆ‘ä»¬å‡ºç°äº†é—®é¢˜ã€‚åœ¨åä¸€ç§æƒ…å†µä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å­˜åœ¨é—®é¢˜ï¼Œä½†æ˜¯ä¸çŸ¥é“ç½ªé­ç¥¸é¦–åœ¨å“ªé‡Œï¼Œå¦‚æœä½¿ç”¨å—æ£€æŸ¥çš„é›†åˆï¼Œå°±å¯ä»¥å‘ç°è°åœ¨è¯•å›¾æ’å…¥ä¸è‰¯å¯¹è±¡ã€‚<br>è®©æˆ‘ä»¬ç”¨å—æ£€æŸ¥çš„é›†åˆæ¥çœ‹çœ‹â€œå°†çŒ«æ’å…¥åˆ°ç‹—åˆ—è¡¨ä¸­â€è¿™ä¸ªé—®é¢˜ã€‚è¿™é‡Œï¼Œ<code>oldStyleMethod()</code> è¡¨ç¤ºé—ç•™ä»£ç ï¼Œå› ä¸ºå®ƒæ¥å—çš„æ˜¯åŸç”Ÿçš„ <strong>List</strong> ï¼Œè€Œ <strong>@SuppressWarningsï¼ˆâ€œuncheckedâ€ï¼‰</strong> æ³¨è§£å¯¹äºå‹åˆ¶æ‰€äº§ç”Ÿçš„è­¦å‘Šæ˜¯å¿…éœ€çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/CheckedList.java</span></span><br><span class="line"><span class="comment">// Using Collection.checkedList()</span></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckedList</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">oldStyleMethod</span><span class="params">(List probablyDogs)</span> </span>&#123;</span><br><span class="line">        probablyDogs.add(<span class="keyword">new</span> Cat());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Dog&gt; dogs1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        oldStyleMethod(dogs1); <span class="comment">// Quietly accepts a Cat</span></span><br><span class="line">        List&lt;Dog&gt; dogs2 = Collections.checkedList(</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;(), Dog.class);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oldStyleMethod(dogs2); <span class="comment">// Throws an exception</span></span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Expected: "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Derived types work fine:</span></span><br><span class="line">        List&lt;Pet&gt; pets = Collections.checkedList(</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;(), Pet.class);</span><br><span class="line">        pets.add(<span class="keyword">new</span> Dog());</span><br><span class="line">        pets.add(<span class="keyword">new</span> Cat());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Expected: java.lang.ClassCastException: Attempt to</span></span><br><span class="line"><span class="comment">insert class typeinfo.pets.Cat element into collection</span></span><br><span class="line"><span class="comment">with element type class typeinfo.pets.Dog</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ’å…¥ä¸€ä¸ª <strong>Cat</strong> å¯¹äº <strong>dogs1</strong> æ¥è¯´æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè€Œ <strong>dogs2</strong> ç«‹å³ä¼šåœ¨è¿™ä¸ªé”™è¯¯ç±»å‹çš„æ’å…¥æ“ä½œä¸ŠæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå°†å¯¼å‡ºç±»å‹çš„å¯¹è±¡æ”¾ç½®åˆ°å°†è¦æ£€æŸ¥åŸºç±»å‹çš„å—æ£€æŸ¥å®¹å™¨ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><!-- Exceptions --><h2 id="æ³›å‹å¼‚å¸¸"><a href="#æ³›å‹å¼‚å¸¸" class="headerlink" title="æ³›å‹å¼‚å¸¸"></a>æ³›å‹å¼‚å¸¸</h2><p>ç”±äºæ“¦é™¤çš„åŸå› ï¼Œ<strong>catch</strong> è¯­å¥ä¸èƒ½æ•è·æ³›å‹ç±»å‹çš„å¼‚å¸¸ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶éƒ½å¿…é¡»çŸ¥é“å¼‚å¸¸çš„ç¡®åˆ‡ç±»å‹ã€‚æ³›å‹ç±»ä¹Ÿä¸èƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ª <strong>Throwable</strong>ï¼ˆè¿™å°†è¿›ä¸€æ­¥é˜»æ­¢æˆ‘ä»¬å»å®šä¹‰ä¸èƒ½æ•è·çš„æ³›å‹å¼‚å¸¸ï¼‰ã€‚<br>ä½†æ˜¯ï¼Œç±»å‹å‚æ•°å¯èƒ½ä¼šåœ¨ä¸€ä¸ªæ–¹æ³•çš„ <strong>throws</strong> å­å¥ä¸­ç”¨åˆ°ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç¼–å†™éšæ£€æŸ¥å‹å¼‚å¸¸ç±»å‹å˜åŒ–çš„æ³›å‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ThrowGenericException.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Processor</span>&lt;<span class="title">T</span>, <span class="title">E</span> <span class="keyword">extends</span> <span class="title">Exception</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(List&lt;T&gt; resultCollector)</span> <span class="keyword">throws</span> E</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessRunner</span>&lt;<span class="title">T</span>, <span class="title">E</span> <span class="keyword">extends</span> <span class="title">Exception</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Processor</span>&lt;<span class="title">T</span>, <span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">processAll</span><span class="params">()</span> <span class="keyword">throws</span> E </span>&#123;</span><br><span class="line">        List&lt;T&gt; resultCollector = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Processor&lt;T, E&gt; processor : <span class="keyword">this</span>)</span><br><span class="line">            processor.process(resultCollector);</span><br><span class="line">        <span class="keyword">return</span> resultCollector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Failure1</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Processor1</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Processor</span>&lt;<span class="title">String</span>, <span class="title">Failure1</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">3</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(List&lt;String&gt; resultCollector)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Failure1 </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(count-- &gt; <span class="number">1</span>)</span><br><span class="line">            resultCollector.add(<span class="string">"Hep!"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            resultCollector.add(<span class="string">"Ho!"</span>);</span><br><span class="line">        <span class="keyword">if</span>(count &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Failure1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Failure2</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Processor2</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Processor</span>&lt;<span class="title">Integer</span>, <span class="title">Failure2</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">2</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(List&lt;Integer&gt; resultCollector)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Failure2 </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(count-- == <span class="number">0</span>)</span><br><span class="line">            resultCollector.add(<span class="number">47</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            resultCollector.add(<span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Failure2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThrowGenericException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProcessRunner&lt;String, Failure1&gt; runner =</span><br><span class="line">            <span class="keyword">new</span> ProcessRunner&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            runner.add(<span class="keyword">new</span> Processor1());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(runner.processAll());</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Failure1 e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ProcessRunner&lt;Integer, Failure2&gt; runner2 =</span><br><span class="line">            <span class="keyword">new</span> ProcessRunner&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            runner2.add(<span class="keyword">new</span> Processor2());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(runner2.processAll());</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Failure2 e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Hep!, Hep!, Ho!]</span></span><br><span class="line"><span class="comment">Failure2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>Processor</strong> æ‰§è¡Œ <code>process()</code> æ–¹æ³•ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæŠ›å‡ºå…·æœ‰ç±»å‹ <strong>E</strong> çš„å¼‚å¸¸ã€‚<code>process()</code> çš„ç»“æœå­˜å‚¨åœ¨ <code>List&lt;T&gt;resultCollector</code> ä¸­ï¼ˆè¿™è¢«ç§°ä¸º<em>æ”¶é›†å‚æ•°</em>ï¼‰ã€‚<strong>ProcessRunner</strong> æœ‰ä¸€ä¸ª <code>processAll()</code> æ–¹æ³•ï¼Œå®ƒä¼šåœ¨æ‰€æŒæœ‰çš„æ¯ä¸ª <strong>Process</strong> å¯¹è±¡æ‰§è¡Œï¼Œå¹¶è¿”å› <strong>resultCollector</strong> ã€‚<br>å¦‚æœä¸èƒ½å‚æ•°åŒ–æ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼Œé‚£ä¹ˆç”±äºæ£€æŸ¥å‹å¼‚å¸¸çš„ç¼˜æ•…ï¼Œå°†ä¸èƒ½ç¼–å†™å‡ºè¿™ç§æ³›åŒ–çš„ä»£ç ã€‚</p><!-- Mixins --><h2 id="æ··å‹"><a href="#æ··å‹" class="headerlink" title="æ··å‹"></a>æ··å‹</h2><p>æœ¯è¯­<em>æ··å‹<em>éšæ—¶é—´çš„æ¨ç§»å¥½åƒæ‹¥æœ‰äº†æ— æ•°çš„å«ä¹‰ï¼Œä½†æ˜¯å…¶æœ€åŸºæœ¬çš„æ¦‚å¿µæ˜¯æ··åˆå¤šä¸ªç±»çš„èƒ½åŠ›ï¼Œä»¥äº§ç”Ÿä¸€ä¸ªå¯ä»¥è¡¨ç¤ºæ··å‹ä¸­æ‰€æœ‰ç±»å‹çš„ç±»ã€‚è¿™å¾€å¾€æ˜¯æˆ‘ä»¬æœ€åçš„æ‰‹æ®µï¼Œå®ƒå°†ä½¿ç»„è£…å¤šä¸ªç±»å˜å¾—ç®€å•æ˜“è¡Œã€‚<br>æ··å‹çš„ä»·å€¼ä¹‹ä¸€æ˜¯å®ƒä»¬å¯ä»¥å°†ç‰¹æ€§å’Œè¡Œä¸ºä¸€è‡´åœ°åº”ç”¨äºå¤šä¸ªç±»ä¹‹ä¸Šã€‚å¦‚æœæƒ³åœ¨æ··å‹ç±»ä¸­ä¿®æ”¹æŸäº›ä¸œè¥¿ï¼Œä½œä¸ºä¸€ç§æ„å¤–çš„å¥½å¤„ï¼Œè¿™äº›ä¿®æ”¹å°†ä¼šåº”ç”¨äºæ··å‹æ‰€åº”ç”¨çš„æ‰€æœ‰ç±»å‹ä¹‹ä¸Šã€‚æ­£ç”±äºæ­¤ï¼Œæ··å‹æœ‰ä¸€ç‚¹</em>é¢å‘åˆ‡é¢ç¼–ç¨‹</em> ï¼ˆAOPï¼‰ çš„å‘³é“ï¼Œè€Œåˆ‡é¢ç»å¸¸è¢«å»ºè®®ç”¨æ¥è§£å†³æ··å‹é—®é¢˜ã€‚</p><h3 id="C-ä¸­çš„æ··å‹"><a href="#C-ä¸­çš„æ··å‹" class="headerlink" title="C++ ä¸­çš„æ··å‹"></a>C++ ä¸­çš„æ··å‹</h3><p>åœ¨ C++ ä¸­ï¼Œä½¿ç”¨å¤šé‡ç»§æ‰¿çš„æœ€å¤§ç†ç”±ï¼Œå°±æ˜¯ä¸ºäº†ä½¿ç”¨æ··å‹ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ··å‹æ¥è¯´ï¼Œæ›´æœ‰è¶£ã€æ›´ä¼˜é›…çš„æ–¹å¼æ˜¯ä½¿ç”¨å‚æ•°åŒ–ç±»å‹ï¼Œå› ä¸ºæ··å‹å°±æ˜¯ç»§æ‰¿è‡ªå…¶ç±»å‹å‚æ•°çš„ç±»ã€‚åœ¨ C++ ä¸­ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºæ··å‹ï¼Œå› ä¸º C++ èƒ½å¤Ÿè®°ä½å…¶æ¨¡ç‰ˆå‚æ•°çš„ç±»å‹ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ª C++ ç¤ºä¾‹ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ··å‹ç±»å‹ï¼šä¸€ä¸ªä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå¯¹è±¡ä¸­æ··å…¥æ‹¥æœ‰ä¸€ä¸ªæ—¶é—´æˆ³è¿™æ ·çš„å±æ€§ï¼Œè€Œå¦ä¸€ä¸ªå¯ä»¥æ··å…¥ä¸€ä¸ªåºåˆ—å·ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Mixins.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">TimeStamped</span> :</span> <span class="keyword">public</span> T &#123;</span><br><span class="line">    <span class="keyword">long</span> timeStamp;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    TimeStamped() &#123; timeStamp = time(<span class="number">0</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getStamp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> timeStamp; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">SerialNumbered</span> :</span> <span class="keyword">public</span> T &#123;</span><br><span class="line">    <span class="keyword">long</span> serialNumber;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> counter;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    SerialNumbered() &#123; serialNumber = counter++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getSerialNumber</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> serialNumber; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define and initialize the static storage:</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">long</span> <span class="title">SerialNumbered</span>&lt;T&gt;:</span>:counter = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Basic</span> &#123;</span></span><br><span class="line">    <span class="built_in">string</span> value;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="built_in">string</span> val)</span> </span>&#123; value = val; &#125;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TimeStamped&lt;SerialNumbered&lt;Basic&gt;&gt; mixin1, mixin2;</span><br><span class="line">    mixin1.<span class="built_in">set</span>(<span class="string">"test string 1"</span>);</span><br><span class="line">    mixin2.<span class="built_in">set</span>(<span class="string">"test string 2"</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; mixin1.get() &lt;&lt; <span class="string">" "</span> &lt;&lt; mixin1.getStamp() &lt;&lt;</span><br><span class="line">      <span class="string">" "</span> &lt;&lt; mixin1.getSerialNumber() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; mixin2.get() &lt;&lt; <span class="string">" "</span> &lt;&lt; mixin2.getStamp() &lt;&lt;</span><br><span class="line">      <span class="string">" "</span> &lt;&lt; mixin2.getSerialNumber() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">test string 1 1452987605 1</span></span><br><span class="line"><span class="comment">test string 2 1452987605 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>main()</code> ä¸­ï¼Œ <strong>mixin1</strong> å’Œ <strong>mixin2</strong> æ‰€äº§ç”Ÿçš„ç±»å‹æ‹¥æœ‰æ‰€æ··å…¥ç±»å‹çš„æ‰€æœ‰æ–¹æ³•ã€‚å¯ä»¥å°†æ··å‹çœ‹ä½œæ˜¯ä¸€ç§åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†ç°æœ‰ç±»æ˜ å°„åˆ°æ–°çš„å­ç±»ä¸Šã€‚æ³¨æ„ï¼Œä½¿ç”¨è¿™ç§æŠ€æœ¯æ¥åˆ›å»ºä¸€ä¸ªæ··å‹æ˜¯å¤šä¹ˆçš„è½»è€Œæ˜“ä¸¾ã€‚åŸºæœ¬ä¸Šï¼Œåªéœ€è¦å£°æ˜â€œè¿™å°±æ˜¯æˆ‘æƒ³è¦çš„â€ï¼Œç´§è·Ÿç€å®ƒå°±å‘ç”Ÿäº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TimeStamped&lt;SerialNumbered&lt;Basic&gt;&gt; mixin1ï¼Œmixin2ï¼›</span><br></pre></td></tr></table></figure><p>é—æ†¾çš„æ˜¯ï¼ŒJava æ³›å‹ä¸å…è®¸è¿™æ ·ã€‚æ“¦é™¤ä¼šå¿˜è®°åŸºç±»ç±»å‹ï¼Œå› æ­¤</p><blockquote><p> æ³›å‹ç±»ä¸èƒ½ç›´æ¥ç»§æ‰¿è‡ªä¸€ä¸ªæ³›å‹å‚æ•°</p></blockquote><p>è¿™çªæ˜¾äº†è®¸å¤šæˆ‘åœ¨ Java è¯­è¨€è®¾è®¡å†³ç­–ï¼ˆä»¥åŠä¸è¿™äº›åŠŸèƒ½ä¸€èµ·å‘å¸ƒï¼‰ä¸­é‡åˆ°çš„ä¸€å¤§é—®é¢˜ï¼šå¤„ç†ä¸€ä»¶äº‹å¾ˆæœ‰å¸Œæœ›ï¼Œä½†æ˜¯å½“æ‚¨å®é™…å°è¯•åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…æ—¶ï¼Œæ‚¨ä¼šå‘ç°è‡ªå·±åšä¸åˆ°ã€‚</p><h3 id="ä¸æ¥å£æ··åˆ"><a href="#ä¸æ¥å£æ··åˆ" class="headerlink" title="ä¸æ¥å£æ··åˆ"></a>ä¸æ¥å£æ··åˆ</h3><p>ä¸€ç§æ›´å¸¸è§çš„æ¨èè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ¥å£æ¥äº§ç”Ÿæ··å‹æ•ˆæœï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Mixins.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TimeStamped</span> </span>&#123; <span class="function"><span class="keyword">long</span> <span class="title">getStamp</span><span class="params">()</span></span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeStampedImp</span> <span class="keyword">implements</span> <span class="title">TimeStamped</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> timeStamp;</span><br><span class="line">    TimeStampedImp() &#123;</span><br><span class="line">        timeStamp = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getStamp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> timeStamp; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SerialNumbered</span> </span>&#123; <span class="function"><span class="keyword">long</span> <span class="title">getSerialNumber</span><span class="params">()</span></span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SerialNumberedImp</span> <span class="keyword">implements</span> <span class="title">SerialNumbered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> serialNumber = counter++;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSerialNumber</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> serialNumber; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Basic</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(String val)</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicImp</span> <span class="keyword">implements</span> <span class="title">Basic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String val)</span> </span>&#123; value = val; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mixin</span> <span class="keyword">extends</span> <span class="title">BasicImp</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">TimeStamped</span>, <span class="title">SerialNumbered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TimeStamped timeStamp = <span class="keyword">new</span> TimeStampedImp();</span><br><span class="line">    <span class="keyword">private</span> SerialNumbered serialNumber =</span><br><span class="line">        <span class="keyword">new</span> SerialNumberedImp();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getStamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> timeStamp.getStamp();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSerialNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialNumber.getSerialNumber();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mixins</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Mixin mixin1 = <span class="keyword">new</span> Mixin(), mixin2 = <span class="keyword">new</span> Mixin();</span><br><span class="line">        mixin1.set(<span class="string">"test string 1"</span>);</span><br><span class="line">        mixin2.set(<span class="string">"test string 2"</span>);</span><br><span class="line">        System.out.println(mixin1.get() + <span class="string">" "</span> +</span><br><span class="line">            mixin1.getStamp() +  <span class="string">" "</span> + mixin1.getSerialNumber());</span><br><span class="line">        System.out.println(mixin2.get() + <span class="string">" "</span> +</span><br><span class="line">            mixin2.getStamp() +  <span class="string">" "</span> + mixin2.getSerialNumber());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">test string 1 1494331663026 1</span></span><br><span class="line"><span class="comment">test string 2 1494331663027 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>Mixin</strong> ç±»åŸºæœ¬ä¸Šæ˜¯åœ¨ä½¿ç”¨<em>å§”æ‰˜</em>ï¼Œå› æ­¤æ¯ä¸ªæ··å…¥ç±»å‹éƒ½è¦æ±‚åœ¨ <strong>Mixin</strong> ä¸­æœ‰ä¸€ä¸ªç›¸åº”çš„åŸŸï¼Œè€Œæˆ‘ä»¬å¿…é¡»åœ¨ <strong>Mixin</strong> ä¸­ç¼–å†™æ‰€æœ‰å¿…éœ€çš„æ–¹æ³•ï¼Œå°†æ–¹æ³•è°ƒç”¨è½¬å‘ç»™æ°å½“çš„å¯¹è±¡ã€‚è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†éå¸¸ç®€å•çš„ç±»ï¼Œä½†æ˜¯å½“ä½¿ç”¨æ›´å¤æ‚çš„æ··å‹æ—¶ï¼Œä»£ç æ•°é‡ä¼šæ€¥é€Ÿå¢åŠ ã€‚</p><h3 id="ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼"><a href="#ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼"></a>ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼</h3><p>å½“æˆ‘ä»¬è§‚å¯Ÿæ··å‹çš„ä½¿ç”¨æ–¹å¼æ—¶ï¼Œå°±ä¼šå‘ç°æ··å‹æ¦‚å¿µå¥½åƒä¸<em>è£…é¥°å™¨</em>è®¾è®¡æ¨¡å¼å…³ç³»å¾ˆè¿‘ã€‚è£…é¥°å™¨ç»å¸¸ç”¨äºæ»¡è¶³å„ç§å¯èƒ½çš„ç»„åˆï¼Œè€Œç›´æ¥å­ç±»åŒ–ä¼šäº§ç”Ÿè¿‡å¤šçš„ç±»ï¼Œå› æ­¤æ˜¯ä¸å®é™…çš„ã€‚<br>è£…é¥°å™¨æ¨¡å¼ä½¿ç”¨åˆ†å±‚å¯¹è±¡æ¥åŠ¨æ€é€æ˜åœ°å‘å•ä¸ªå¯¹è±¡ä¸­æ·»åŠ è´£ä»»ã€‚è£…é¥°å™¨æŒ‡å®šåŒ…è£…åœ¨æœ€åˆçš„å¯¹è±¡å‘¨å›´çš„æ‰€æœ‰å¯¹è±¡éƒ½å…·æœ‰ç›¸åŒçš„åŸºæœ¬æ¥å£ã€‚æŸäº›äº‹ç‰©æ˜¯å¯è£…é¥°çš„ï¼Œå¯ä»¥é€šè¿‡å°†å…¶ä»–ç±»åŒ…è£…åœ¨è¿™ä¸ªå¯è£…é¥°å¯¹è±¡çš„å››å‘¨ï¼Œæ¥å°†åŠŸèƒ½åˆ†å±‚ã€‚è¿™ä½¿å¾—å¯¹è£…é¥°å™¨çš„ä½¿ç”¨æ˜¯é€æ˜çš„â€”â€”æ— è®ºå¯¹è±¡æ˜¯å¦è¢«è£…é¥°ï¼Œæˆ‘ä»¬éƒ½æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥å‘å¯¹è±¡å‘é€çš„å…¬å…±æ¶ˆæ¯é›†ã€‚è£…é¥°ç±»ä¹Ÿå¯ä»¥æ·»åŠ æ–°æ–¹æ³•ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿™å°†æ˜¯å—é™çš„ã€‚<br>è£…é¥°å™¨æ˜¯é€šè¿‡ä½¿ç”¨ç»„åˆå’Œå½¢å¼åŒ–ç»“æ„ï¼ˆå¯è£…é¥°ç‰©/è£…é¥°å™¨å±‚æ¬¡ç»“æ„ï¼‰æ¥å®ç°çš„ï¼Œè€Œæ··å‹æ˜¯åŸºäºç»§æ‰¿çš„ã€‚å› æ­¤å¯ä»¥å°†åŸºäºå‚æ•°åŒ–ç±»å‹çš„æ··å‹å½“ä½œæ˜¯ä¸€ç§æ³›å‹è£…é¥°å™¨æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸éœ€è¦è£…é¥°å™¨è®¾è®¡æ¨¡å¼çš„ç»§æ‰¿ç»“æ„ã€‚<br>å‰é¢çš„ç¤ºä¾‹å¯ä»¥è¢«æ”¹å†™ä¸ºä½¿ç”¨è£…é¥°å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/decorator/Decoration.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;java generics.decorator.Decoration&#125;</span></span><br><span class="line"><span class="keyword">package</span> generics.decorator;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Basic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String val)</span> </span>&#123; value = val; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">extends</span> <span class="title">Basic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Basic basic;</span><br><span class="line">    Decorator(Basic basic) &#123; <span class="keyword">this</span>.basic = basic; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String val)</span> </span>&#123; basic.set(val); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> basic.get(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeStamped</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> timeStamp;</span><br><span class="line">    TimeStamped(Basic basic) &#123;</span><br><span class="line">        <span class="keyword">super</span>(basic);</span><br><span class="line">        timeStamp = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getStamp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> timeStamp; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SerialNumbered</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> serialNumber = counter++;</span><br><span class="line">    SerialNumbered(Basic basic) &#123; <span class="keyword">super</span>(basic); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSerialNumber</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> serialNumber; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decoration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TimeStamped t = <span class="keyword">new</span> TimeStamped(<span class="keyword">new</span> Basic());</span><br><span class="line">        TimeStamped t2 = <span class="keyword">new</span> TimeStamped(</span><br><span class="line">            <span class="keyword">new</span> SerialNumbered(<span class="keyword">new</span> Basic()));</span><br><span class="line">        <span class="comment">//- t2.getSerialNumber(); // Not available</span></span><br><span class="line">        SerialNumbered s = <span class="keyword">new</span> SerialNumbered(<span class="keyword">new</span> Basic());</span><br><span class="line">        SerialNumbered s2 = <span class="keyword">new</span> SerialNumbered(</span><br><span class="line">            <span class="keyword">new</span> TimeStamped(<span class="keyword">new</span> Basic()));</span><br><span class="line">        <span class="comment">//- s2.getStamp(); // Not available</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿè‡ªæ³›å‹çš„ç±»åŒ…å«æ‰€æœ‰æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œä½†æ˜¯ç”±ä½¿ç”¨è£…é¥°å™¨æ‰€äº§ç”Ÿçš„å¯¹è±¡ç±»å‹æ˜¯æœ€åè¢«è£…é¥°çš„ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡å¯ä»¥æ·»åŠ å¤šä¸ªå±‚ï¼Œä½†æ˜¯æœ€åä¸€å±‚æ‰æ˜¯å®é™…çš„ç±»å‹ï¼Œå› æ­¤åªæœ‰æœ€åä¸€å±‚çš„æ–¹æ³•æ˜¯å¯è§†çš„ï¼Œè€Œæ··å‹çš„ç±»å‹æ˜¯æ‰€æœ‰è¢«æ··åˆåˆ°ä¸€èµ·çš„ç±»å‹ã€‚å› æ­¤å¯¹äºè£…é¥°å™¨æ¥è¯´ï¼Œå…¶æ˜æ˜¾çš„ç¼ºé™·æ˜¯å®ƒåªèƒ½æœ‰æ•ˆåœ°å·¥ä½œäºè£…é¥°ä¸­çš„ä¸€å±‚ï¼ˆæœ€åä¸€å±‚ï¼‰ï¼Œè€Œæ··å‹æ–¹æ³•æ˜¾ç„¶ä¼šæ›´è‡ªç„¶ä¸€äº›ã€‚å› æ­¤ï¼Œè£…é¥°å™¨åªæ˜¯å¯¹ç”±æ··å‹æå‡ºçš„é—®é¢˜çš„ä¸€ç§å±€é™çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="ä¸åŠ¨æ€ä»£ç†æ··åˆ"><a href="#ä¸åŠ¨æ€ä»£ç†æ··åˆ" class="headerlink" title="ä¸åŠ¨æ€ä»£ç†æ··åˆ"></a>ä¸åŠ¨æ€ä»£ç†æ··åˆ</h3><p>å¯ä»¥ä½¿ç”¨åŠ¨æ€ä»£ç†æ¥åˆ›å»ºä¸€ç§æ¯”è£…é¥°å™¨æ›´è´´è¿‘æ··å‹æ¨¡å‹çš„æœºåˆ¶ï¼ˆæŸ¥çœ‹ <a href="book/19-Type-Information.md">ç±»å‹ä¿¡æ¯</a> ä¸€ç« ä¸­å…³äº Java çš„åŠ¨æ€ä»£ç†å¦‚ä½•å·¥ä½œçš„è§£é‡Šï¼‰ã€‚é€šè¿‡ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œæ‰€äº§ç”Ÿçš„ç±»çš„åŠ¨æ€ç±»å‹å°†ä¼šæ˜¯å·²ç»æ··å…¥çš„ç»„åˆç±»å‹ã€‚<br>ç”±äºåŠ¨æ€ä»£ç†çš„é™åˆ¶ï¼Œæ¯ä¸ªè¢«æ··å…¥çš„ç±»éƒ½å¿…é¡»æ˜¯æŸä¸ªæ¥å£çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/DynamicProxyMixin.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.Tuple.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MixinProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; delegatesByMethod;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    MixinProxy(Tuple2&lt;Object, Class&lt;?&gt;&gt;... pairs) &#123;</span><br><span class="line">        delegatesByMethod = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Tuple2&lt;Object, Class&lt;?&gt;&gt; pair : pairs) &#123;</span><br><span class="line">            <span class="keyword">for</span>(Method method : pair.a2.getMethods()) &#123;</span><br><span class="line">                String methodName = method.getName();</span><br><span class="line">                <span class="comment">// The first interface in the map</span></span><br><span class="line">                <span class="comment">// implements the method.</span></span><br><span class="line">                <span class="keyword">if</span>(!delegatesByMethod.containsKey(methodName))</span><br><span class="line">                    delegatesByMethod.put(methodName, pair.a1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">      Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        Object delegate = delegatesByMethod.get(methodName);</span><br><span class="line">        <span class="keyword">return</span> method.invoke(delegate, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newInstance</span><span class="params">(Tuple2... pairs)</span> </span>&#123;</span><br><span class="line">        Class[] interfaces = <span class="keyword">new</span> Class[pairs.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pairs.length; i++) &#123;</span><br><span class="line">            interfaces[i] = (Class)pairs[i].a2;</span><br><span class="line">        &#125;</span><br><span class="line">        ClassLoader cl = pairs[<span class="number">0</span>].a1.getClass().getClassLoader();</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(cl, interfaces, <span class="keyword">new</span> MixinProxy(pairs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxyMixin</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object mixin = MixinProxy.newInstance(</span><br><span class="line">          tuple(<span class="keyword">new</span> BasicImp(), Basic.class),</span><br><span class="line">          tuple(<span class="keyword">new</span> TimeStampedImp(), TimeStamped.class),</span><br><span class="line">          tuple(<span class="keyword">new</span> SerialNumberedImp(), SerialNumbered.class));</span><br><span class="line">        Basic b = (Basic)mixin;</span><br><span class="line">        TimeStamped t = (TimeStamped)mixin;</span><br><span class="line">        SerialNumbered s = (SerialNumbered)mixin;</span><br><span class="line">        b.set(<span class="string">"Hello"</span>);</span><br><span class="line">        System.out.println(b.get());</span><br><span class="line">        System.out.println(t.getStamp());</span><br><span class="line">        System.out.println(s.getSerialNumber());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Hello</span></span><br><span class="line"><span class="comment">1494331653339</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºåªæœ‰åŠ¨æ€ç±»å‹è€Œä¸æ˜¯é™æ€ç±»å‹æ‰åŒ…å«æ‰€æœ‰çš„æ··å…¥ç±»å‹ï¼Œå› æ­¤è¿™ä»æ—§ä¸å¦‚ C++ çš„æ–¹å¼å¥½ï¼Œå› ä¸ºå¯ä»¥åœ¨å…·æœ‰è¿™äº›ç±»å‹çš„å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬è¢«å¼ºåˆ¶è¦æ±‚å¿…é¡»å…ˆå°†è¿™äº›å¯¹è±¡å‘ä¸‹è½¬å‹åˆ°æ°å½“çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œå®ƒæ˜æ˜¾åœ°æ›´æ¥è¿‘äºçœŸæ­£çš„æ··å‹ã€‚<br>ä¸ºäº†è®© Java æ”¯æŒæ··å‹ï¼Œäººä»¬å·²ç»åšäº†å¤§é‡çš„å·¥ä½œæœç€è¿™ä¸ªç›®æ ‡åŠªåŠ›ï¼ŒåŒ…æ‹¬åˆ›å»ºäº†è‡³å°‘ä¸€ç§é™„åŠ è¯­è¨€ï¼ˆ Jam è¯­è¨€ï¼‰ï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨æ¥æ”¯æŒæ··å‹çš„ã€‚</p><!-- Latent Typing --><h2 id="æ½œåœ¨ç±»å‹æœºåˆ¶"><a href="#æ½œåœ¨ç±»å‹æœºåˆ¶" class="headerlink" title="æ½œåœ¨ç±»å‹æœºåˆ¶"></a>æ½œåœ¨ç±»å‹æœºåˆ¶</h2><p>åœ¨æœ¬ç« çš„å¼€å¤´ä»‹ç»è¿‡è¿™æ ·çš„æ€æƒ³ï¼Œå³è¦ç¼–å†™èƒ½å¤Ÿå°½å¯èƒ½å¹¿æ³›åœ°åº”ç”¨çš„ä»£ç ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å„ç§é€”å¾„æ¥æ”¾æ¾å¯¹æˆ‘ä»¬çš„ä»£ç å°†è¦ä½œç”¨çš„ç±»å‹æ‰€ä½œçš„é™åˆ¶ï¼ŒåŒæ—¶ä¸ä¸¢å¤±é™æ€ç±»å‹æ£€æŸ¥çš„å¥½å¤„ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™å‡ºæ— éœ€ä¿®æ”¹å°±å¯ä»¥åº”ç”¨äºæ›´å¤šæƒ…å†µçš„ä»£ç ï¼Œå³æ›´åŠ â€œæ³›åŒ–â€çš„ä»£ç ã€‚</p><p>Java æ³›å‹çœ‹èµ·æ¥æ˜¯å‘è¿™ä¸€æ–¹å‘è¿ˆè¿›äº†ä¸€æ­¥ã€‚å½“æˆ‘ä»¬åœ¨ç¼–å†™æˆ–ä½¿ç”¨åªæ˜¯æŒæœ‰å¯¹è±¡çš„æ³›å‹æ—¶ï¼Œè¿™äº›ä»£ç å°†å¯ä»¥å·¥ä½œäºä»»ä½•ç±»å‹ï¼ˆé™¤äº†åŸºæœ¬ç±»å‹ï¼Œå°½ç®¡æ­£å¦‚æˆ‘ä»¬æ‰€è§åˆ°çš„ï¼Œè‡ªåŠ¨è£…ç®±æœºåˆ¶å¯ä»¥å…‹æœè¿™ä¸€ç‚¹ï¼‰ã€‚æˆ–è€…ï¼Œæ¢ä¸ªè§’åº¦è®²ï¼Œâ€œæŒæœ‰å™¨â€æ³›å‹èƒ½å¤Ÿå£°æ˜ï¼šâ€œæˆ‘ä¸å…³å¿ƒæˆ‘ä»¬æ˜¯ä»€ä¹ˆç±»å‹â€ã€‚å¦‚æœä»£ç ä¸å…³å¿ƒå®ƒå°†è¦ä½œç”¨çš„ç±»å‹ï¼Œé‚£ä¹ˆè¿™ç§ä»£ç å°±å¯ä»¥çœŸæ­£åœ°åº”ç”¨äºä»»ä½•åœ°æ–¹ï¼Œå¹¶å› æ­¤è€Œç›¸å½“æ³›åŒ–ã€‚</p><p>è¿˜æ˜¯æ­£å¦‚æˆ‘ä»¬æ‰€è§åˆ°çš„ï¼Œå½“è¦åœ¨æ³›å‹ç±»å‹ä¸Šæ‰§è¡Œæ“ä½œï¼ˆå³è°ƒç”¨ <strong>Object</strong> æ–¹æ³•ä¹‹å¤–çš„æ–¹æ³•ï¼‰æ—¶ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚æ“¦é™¤å¼ºåˆ¶è¦æ±‚æŒ‡å®šå¯èƒ½ä¼šç”¨åˆ°çš„æ³›å‹ç±»å‹çš„è¾¹ç•Œï¼Œä»¥å®‰å…¨åœ°è°ƒç”¨ä»£ç ä¸­çš„æ³›å‹å¯¹è±¡ä¸Šçš„å…·ä½“æ–¹æ³•ã€‚è¿™æ˜¯å¯¹â€œæ³›åŒ–â€æ¦‚å¿µçš„ä¸€ç§æ˜æ˜¾çš„é™åˆ¶ï¼Œå› ä¸ºå¿…é¡»é™åˆ¶æˆ‘ä»¬çš„æ³›å‹ç±»å‹ï¼Œä½¿å®ƒä»¬ç»§æ‰¿è‡ªç‰¹å®šçš„ç±»ï¼Œæˆ–è€…å®ç°ç‰¹å®šçš„æ¥å£ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯èƒ½ä¼šä½¿ç”¨æ™®é€šç±»æˆ–æ™®é€šæ¥å£ï¼Œå› ä¸ºé™å®šè¾¹ç•Œçš„æ³›å‹å¯èƒ½ä¼šå’ŒæŒ‡å®šç±»æˆ–æ¥å£æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>æŸäº›ç¼–ç¨‹è¯­è¨€æä¾›çš„ä¸€ç§è§£å†³æ–¹æ¡ˆç§°ä¸º<em>æ½œåœ¨ç±»å‹æœºåˆ¶</em>æˆ–<em>ç»“æ„åŒ–ç±»å‹æœºåˆ¶</em>ï¼Œè€Œæ›´å¤æ€ªçš„æœ¯è¯­ç§°ä¸º<em>é¸­å­ç±»å‹æœºåˆ¶</em>ï¼Œå³â€œå¦‚æœå®ƒèµ°èµ·æ¥åƒé¸­å­ï¼Œå¹¶ä¸”å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒå½“ä½œé¸­å­å¯¹å¾…ã€‚â€é¸­å­ç±»å‹æœºåˆ¶å˜æˆäº†ä¸€ç§ç›¸å½“æµè¡Œçš„æœ¯è¯­ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®ƒä¸åƒå…¶ä»–çš„æœ¯è¯­é‚£æ ·æ‰¿è½½ç€å†å²çš„åŒ…è¢±ã€‚</p><p>æ³›å‹ä»£ç å…¸å‹åœ°åªèƒ½åœ¨æ³›å‹ç±»å‹ä¸Šè°ƒç”¨å°‘é‡æ–¹æ³•ï¼Œè€Œå…·æœ‰æ½œåœ¨ç±»å‹æœºåˆ¶çš„è¯­è¨€åªè¦æ±‚å®ç°æŸä¸ªæ–¹æ³•å­é›†ï¼Œè€Œä¸æ˜¯æŸä¸ªç‰¹å®šç±»æˆ–æ¥å£ï¼Œä»è€Œæ”¾æ¾äº†è¿™ç§é™åˆ¶ï¼ˆå¹¶ä¸”å¯ä»¥äº§ç”Ÿæ›´åŠ æ³›åŒ–çš„ä»£ç ï¼‰ã€‚æ­£ç”±äºæ­¤ï¼Œæ½œåœ¨ç±»å‹æœºåˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ¨ªè·¨ç±»ç»§æ‰¿ç»“æ„ï¼Œè°ƒç”¨ä¸å±äºæŸä¸ªå…¬å…±æ¥å£çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œå®é™…ä¸Šä¸€æ®µä»£ç å¯ä»¥å£°æ˜ï¼šâ€œæˆ‘ä¸å…³å¿ƒæˆ‘ä»¬æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåªè¦æˆ‘ä»¬å¯ä»¥ <code>speak()</code> å’Œ <code>sit()</code> å³å¯ã€‚â€ç”±äºä¸è¦æ±‚å…·ä½“ç±»å‹ï¼Œå› æ­¤ä»£ç å°±å¯ä»¥æ›´åŠ æ³›åŒ–ã€‚</p><p>æ½œåœ¨ç±»å‹æœºåˆ¶æ˜¯ä¸€ç§ä»£ç ç»„ç»‡å’Œå¤ç”¨æœºåˆ¶ã€‚æœ‰äº†å®ƒï¼Œç¼–å†™å‡ºçš„ä»£ç ç›¸å¯¹äºæ²¡æœ‰å®ƒç¼–å†™å‡ºçš„ä»£ç ï¼Œèƒ½å¤Ÿæ›´å®¹æ˜“åœ°å¤ç”¨ã€‚ä»£ç ç»„ç»‡å’Œå¤ç”¨æ˜¯æ‰€æœ‰è®¡ç®—æœºç¼–ç¨‹çš„åŸºæœ¬æ‰‹æ®µï¼šç¼–å†™ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œå¹¶åœ¨ä¸€ä¸ªä½ç½®ä¿å­˜ä»£ç ã€‚å› ä¸ºæˆ‘å¹¶æœªè¢«è¦æ±‚å»å‘½åæˆ‘çš„ä»£ç è¦æ“ä½œäºå…¶ä¸Šçš„ç¡®åˆ‡æ¥å£ï¼Œæ‰€ä»¥ï¼Œæœ‰äº†æ½œåœ¨ç±»å‹æœºåˆ¶ï¼Œæˆ‘å°±å¯ä»¥ç¼–å†™æ›´å°‘çš„ä»£ç ï¼Œå¹¶æ›´å®¹æ˜“åœ°å°†å…¶åº”ç”¨äºå¤šä¸ªåœ°æ–¹ã€‚</p><p>æ”¯æŒæ½œåœ¨ç±»å‹æœºåˆ¶çš„è¯­è¨€åŒ…æ‹¬ Pythonï¼ˆå¯ä»¥ä» <a href="http://www.Python.org" target="_blank" rel="noopener">www.Python.org</a> å…è´¹ä¸‹è½½ï¼‰ã€C++ã€Rubyã€SmallTalk å’Œ Goã€‚Python æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼ˆå‡ ä¹æ‰€æœ‰çš„ç±»å‹æ£€æŸ¥éƒ½å‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼‰ï¼Œè€Œ C++ å’Œ Go æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼ˆç±»å‹æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼‰ï¼Œå› æ­¤æ½œåœ¨ç±»å‹æœºåˆ¶ä¸è¦æ±‚é™æ€æˆ–åŠ¨æ€ç±»å‹æ£€æŸ¥ã€‚</p><h3 id="pyhton-ä¸­çš„æ½œåœ¨ç±»å‹"><a href="#pyhton-ä¸­çš„æ½œåœ¨ç±»å‹" class="headerlink" title="pyhton ä¸­çš„æ½œåœ¨ç±»å‹"></a>pyhton ä¸­çš„æ½œåœ¨ç±»å‹</h3><p>å¦‚æœæˆ‘ä»¬å°†ä¸Šé¢çš„æè¿°ç”¨ Python æ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generics/DogsAndRobots.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Arf!"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sit</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Sitting"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reproduce</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Click!"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sit</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Clank!"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">oilChange</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">perform</span><span class="params">(anything)</span>:</span></span><br><span class="line">    anything.speak()</span><br><span class="line">    anything.sit()</span><br><span class="line"></span><br><span class="line">a = Dog()</span><br><span class="line">b = Robot()</span><br><span class="line">perform(a)</span><br><span class="line">perform(b)</span><br><span class="line"></span><br><span class="line">output = <span class="string">"""</span></span><br><span class="line"><span class="string">Arf!</span></span><br><span class="line"><span class="string">Sitting</span></span><br><span class="line"><span class="string">Click!</span></span><br><span class="line"><span class="string">Clank!</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>Python ä½¿ç”¨ç¼©è¿›æ¥ç¡®å®šä½œç”¨åŸŸï¼ˆå› æ­¤ä¸éœ€è¦ä»»ä½•èŠ±æ‹¬å·ï¼‰ï¼Œè€Œå†’å·å°†è¡¨ç¤ºæ–°çš„ä½œç”¨åŸŸçš„å¼€å§‹ã€‚â€œ<strong>#</strong>â€ è¡¨ç¤ºæ³¨é‡Šåˆ°è¡Œå°¾ï¼Œå°±åƒJavaä¸­çš„ â€œ <strong>//</strong> â€ã€‚ç±»çš„æ–¹æ³•éœ€è¦æ˜¾å¼åœ°æŒ‡å®š <strong>this</strong> å¼•ç”¨çš„ç­‰ä»·ç‰©ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‰æƒ¯ä¾‹æˆä¸º <strong>self</strong> ã€‚æ„é€ å™¨è°ƒç”¨ä¸è¦æ±‚ä»»ä½•ç±»å‹çš„â€œ <strong>new</strong> â€å…³é”®å­—ï¼Œå¹¶ä¸” Python å…è®¸æ™®é€šï¼ˆéæˆå‘˜ï¼‰å‡½æ•°ï¼Œå°±åƒ <code>perform()</code> æ‰€è¡¨æ˜çš„é‚£æ ·ã€‚æ³¨æ„ï¼Œåœ¨ <code>perform(anything)</code> ä¸­ï¼Œæ²¡æœ‰ä»»ä½•é’ˆå¯¹ <strong>anything</strong> çš„ç±»å‹ï¼Œ<strong>anything</strong> åªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå®ƒå¿…é¡»èƒ½å¤Ÿæ‰§è¡Œ <code>perform()</code> æœŸæœ›å®ƒæ‰§è¡Œçš„æ“ä½œï¼Œå› æ­¤è¿™é‡Œéšå«ç€ä¸€ä¸ªæ¥å£ã€‚ä½†æ˜¯æˆ‘ä»¬ä»æ¥éƒ½ä¸å¿…æ˜¾å¼åœ°å†™å‡ºè¿™ä¸ªæ¥å£â€”â€”å®ƒæ˜¯æ½œåœ¨çš„ã€‚<code>perform()</code> ä¸å…³å¿ƒå…¶å‚æ•°çš„ç±»å‹ï¼Œå› æ­¤æˆ‘å¯ä»¥å‘å®ƒä¼ é€’ä»»ä½•å¯¹è±¡ï¼Œåªè¦è¯¥å¯¹è±¡æ”¯æŒ  <code>speak()</code> å’Œ <code>sit()</code> æ–¹æ³•ã€‚å¦‚æœä¼ é€’ç»™ <code>perform()</code> çš„å¯¹è±¡ä¸æ”¯æŒè¿™äº›æ“ä½œï¼Œé‚£ä¹ˆå°†ä¼šå¾—åˆ°è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><p>è¾“å‡ºè§„å®šä½¿ç”¨ä¸‰é‡å¼•å·åˆ›å»ºå¸¦æœ‰å†…åµŒæ¢è¡Œç¬¦çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="C-ä¸­çš„æ½œåœ¨ç±»å‹"><a href="#C-ä¸­çš„æ½œåœ¨ç±»å‹" class="headerlink" title="C++ ä¸­çš„æ½œåœ¨ç±»å‹"></a>C++ ä¸­çš„æ½œåœ¨ç±»å‹</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨ C++ äº§ç”Ÿç›¸åŒçš„æ•ˆæœï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/DogsAndRobots.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Arf!"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Sitting"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reproduce</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Click!"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"Clank!"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">oilChange</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">void</span> <span class="title">perform</span>(<span class="title">T</span> <span class="title">anything</span>) &#123;</span></span><br><span class="line">    anything.speak();</span><br><span class="line">    anything.sit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Dog d;</span><br><span class="line">    Robot r;</span><br><span class="line">    perform(d);</span><br><span class="line">    perform(r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Arf!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åœ¨ Python å’Œ C++ ä¸­ï¼Œ<strong>Dog</strong> å’Œ <strong>Robot</strong> æ²¡æœ‰ä»»ä½•å…±åŒçš„ä¸œè¥¿ï¼Œåªæ˜¯ç¢°å·§æœ‰ä¸¤ä¸ªæ–¹æ³•å…·æœ‰ç›¸åŒçš„ç­¾åã€‚ä»ç±»å‹çš„è§‚ç‚¹çœ‹ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œ<code>perform()</code> ä¸å…³å¿ƒå…¶å‚æ•°çš„å…·ä½“ç±»å‹ï¼Œå¹¶ä¸”æ½œåœ¨ç±»å‹æœºåˆ¶å…è®¸å®ƒæ¥å—è¿™ä¸¤ç§ç±»å‹çš„å¯¹è±¡ã€‚<br>C++ ç¡®ä¿äº†å®ƒå®é™…ä¸Šå¯ä»¥å‘é€çš„é‚£äº›æ¶ˆæ¯ï¼Œå¦‚æœè¯•å›¾ä¼ é€’é”™è¯¯ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼ˆè¿™äº›é”™è¯¯æ¶ˆæ¯ä»å†å²ä¸Šçœ‹æ˜¯ç›¸å½“å¯æ€•å’Œå†—é•¿çš„ï¼Œæ˜¯ C++ çš„æ¨¡ç‰ˆåå£°æ¬ ä½³çš„ä¸»è¦åŸå› ï¼‰ã€‚å°½ç®¡å®ƒä»¬æ˜¯åœ¨ä¸åŒæ—¶æœŸå®ç°è¿™ä¸€ç‚¹çš„ï¼ŒC++ åœ¨ç¼–è¯‘æœŸï¼Œè€Œ Python åœ¨è¿è¡Œæ—¶ï¼Œä½†æ˜¯è¿™ä¸¤ç§è¯­è¨€éƒ½å¯ä»¥ç¡®ä¿ç±»å‹ä¸ä¼šè¢«è¯¯ç”¨ï¼Œå› æ­¤è¢«è®¤ä¸ºæ˜¯å¼ºç±»å‹çš„ã€‚æ½œåœ¨ç±»å‹æœºåˆ¶æ²¡æœ‰æŸå®³å¼ºç±»å‹æœºåˆ¶ã€‚</p><h3 id="Go-ä¸­çš„æ½œåœ¨ç±»å‹"><a href="#Go-ä¸­çš„æ½œåœ¨ç±»å‹" class="headerlink" title="Go ä¸­çš„æ½œåœ¨ç±»å‹"></a>Go ä¸­çš„æ½œåœ¨ç±»å‹</h3><p>è¿™é‡Œç”¨ Go è¯­è¨€ç¼–å†™ç›¸åŒçš„ç¨‹åºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/dogsandrobots.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Dog)</span> <span class="title">speak</span><span class="params">()</span></span> &#123; fmt.Printf(<span class="string">"Arf!\n"</span>)&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Dog)</span> <span class="title">sit</span><span class="params">()</span></span> &#123; fmt.Printf(<span class="string">"Sitting\n"</span>)&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Dog)</span> <span class="title">reproduce</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Robot <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Robot)</span> <span class="title">speak</span><span class="params">()</span></span> &#123; fmt.Printf(<span class="string">"Click!\n"</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Robot)</span> <span class="title">sit</span><span class="params">()</span></span> &#123; fmt.Printf(<span class="string">"Clank!\n"</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this Robot)</span> <span class="title">oilChange</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">perform</span><span class="params">(speaker <span class="keyword">interface</span> &#123; speak()</span>; <span class="title">sit</span><span class="params">()</span> &#125;)</span> &#123;</span><br><span class="line">  speaker.speak();</span><br><span class="line">  speaker.sit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  perform(Dog&#123;&#125;)</span><br><span class="line">  perform(Robot&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Arf!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>Go æ²¡æœ‰ <strong>class</strong> å…³é”®å­—ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ä¸Šè¿°å½¢å¼åˆ›å»ºç­‰æ•ˆçš„åŸºæœ¬ç±»ï¼šå®ƒé€šå¸¸ä¸å®šä¹‰ä¸ºç±»ï¼Œè€Œæ˜¯å®šä¹‰ä¸º <strong>struct</strong> ï¼Œåœ¨å…¶ä¸­å®šä¹‰æ•°æ®å­—æ®µï¼ˆæ­¤å¤„ä¸å­˜åœ¨ï¼‰ã€‚ å¯¹äºæ¯ç§æ–¹æ³•ï¼Œéƒ½ä»¥ <strong>func</strong> å…³é”®å­—å¼€å¤´ï¼Œç„¶åï¼ˆä¸ºäº†å°†è¯¥æ–¹æ³•é™„åŠ åˆ°æ‚¨çš„ç±»ä¸Šï¼‰æ”¾åœ¨æ‹¬å·ä¸­ï¼Œè¯¥æ‹¬å·åŒ…å«å¯¹è±¡å¼•ç”¨ï¼Œè¯¥å¯¹è±¡å¼•ç”¨å¯ä»¥æ˜¯ä»»ä½•æ ‡è¯†ç¬¦ï¼Œä½†æ˜¯æˆ‘åœ¨è¿™é‡Œä½¿ç”¨ <strong>this</strong> æ¥æé†’æ‚¨ï¼Œå°±åƒåœ¨ C ++ æˆ– Java ä¸­çš„ <strong>this</strong> ä¸€æ ·ã€‚ ç„¶åï¼Œåœ¨Goä¸­åƒè¿™æ ·å®šä¹‰å…¶ä½™çš„å‡½æ•°ã€‚</p><p>Goä¹Ÿæ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œå› æ­¤è¿™ç§â€œé¢å‘å¯¹è±¡çš„ç›®æ ‡â€å½¢å¼æ˜¯ç›¸å¯¹åŸå§‹çš„ï¼Œå¹¶ä¸”å¯èƒ½æ˜¯æˆ‘æ— æ³•èŠ±æ›´å¤šçš„æ—¶é—´æ¥å­¦ä¹ è¯¥è¯­è¨€çš„ä¸»è¦åŸå› ã€‚ ä½†æ˜¯ï¼ŒGo çš„ç»„æˆå¾ˆç®€å•ã€‚</p><p><code>perform()</code> å‡½æ•°ä½¿ç”¨æ½œåœ¨ç±»å‹ï¼šå‚æ•°çš„ç¡®åˆ‡ç±»å‹å¹¶ä¸é‡è¦ï¼Œåªè¦å®ƒåŒ…å«äº† <code>speak()</code> å’Œ  <code>sit()</code> æ–¹æ³•å³å¯ã€‚ è¯¥æ¥å£åœ¨æ­¤å¤„åŒ¿åå®šä¹‰ï¼Œå†…è”ï¼Œå¦‚ <code>perform()</code> çš„å‚æ•°åˆ—è¡¨æ‰€ç¤ºã€‚</p><p><code>main()</code> è¯æ˜ <code>perform()</code> ç¡®å®å¯¹å…¶å‚æ•°çš„ç¡®åˆ‡ç±»å‹ä¸åœ¨ä¹ï¼Œåªè¦å¯ä»¥åœ¨è¯¥å‚æ•°ä¸Šè°ƒç”¨ <code>talk()</code> å’Œ <code>sit()</code> å³å¯ã€‚ ä½†æ˜¯ï¼Œå°±åƒ C ++ æ¨¡æ¿å‡½æ•°ä¸€æ ·ï¼Œåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ã€‚</p><p>è¯­æ³• <strong>Dog {}</strong> å’Œ <strong>Robot {}</strong> åˆ›å»ºåŒ¿åçš„ <strong>Dog</strong> å’Œ <strong>Robot</strong> ç»“æ„ã€‚</p><h3 id="javaä¸­çš„ç›´æ¥æ½œåœ¨ç±»å‹"><a href="#javaä¸­çš„ç›´æ¥æ½œåœ¨ç±»å‹" class="headerlink" title="javaä¸­çš„ç›´æ¥æ½œåœ¨ç±»å‹"></a>javaä¸­çš„ç›´æ¥æ½œåœ¨ç±»å‹</h3><p>å› ä¸ºæ³›å‹æ˜¯åœ¨è¿™åœºç«èµ›çš„åæœŸæ‰æ·»åŠ åˆ° Java ä¸­ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•æœºä¼šå¯ä»¥å»å®ç°ä»»ä½•ç±»å‹çš„æ½œåœ¨ç±»å‹æœºåˆ¶ï¼Œå› æ­¤ Java æ²¡æœ‰å¯¹è¿™ç§ç‰¹æ€§çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œåˆçœ‹èµ·æ¥ï¼ŒJava çš„æ³›å‹æœºåˆ¶æ¯”æ”¯æŒæ½œåœ¨ç±»å‹æœºåˆ¶çš„è¯­è¨€æ›´â€œç¼ºä¹æ³›åŒ–æ€§â€ã€‚ï¼ˆä½¿ç”¨æ“¦é™¤æ¥å®ç° Java æ³›å‹çš„å®ç°æœ‰æ—¶ç§°ä¸ºç¬¬äºŒç±»æ³›å‹ç±»å‹ï¼‰ä¾‹å¦‚ï¼Œåœ¨ Java 8  ä¹‹å‰å¦‚æœæˆ‘ä»¬è¯•å›¾ç”¨ Java å®ç°ä¸Šé¢ dogs-and-robots çš„ç¤ºä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šè¢«å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ä¸€ä¸ªç±»æˆ–æ¥å£ï¼Œå¹¶åœ¨è¾¹ç•Œè¡¨è¾¾å¼ä¸­æŒ‡å®šå®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Performs.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Performs</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/DogsAndRobots.java</span></span><br><span class="line"><span class="comment">// No (direct) latent typing in Java</span></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformingDog</span> <span class="keyword">extends</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Performs</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Woof!"</span>); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Sitting"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reproduce</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">implements</span> <span class="title">Performs</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Click!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Clank!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oilChange</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Communicate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Performs&gt;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">perform</span><span class="params">(T performer)</span> </span>&#123;</span><br><span class="line">        performer.speak();</span><br><span class="line">        performer.sit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogsAndRobots</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Communicate.perform(<span class="keyword">new</span> PerformingDog());</span><br><span class="line">        Communicate.perform(<span class="keyword">new</span> Robot());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Woof!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¦æ³¨æ„ï¼Œ<code>perform()</code> ä¸éœ€è¦ä½¿ç”¨æ³›å‹æ¥å·¥ä½œï¼Œå®ƒå¯ä»¥è¢«ç®€å•åœ°æŒ‡å®šä¸ºæ¥å—ä¸€ä¸ª <strong>Performs</strong> å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SimpleDogsAndRobots.java</span></span><br><span class="line"><span class="comment">// Removing the generic; code still works</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommunicateSimply</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">perform</span><span class="params">(Performs performer)</span> </span>&#123;</span><br><span class="line">        performer.speak();</span><br><span class="line">        performer.sit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDogsAndRobots</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CommunicateSimply.perform(<span class="keyword">new</span> PerformingDog());</span><br><span class="line">        CommunicateSimply.perform(<span class="keyword">new</span> Robot());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Woof!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæ³›å‹ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºè¿™äº›ç±»å·²ç»è¢«å¼ºåˆ¶è¦æ±‚å®ç° <strong>Performs</strong> æ¥å£ã€‚</p><!-- Compensating for the Lack of (Direct) Latent --><h2 id="å¯¹ç¼ºä¹æ½œåœ¨ç±»å‹æœºåˆ¶çš„è¡¥å¿"><a href="#å¯¹ç¼ºä¹æ½œåœ¨ç±»å‹æœºåˆ¶çš„è¡¥å¿" class="headerlink" title="å¯¹ç¼ºä¹æ½œåœ¨ç±»å‹æœºåˆ¶çš„è¡¥å¿"></a>å¯¹ç¼ºä¹æ½œåœ¨ç±»å‹æœºåˆ¶çš„è¡¥å¿</h2><p>å°½ç®¡ Java ä¸ç›´æ¥æ”¯æŒæ½œåœ¨ç±»å‹æœºåˆ¶ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€æ³›å‹ä»£ç ä¸èƒ½åœ¨ä¸åŒçš„ç±»å‹å±‚æ¬¡ç»“æ„ä¹‹é—´åº”ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»æ—§å¯ä»¥åˆ›å»ºçœŸæ­£çš„æ³›å‹ä»£ç ï¼Œä½†æ˜¯è¿™éœ€è¦ä»˜å‡ºä¸€äº›é¢å¤–çš„åŠªåŠ›ã€‚</p><h3 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h3><p>å¯ä»¥ä½¿ç”¨çš„ä¸€ç§æ–¹å¼æ˜¯åå°„ï¼Œä¸‹é¢çš„ <code>perform()</code> æ–¹æ³•å°±æ˜¯ç”¨äº†æ½œåœ¨ç±»å‹æœºåˆ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/LatentReflection.java</span></span><br><span class="line"><span class="comment">// Using reflection for latent typing</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Does not implement Performs:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mime</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">walkAgainstTheWind</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Pretending to sit"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushInvisibleWalls</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Mime"</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Does not implement Performs:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmartDog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Woof!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Sitting"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reproduce</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommunicateReflectively</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">perform</span><span class="params">(Object speaker)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; spkr = speaker.getClass();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method speak = spkr.getMethod(<span class="string">"speak"</span>);</span><br><span class="line">                speak.invoke(speaker);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(NoSuchMethodException e) &#123;</span><br><span class="line">                System.out.println(speaker + <span class="string">" cannot speak"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method sit = spkr.getMethod(<span class="string">"sit"</span>);</span><br><span class="line">                sit.invoke(speaker);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(NoSuchMethodException e) &#123;</span><br><span class="line">                System.out.println(speaker + <span class="string">" cannot sit"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(SecurityException |</span><br><span class="line">            IllegalAccessException |</span><br><span class="line">            IllegalArgumentException |</span><br><span class="line">            InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(speaker.toString(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LatentReflection</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CommunicateReflectively.perform(<span class="keyword">new</span> SmartDog());</span><br><span class="line">        CommunicateReflectively.perform(<span class="keyword">new</span> Robot());</span><br><span class="line">        CommunicateReflectively.perform(<span class="keyword">new</span> Mime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Woof!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">Mime cannot speak</span></span><br><span class="line"><span class="comment">Pretending to sit</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ï¼Œè¿™äº›ç±»å®Œå…¨æ˜¯å½¼æ­¤åˆ†ç¦»çš„ï¼Œæ²¡æœ‰ä»»ä½•å…¬å…±åŸºç±»ï¼ˆé™¤äº† <strong>Object</strong> ï¼‰æˆ–æ¥å£ã€‚é€šè¿‡åå°„, <code>CommunicateReflectively.perform()</code> èƒ½å¤ŸåŠ¨æ€åœ°ç¡®å®šæ‰€éœ€è¦çš„æ–¹æ³•æ˜¯å¦å¯ç”¨å¹¶è°ƒç”¨å®ƒä»¬ã€‚å®ƒç”šè‡³èƒ½å¤Ÿå¤„ç† <strong>Mime</strong> åªå…·æœ‰ä¸€ä¸ªå¿…éœ€çš„æ–¹æ³•è¿™ä¸€äº‹å®ï¼Œå¹¶èƒ½å¤Ÿéƒ¨åˆ†å®ç°å…¶ç›®æ ‡ã€‚</p><h3 id="å°†ä¸€ä¸ªæ–¹æ³•åº”ç”¨äºåºåˆ—"><a href="#å°†ä¸€ä¸ªæ–¹æ³•åº”ç”¨äºåºåˆ—" class="headerlink" title="å°†ä¸€ä¸ªæ–¹æ³•åº”ç”¨äºåºåˆ—"></a>å°†ä¸€ä¸ªæ–¹æ³•åº”ç”¨äºåºåˆ—</h3><p>åå°„æä¾›äº†ä¸€äº›æœ‰ç”¨çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯å®ƒå°†æ‰€æœ‰çš„ç±»å‹æ£€æŸ¥éƒ½è½¬ç§»åˆ°äº†è¿è¡Œæ—¶ï¼Œå› æ­¤åœ¨è®¸å¤šæƒ…å†µä¸‹å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çš„ã€‚å¦‚æœèƒ½å¤Ÿå®ç°ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼Œè¿™é€šå¸¸ä¼šæ›´ç¬¦åˆè¦æ±‚ã€‚ä½†æ˜¯æœ‰å¯èƒ½å®ç°ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥å’Œæ½œåœ¨ç±»å‹æœºåˆ¶å—ï¼Ÿ</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªè¯´æ˜è¿™ä¸ªé—®é¢˜çš„ç¤ºä¾‹ã€‚å‡è®¾æƒ³è¦åˆ›å»ºä¸€ä¸ª <code>apply()</code> æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿå°†ä»»ä½•æ–¹æ³•åº”ç”¨äºæŸä¸ªåºåˆ—ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨æ¥å£ä¸é€‚åˆï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦å°†ä»»ä½•æ–¹æ³•åº”ç”¨äºä¸€ä¸ªå¯¹è±¡é›†åˆï¼Œè€Œæ¥å£ä¸å¯èƒ½æè¿°ä»»ä½•æ–¹æ³•ã€‚å¦‚ä½•ç”¨ Java æ¥å®ç°è¿™ä¸ªéœ€æ±‚å‘¢ï¼Ÿ</p><p>æœ€åˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åå°„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”±äºæœ‰äº† Java çš„å¯å˜å‚æ•°ï¼Œè¿™ç§æ–¹å¼è¢«è¯æ˜æ˜¯ç›¸å½“ä¼˜é›…çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Apply.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apply</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, S extends Iterable&lt;T&gt;&gt;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">apply</span><span class="params">(S seq, Method f, Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(T t: seq)</span><br><span class="line">                f.invoke(t, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IllegalAccessException |</span><br><span class="line">            IllegalArgumentException |</span><br><span class="line">            InvocationTargetException e) &#123;</span><br><span class="line">            <span class="comment">// Failures are programmer errors</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <strong>Apply.java</strong> ä¸­ï¼Œå¼‚å¸¸è¢«è½¬æ¢ä¸º <strong>RuntimeException</strong> ï¼Œå› ä¸ºæ²¡æœ‰å¤šå°‘åŠæ³•å¯ä»¥ä»è¿™ç§å¼‚å¸¸ä¸­æ¢å¤â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬å®é™…ä¸Šä»£è¡¨ç€ç¨‹åºå‘˜çš„é”™è¯¯ã€‚</p><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åªä½¿ç”¨ Java 8 æ–¹æ³•å‚è€ƒï¼ˆç¨åæ˜¾ç¤ºï¼‰è€Œä¸æ˜¯åå°„æ–¹æ³• <strong>f</strong> ï¼Ÿ æ³¨æ„ï¼Œ<code>invoke()</code> å’Œ <code>apply()</code> çš„ä¼˜ç‚¹æ˜¯å®ƒä»¬å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œçµæ´»æ€§å¯èƒ½è‡³å…³é‡è¦ã€‚</p><p>ä¸ºäº†æµ‹è¯• <strong>Apply</strong> ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª <strong>Shape</strong> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Shape.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName() + <span class="string">" "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span> + <span class="string">" rotate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newSize)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span> + <span class="string">" resize "</span> + newSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¢«ä¸€ä¸ªå­ç±» <strong>Square</strong> ç»§æ‰¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/Square.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯• <strong>Apply</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ApplyTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplyTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Shape&gt; shapes =</span><br><span class="line">          Suppliers.create(ArrayList::<span class="keyword">new</span>, Shape::<span class="keyword">new</span>, <span class="number">3</span>);</span><br><span class="line">        Apply.apply(shapes, Shape.class.getMethod(<span class="string">"rotate"</span>));</span><br><span class="line">        Apply.apply(shapes, Shape.class.getMethod(<span class="string">"resize"</span>, <span class="keyword">int</span>.class), <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Square&gt; squares =</span><br><span class="line">          Suppliers.create(ArrayList::<span class="keyword">new</span>, Square::<span class="keyword">new</span>, <span class="number">3</span>);</span><br><span class="line">        Apply.apply(squares, Shape.class.getMethod(<span class="string">"rotate"</span>));</span><br><span class="line">        Apply.apply(squares, Shape.class.getMethod(<span class="string">"resize"</span>, <span class="keyword">int</span>.class), <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        Apply.apply(<span class="keyword">new</span> FilledList&lt;&gt;(Shape::<span class="keyword">new</span>, <span class="number">3</span>),</span><br><span class="line">          Shape.class.getMethod(<span class="string">"rotate"</span>));</span><br><span class="line">        Apply.apply(<span class="keyword">new</span> FilledList&lt;&gt;(Square::<span class="keyword">new</span>, <span class="number">3</span>),</span><br><span class="line">          Shape.class.getMethod(<span class="string">"rotate"</span>));</span><br><span class="line"></span><br><span class="line">        SimpleQueue&lt;Shape&gt; shapeQ = Suppliers.fill(</span><br><span class="line">          <span class="keyword">new</span> SimpleQueue&lt;&gt;(), SimpleQueue::add,</span><br><span class="line">          Shape::<span class="keyword">new</span>, <span class="number">3</span>);</span><br><span class="line">        Suppliers.fill(shapeQ, SimpleQueue::add,</span><br><span class="line">          Square::<span class="keyword">new</span>, <span class="number">3</span>);</span><br><span class="line">        Apply.apply(shapeQ, Shape.class.getMethod(<span class="string">"rotate"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Shape 0 rotate</span></span><br><span class="line"><span class="comment">Shape 1 rotate</span></span><br><span class="line"><span class="comment">Shape 2 rotate</span></span><br><span class="line"><span class="comment">Shape 0 resize 7</span></span><br><span class="line"><span class="comment">Shape 1 resize 7</span></span><br><span class="line"><span class="comment">Shape 2 resize 7</span></span><br><span class="line"><span class="comment">Square 3 rotate</span></span><br><span class="line"><span class="comment">Square 4 rotate</span></span><br><span class="line"><span class="comment">Square 5 rotate</span></span><br><span class="line"><span class="comment">Square 3 resize 7</span></span><br><span class="line"><span class="comment">Square 4 resize 7</span></span><br><span class="line"><span class="comment">Square 5 resize 7</span></span><br><span class="line"><span class="comment">Shape 6 rotate</span></span><br><span class="line"><span class="comment">Shape 7 rotate</span></span><br><span class="line"><span class="comment">Shape 8 rotate</span></span><br><span class="line"><span class="comment">Square 9 rotate</span></span><br><span class="line"><span class="comment">Square 10 rotate</span></span><br><span class="line"><span class="comment">Square 11 rotate</span></span><br><span class="line"><span class="comment">Shape 12 rotate</span></span><br><span class="line"><span class="comment">Shape 13 rotate</span></span><br><span class="line"><span class="comment">Shape 14 rotate</span></span><br><span class="line"><span class="comment">Square 15 rotate</span></span><br><span class="line"><span class="comment">Square 16 rotate</span></span><br><span class="line"><span class="comment">Square 17 rotate</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åœ¨ <strong>Apply</strong> ä¸­ï¼Œæˆ‘ä»¬è¿æ°”å¾ˆå¥½ï¼Œå› ä¸ºç¢°å·§åœ¨ Java ä¸­å†…å»ºäº†ä¸€ä¸ªç”± Java é›†åˆç±»åº“ä½¿ç”¨çš„ <strong>Iterable</strong> æ¥å£ã€‚æ­£ç”±äºæ­¤ï¼Œ <code>apply()</code> æ–¹æ³•å¯ä»¥æ¥å—ä»»ä½•å®ç°äº† <strong>Iterable</strong> æ¥å£çš„äº‹ç‰©ï¼ŒåŒ…æ‹¬è¯¸å¦‚ <strong>List</strong> è¿™æ ·çš„æ‰€æœ‰ <strong>Collection</strong> ç±»ã€‚ä½†æ˜¯å®ƒè¿˜å¯ä»¥æ¥å—å…¶ä»–ä»»ä½•äº‹ç‰©ï¼Œåªè¦èƒ½å¤Ÿä½¿è¿™äº›äº‹ç‰©æ˜¯ <strong>Iterable</strong> çš„â€”â€”ä¾‹å¦‚ï¼Œåœ¨ <code>main()</code> ä¸­ä½¿ç”¨ä¸‹é¢å®šä¹‰çš„ <strong>SimpleQueue</strong> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/SimpleQueue.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A different kind of Iterable collection</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleQueue</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;T&gt; storage = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span> </span>&#123; storage.offer(t); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> storage.poll(); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> storage.iterator();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚åå°„è§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥é‚£æ ·ä¼˜é›…ï¼Œæˆ‘ä»¬å¿…é¡»è§‚å¯Ÿåˆ°åå°„ï¼ˆå°½ç®¡åœ¨ Java çš„æœ€æ–°ç‰ˆæœ¬ä¸­å¾—åˆ°äº†æ˜¾ç€æ”¹è¿›ï¼‰é€šå¸¸æ¯”éåå°„å®ç°è¦æ…¢ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚ ä½†å®ƒä¸åº”é˜»æ­¢æ‚¨å°è¯•è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¾ç„¶æ˜¯å€¼å¾—è€ƒè™‘çš„ä¸€ç‚¹ã€‚</p><p>å‡ ä¹å¯ä»¥è‚¯å®šï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆä½¿ç”¨ Java 8 çš„å‡½æ•°å¼æ–¹æ³•ï¼Œå¹¶ä¸”åªæœ‰åœ¨è§£å†³äº†ç‰¹æ®Šéœ€æ±‚æ—¶æ‰è¯‰è¯¸åå°„ã€‚ è¿™é‡Œå¯¹ <strong>ApplyTest.java</strong> è¿›è¡Œäº†é‡å†™ï¼Œä»¥åˆ©ç”¨ Java 8 çš„æµå’Œå‡½æ•°å·¥å…·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/ApplyFunctional.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplyFunctional</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.of(</span><br><span class="line">          Stream.generate(Shape::<span class="keyword">new</span>).limit(<span class="number">2</span>),</span><br><span class="line">          Stream.generate(Square::<span class="keyword">new</span>).limit(<span class="number">2</span>))</span><br><span class="line">        .flatMap(c -&gt; c) <span class="comment">// flatten into one stream</span></span><br><span class="line">        .peek(Shape::rotate)</span><br><span class="line">        .forEach(s -&gt; s.resize(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> FilledList&lt;&gt;(Shape::<span class="keyword">new</span>, <span class="number">2</span>)</span><br><span class="line">          .forEach(Shape::rotate);</span><br><span class="line">        <span class="keyword">new</span> FilledList&lt;&gt;(Square::<span class="keyword">new</span>, <span class="number">2</span>)</span><br><span class="line">          .forEach(Shape::rotate);</span><br><span class="line"></span><br><span class="line">        SimpleQueue&lt;Shape&gt; shapeQ = Suppliers.fill(</span><br><span class="line">          <span class="keyword">new</span> SimpleQueue&lt;&gt;(), SimpleQueue::add,</span><br><span class="line">          Shape::<span class="keyword">new</span>, <span class="number">2</span>);</span><br><span class="line">        Suppliers.fill(shapeQ, SimpleQueue::add,</span><br><span class="line">          Square::<span class="keyword">new</span>, <span class="number">2</span>);</span><br><span class="line">        shapeQ.forEach(Shape::rotate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Shape 0 rotate</span></span><br><span class="line"><span class="comment">Shape 0 resize 7</span></span><br><span class="line"><span class="comment">Shape 1 rotate</span></span><br><span class="line"><span class="comment">Shape 1 resize 7</span></span><br><span class="line"><span class="comment">Square 2 rotate</span></span><br><span class="line"><span class="comment">Square 2 resize 7</span></span><br><span class="line"><span class="comment">Square 3 rotate</span></span><br><span class="line"><span class="comment">Square 3 resize 7</span></span><br><span class="line"><span class="comment">Shape 4 rotate</span></span><br><span class="line"><span class="comment">Shape 5 rotate</span></span><br><span class="line"><span class="comment">Square 6 rotate</span></span><br><span class="line"><span class="comment">Square 7 rotate</span></span><br><span class="line"><span class="comment">Shape 8 rotate</span></span><br><span class="line"><span class="comment">Shape 9 rotate</span></span><br><span class="line"><span class="comment">Square 10 rotate</span></span><br><span class="line"><span class="comment">Square 11 rotate</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨ Java 8ï¼Œå› æ­¤ä¸éœ€è¦ <code>Apply.apply()</code> ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆç”Ÿæˆä¸¤ä¸ª <strong>Stream</strong> ï¼š ä¸€ä¸ªæ˜¯ <strong>Shape</strong> ï¼Œä¸€ä¸ªæ˜¯ <strong>Square</strong> ï¼Œå¹¶å°†å®ƒä»¬å±•å¹³ä¸ºå•ä¸ªæµã€‚ å°½ç®¡ Java ç¼ºå°‘åŠŸèƒ½è¯­è¨€ä¸­ç»å¸¸å‡ºç°çš„ <code>flatten()</code> ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>flatMap(c-&gt; c)</code> äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œåè€…ä½¿ç”¨èº«ä»½æ˜ å°„å°†æ“ä½œç®€åŒ–ä¸ºâ€œ  <strong>flatten</strong> â€ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ <code>peek()</code> å½“åšå¯¹ <code>rotate()</code> çš„è°ƒç”¨ï¼Œå› ä¸º <code>peek()</code> æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼ˆæ­¤å¤„æ˜¯å‡ºäºå‰¯ä½œç”¨ï¼‰ï¼Œå¹¶åœ¨æœªæ›´æ”¹çš„æƒ…å†µä¸‹ä¼ é€’å¯¹è±¡ã€‚</p><p>æ³¨æ„ï¼Œä½¿ç”¨ <strong>FilledList</strong> å’Œ <strong>shapeQ</strong> è°ƒç”¨ <code>forEach()</code> æ¯” <code>Apply.apply()</code> ä»£ç æ•´æ´å¾—å¤šã€‚ åœ¨ä»£ç ç®€å•æ€§å’Œå¯è¯»æ€§æ–¹é¢ï¼Œç»“æœæ¯”ä»¥å‰çš„æ–¹æ³•å¥½å¾—å¤šã€‚ å¹¶ä¸”ï¼Œç°åœ¨ä¹Ÿä¸å¯èƒ½ä»  <code>main()</code> å¼•å‘å¼‚å¸¸ã€‚</p><!-- Assisted Latent Typing in Java 8 --><h2 id="Java8-ä¸­çš„è¾…åŠ©æ½œåœ¨ç±»å‹"><a href="#Java8-ä¸­çš„è¾…åŠ©æ½œåœ¨ç±»å‹" class="headerlink" title="Java8 ä¸­çš„è¾…åŠ©æ½œåœ¨ç±»å‹"></a>Java8 ä¸­çš„è¾…åŠ©æ½œåœ¨ç±»å‹</h2><p>å…ˆå‰å£°æ˜å…³äº Java ç¼ºä¹å¯¹æ½œåœ¨ç±»å‹çš„æ”¯æŒåœ¨ Java 8 ä¹‹å‰æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚ä½†æ˜¯ï¼ŒJava 8 ä¸­çš„éç»‘å®šæ–¹æ³•å¼•ç”¨ä½¿æˆ‘ä»¬èƒ½å¤Ÿäº§ç”Ÿä¸€ç§æ½œåœ¨ç±»å‹çš„å½¢å¼ï¼Œä»¥æ»¡è¶³åˆ›å»ºä¸€æ®µå¯å·¥ä½œåœ¨ä¸ç›¸å¹²ç±»å‹ä¸Šçš„ä»£ç ã€‚å› ä¸º Java æœ€åˆå¹¶ä¸æ˜¯å¦‚æ­¤è®¾è®¡ï¼Œæ‰€ä»¥ç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œæ¯”å…¶ä»–è¯­è¨€ä¸­è¦å°´å°¬ä¸€äº›ã€‚ä½†æ˜¯ï¼Œè‡³å°‘ç°åœ¨æˆä¸ºäº†å¯èƒ½ï¼Œåªæ˜¯ç¼ºä¹ä»¤äººæƒŠè‰³ä¹‹å¤„ã€‚</p><p>æˆ‘åœ¨å…¶ä»–åœ°æ–¹ä»æ²¡é‡è¿‡è¿™ç§æŠ€æœ¯ï¼Œå› æ­¤æˆ‘å°†å…¶ç§°ä¸ºè¾…åŠ©æ½œåœ¨ç±»å‹ã€‚</p><p>æˆ‘ä»¬å°†é‡å†™ <strong>DogsAndRobots.java</strong> æ¥æ¼”ç¤ºè¯¥æŠ€æœ¯ã€‚ ä¸ºä½¿å¤–è§‚çœ‹èµ·æ¥ä¸åŸå§‹ç¤ºä¾‹å°½å¯èƒ½ç›¸ä¼¼ï¼Œæˆ‘ä»…å‘æ¯ä¸ªåŸå§‹ç±»åæ·»åŠ äº† <strong>A</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/DogsAndRobotMethodReferences.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "Assisted Latent Typing"</span></span><br><span class="line"><span class="keyword">import</span> typeinfo.pets.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformingDogA</span> <span class="keyword">extends</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Woof!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Sitting"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reproduce</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Click!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sit</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"Clank!"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oilChange</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommunicateA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;P&gt; <span class="function"><span class="keyword">void</span> <span class="title">perform</span><span class="params">(P performer,</span></span></span><br><span class="line"><span class="function"><span class="params">      Consumer&lt;P&gt; action1, Consumer&lt;P&gt; action2)</span> </span>&#123;</span><br><span class="line">        action1.accept(performer);</span><br><span class="line">        action2.accept(performer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogsAndRobotMethodReferences</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CommunicateA.perform(<span class="keyword">new</span> PerformingDogA(),</span><br><span class="line">          PerformingDogA::speak, PerformingDogA::sit);</span><br><span class="line">        CommunicateA.perform(<span class="keyword">new</span> RobotA(),</span><br><span class="line">          RobotA::speak, RobotA::sit);</span><br><span class="line">        CommunicateA.perform(<span class="keyword">new</span> Mime(),</span><br><span class="line">          Mime::walkAgainstTheWind,</span><br><span class="line">          Mime::pushInvisibleWalls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Woof!</span></span><br><span class="line"><span class="comment">Sitting</span></span><br><span class="line"><span class="comment">Click!</span></span><br><span class="line"><span class="comment">Clank!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>PerformingDogA</strong> å’Œ <strong>RobotA</strong> ä¸ <strong>DogsAndRobots.java</strong> ä¸­çš„ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬ä¸ç»§æ‰¿é€šç”¨æ¥å£ <strong>Performs</strong> ï¼Œå› æ­¤å®ƒä»¬æ²¡æœ‰é€šç”¨æ€§ã€‚</p><p><code>CommunicateA.perform()</code> åœ¨æ²¡æœ‰çº¦æŸçš„ <strong>P</strong> ä¸Šç”Ÿæˆã€‚ åªè¦å¯ä»¥ä½¿ç”¨ <code>Consumer &lt;P&gt;</code>ï¼Œå®ƒåœ¨è¿™é‡Œå°±å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œè¿™äº› <code>Consumer&lt;P&gt;</code> ä»£è¡¨ä¸å¸¦å‚æ•°çš„ <strong>P</strong> æ–¹æ³•çš„æœªç»‘å®šæ–¹æ³•å¼•ç”¨ã€‚å½“æ‚¨è°ƒç”¨ <strong>Consumer</strong>  çš„ <code>accept()</code> æ–¹æ³•æ—¶ï¼Œå®ƒå°†æ–¹æ³•å¼•ç”¨ç»‘å®šåˆ°æ‰§è¡Œè€…å¯¹è±¡å¹¶è°ƒç”¨è¯¥æ–¹æ³•ã€‚ ç”±äº <a href="book/13-Functional-Programming.md">å‡½æ•°å¼ç¼–ç¨‹</a> ä¸€ç« ä¸­æè¿°çš„â€œé­”æœ¯â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»ä½•ç¬¦åˆç­¾åçš„æœªç»‘å®šæ–¹æ³•å¼•ç”¨ä¼ é€’ç»™ <code>CommunicateA.perform()</code> ã€‚</p><p>ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºâ€œè¾…åŠ©â€ï¼Œæ˜¯å› ä¸ºæ‚¨å¿…é¡»æ˜¾å¼åœ°ä¸º <code>perform()</code> æä¾›è¦ä½¿ç”¨çš„æ–¹æ³•å¼•ç”¨ã€‚ å®ƒä¸èƒ½åªæŒ‰åç§°è°ƒç”¨æ–¹æ³•ã€‚</p><p>å°½ç®¡ä¼ é€’æœªç»‘å®šçš„æ–¹æ³•å¼•ç”¨ä¼¼ä¹è¦èŠ±å¾ˆå¤šåŠ›æ°”ï¼Œä½†æ½œåœ¨ç±»å‹çš„æœ€ç»ˆç›®æ ‡è¿˜æ˜¯å¯ä»¥å®ç°çš„ã€‚ æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»£ç ç‰‡æ®µ <code>CommunicateA.perform()</code> ï¼Œè¯¥ä»£ç å¯ç”¨äºä»»ä½•å…·æœ‰ç¬¦åˆç­¾åçš„æ–¹æ³•å¼•ç”¨çš„ç±»å‹ã€‚ è¯·æ³¨æ„ï¼Œè¿™ä¸æˆ‘ä»¬çœ‹åˆ°çš„å…¶ä»–è¯­è¨€ä¸­çš„æ½œåœ¨ç±»å‹æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºè¿™äº›è¯­è¨€ä¸ä»…éœ€è¦ç­¾åä»¥ç¬¦åˆè§„èŒƒï¼Œè¿˜éœ€è¦æ–¹æ³•åç§°ã€‚ å› æ­¤ï¼Œè¯¥æŠ€æœ¯å¯ä»¥è¯´äº§ç”Ÿäº†æ›´å¤šçš„é€šç”¨ä»£ç ã€‚</p><p>ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘è¿˜ä» <strong>LatentReflection.java</strong> ä¸­å¼•å…¥äº† <strong>Mime</strong>ã€‚</p><h3 id="ä½¿ç”¨Suppliersç±»çš„é€šç”¨æ–¹æ³•"><a href="#ä½¿ç”¨Suppliersç±»çš„é€šç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨Suppliersç±»çš„é€šç”¨æ–¹æ³•"></a>ä½¿ç”¨<strong>Suppliers</strong>ç±»çš„é€šç”¨æ–¹æ³•</h3><p>é€šè¿‡è¾…åŠ©æ½œåœ¨ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æœ¬ç« å…¶ä»–éƒ¨åˆ†ä¸­ä½¿ç”¨çš„ <strong>Suppliers</strong> ç±»ã€‚ æ­¤ç±»åŒ…å«ä½¿ç”¨ç”Ÿæˆå™¨å¡«å…… <strong>Collection</strong> çš„å·¥å…·æ–¹æ³•ã€‚ æ³›åŒ–è¿™äº›æ“ä½œå¾ˆæœ‰æ„ä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Suppliers.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A utility to use with Suppliers</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Suppliers</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Create a collection and fill it:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, C extends Collection&lt;T&gt;&gt; C</span><br><span class="line">      create(Supplier&lt;C&gt; factory, Supplier&lt;T&gt; gen, <span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.generate(gen)</span><br><span class="line">            .limit(n)</span><br><span class="line">            .collect(factory, C::add, C::addAll);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Fill an existing collection:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, C extends Collection&lt;T&gt;&gt;</span><br><span class="line">      <span class="function">C <span class="title">fill</span><span class="params">(C coll, Supplier&lt;T&gt; gen, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        Stream.generate(gen)</span><br><span class="line">            .limit(n)</span><br><span class="line">            .forEach(coll::add);</span><br><span class="line">        <span class="keyword">return</span> coll;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Use an unbound method reference to</span></span><br><span class="line">    <span class="comment">// produce a more general method:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;H, A&gt; <span class="function">H <span class="title">fill</span><span class="params">(H holder,</span></span></span><br><span class="line"><span class="function"><span class="params">      BiConsumer&lt;H, A&gt; adder, Supplier&lt;A&gt; gen, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        Stream.generate(gen)</span><br><span class="line">            .limit(n)</span><br><span class="line">            .forEach(a -&gt; adder.accept(holder, a));</span><br><span class="line">        <span class="keyword">return</span> holder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>create()</code> ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>Collection</strong> å­ç±»å‹ï¼Œè€Œ <code>fill()</code> çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°†å…ƒç´ æ”¾å…¥ <strong>Collection</strong> çš„ç°æœ‰å­ç±»å‹ä¸­ã€‚ è¯·æ³¨æ„ï¼Œè¿˜ä¼šè¿”å›ä¼ å…¥çš„å®¹å™¨çš„ç¡®åˆ‡ç±»å‹ï¼Œå› æ­¤ä¸ä¼šä¸¢å¤±ç±»å‹ä¿¡æ¯ã€‚</p><p>å‰ä¸¤ç§æ–¹æ³•ä¸€èˆ¬éƒ½å—çº¦æŸï¼Œåªèƒ½ä¸ <strong>Collection</strong> å­ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚<code>fill()</code> çš„ç¬¬äºŒä¸ªç‰ˆæœ¬é€‚ç”¨äºä»»ä½•ç±»å‹çš„ <strong>holder</strong> ã€‚ å®ƒéœ€è¦ä¸€ä¸ªé™„åŠ å‚æ•°ï¼šæœªç»‘å®šæ–¹æ³•å¼•ç”¨ <code>adder. fill()</code> ï¼Œä½¿ç”¨è¾…åŠ©æ½œåœ¨ç±»å‹æ¥ä½¿å…¶ä¸ä»»ä½•å…·æœ‰æ·»åŠ å…ƒç´ æ–¹æ³•çš„ <strong>holder</strong> ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚å› ä¸ºæ­¤æœªç»‘å®šæ–¹æ³• <strong>adder</strong> å¿…é¡»å¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆè¦æ·»åŠ åˆ° <strong>holder</strong> çš„å…ƒç´ ï¼‰ï¼Œæ‰€ä»¥ <strong>adder</strong> å¿…é¡»æ˜¯ <code>BiConsumer &lt;Hï¼ŒA&gt;</code> ï¼Œå…¶ä¸­ <strong>H</strong> æ˜¯è¦ç»‘å®šåˆ°çš„ <strong>holder</strong> å¯¹è±¡çš„ç±»å‹ï¼Œè€Œ <strong>A</strong> æ˜¯è¦è¢«æ·»åŠ çš„ç»‘å®šå…ƒç´ ç±»å‹ã€‚ å¯¹ <code>accept()</code> çš„è°ƒç”¨å°†ä½¿ç”¨å‚æ•° a è°ƒç”¨å¯¹è±¡ <strong>holder</strong> ä¸Šçš„æœªç»‘å®šæ–¹æ³• <strong>holder</strong>ã€‚</p><p>åœ¨ä¸€ä¸ªç¨ä½œæ¨¡æ‹Ÿçš„æµ‹è¯•ä¸­å¯¹ <strong>Suppliers</strong> å·¥å…·ç¨‹åºè¿›è¡Œäº†æµ‹è¯•ï¼Œè¯¥ä»¿çœŸè¿˜ä½¿ç”¨äº†æœ¬ç« å‰é¢å®šä¹‰çš„ <strong>RandomList</strong> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generics/BankTeller.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A very simple bank teller simulation</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Customer "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Teller "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bank</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;BankTeller&gt; tellers =</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(BankTeller bt)</span> </span>&#123;</span><br><span class="line">        tellers.add(bt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BankTeller</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serve</span><span class="params">(Teller t, Customer c)</span> </span>&#123;</span><br><span class="line">        System.out.println(t + <span class="string">" serves "</span> + c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Demonstrate create():</span></span><br><span class="line">        RandomList&lt;Teller&gt; tellers =</span><br><span class="line">            Suppliers.create(</span><br><span class="line">            RandomList::<span class="keyword">new</span>, Teller::<span class="keyword">new</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// Demonstrate fill():</span></span><br><span class="line">        List&lt;Customer&gt; customers = Suppliers.fill(</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;(), Customer::<span class="keyword">new</span>, <span class="number">12</span>);</span><br><span class="line">        customers.forEach(c -&gt;</span><br><span class="line">            serve(tellers.select(), c));</span><br><span class="line">        <span class="comment">// Demonstrate assisted latent typing:</span></span><br><span class="line">        Bank bank = Suppliers.fill(</span><br><span class="line">            <span class="keyword">new</span> Bank(), Bank::put, BankTeller::<span class="keyword">new</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// Can also use second version of fill():</span></span><br><span class="line">        List&lt;Customer&gt; customers2 = Suppliers.fill(</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;(),</span><br><span class="line">            List::add, Customer::<span class="keyword">new</span>, <span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Teller 3 serves Customer 1</span></span><br><span class="line"><span class="comment">Teller 2 serves Customer 2</span></span><br><span class="line"><span class="comment">Teller 3 serves Customer 3</span></span><br><span class="line"><span class="comment">Teller 1 serves Customer 4</span></span><br><span class="line"><span class="comment">Teller 1 serves Customer 5</span></span><br><span class="line"><span class="comment">Teller 3 serves Customer 6</span></span><br><span class="line"><span class="comment">Teller 1 serves Customer 7</span></span><br><span class="line"><span class="comment">Teller 2 serves Customer 8</span></span><br><span class="line"><span class="comment">Teller 3 serves Customer 9</span></span><br><span class="line"><span class="comment">Teller 3 serves Customer 10</span></span><br><span class="line"><span class="comment">Teller 2 serves Customer 11</span></span><br><span class="line"><span class="comment">Teller 4 serves Customer 12</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° <code>create()</code> ç”Ÿæˆä¸€ä¸ªæ–°çš„ <strong>Collection</strong> å¯¹è±¡ï¼Œè€Œ <code>fill()</code> æ·»åŠ åˆ°ç°æœ‰ <strong>Collection</strong> ä¸­ã€‚ç¬¬äºŒä¸ªç‰ˆæœ¬<code>fill()</code> æ˜¾ç¤ºï¼Œå®ƒä¸ä»…ä¸æ— å…³çš„æ–°ç±»å‹ <strong>Bank</strong> ä¸€èµ·ä½¿ç”¨ï¼Œè¿˜èƒ½ä¸ <strong>List</strong> ä¸€èµ·ä½¿ç”¨ã€‚å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œ<code>fill()</code> çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åœ¨æŠ€æœ¯ä¸Šä¸æ˜¯å¿…éœ€çš„ï¼Œä½†åœ¨ä½¿ç”¨ <strong>Collection</strong> æ—¶æä¾›äº†è¾ƒçŸ­çš„è¯­æ³•ã€‚</p><!-- Summary: Is Casting Really So Bad? --><h2 id="æ€»ç»“ï¼šç±»å‹è½¬æ¢çœŸçš„å¦‚æ­¤ä¹‹ç³Ÿå—ï¼Ÿ"><a href="#æ€»ç»“ï¼šç±»å‹è½¬æ¢çœŸçš„å¦‚æ­¤ä¹‹ç³Ÿå—ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šç±»å‹è½¬æ¢çœŸçš„å¦‚æ­¤ä¹‹ç³Ÿå—ï¼Ÿ"></a>æ€»ç»“ï¼šç±»å‹è½¬æ¢çœŸçš„å¦‚æ­¤ä¹‹ç³Ÿå—ï¼Ÿ</h2><p>è‡ªä» C++ æ¨¡ç‰ˆå‡ºç°ä»¥æ¥ï¼Œæˆ‘å°±ä¸€ç›´åœ¨è‡´åŠ›äºè§£é‡Šå®ƒï¼Œæˆ‘å¯èƒ½æ¯”å¤§å¤šæ•°äººéƒ½æ›´æ—©åœ°æå‡ºäº†ä¸‹é¢çš„è®ºç‚¹ã€‚ç›´åˆ°æœ€è¿‘ï¼Œæˆ‘æ‰åœä¸‹æ¥ï¼Œå»æ€è€ƒè¿™ä¸ªè®ºç‚¹åˆ°åº•åœ¨å¤šå°‘æ—¶é—´å†…æ˜¯æœ‰æ•ˆçš„â€”â€”æˆ‘å°†è¦æè¿°çš„é—®é¢˜åˆ°åº•æœ‰å¤šå°‘æ¬¡å¯ä»¥ç©¿è¶Šéšœç¢å¾—ä»¥è§£å†³ã€‚</p><p>è¿™ä¸ªè®ºç‚¹å°±æ˜¯ï¼šä½¿ç”¨æ³›å‹ç±»å‹æœºåˆ¶çš„æœ€å¸å¼•äººçš„åœ°æ–¹ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨é›†åˆç±»çš„åœ°æ–¹ï¼Œè¿™äº›ç±»åŒ…æ‹¬è¯¸å¦‚å„ç§ <strong>List</strong> ã€å„ç§ <strong>Set</strong> ã€å„ç§ <strong>Map</strong> ç­‰æˆ‘ä»¬åœ¨ <a href="book/12-Collections.md">é›†åˆ</a> å’Œ <a href="book/Appendix-Collection-Topics.md">é™„å½•ï¼šé›†åˆä¸»é¢˜</a> è¿™ä¸¤ç« æ‰€è§ã€‚åœ¨ Java 5 ä¹‹å‰ï¼Œå½“æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡æ”¾ç½®åˆ°é›†åˆä¸­æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«å‘ä¸Šè½¬å‹ä¸º <strong>Object</strong> ï¼Œå› æ­¤æˆ‘ä»¬ä¼šä¸¢å¤±ç±»å‹ä¿¡æ¯ã€‚å½“æˆ‘ä»¬æƒ³è¦å°†è¿™ä¸ªå¯¹è±¡ä»é›†åˆä¸­å–å›ï¼Œç”¨å®ƒå»æ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¿…é¡»å°†å…¶å‘ä¸‹è½¬å‹å›æ­£ç¡®çš„ç±»å‹ã€‚æˆ‘ç”¨çš„ç¤ºä¾‹æ˜¯æŒæœ‰ <strong>Cat</strong> çš„ <strong>List</strong> ï¼ˆè¿™ä¸ªç¤ºä¾‹çš„ä¸€ç§ä½¿ç”¨è‹¹æœå’Œæ¡”å­çš„å˜ä½“åœ¨ <a href="book/12-Collections.md">é›†åˆ</a> ç« èŠ‚çš„å¼€å¤´å±•ç¤ºè¿‡ï¼‰ã€‚å¦‚æœæ²¡æœ‰ Java 5 æ³›å‹ç‰ˆæœ¬çš„é›†åˆï¼Œæˆ‘ä»¬æ”¾åˆ°å®¹é›†é‡Œå’Œä»é›†åˆä¸­å–å›çš„éƒ½æ˜¯ <strong>Object</strong> ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¼šå°†ä¸€ä¸ª <strong>Dog</strong> æ”¾ç½®åˆ° <strong>Cat</strong> çš„ <strong>List</strong> ä¸­ã€‚</p><p>ä½†æ˜¯ï¼Œæ³›å‹å‡ºç°ä¹‹å‰çš„ Java å¹¶ä¸ä¼šè®©æˆ‘ä»¬è¯¯ç”¨æ”¾å…¥åˆ°é›†åˆä¸­çš„å¯¹è±¡ã€‚å¦‚æœå°†ä¸€ä¸ª <strong>Dog</strong> æ‰”åˆ° <strong>Cat</strong> çš„é›†åˆä¸­ï¼Œå¹¶ä¸”è¯•å›¾å°†è¿™ä¸ªé›†åˆä¸­çš„æ‰€æœ‰ä¸œè¥¿éƒ½å½“ä½œ <strong>Cat</strong> å¤„ç†ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä»è¿™ä¸ª <strong>Cat</strong> é›†åˆä¸­å–å›é‚£ä¸ª <strong>Dog</strong> å¼•ç”¨ï¼Œå¹¶è¯•å›¾å°†å…¶è½¬å‹ä¸º <strong>Cat</strong> æ—¶ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ª <strong>RuntimeException</strong> ã€‚æˆ‘ä»¬ä»æ—§å¯ä»¥å‘ç°é—®é¢˜ï¼Œä½†æ˜¯æ˜¯åœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æœŸå‘ç°å®ƒçš„ã€‚</p><p>åœ¨æœ¬ä¹¦ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘æ›¾ç»è¯´è¿‡ï¼š</p><blockquote><p>è¿™ä¸æ­¢ä»¤äººæ¼ç«ï¼Œå®ƒè¿˜å¯èƒ½ä¼šäº§ç”Ÿéš¾ä»¥å‘ç°çš„ç¼ºé™·ã€‚å¦‚æœè¿™ä¸ªç¨‹åºçš„æŸä¸ªéƒ¨åˆ†ï¼ˆæˆ–æ•°ä¸ªéƒ¨åˆ†ï¼‰å‘é›†åˆä¸­æ’å…¥äº†å¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡å¼‚å¸¸ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºçš„å¦ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ä¸­å‘ç°æœ‰ä¸è‰¯å¯¹è±¡è¢«æ”¾ç½®åˆ°äº†é›†åˆä¸­ï¼Œé‚£ä¹ˆå¿…é¡»å‘ç°è¿™ä¸ªä¸è‰¯æ’å…¥åˆ°åº•æ˜¯åœ¨ä½•å¤„å‘ç”Ÿçš„ã€‚</p></blockquote><p>ä½†æ˜¯ï¼Œéšç€å¯¹è¿™ä¸ªè®ºç‚¹çš„è¿›ä¸€æ­¥æ£€æŸ¥ï¼Œæˆ‘å¼€å§‹æ€€ç–‘å®ƒäº†ã€‚é¦–å…ˆï¼Œè¿™ä¼šå¤šä¹ˆé¢‘ç¹åœ°å‘ç”Ÿå‘¢ï¼Ÿæˆ‘è®°å¾—è¿™ç±»äº‹æƒ…ä»æœªå‘ç”Ÿåœ¨æˆ‘èº«ä¸Šï¼Œå¹¶ä¸”å½“æˆ‘åœ¨ä¼šè®®ä¸Šè¯¢é—®å…¶ä»–äººæ—¶ï¼Œæˆ‘ä¹Ÿä»æ¥æ²¡æœ‰å¬è¯´è¿‡æœ‰äººç¢°ä¸Šè¿‡ã€‚å¦ä¸€æœ¬ä¹¦ä½¿ç”¨äº†ä¸€ä¸ªç§°ä¸º <strong>files</strong> çš„ list ç¤ºä¾‹ï¼Œå®ƒåŒ…å« <strong>String</strong> å¯¹è±¡ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå‘ <strong>files</strong> ä¸­æ·»åŠ ä¸€ä¸ª <strong>File</strong> å¯¹è±¡çœ‹èµ·æ¥ç›¸å½“è‡ªç„¶ï¼Œå› æ­¤è¿™ä¸ªå¯¹è±¡çš„åå­—å¯èƒ½å« <strong>fileNames</strong> æ›´å¥½ã€‚æ— è®º Java æä¾›äº†å¤šå°‘ç±»å‹æ£€æŸ¥ï¼Œä»æ—§å¯èƒ½ä¼šå†™å‡ºæ™¦æ¶©çš„ç¨‹åºï¼Œè€Œç¼–å†™å·®åŠ²å„¿çš„ç¨‹åºå³ä¾¿å¯ä»¥ç¼–è¯‘ï¼Œå®ƒä»æ—§æ˜¯ç¼–å†™å·®åŠ²å„¿çš„ç¨‹åºã€‚å¯èƒ½å¤§å¤šæ•°äººéƒ½ä¼šä½¿ç”¨å‘½åè‰¯å¥½çš„é›†åˆï¼Œä¾‹å¦‚ <strong>cats</strong> ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å‘è¯•å›¾æ·»åŠ é <strong>Cat</strong> å¯¹è±¡çš„ç¨‹åºå‘˜æä¾›å¯è§†çš„è­¦å‘Šã€‚å¹¶ä¸”å³ä¾¿è¿™ç±»äº‹æƒ…å‘ç”Ÿäº†ï¼Œå®ƒçœŸæ­£åˆèƒ½æ½œä¼å¤šä¹…å‘¢ï¼Ÿåªè¦æˆ‘ä»¬å¼€å§‹ç”¨çœŸå®æ•°æ®æ¥è¿è¡Œæµ‹è¯•ï¼Œå°±ä¼šéå¸¸å¿«åœ°çœ‹åˆ°å¼‚å¸¸ã€‚</p><p>æœ‰ä¸€ä½ä½œè€…ç”šè‡³æ–­è¨€ï¼Œè¿™æ ·çš„ç¼ºé™·å°†â€œ<em>æ½œä¼æ•°å¹´</em>â€ã€‚ä½†æ˜¯æˆ‘ä¸è®°å¾—æœ‰ä»»ä½•å¤§é‡çš„ç›¸å…³æŠ¥å‘Šï¼Œæ¥è¯´æ˜äººä»¬åœ¨æŸ¥æ‰¾â€œç‹—åœ¨çŒ«åˆ—è¡¨ä¸­â€è¿™ç±»ç¼ºé™·æ—¶å›°éš¾é‡é‡ï¼Œæˆ–è€…æ˜¯è¯´æ˜äººä»¬ä¼šéå¸¸é¢‘ç¹åœ°äº§ç”Ÿè¿™ç§é”™è¯¯ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°†åœ¨ <a href="book/24-Concurrent-Programming.md">å¤šçº¿ç¨‹ç¼–ç¨‹</a> ç« èŠ‚ä¸­çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ—¶ï¼Œå‡ºç°é‚£äº›å¯èƒ½çœ‹èµ·æ¥æç½•è§çš„ç¼ºé™·ï¼Œæ˜¯å¾ˆå¯»å¸¸å¹¶å®¹æ˜“å‘ç”Ÿçš„äº‹ï¼Œè€Œä¸”ï¼Œå¯¹äºåˆ°åº•å‡ºäº†ä»€ä¹ˆé”™ï¼Œè¿™äº›ç¼ºé™·åªèƒ½ç»™æˆ‘ä»¬ä¸€ä¸ªå¾ˆæ¨¡ç³Šçš„æ¦‚å¿µã€‚å› æ­¤ï¼Œå¯¹äºæ³›å‹æ˜¯æ·»åŠ åˆ° Java ä¸­çš„éå¸¸æ˜¾è‘—å’Œç›¸å½“å¤æ‚çš„ç‰¹æ€§è¿™ä¸€ç‚¹ï¼Œâ€œç‹—åœ¨çŒ«åˆ—è¡¨ä¸­â€è¿™ä¸ªè®ºæ®çœŸçš„èƒ½å¤Ÿæˆä¸ºå®ƒçš„ç†ç”±å—ï¼Ÿ<br>æˆ‘ç›¸ä¿¡è¢«ç§°ä¸º<em>æ³›å‹</em>çš„é€šç”¨è¯­è¨€ç‰¹æ€§ï¼ˆå¹¶éå¿…é¡»æ˜¯å…¶åœ¨ Java ä¸­çš„ç‰¹å®šå®ç°ï¼‰çš„ç›®çš„åœ¨äºå¯è¡¨è¾¾æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºäº†åˆ›å»ºç±»å‹å®‰å…¨çš„é›†åˆã€‚ç±»å‹å®‰å…¨çš„é›†åˆæ˜¯èƒ½å¤Ÿåˆ›å»ºæ›´é€šç”¨ä»£ç è¿™ä¸€èƒ½åŠ›æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚<br>å› æ­¤ï¼Œå³ä¾¿â€œç‹—åœ¨çŒ«åˆ—è¡¨ä¸­â€è¿™ä¸ªè®ºæ®ç»å¸¸è¢«ç”¨æ¥è¯æ˜æ³›å‹æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯å®ƒä»æ—§æ˜¯æœ‰é—®é¢˜çš„ã€‚å°±åƒæˆ‘åœ¨æœ¬ç« å¼€å¤´å£°ç§°çš„ï¼Œæˆ‘ä¸ç›¸ä¿¡è¿™å°±æ˜¯æ³›å‹è¿™ä¸ªæ¦‚å¿µçœŸæ­£çš„å«ä¹‰ã€‚ç›¸åï¼Œæ³›å‹æ­£å¦‚å…¶åç§°æ‰€æš—ç¤ºçš„ï¼šå®ƒæ˜¯ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å®ƒå¯ä»¥ç¼–å†™å‡ºæ›´â€œæ³›åŒ–â€çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯¹äºå®ƒä»¬èƒ½å¤Ÿä½œç”¨çš„ç±»å‹å…·æœ‰æ›´å°‘çš„é™åˆ¶ï¼Œå› æ­¤å•ä¸ªçš„ä»£ç æ®µå¯ä»¥åº”ç”¨åˆ°æ›´å¤šçš„ç±»å‹ä¸Šã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æœ¬ç« ä¸­çœ‹åˆ°çš„ï¼Œç¼–å†™çœŸæ­£æ³›åŒ–çš„â€œæŒæœ‰å™¨â€ç±»ï¼ˆ Java çš„å®¹å™¨å°±æ˜¯è¿™ç§ç±»ï¼‰ç›¸å½“ç®€å•ï¼Œä½†æ˜¯ç¼–å†™å‡ºèƒ½å¤Ÿæ“ä½œå…¶æ³›å‹ç±»å‹çš„æ³›åŒ–ä»£ç å°±éœ€è¦é¢å¤–çš„åŠªåŠ›äº†ï¼Œè¿™äº›åŠªåŠ›éœ€è¦ç±»åˆ›å»ºè€…å’Œç±»æ¶ˆè´¹è€…å…±åŒä»˜å‡ºï¼Œä»–ä»¬å¿…é¡»ç†è§£è¿™äº›ä»£ç çš„æ¦‚å¿µå’Œå®ç°ã€‚è¿™äº›é¢å¤–çš„åŠªåŠ›ä¼šå¢åŠ ä½¿ç”¨è¿™ç§ç‰¹æ€§çš„éš¾åº¦ï¼Œå¹¶å¯èƒ½ä¼šå› æ­¤è€Œä½¿å…¶åœ¨æŸäº›åœºåˆç¼ºä¹å¯åº”ç”¨æ€§ï¼Œè€Œåœ¨è¿™äº›åœºåˆä¸­ï¼Œå®ƒå¯èƒ½ä¼šå¸¦æ¥é™„åŠ çš„ä»·å€¼ã€‚</p><p>è¿˜è¦æ³¨æ„åˆ°ï¼Œå› ä¸ºæ³›å‹æ˜¯åæ¥æ·»åŠ åˆ° Java ä¸­ï¼Œè€Œä¸æ˜¯ä»ä¸€å¼€å§‹å°±è®¾è®¡åˆ°è¿™ç§è¯­è¨€ä¸­çš„ï¼Œæ‰€ä»¥æŸäº›å®¹å™¨æ— æ³•è¾¾åˆ°å®ƒä»¬åº”è¯¥å…·å¤‡çš„å¥å£®æ€§ã€‚ä¾‹å¦‚ï¼Œè§‚å¯Ÿä¸€ä¸‹ <strong>Map</strong> ï¼Œåœ¨ç‰¹å®šçš„æ–¹æ³• <code>containsKey(Object key)</code>å’Œ <code>get(Object key)</code> ä¸­å°±åŒ…å«è¿™ç±»æƒ…å†µã€‚å¦‚æœè¿™äº›ç±»æ˜¯ä½¿ç”¨åœ¨å®ƒä»¬ä¹‹å‰å°±å­˜åœ¨çš„æ³›å‹è®¾è®¡çš„ï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•å°†ä¼šä½¿ç”¨å‚æ•°åŒ–ç±»å‹è€Œä¸æ˜¯ <strong>Object</strong> ï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥æä¾›è¿™äº›æ³›å‹å‡è®¾ä¼šæä¾›çš„ç¼–è¯‘æœŸæ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ C++ çš„ <strong>map</strong> ä¸­ï¼Œé”®çš„ç±»å‹æ€»æ˜¯åœ¨ç¼–è¯‘æœŸæ£€æŸ¥çš„ã€‚</p><p>æœ‰ä¸€ä»¶äº‹å¾ˆæ˜æ˜¾ï¼šåœ¨ä¸€ç§è¯­è¨€å·²ç»è¢«å¹¿æ³›åº”ç”¨ä¹‹åï¼Œåœ¨å…¶è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­å¼•å…¥ä»»ä½•ç§ç±»çš„æ³›å‹æœºåˆ¶ï¼Œéƒ½ä¼šæ˜¯ä¸€é¡¹éå¸¸éå¸¸æ£˜æ‰‹çš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ˜¯ä¸€é¡¹ä¸ä»˜å‡ºè‰°è¾›å°±æ— æ³•å®Œæˆçš„ä»»åŠ¡ã€‚åœ¨ C++ ä¸­ï¼Œæ¨¡ç‰ˆæ˜¯åœ¨å…¶æœ€åˆçš„ ISO ç‰ˆæœ¬ä¸­å°±å¼•å…¥çš„ï¼ˆå³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿå¼•å‘äº†é˜µç—›ï¼Œå› ä¸ºåœ¨ç¬¬ä¸€ä¸ªæ ‡å‡† C++ å‡ºç°ä¹‹å‰ï¼Œæœ‰å¾ˆå¤šéæ¨¡ç‰ˆç‰ˆæœ¬åœ¨ä½¿ç”¨ï¼‰ï¼Œå› æ­¤å®é™…ä¸Šæ¨¡ç‰ˆä¸€ç›´éƒ½æ˜¯è¿™ç§è¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Java ä¸­ï¼Œæ³›å‹æ˜¯åœ¨è¿™ç§è¯­è¨€é¦–æ¬¡å‘å¸ƒå¤§çº¦ 10 å¹´ä¹‹åæ‰å¼•å…¥çš„ï¼Œå› æ­¤å‘æ³›å‹è¿ç§»çš„é—®é¢˜ç‰¹åˆ«å¤šï¼Œå¹¶ä¸”å¯¹æ³›å‹çš„è®¾è®¡äº§ç”Ÿäº†æ˜æ˜¾çš„å½±å“ã€‚å…¶ç»“æœå°±æ˜¯ï¼Œç¨‹åºå‘˜å°†æ‰¿å—è¿™äº›ç—›è‹¦ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½æ˜¯ç”±äº Java è®¾è®¡è€…åœ¨è®¾è®¡ 1.0 ç‰ˆæœ¬æ—¶æ‰€è¡¨ç°å‡ºæ¥çš„çŸ­è§†é€ æˆçš„ã€‚å½“ Java æœ€åˆè¢«åˆ›å»ºæ—¶ï¼Œå®ƒçš„è®¾è®¡è€…ä»¬å½“ç„¶äº†è§£ C++ çš„æ¨¡ç‰ˆï¼Œä»–ä»¬ç”šè‡³è€ƒè™‘å°†å…¶å›Šæ‹¬åˆ° Java è¯­è¨€ä¸­ï¼Œä½†æ˜¯å‡ºäºè¿™æ ·æˆ–é‚£æ ·çš„åŸå› ï¼Œä»–ä»¬å†³å®šå°†æ¨¡ç‰ˆæ’é™¤åœ¨å¤–ï¼ˆå…¶è¿¹è±¡å°±æ˜¯ä»–ä»¬è¿‡äºåŒ†å¿™ï¼‰ã€‚å› æ­¤ï¼Œ Java è¯­è¨€å’Œä½¿ç”¨å®ƒçš„ç¨‹åºå‘˜éƒ½å°†æ‰¿å—è¿™äº›ç—›è‹¦ã€‚åªæœ‰æ—¶é—´å°†ä¼šè¯´æ˜ Java çš„æ³›å‹æ–¹å¼å¯¹è¿™ç§è¯­è¨€æ‰€é€ æˆçš„æœ€ç»ˆå½±å“ã€‚<br>æŸäº›è¯­è¨€ï¼Œå·²ç»èå…¥äº†æ›´ç®€æ´ã€å½±å“æ›´å°çš„æ–¹å¼ï¼Œæ¥å®ç°å‚æ•°åŒ–ç±»å‹ã€‚æˆ‘ä»¬ä¸å¯èƒ½ä¸å»æƒ³è±¡è¿™æ ·çš„è¯­è¨€å°†ä¼šæˆä¸º Java çš„ç»§ä»»è€…ï¼Œå› ä¸ºå®ƒä»¬é‡‡ç”¨çš„æ–¹å¼ï¼Œä¸ C++ é€šè¿‡ C æ¥å®ç°çš„æ–¹å¼ç›¸åŒï¼šæŒ‰åŸæ ·ä½¿ç”¨å®ƒï¼Œç„¶åå¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚</p><h2 id="è¿›é˜¶é˜…è¯»"><a href="#è¿›é˜¶é˜…è¯»" class="headerlink" title="è¿›é˜¶é˜…è¯»"></a>è¿›é˜¶é˜…è¯»</h2><p>æ³›å‹çš„å…¥é—¨æ–‡æ¡£æ˜¯ ã€ŠGenerics in the Java Programming Languageã€‹ï¼Œä½œè€…æ˜¯ Gilad Brachaï¼Œå¯ä»¥ä» <a href="http://java.oracle.com" target="_blank" rel="noopener">http://java.oracle.com</a> è·å–ã€‚</p><p>Angelika Langer çš„ã€ŠJava Generics FAQsã€‹æ˜¯ä¸€ä»½éå¸¸æœ‰å¸®åŠ©çš„èµ„æ–™ï¼Œå¯ä»¥ä» <a href="http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html" target="_blank" rel="noopener">http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html</a> è·å–ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä» ã€ŠAdding Wildcards to the Java Programming Languageã€‹ä¸­å­¦åˆ°æ›´å¤šå…³äºé€šé…ç¬¦çš„çŸ¥è¯†ï¼Œä½œè€…æ˜¯ Torgersonã€Ernstã€Hansenã€von der Aheã€Bracha å’Œ Gafterï¼Œåœ°å€æ˜¯ <a href="http://www.jot.fm/issues/issue_2004_12/article5ã€‚" target="_blank" rel="noopener">http://www.jot.fm/issues/issue_2004_12/article5ã€‚</a></p><p>Neal After å¯¹äº Java é—®é¢˜ï¼ˆå°¤å…¶æ˜¯æ“¦é™¤ï¼‰çš„çœ‹æ³•å¯ä»¥ä»è¿™é‡Œæ‰¾åˆ°ï¼š<a href="http://www.infoq.com/articles/neal-gafter-on-javaã€‚" target="_blank" rel="noopener">http://www.infoq.com/articles/neal-gafter-on-javaã€‚</a></p><!-- åˆ†é¡µ --><div style="page-break-after: always;"></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥å£å’ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§å°†æ¥å£ä¸å®ç°åˆ†ç¦»çš„æ›´åŠ ç»“æ„åŒ–çš„æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="2020å¹´6æœˆ" scheme="http://yoursite.com/categories/2020%E5%B9%B46%E6%9C%88/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
</feed>
